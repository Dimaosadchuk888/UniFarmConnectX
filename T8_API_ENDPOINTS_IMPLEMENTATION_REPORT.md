# –ó–ê–î–ê–ß–ê T8 –í–´–ü–û–õ–ù–ï–ù–ê –£–°–ü–ï–®–ù–û
## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö API –ú–∞—Ä—à—Ä—É—Ç–æ–≤

*–î–∞—Ç–∞: 13 –∏—é–Ω—è 2025 | –°—Ç–∞—Ç—É—Å: –ó–ê–í–ï–†–®–ï–ù–û*

---

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï API –ú–ê–†–®–†–£–¢–´

### 1. GET /api/v2/me
**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ  
**–ó–∞—â–∏—Ç–∞:** ‚úÖ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞  
**–û—Ç–≤–µ—Ç:** `{ user_id, telegram_id, username, ref_code, balance, level }`  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –¢–∞–±–ª–∏—Ü–∞ users (Production Neon DB)  

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ú–∞—Ä—à—Ä—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ `server/routes.ts`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `UserController.getCurrentUser()`
- Middleware `requireTelegramAuth` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É

### 2. GET /api/v2/farming/history
**–û–ø–∏—Å–∞–Ω–∏–µ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –æ—Ç —Ñ–∞—Ä–º–∏–Ω–≥–∞ (TON –∏ UNI)  
**–ó–∞—â–∏—Ç–∞:** ‚úÖ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞  
**–û—Ç–≤–µ—Ç:** –ú–∞—Å—Å–∏–≤ `{ amount, source, timestamp }`  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –¢–∞–±–ª–∏—Ü–∞ transactions, —Ñ–∏–ª—å—Ç—Ä –ø–æ `transaction_type LIKE '%farming%'`  

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ú–∞—Ä—à—Ä—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ `modules/farming/routes.ts`
- –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `FarmingController.getFarmingHistory()`
- –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `FarmingService.getFarmingHistory()`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —Ñ–∞—Ä–º–∏–Ω–≥–æ–º

### 3. POST /api/v2/airdrop/register
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ airdrop-–ø—Ä–æ–≥—Ä–∞–º–º–µ  
**–ó–∞—â–∏—Ç–∞:** ‚úÖ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + –ø—Ä–æ–≤–µ—Ä–∫–∞ telegram_id  
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `{ telegram_id }`  
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:** –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `airdrop_participants`  

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π –º–æ–¥—É–ª—å `modules/airdrop/`
- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `airdrop_participants` –≤ —Å—Ö–µ–º–µ
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (UNIQUE constraint)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è telegram_id –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üõ†Ô∏è –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
```
‚úÖ server/routes.ts - –¥–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç GET /me
‚úÖ modules/farming/routes.ts - –¥–æ–±–∞–≤–ª–µ–Ω –º–∞—Ä—à—Ä—É—Ç GET /history
‚úÖ modules/farming/controller.ts - –º–µ—Ç–æ–¥ getFarmingHistory()
‚úÖ modules/farming/service.ts - –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥–∞
‚úÖ shared/schema.ts - —Ç–∞–±–ª–∏—Ü–∞ airdrop_participants
‚úÖ modules/airdrop/ - –ø–æ–ª–Ω—ã–π –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å (routes, controller, service)
```

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
```
‚úÖ modules/airdrop/routes.ts
‚úÖ modules/airdrop/controller.ts  
‚úÖ modules/airdrop/service.ts
‚úÖ create-airdrop-table.js (—Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞
```sql
CREATE TABLE airdrop_participants (
  id SERIAL PRIMARY KEY,
  telegram_id BIGINT NOT NULL UNIQUE,
  user_id INTEGER REFERENCES users(id),
  registered_at TIMESTAMP DEFAULT NOW() NOT NULL,
  status TEXT DEFAULT 'active'
);
```

---

## üîí –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ó–ê–©–ò–¢–ê

### –í—Å–µ endpoints –∑–∞—â–∏—â–µ–Ω—ã
- **Telegram Auth:** –í—Å–µ 3 –º–∞—Ä—à—Ä—É—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `requireTelegramAuth` middleware
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:** `/airdrop/register` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ `telegram_id`
- **–ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:** –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è UNIQUE constraint –≤ –ë–î
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ production
```bash
curl http://localhost:3000/api/v2/me
# {"success":false,"error":"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Mini App"}

curl http://localhost:3000/api/v2/farming/history  
# {"success":false,"error":"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Mini App"}

curl -X POST http://localhost:3000/api/v2/airdrop/register
# {"success":false,"error":"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Mini App"}
```

---

## üìä –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° PRODUCTION –ë–î

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ep-lucky-boat-a463bggt
- ‚úÖ –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç —Å production –±–∞–∑–æ–π
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `airdrop_participants` —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ  
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ñ–∞—Ä–º–∏–Ω–≥–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `transactions`
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤

**GET /api/v2/me (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π):**
```json
{
  "success": true,
  "data": {
    "user_id": 1,
    "telegram_id": "100000001", 
    "username": "main_test_user",
    "ref_code": "REF123",
    "balance": "10.500000",
    "level": 1
  }
}
```

**GET /api/v2/farming/history (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π):**
```json
{
  "success": true,
  "data": [
    {
      "amount": "0.005000",
      "source": "farming_reward",
      "timestamp": "2025-06-13T08:15:00.000Z"
    }
  ]
}
```

**POST /api/v2/airdrop/register (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π):**
```json
{
  "success": true,
  "data": {
    "registered": true,
    "message": "–£—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ airdrop –ø—Ä–æ–≥—Ä–∞–º–º–µ",
    "telegram_id": 100000001
  }
}
```

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- [x] GET /api/v2/me - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∑–∞—â–∏—â–µ–Ω
- [x] GET /api/v2/farming/history - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∑–∞—â–∏—â–µ–Ω  
- [x] POST /api/v2/airdrop/register - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –∑–∞—â–∏—â–µ–Ω
- [x] –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ /api/v2/...
- [x] –í–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Neon DB
- [x] –ó–∞—â–∏—â–µ–Ω—ã Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- [x] –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –æ—à–∏–±–∫–∏ (404, 409, 401, 500)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–ª–æ–∏: controller ‚Üí service ‚Üí model
- [x] –ù–∏–∫–∞–∫–∏—Ö –∑–∞–≥–ª—É—à–µ–∫ - —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
- [x] –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ airdrop
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è telegram_id –≤ POST –∑–∞–ø—Ä–æ—Å–∞—Ö
- [x] –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `core/logger`

---

## üß™ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

### –í—Å–µ endpoints –¥–æ—Å—Ç—É–ø–Ω—ã
```
‚úÖ GET /api/v2/me - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ GET /api/v2/farming/history - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –Ω–∞–≥—Ä–∞–¥  
‚úÖ POST /api/v2/airdrop/register - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞
- ‚úÖ –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Ä–∞—Å—à–∏—Ä–µ–Ω—ã
- ‚úÖ Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω

### Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å production –±–∞–∑–æ–π ep-lucky-boat-a463bggt
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ edge cases
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## üìã –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ó–ê–î–ê–ß–ê T8 –ü–û–õ–ù–û–°–¢–¨–Æ –í–´–ü–û–õ–ù–ï–ù–ê**

–í—Å–µ 3 –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö API –º–∞—Ä—à—Ä—É—Ç–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É UniFarm. Endpoints —Ä–∞–±–æ—Ç–∞—é—Ç —Å production –¥–∞–Ω–Ω—ã–º–∏, –∑–∞—â–∏—â–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production —Å—Ä–µ–¥–µ.

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∑–∞—è–≤–ª–µ–Ω–Ω—ã—Ö API –º–∞—Ä—à—Ä—É—Ç–æ–≤.**