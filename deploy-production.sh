#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Production —Ä–µ–∂–∏–º–µ
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç –∫ –¥–µ–ø–ª–æ—é –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"
  echo "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å TELEGRAM_BOT_TOKEN –≤ —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞"
  exit 1
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export NODE_ENV=production
export PRODUCTION_DOMAIN="https://uni-farm-connect-2-misterxuniverse.replit.app"
export TELEGRAM_MINI_APP_URL="https://t.me/UniFarming_Bot/UniFarm"

echo "===== UniFarm Production Deployment ====="
echo "Environment: $NODE_ENV"
echo "Production Domain: $PRODUCTION_DOMAIN"
echo "Telegram Mini App URL: $TELEGRAM_MINI_APP_URL"
echo "========================================"

# –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üî® –°–±–æ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏..."
NODE_ENV=production npm run build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–±–æ—Ä–∫–∏
if [ $? -ne 0 ]; then
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏"
  exit 1
fi

echo "‚úÖ –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω–∞"

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ production —Ä–µ–∂–∏–º–µ..."
NODE_ENV=production tsx server/index.ts