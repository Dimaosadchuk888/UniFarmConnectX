<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        h1, h2 {
            color: #4CAF50;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            background: #2d3e2d;
            border-left: 4px solid #4CAF50;
        }
        .error {
            background: #3e2d2d;
            border-left: 4px solid #f44336;
        }
        .info {
            background: #2d3e3e;
            border-left: 4px solid #2196F3;
        }
        .warning {
            background: #3e3e2d;
            border-left: 4px solid #ff9800;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .results-container {
            margin-top: 20px;
        }
        .summary {
            background: #2d2d3e;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤</h1>
    <p>–î–∞—Ç–∞: 12.07.2025 | –í—Ä–µ–º—è: 12:50</p>
    
    <div>
        <button onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        <button onclick="clearResults()">üßπ –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
    </div>
    
    <div id="results" class="results-container"></div>
    <div id="summary" class="summary" style="display:none;"></div>

    <script>
        const jwtToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NzQsInRlbGVncmFtX2lkIjoxMjM0NTY3ODksInVzZXJuYW1lIjoidGVzdF91c2VyXzE3NTIxMjk4NDA5MDUiLCJmaXJzdF9uYW1lIjoiVGVzdCIsImxhc3RfbmFtZSI6IlVzZXIiLCJyZWZfY29kZSI6IlJFRl8xNzUyMTI5ODQwOTA1X3Q5Mzh2cyIsImlhdCI6MTc1MjEyOTg0MCwiZXhwIjoxNzUyNzM0NjQwfQ.JxAC5u79LcXU0HQsEP_9GsLTc_Qnk0xBGLhJIQ0bE-4';
        
        const tests = [
            {
                name: 'UNI Farming Status',
                method: 'GET',
                url: '/api/v2/uni-farming/status?user_id=74',
                expectCode: 200
            },
            {
                name: 'Wallet Balance',
                method: 'GET',
                url: '/api/v2/wallet/balance',
                expectCode: 200
            },
            {
                name: 'Wallet Transactions',
                method: 'GET',
                url: '/api/v2/wallet/transactions?page=1&limit=10',
                expectCode: 200
            },
            {
                name: 'Wallet Withdraw (POST)',
                method: 'POST',
                url: '/api/v2/wallet/withdraw',
                body: {
                    amount: 100,
                    currency: 'UNI',
                    wallet_address: 'test_wallet_address'
                },
                expectCode: [200, 400] // –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
            },
            {
                name: 'TON Deposit (POST)',
                method: 'POST',
                url: '/api/v2/wallet/ton-deposit',
                body: {
                    ton_tx_hash: 'test_tx_' + Date.now(),
                    amount: 0.1,
                    wallet_address: 'ton_test_wallet'
                },
                expectCode: 200
            },
            {
                name: 'Wallet Transfer (POST)',
                method: 'POST',
                url: '/api/v2/wallet/transfer',
                body: {
                    recipient_id: 75,
                    amount: 10,
                    currency: 'UNI'
                },
                expectCode: [200, 400] // –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
            }
        ];
        
        let testResults = [];
        
        async function runTest(test) {
            const startTime = Date.now();
            
            try {
                const options = {
                    method: test.method,
                    headers: {
                        'Authorization': `Bearer ${jwtToken}`,
                        'Content-Type': 'application/json'
                    }
                };
                
                if (test.body) {
                    options.body = JSON.stringify(test.body);
                }
                
                const response = await fetch(test.url, options);
                const responseTime = Date.now() - startTime;
                const data = await response.json();
                
                const expectedCodes = Array.isArray(test.expectCode) ? test.expectCode : [test.expectCode];
                const success = expectedCodes.includes(response.status);
                
                return {
                    test: test.name,
                    success,
                    status: response.status,
                    responseTime,
                    data,
                    expectCode: test.expectCode
                };
                
            } catch (error) {
                return {
                    test: test.name,
                    success: false,
                    error: error.message,
                    responseTime: Date.now() - startTime
                };
            }
        }
        
        async function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤...</h2>';
            testResults = [];
            
            for (const test of tests) {
                const result = await runTest(test);
                testResults.push(result);
                displayResult(result);
            }
            
            showSummary();
        }
        
        function displayResult(result) {
            const resultsDiv = document.getElementById('results');
            
            if (resultsDiv.innerHTML.includes('–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤...')) {
                resultsDiv.innerHTML = '<h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h2>';
            }
            
            const className = result.success ? 'success' : 'error';
            const icon = result.success ? '‚úÖ' : '‚ùå';
            
            let html = `
                <div class="test-result ${className}">
                    <strong>${icon} ${result.test}</strong><br>
                    –°—Ç–∞—Ç—É—Å: ${result.status || 'Error'} | –í—Ä–µ–º—è: ${result.responseTime}ms
            `;
            
            if (result.error) {
                html += `<br>–û—à–∏–±–∫–∞: ${result.error}`;
            } else if (result.data) {
                html += `<br>–û—Ç–≤–µ—Ç: ${JSON.stringify(result.data, null, 2).substring(0, 200)}...`;
            }
            
            html += '</div>';
            resultsDiv.innerHTML += html;
        }
        
        function showSummary() {
            const summaryDiv = document.getElementById('summary');
            const total = testResults.length;
            const successful = testResults.filter(r => r.success).length;
            const failed = total - successful;
            const successRate = ((successful / total) * 100).toFixed(1);
            
            summaryDiv.innerHTML = `
                <h2>üìà –ò—Ç–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <p><strong>–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${total}</p>
                <p><strong>‚úÖ –£—Å–ø–µ—à–Ω–æ:</strong> ${successful}</p>
                <p><strong>‚ùå –ü—Ä–æ–≤–∞–ª–µ–Ω–æ:</strong> ${failed}</p>
                <p><strong>üìä –£—Å–ø–µ—à–Ω–æ—Å—Ç—å:</strong> ${successRate}%</p>
                <hr>
                <h3>üéØ –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏: ${successRate >= 80 ? '–£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–ê' : '–¢–†–ï–ë–£–ï–¢ –î–û–†–ê–ë–û–¢–ö–ò'}</h3>
                ${successRate < 100 ? '<p>‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π</p>' : ''}
            `;
            
            summaryDiv.style.display = 'block';
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
            testResults = [];
        }
    </script>
</body>
</html>