#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Neon DB
# –ê–≤—Ç–æ—Ä: AI Developer
# –î–∞—Ç–∞: 14.05.2025

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Neon DB
export FORCE_NEON_DB=true
export DATABASE_PROVIDER=neon
export DISABLE_REPLIT_DB=true
export USE_LOCAL_DB_ONLY=false
export NODE_ENV=production

# –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env.neon, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
if [ -f .env.neon ]; then
  echo "–ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env.neon..."
  
  # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  temp_file=$(mktemp)
  
  # –ß–∏—Ç–∞–µ–º .env.neon –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  cat .env.neon | grep -v '^#' | grep '=' | while read -r line; do
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –Ω–µ –ø—É—Å—Ç–∞—è
    if [ -n "$line" ]; then
      # –†–∞–∑–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ –ø–µ—Ä–≤–æ–º—É –∑–Ω–∞–∫—É —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞
      key=$(echo $line | cut -d= -f1)
      value=$(echo $line | cut -d= -f2-)
      
      # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
      echo "export $key=\"$value\"" >> $temp_file
    fi
  done
  
  # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
  source $temp_file
  
  # –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
  rm $temp_file
  
  echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Neon DB –∑–∞–≥—Ä—É–∂–µ–Ω—ã"
else
  echo "‚ö†Ô∏è –§–∞–π–ª .env.neon –Ω–µ –Ω–∞–π–¥–µ–Ω!"
  echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ .env.neon —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB"
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å DATABASE_URL –¥–ª—è Neon DB
if [ -z "$DATABASE_URL" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
  echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª .env.neon —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é DATABASE_URL —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º URL –¥–ª—è Neon DB"
  exit 1
fi

echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Neon DB..."
echo "DATABASE_PROVIDER=$DATABASE_PROVIDER"
echo "FORCE_NEON_DB=$FORCE_NEON_DB"
echo "NODE_ENV=$NODE_ENV"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
node start-unified.js