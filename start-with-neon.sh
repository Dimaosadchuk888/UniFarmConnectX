#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ Neon DB
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env.neon –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä

# –¶–≤–µ—Ç–∞ –¥–ª—è –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º–æ–≥–æ –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}===============================================${NC}"
echo -e "${GREEN}üöÄ –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –° NEON DB${NC}"
echo -e "${BLUE}===============================================${NC}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ .env.neon
if [ ! -f ".env.neon" ]; then
  echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª .env.neon –Ω–µ –Ω–∞–π–¥–µ–Ω!${NC}"
  echo -e "${YELLOW}–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env.neon —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB${NC}"
  exit 1
fi

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env.neon
echo -e "${BLUE}üìù –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env.neon...${NC}"
export $(grep -v '^#' .env.neon | xargs)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ DATABASE_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if [ -z "$DATABASE_URL" ]; then
  echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è DATABASE_URL –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ .env.neon!${NC}"
  exit 1
fi

echo -e "${GREEN}‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ${NC}"

# –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo -e "${BLUE}üßπ –°–±—Ä–æ—Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è...${NC}"
unset REPLIT_DB_URL
echo -e "${GREEN}‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã${NC}"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Neon DB
echo -e "${BLUE}üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–æ–≤ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Neon DB...${NC}"
export FORCE_NEON_DB=true
export DISABLE_REPLIT_DB=true
export OVERRIDE_DB_PROVIDER=neon
export DATABASE_PROVIDER=neon
export USE_LOCAL_DB_ONLY=false
echo -e "${GREEN}‚úÖ –§–ª–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã${NC}"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
echo -e "${BLUE}üìã –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:${NC}"
echo -e "  DATABASE_PROVIDER=${YELLOW}${DATABASE_PROVIDER}${NC}"
echo -e "  FORCE_NEON_DB=${YELLOW}${FORCE_NEON_DB}${NC}"
echo -e "  DATABASE_URL=${YELLOW}$(echo $DATABASE_URL | sed 's/:[^:]*@/:***@/')${NC}"

echo -e "${BLUE}===============================================${NC}"
echo -e "${GREEN}üöÄ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê${NC}"
echo -e "${BLUE}===============================================${NC}"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ JS-—Å–∫—Ä–∏–ø—Ç–∞
node start-with-neon-db.js