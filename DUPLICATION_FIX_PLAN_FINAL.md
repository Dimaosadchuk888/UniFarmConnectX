# –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú–´ –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–ò

## üéØ –¶–ï–õ–¨
–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–∞–∫ User 25 - –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π.

## üîç –ö–û–†–ï–ù–¨ –ü–†–û–ë–õ–ï–ú–´
–í `core/TransactionService.ts` —Å—Ç—Ä–æ–∫–∏ 103-147:
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ DEPOSIT –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- User 25 "–ø–æ–≤–µ–∑–ª–æ" - –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –ø–æ–¥ –ª–æ–∂–Ω—É—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é
- –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ø–∞–¥–∞—é—Ç –ø–æ–¥ –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è

## üîß –†–ï–®–ï–ù–ò–Ø (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

### 1. –ò–°–ü–†–ê–í–ò–¢–¨ –õ–û–ì–ò–ö–£ –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–ò
**–§–∞–π–ª:** `core/TransactionService.ts` —Å—Ç—Ä–æ–∫–∏ 103-147

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ tx_hash
```javascript
// –¢–ï–ö–£–©–ê–Ø –õ–û–ì–ò–ö–ê (–ü–†–û–ë–õ–ï–ú–ù–ê–Ø):
.eq('tx_hash_unique', txHashToCheck)  // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
.eq('user_id', user_id)  // –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

**–†–µ—à–µ–Ω–∏–µ:** –°–¥–µ–ª–∞—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π:
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ >10 –º–∏–Ω—É—Ç)
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ tx_hash, –Ω–æ –∏ amount —Ç–æ—á–Ω–æ
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ (–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è failed)

### 2. –î–û–ë–ê–í–ò–¢–¨ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–• –î–ï–ü–û–ó–ò–¢–û–í
**–¶–µ–ª—å:** –í–∏–¥–µ—Ç—å –∫–æ–≥–¥–∞ –∏ –ø–æ—á–µ–º—É –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–µ–ø–æ–∑–∏—Ç—ã

**–î–æ–±–∞–≤–∏—Ç—å –≤ –º–µ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ error:**
```javascript
logger.error('[CRITICAL] [DEPOSIT_BLOCKED_BY_DEDUPLICATION]', {
  user_id,
  ton_tx_hash: txHashToCheck,
  amount_ton,
  blocked_reason: 'DUPLICATE_DETECTED',
  existing_transaction_id: existing.id,
  existing_created_at: existing.created_at,
  time_difference_minutes: Math.round((Date.now() - new Date(existing.created_at).getTime()) / (1000 * 60))
});
```

### 3. –£–õ–£–ß–®–ò–¢–¨ –£–°–õ–û–í–ò–Ø –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–ò
**–¢–µ–∫—É—â–µ–µ —É—Å–ª–æ–≤–∏–µ (—Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–æ–µ):**
```javascript
const isSameTransaction = 
  existing.user_id === user_id &&
  Math.abs(parseFloat(existing.amount_ton) - amount_ton) < 0.000001 &&
  existing.type === TRANSACTION_TYPE_MAPPING[type];
```

**–ù–æ–≤–æ–µ —É—Å–ª–æ–≤–∏–µ (–±–æ–ª–µ–µ —É–º–Ω–æ–µ):**
```javascript
const timeDifferenceMinutes = Math.round((Date.now() - new Date(existing.created_at).getTime()) / (1000 * 60));
const isRecentDuplicate = timeDifferenceMinutes < 10; // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
const isSameAmount = Math.abs(parseFloat(existing.amount_ton) - amount_ton) < 0.000001;
const isSameUser = existing.user_id === user_id;
const existingNotFailed = existing.status !== 'failed';

const shouldBlock = isRecentDuplicate && isSameAmount && isSameUser && existingNotFailed;
```

### 4. –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨ –ü–û–¢–ï–†–Ø–ù–ù–´–ï –î–ï–ü–û–ó–ò–¢–´
**–î–ª—è 21 –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –ø–æ –ª–æ–≥–∞–º
- –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã–µ DEPOSIT –∑–∞–ø–∏—Å–∏
- –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üöÄ –ü–û–†–Ø–î–û–ö –í–ù–ï–î–†–ï–ù–ò–Ø

### –≠–¢–ê–ü 1: –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ UnifiedTransactionService
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–∞—Ö

### –≠–¢–ê–ü 2: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï
1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã
2. –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
3. –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏

### –≠–¢–ê–ü 3: –ú–û–ù–ò–¢–û–†–ò–ù–ì
1. –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ DEPOSIT_BLOCKED_BY_DEDUPLICATION
3. –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

## üìä –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ User 25
- –ò—Å—á–µ–∑–Ω—É—Ç "–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ" –¥–µ–ø–æ–∑–∏—Ç—ã
- TON Boost –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö
- 77.8% –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥—É—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã