# üéØ –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø WITHDRAWAL SYSTEM

## –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞
‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:

### 1. withdrawalService.ts 
```typescript
// –î–û–ë–ê–í–õ–ï–ù–û: Business logic error handling
if ((error as any).error && typeof (error as any).error === 'string') {
  console.log(`[submitWithdrawal] [${requestId}] Business logic error detected:`, (error as any).error);
  return {
    message: (error as any).error, // –¢–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç API
    error_type: 'business_logic_error'
  };
}
```

### 2. WithdrawalError interface
```typescript
export interface WithdrawalError {
  message: string;
  field?: string;
  error_type?: 'authentication_required' | 'validation_error' | 'server_error' | 
               'network_error' | 'business_logic_error' | 'unknown_error'; // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
}
```

### 3. WithdrawalForm.tsx
```typescript
} else if (errorType === 'business_logic_error') {
  // Business logic errors - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç API
  showError(errorMessage); // –ë–ï–ó –ø—Ä–µ—Ñ–∏–∫—Å–∞ "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏"
```

## –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç:

### ‚úÖ Auth Errors (401)
**–ë—ã–ª–æ**: "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞..."  
**–°—Ç–∞–ª–æ**: "–¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –í–æ–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ"

### ‚úÖ Business Logic Errors (400 —Å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º)  
**–ë—ã–ª–æ**: "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞..."  
**–°—Ç–∞–ª–æ**: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: 39.52 TON" (—Ç–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç API)

### ‚úÖ Validation Errors (400 –æ–±—â–∏–µ)
**–°—Ç–∞–ª–æ**: "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: [–¥–µ—Ç–∞–ª–∏]"

### ‚úÖ Server Errors (500)
**–°—Ç–∞–ª–æ**: "–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º: [–¥–µ—Ç–∞–ª–∏]"

### ‚úÖ Real Network Errors (TypeError fetch)
**–°—Ç–∞–ª–æ**: "–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é: [–¥–µ—Ç–∞–ª–∏]" (—Ç–æ–ª—å–∫–æ –¥–ª—è –†–ï–ê–õ–¨–ù–´–• network failures)

## Root Cause –±—ã–ª–∞ –≤:
1. **withdrawalService.ts** catch –±–ª–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –í–°–ï –æ—à–∏–±–∫–∏ –∫–∞–∫ network errors
2. API –≤–æ–∑–≤—Ä–∞—â–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ business logic errors ("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤")  
3. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–ª "–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É" –≤–º–µ—Å—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—à–∏–±–∫–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
API Response: {"success": false, "error": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: X TON"}
     ‚Üì
correctApiRequest: —Å–æ–∑–¥–∞–µ—Ç error —Å –ø–æ–ª–µ–º .error  
     ‚Üì
withdrawalService: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç (error as any).error (–ù–û–í–û–ï!)
     ‚Üì  
WithdrawalForm: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç API
     ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: X TON"
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- ‚ùå –ë–æ–ª—å—à–µ –ù–ï–¢ "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞"  
- ‚úÖ –¢–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç API –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º (auth vs business logic vs network)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û