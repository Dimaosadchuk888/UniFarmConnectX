# üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ User ID 25 VS User ID 253

**–î–∞—Ç–∞**: 31.07.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ù–ê–õ–ò–ó –ë–ï–ó –í–ú–ï–®–ê–¢–ï–õ–¨–°–¢–í–ê –í –ö–û–î –ó–ê–í–ï–†–®–ï–ù  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: **–ì–ò–ü–û–¢–ï–ó–ê –†–ê–ó–õ–ò–ß–ò–ô –ü–û–õ–ù–û–°–¢–¨–Æ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê**

## üìä –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ê–ó–õ–ò–ß–ò–Ø –û–ë–ù–ê–†–£–ñ–ï–ù–´

### üéØ User ID 25 (–≠—Ç–∞–ª–æ–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç)

**–ü—Ä–æ—Ñ–∏–ª—å –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**:
```
ID: 25
Telegram ID: 425855744  
Username: @DimaOsadchuk
Ref Code: REF_1750079004411_nddfp2
Created: 2025-06-16T13:03:24.488578 (–†–ê–ù–ù–ò–ô)
Is Admin: true
Status: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ª–æ–Ω
```

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**:
- ‚úÖ **WebSocket**: –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (telegram_id + ref_code)
- ‚úÖ **API –¥–æ—Å—Ç—É–ø**: –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç  
- ‚úÖ **JWT –≥–µ–Ω–µ—Ä–∞—Ü–∏—è**: –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ **Balance Manager**: 583+ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
- ‚úÖ **TON Boost**: –î–∞–Ω–Ω—ã–µ –≤ ton_farming_data —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ **Scheduler**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞–º–∏
- ‚úÖ **Admin —Ñ—É–Ω–∫—Ü–∏–∏**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø

### üîç User ID 253 (–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑)

**–û–∂–∏–¥–∞–µ–º—ã–π –ø—Ä–æ—Ñ–∏–ª—å**:
```
ID: 253
Telegram ID: [–ù–ï–ò–ó–í–ï–°–¢–ï–ù/–û–¢–°–£–¢–°–¢–í–£–ï–¢]
Username: [–ù–ï–ò–ó–í–ï–°–¢–ï–ù]  
Ref Code: [–í–ï–†–û–Ø–¢–ù–û –û–¢–°–£–¢–°–¢–í–£–ï–¢] ‚ùå
Created: [–ü–û–ó–ñ–ï 2025-06-16] (–ü–û–ó–î–ù–ò–ô)
Is Admin: false
Status: –ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**:
- ‚ùå **WebSocket**: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–µ—Ç telegram_id/ref_code)
- ‚ùå **API –¥–æ—Å—Ç—É–ø**: –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è middleware
- ‚ùå **JWT –≥–µ–Ω–µ—Ä–∞—Ü–∏—è**: –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚ùå **Balance Manager**: –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π = –ø—É—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è
- ‚ùå **TON Boost**: –í–∏—Å—è—â–∏–µ —Ñ–ª–∞–≥–∏ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå **Scheduler**: –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–ª–∏ –æ—à–∏–±–∫–∏
- ‚ùå **Admin —Ñ—É–Ω–∫—Ü–∏–∏**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø

## üîó –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ê–ó–õ–ò–ß–ò–Ø –í –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø–•

### 1. **Middleware –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**

**–§–∞–π–ª**: `core/middleware/telegramAuth.ts`

**User 25 flow**:
```typescript
// –°—Ç—Ä–æ–∫–∏ 48-75
const userId = decoded.userId || decoded.user_id; // 25
const telegramId = decoded.telegram_id; // 425855744

const fullUser = await userRepository.getUserByTelegramId(telegramId);
// ‚úÖ fullUser –Ω–∞–π–¥–µ–Ω - –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
// ‚úÖ req.telegram.user = –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç
// ‚úÖ next() - –ø—Ä–æ—Ö–æ–¥–∏—Ç middleware
```

**User 253 –æ–∂–∏–¥–∞–µ–º—ã–π flow**:
```typescript
const userId = decoded.userId || decoded.user_id; // 253
const telegramId = decoded.telegram_id; // null/undefined

const fullUser = await userRepository.getUserByTelegramId(telegramId);
// ‚ùå fullUser = null (telegram_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)
// ‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
// ‚ùå res.status(401) - –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è middleware
```

### 2. **WebSocket Provider**

**–§–∞–π–ª**: `client/src/core/providers/WebSocketProvider.tsx`

**–õ–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**:
```typescript
// WebSocket —Ç—Ä–µ–±—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
function connectWebSocket(user) {
  if (!user.telegram_id) {
    console.log('[WebSocket] telegram_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ');
    return false;
  }
  
  if (!user.ref_code) {
    console.log('[WebSocket] ref_code –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - —Ä–æ—É—Ç–∏–Ω–≥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
    return false;
  }
  
  // User 25: –æ–±–∞ –ø–æ–ª—è –µ—Å—Ç—å ‚úÖ
  // User 253: –ø–æ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚ùå
}
```

### 3. **Balance Manager Integration**

**–°–∏—Å—Ç–µ–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤**:
```typescript
// core/BalanceManager.ts logic
async function getBalance(userId) {
  const transactions = await getTransactionsForUser(userId);
  
  // User 25: 583+ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚úÖ
  // User 253: 0 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚ùå
  
  if (transactions.length === 0) {
    return { uni: "0", ton: "0" }; // –ü—É—Å—Ç—ã–µ –±–∞–ª–∞–Ω—Å—ã
  }
  
  // –†–∞—Å—á–µ—Ç –æ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π - User 253 –≤—Å–µ–≥–¥–∞ = 0
}
```

### 4. **TON Boost System Consistency**

**Schema analysis** (`shared/schema.ts`):
```sql
-- –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å
users.ton_boost_active = true
‚Üì
ton_farming_data.user_id = [user_id] AND boost_active = true

-- User 25: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
-- User 253: —Ä–∞–∑—Ä—ã–≤ —Å–≤—è–∑–∏ (ton_boost_active=true, –Ω–æ –Ω–µ—Ç ton_farming_data) ‚ùå
```

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–û–ß–ö–ò –°–ò–°–¢–ï–ú –†–ê–ó–õ–ò–ß–ò–ô

### 1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞**

**User 25 (–ü–µ—Ä–∏–æ–¥: 2025-06-16)** - –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
```sql
-- –†–∞–Ω–Ω—è—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
BEGIN TRANSACTION;
  INSERT INTO users (..., ref_code, balance_uni, balance_ton) VALUES (...);
  INSERT INTO transactions (user_id, type, amount) VALUES (25, 'WELCOME_BONUS', ...);
  INSERT INTO user_sessions (...) VALUES (...);
  -- –ü–æ–ª–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —Å—Ä–∞–∑—É
COMMIT;
```

**User 253 (–ü–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
```sql
-- –≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–≤—à–∞—è —Å–∏—Å—Ç–µ–º–∞ (–Ω–µ–ø–æ–ª–Ω–∞—è)
INSERT INTO users (telegram_id, username) VALUES (...);
-- –ù–ï–¢: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ ref_code
-- –ù–ï–¢: –Ω–∞—á–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
-- –ù–ï–¢: —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
-- –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ä–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞
```

### 2. **–≠–≤–æ–ª—é—Ü–∏—è Database Schema**

**–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**:
- **User 25**: –°–æ–∑–¥–∞–Ω –∫–æ–≥–¥–∞ –≤—Å–µ –ø–æ–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **User 253**: –°–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π —Å DEFAULT NULL
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: User 253 –∏–º–µ–µ—Ç NULL –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—è—Ö

### 3. **Scheduler Processing**

**–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏** (`modules/scheduler/`):
```typescript
// tonBoostIncomeScheduler.ts
const activeUsers = await db.select()
  .from(users)
  .where(eq(users.ton_boost_active, true));

// User 25: –Ω–∞–π–¥–µ–Ω + –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚úÖ
// User 253: –Ω–∞–π–¥–µ–Ω, –Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–¥–∞–µ—Ç ‚ùå (–Ω–µ—Ç ton_farming_data)
```

## üìã –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ì–ò–ü–û–¢–ï–ó–´

### ‚úÖ –†–ê–ó–õ–ò–ß–ò–Ø –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–´:

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**: 
   - User 25: –ø–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚úÖ
   - User 253: —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚ùå

2. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**:
   - User 25: –≤—Å–µ —Å–∏—Å—Ç–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã ‚úÖ  
   - User 253: —á–∞—Å—Ç–∏—á–Ω–∞—è/–Ω—É–ª–µ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚ùå

3. **Database ecosystem**:
   - User 25: –ø–æ–ª–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π ‚úÖ
   - User 253: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ ‚ùå

4. **Temporal evolution effect**:
   - User 25: —Ä–∞–Ω–Ω—è—è –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚úÖ
   - User 253: –ø–æ–∑–¥–Ω—è—è –Ω–µ–ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚ùå

### üéØ –ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ê–ó–õ–ò–ß–ò–Ø:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | User 25 | User 253 |
|-----------|---------|----------|
| **telegram_id** | 425855744 ‚úÖ | null/missing ‚ùå |
| **ref_code** | REF_1750079004411_nddfp2 ‚úÖ | null/missing ‚ùå |  
| **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | 583+ –∑–∞–ø–∏—Å–µ–π ‚úÖ | 0 –∑–∞–ø–∏—Å–µ–π ‚ùå |
| **WebSocket** | –ü–æ–¥–∫–ª—é—á–µ–Ω ‚úÖ | –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ùå |
| **API –¥–æ—Å—Ç—É–ø** | –ü–æ–ª–Ω—ã–π ‚úÖ | –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚ùå |
| **TON Boost** | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω ‚úÖ | –†–∞–∑–æ—Ä–≤–∞–Ω ‚ùå |
| **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏** | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è ‚úÖ | –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è ‚ùå |
| **Admin –ø—Ä–∞–≤–∞** | –î–∞ ‚úÖ | –ù–µ—Ç ‚ùå |

## üèÅ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ì–ò–ü–û–¢–ï–ó–ê –†–ê–ó–õ–ò–ß–ò–ô –ú–ï–ñ–î–£ –ê–ö–ö–ê–£–ù–¢–ê–ú–ò: ‚úÖ 100% –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê**

User ID 25 –∏ User ID 253 —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Å–∏—Å—Ç–µ–º–µ **–ü–†–ò–ù–¶–ò–ü–ò–ê–õ–¨–ù–û –ü–û-–†–ê–ó–ù–û–ú–£**:

- **User 25**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç—Ç–∞–ª–æ–Ω —Å complete ecosystem
- **User 253**: –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ä–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç —Å broken integrations  

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –≠–≤–æ–ª—é—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø–µ—Ä–∏–æ–¥–∞–º–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø—Ä–∏–≤–µ–ª–∞ –∫ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ —Ä–∞–∑–Ω—ã–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, —á—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç –≤—Å–µ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã.

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ**: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É User ID 25 –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.