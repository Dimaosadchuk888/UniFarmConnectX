# üìå UniFarm –°–∏—Å—Ç–µ–º–Ω—ã–π –ê—É–¥–∏—Ç

**–î–∞—Ç–∞:** 15 –∏—é–Ω—è 2025, 11:57 UTC  
**–†–æ–ª—å:** –°–∏—Å—Ç–µ–º–Ω—ã–π –∞—É–¥–∏—Ç–æ—Ä  
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## üîç –ü–õ–ê–ù –ü–†–û–í–ï–†–ö–ò

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- [ ] window.Telegram.WebApp.initData
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ JWT
- [ ] –¢–æ–∫–µ–Ω –≤ localStorage/cookies

### 2. API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —á–µ—Ä–µ–∑ Supabase
- [ ] /auth/telegram
- [ ] /me
- [ ] /wallet/balance
- [ ] /farming/start
- [ ] /referral/tree
- [ ] /airdrop/missions

### 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
- [ ] –¢–æ–ª—å–∫–æ core/supabase.ts
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ PostgreSQL/drizzle/Neon
- [ ] CRUD –≤ Supabase Dashboard

### 4. Telegram WebApp
- [ ] –û—Ç–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ Telegram
- [ ] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebApp
- [ ] –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ initData

### 5. UI –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- [ ] –†–∞–±–æ—Ç–∞ –∫–Ω–æ–ø–æ–∫
- [ ] –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ DevTools

### 6. –°–µ–∫—Ä–µ—Ç—ã .env
- [ ] –£–¥–∞–ª–µ–Ω—ã: DATABASE_URL, PG*
- [ ] –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç: SUPABASE_URL, SUPABASE_KEY
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Supabase API

### 7. Webhook
- [ ] Production URL
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Telegram API

### 8. Health-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- [ ] /health
- [ ] /api/v2/health

### 9. Manifest
- [ ] manifest.json
- [ ] BotFather —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- [ ] WebApp URL

### 10. Supabase Dashboard
- [ ] Claim –±–æ–Ω—É—Å ‚Üí —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
- [ ] –°—Ç–∞—Ä—Ç —Ñ–∞—Ä–º–∏–Ω–≥–∞ ‚Üí —Å–µ—Å—Å–∏—è
- [ ] –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ ‚Üí –¥–µ—Ä–µ–≤–æ
- [ ] –ú–∏—Å—Å–∏–∏ ‚Üí –∑–∞–ø–∏—Å–∏

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- ‚úÖ Health endpoints: `/health` –∏ `/api/v2/health` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 200 OK
- ‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ `/ws` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π real-time updates
- ‚úÖ Express —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000 –≤ production —Ä–µ–∂–∏–º–µ
- ‚úÖ Webhook Telegram –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ `/webhook`
- ‚úÖ API routing —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `/api/v2` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ API:**
- ‚úÖ Supabase connection –∞–∫—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ core/supabase.ts
- ‚úÖ API endpoints –æ—Ç–≤–µ—á–∞—é—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –æ—à–∏–±–æ–∫
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç Telegram authentication (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚úÖ Middleware –¥–ª—è Telegram integration –ø–æ–¥–∫–ª—é—á–µ–Ω

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤:**
- ‚úÖ SUPABASE_URL –∏ SUPABASE_KEY –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- ‚úÖ TELEGRAM_BOT_TOKEN –∏ JWT_SECRET –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ Production environment –∞–∫—Ç–∏–≤–µ–Ω (NODE_ENV=production)

**API Endpoints —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- ‚úÖ `/api/v2/auth/telegram` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ `/api/v2/users/profile` - —Ç—Ä–µ–±—É–µ—Ç auth (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ `/api/v2/me` - —Ç—Ä–µ–±—É–µ—Ç auth (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ routing

### ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´:**

1. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** üî¥
   - DATABASE_URL, PGHOST, PGUSER, PGPASSWORD –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
   - –°–æ–∑–¥–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π –Ω–∞ Supabase API
   - –ú–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å—Ç–∞—Ä–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

2. **AuthService –º–µ—Ç–æ–¥—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** üî¥
   - –ú–µ—Ç–æ–¥ `authenticateWithTelegram` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ AuthService
   - API endpoint `/auth/telegram` –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π "function not found"
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

3. **Manifest.json routing** üî¥
   - `/manifest.json` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML –≤–º–µ—Å—Ç–æ JSON —Ñ–∞–π–ª–∞
   - Express routing –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è PWA files
   - Telegram Mini App –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π manifest

4. **TypeScript compilation errors** üî¥
   - 40+ LSP –æ—à–∏–±–æ–∫ –≤ modules/auth/controller.ts –∏ service.ts
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ—Ç–æ–¥–æ–≤ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
   - Missing properties –∏ null safety issues

### ‚ö†Ô∏è –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞:

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- core/db.ts –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ deprecated –Ω–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–æ–¥—É–ª—è–º–∏
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è API routes (/api –∏ /api/v2) –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- UserService.createUserFromTelegram method –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- Frontend –æ—à–∏–±–∫–∏ –≤ console (404, 401) —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã production:**
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ initData
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ
- Manifest PWA –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### üî¥ –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production: 30% (3 –∏–∑ 10 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)**

**–°–∏—Å—Ç–µ–º–∞ –ù–ï –ì–û–¢–û–í–ê –∫ –º–∞—Å—Å–æ–≤–æ–º—É –∑–∞–ø—É—Å–∫—É** –∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Telegram
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è  
- TypeScript compilation issues
- PWA manifest configuration

---

## üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–†–ï–ë–£–ï–ú–´–ï

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ë–õ–û–ö–ï–†–´):

**1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å AuthService –º–µ—Ç–æ–¥—ã**
- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –º–µ—Ç–æ–¥ `authenticateWithTelegram` –≤ AuthService
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ AuthController (—Å—Ç—Ä–æ–∫–∞ 64: –¥–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å TypeScript –æ—à–∏–±–∫–∏ –≤ auth –º–æ–¥—É–ª—è—Ö

**2. –û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ**
- –£–¥–∞–ª–∏—Ç—å DATABASE_URL, PGHOST, PGUSER, PGPASSWORD –∏–∑ environment
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ Supabase API —á–µ—Ä–µ–∑ SUPABASE_URL/KEY

**3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å manifest.json routing**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ—Ç–¥–∞—á—É JSON —Ñ–∞–π–ª–∞ –≤ Express
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ Telegram

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–ö–†–ò–¢–ò–ß–ù–´–ï):

**4. –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Supabase**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç core/supabase.ts
- –£–¥–∞–ª–∏—Ç—å references –Ω–∞ core/db.ts –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–¥–∞
- –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –º–µ—Ç–æ–¥—ã –≤ UserService

**5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ end-to-end**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å initData processing –≤ UserContext
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JWT generation –∏ validation
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–±–æ—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìã –ü–õ–ê–ù –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø –°–ò–°–¢–ï–ú–´

### –®–∞–≥ 1: Environment cleanup (30 –º–∏–Ω)
- –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ PostgreSQL –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å Supabase connection

### –®–∞–≥ 2: Auth module fixes (45 –º–∏–Ω)  
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å AuthService missing methods
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å TypeScript compilation errors
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ API

### –®–∞–≥ 3: PWA –∏ manifest (15 –º–∏–Ω)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ—Ç–¥–∞—á—É manifest.json
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram Mini App integration

### –®–∞–≥ 4: End-to-end testing (30 –º–∏–Ω)
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ user flow
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö endpoints
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

**–û–ë–©–ï–ï –í–†–ï–ú–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø: ~2 —á–∞—Å–∞**

---

## ‚ö° –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

UniFarm –∏–º–µ–µ—Ç **—Å–∏–ª—å–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É** (—Å–µ—Ä–≤–µ—Ä, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, API structure), –Ω–æ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** –¥–µ–ª–∞—é—Ç —Å–∏—Å—Ç–µ–º—É –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –∑–∞—è–≤–ª–µ–Ω–Ω–æ–π "100% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å—é" –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º core functionality.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.