# üìã –û–¢–ß–ï–¢ T3.1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∞—Ä–º–∏–Ω–≥ –¥–æ—Ö–æ–¥–∞ –≤ wallet

## ‚ùå –û–ë–ù–ê–†–£–ñ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

–ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Å–∏—Å—Ç–µ–º—ã UniFarm –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∞—Ä–º–∏–Ω–≥ –¥–æ—Ö–æ–¥–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç**. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –º–æ–¥–µ–ª–∏ —Ä—É—á–Ω–æ–≥–æ –∫–ª–µ–π–º–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `claimRewards()`.

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ –ï—Å—Ç—å —Ä–∞—Å—á–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ï—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ pending rewards –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ  
- ‚ùå **–ù–ï–¢** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ wallet –±–∞–ª–∞–Ω—Å
- ‚ùå **–ù–ï–¢** –º–µ—Ç–æ–¥–æ–≤ `addUniFarmIncome()` –∏ `addTonFarmIncome()`
- ‚ùå **–ù–ï–¢** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï

### 1. –ú–µ—Ç–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –≤ WalletService

**addUniFarmIncome(userId, amount)**
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å UNI
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—É–º–º—É –¥–æ—Ö–æ–¥–∞ 
- –û–±–Ω–æ–≤–ª—è–µ—Ç `users.balance_uni` –Ω–∞–ø—Ä—è–º—É—é
- –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Ç–∏–ø–∞ `farming_income`
- –õ–æ–≥–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**addTonFarmIncome(userId, amount)**
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å TON
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—É–º–º—É –¥–æ—Ö–æ–¥–∞
- –û–±–Ω–æ–≤–ª—è–µ—Ç `users.balance_ton` –Ω–∞–ø—Ä—è–º—É—é  
- –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Ç–∏–ø–∞ `farming_income`
- –õ–æ–≥–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**FarmingScheduler (core/scheduler/farmingScheduler.ts)**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ cron job
- –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤ –ø–æ `uni_farming_start_timestamp`
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- –í—ã–∑—ã–≤–∞–µ—Ç `addUniFarmIncome()` –∏ `addTonFarmIncome()`
- –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
- UNI: –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 0.001 UNI/—á–∞—Å = 0.000000277778 UNI/—Å–µ–∫
- TON: –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 0.0001 TON/—á–∞—Å = 0.000000027778 TON/—Å–µ–∫
- –î–æ—Ö–æ–¥ = —Å–µ–∫—É–Ω–¥—ã_–ø—Ä–æ—à–µ–¥—à–∏–µ √ó —Å—Ç–∞–≤–∫–∞_–≤_—Å–µ–∫—É–Ω–¥—É

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä

**server/index.ts –æ–±–Ω–æ–≤–ª–µ–Ω:**
- –ò–º–ø–æ—Ä—Ç `farmingScheduler`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –°–æ–∑–¥–∞–Ω test-farming-auto-income.js
**–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
1. **WalletService –º–µ—Ç–æ–¥—ã** - –Ω–∞–ª–∏—á–∏–µ addUniFarmIncome/addTonFarmIncome
2. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ñ–∞—Ä–º–∏–Ω–≥–∞** - –∑–∞–ø—É—Å–∫ UNI/TON —Ñ–∞—Ä–º–∏–Ω–≥–∞
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π farming_income
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä—É—á–Ω–æ–≥–æ –∫–ª–µ–π–º–∞** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏
5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ wallet –±–∞–ª–∞–Ω—Å–∞** - —Ä–æ—Å—Ç balance_uni –∏ balance_ton

## ‚ö° –ö–õ–Æ–ß–ï–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### –ë—ã–ª–æ (—Ä—É—á–Ω–æ–π –∫–ª–µ–π–º):
```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å
await farmingService.claimRewards(telegramId);
// –î–æ—Ö–æ–¥ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –≤ pending —Å–æ—Å—Ç–æ—è–Ω–∏–∏
```

### –°—Ç–∞–ª–æ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ):
```typescript
// –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
await walletService.addUniFarmIncome(userId, calculatedIncome);
await walletService.addTonFarmIncome(userId, calculatedIncome);
// –î–æ—Ö–æ–¥ —Å—Ä–∞–∑—É –ø–æ—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ wallet –±–∞–ª–∞–Ω—Å
```

## üìä –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ:
- ‚úÖ `addUniFarmIncome()` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `users.balance_uni`
- ‚úÖ `addTonFarmIncome()` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `users.balance_ton`
- ‚úÖ –î–æ—Ö–æ–¥ –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
- ‚úÖ –°–æ–∑–¥–∞—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

### –ò—Å–∫–ª—é—á–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
- ‚ùå –ú–µ—Ç–æ–¥—ã claimRewards –ù–ï —Å–æ–∑–¥–∞–Ω—ã
- ‚ùå –¢–∞–±–ª–∏—Ü–∞ farming_deposits –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  
- ‚ùå –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∫–ª–µ–π–º–∞ –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ù–ï —Å–æ–∑–¥–∞–Ω—ã

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

**–ú–æ–¥–µ–ª—å "–Ω–∞—á–∏—Å–ª–µ–Ω–æ ‚Üí –∑–∞—á–∏—Å–ª–µ–Ω–æ" —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞:**

1. **–§–∞—Ä–º–∏–Ω–≥ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è** ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–∞
2. **–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç** ‚Üí –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥
3. **–î–æ—Ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è** ‚Üí wallet –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–æ—Å—Ç –±–∞–ª–∞–Ω—Å–∞** ‚Üí –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

**–°–∏—Å—Ç–µ–º–∞ UniFarm —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∞—Ä–º–∏–Ω–≥ –¥–æ—Ö–æ–¥–∞ –Ω–∞–ø—Ä—è–º—É—é –≤ wallet –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.**