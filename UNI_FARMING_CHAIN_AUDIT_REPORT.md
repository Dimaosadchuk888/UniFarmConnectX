# üìã –û–¢–ß–Å–¢: –ê—É–¥–∏—Ç —Ü–µ–ø–æ—á–∫–∏ —Å–ø–∏—Å–∞–Ω–∏—è UNI –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥–∞

**–î–∞—Ç–∞:** 9 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´

## üìÅ –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ß–µ—Ä–µ–∑ ROADMAP.md –Ω–∞–π–¥–µ–Ω—ã:
1. **API endpoints** (—Å—Ç—Ä–æ–∫–∏ 165-176 ROADMAP.md):
   - POST /api/v2/farming/deposit - –æ—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–µ–ø–æ–∑–∏—Ç–∞
   - POST /api/v2/farming/start - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π endpoint
   - POST /api/v2/farming/direct-deposit - –ø—Ä—è–º–æ–π –¥–µ–ø–æ–∑–∏—Ç –º–∏–Ω—É—è BaseController

2. **–ù–µ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** (—Å—Ç—Ä–æ–∫–∞ 432 ROADMAP.md):
   - modules/farming/directDeposit.ts - –ø—Ä—è–º—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –≤ —Ñ–∞—Ä–º–∏–Ω–≥

3. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** (—Å—Ç—Ä–æ–∫–∏ 386, 447):
   - core/scheduler/farmingScheduler.ts - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

## üìå –ê–Ω–∞–ª–∏–∑ —ç—Ç–∞–ø–æ–≤ —Ü–µ–ø–æ—á–∫–∏

### ‚úÖ –≠–¢–ê–ü 1: –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞—Ä–º–∏–Ω–≥–∞

**–ù–∞–π–¥–µ–Ω–æ 3 —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞:**

1. **FarmingController.depositUni** (—Å—Ç—Ä–æ–∫–∞ 210-264 controller.ts)
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç amount –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é Telegram
   - –í—ã–∑—ã–≤–∞–µ—Ç `farmingService.depositUniForFarming()`

2. **FarmingController.startFarming** (—Å—Ç—Ä–æ–∫–∞ 157-183 controller.ts) 
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ—Ç –∂–µ –º–µ—Ç–æ–¥ —Å–µ—Ä–≤–∏—Å–∞
   
3. **directDepositHandler** (modules/farming/directDeposit.ts)
   - –û–±—Ö–æ–¥ BaseController –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
   - –ù–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞–µ—Ç `farmingService.depositUniForFarming()`

**‚ùå –ü–†–û–ë–õ–ï–ú–ê –ù–ï –ó–î–ï–°–¨** - –≤—Å–µ —Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å

### ‚úÖ –≠–¢–ê–ü 2: –°–ø–∏—Å–∞–Ω–∏–µ UNI 

**–í modules/farming/service.ts –º–µ—Ç–æ–¥ depositUniForFarming():**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞** (—Å—Ç—Ä–æ–∫–∏ 186-197):
   ```typescript
   const currentBalance = parseFloat(user.balance_uni || '0');
   if (currentBalance < depositAmount) {
     return { success: false, message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' };
   }
   ```

2. **–°–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ BalanceManager** (—Å—Ç—Ä–æ–∫–∏ 229-242):
   ```typescript
   const balanceUpdateResult = await balanceManager.subtractBalance(
     user.id,
     depositAmount,
     0,
     'UNI farming deposit'
   );
   ```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ –≤ –ë–î** (—Å—Ç—Ä–æ–∫–∏ 245-254):
   ```typescript
   const { data: updateData, error: updateError } = await supabase
     .from(FARMING_TABLES.USERS)
     .update({
       uni_deposit_amount: newDepositAmount,
       uni_farming_start_timestamp: new Date().toISOString(),
       uni_farming_last_update: new Date().toISOString(),
       uni_farming_rate: FARMING_CONFIG.DEFAULT_RATE,
       uni_farming_active: true  // –ò–°–ü–†–ê–í–õ–ï–ù–û
     })
   ```

**‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê:**
- –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è —Ñ–ª–∞–≥ `uni_farming_active = true`
- –ë–µ–∑ —ç—Ç–æ–≥–æ —Ñ–ª–∞–≥–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚ùå –≠–¢–ê–ü 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞—Ä–º–∏–Ω–≥-—Å–µ—Å—Å–∏–∏

**–ù–ï –ü–†–û–ò–°–•–û–î–ò–¢!** 

–í –∫–æ–¥–µ `depositUniForFarming()` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `farming_sessions`. –ï—Å—Ç—å —Ç–æ–ª—å–∫–æ:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ FARMING_REWARD

**–¢–∞–±–ª–∏—Ü–∞ farming_sessions –ø—É—Å—Ç–∞—è** —Å–æ–≥–ª–∞—Å–Ω–æ ROADMAP.md (—Å—Ç—Ä–æ–∫–∞ 533)

### ‚úÖ –≠–¢–ê–ü 4: –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤

**–í core/scheduler/farmingScheduler.ts:**

1. **–ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤** (—Å—Ç—Ä–æ–∫–∏ 43-47):
   ```typescript
   const { data: activeFarmers, error } = await supabase
     .from('users')
     .select('*')
     .not('uni_farming_start_timestamp', 'is', null)
     .not('uni_farming_rate', 'is', null);
   ```

2. **–†–∞—Å—á—ë—Ç –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ** (—Å—Ç—Ä–æ–∫–∏ 58-98):
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –û–±–Ω–æ–≤–ª—è–µ—Ç balance_uni
   - –°–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é FARMING_REWARD
   - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ farming_sessions (—Å—Ç—Ä–æ–∫–∏ 72-84)

**‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:**
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ `uni_farming_active`
- –ù–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 62 —ç—Ç–æ—Ç —Ñ–ª–∞–≥ = false, –ø–æ—ç—Ç–æ–º—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## ‚ùå –¢–æ—á–∫–∏ –æ–±—Ä—ã–≤–∞ –ª–æ–≥–∏–∫–∏

### 1. **–§–ª–∞–≥ uni_farming_active**
- **–ì–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –ü—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ –≤ –º–µ—Ç–æ–¥–µ `depositUniForFarming`
- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –§–ª–∞–≥ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ)
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –§–∞—Ä–º–∏–Ω–≥ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, —Ö–æ—Ç—è –¥–µ–ø–æ–∑–∏—Ç –µ—Å—Ç—å

### 2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø–∏—Å–∏ –≤ farming_sessions –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ**
- **–ì–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è UNI
- **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–∞—Ä–º–∏–Ω–≥-–ø–∞–∫–µ—Ç–æ–≤

### 3. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ `uni_farming_start_timestamp` –∏ `uni_farming_rate`
- **–ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:** –§–ª–∞–≥ `uni_farming_active`
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ú–æ–∂–µ—Ç –Ω–∞—á–∏—Å–ª—è—Ç—å –¥–æ—Ö–æ–¥ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–ø–∏—Å–∞–Ω–∏—è

**–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 62:**
- –ë–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è: 448.229512 ‚Üí 448.231257 ‚Üí 448.232133
- uni_deposit_amount = 100 (–¥–µ–ø–æ–∑–∏—Ç –∑–∞–ø–∏—Å–∞–Ω)
- uni_farming_rate = 0.01 (—Å—Ç–∞–≤–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞)
- uni_farming_start_timestamp –µ—Å—Ç—å

**–í–´–í–û–î:** –°–ø–∏—Å–∞–Ω–∏–µ UNI –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –¥–µ–ø–æ–∑–∏—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è, –Ω–æ —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è.

## üß© –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ API endpoints –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã
2. ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ UNI —á–µ—Ä–µ–∑ BalanceManager
3. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ uni_deposit_amount –≤ –ë–î
4. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uni_farming_rate
5. ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º (—á–∞—Å—Ç–∏—á–Ω–æ)

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚ùå –§–ª–∞–≥ uni_farming_active –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û –≤ –∫–æ–¥–µ)
2. ‚ùå –ù–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ farming_sessions –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
3. ‚ùå UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞—Ä–º–∏–Ω–≥ –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–π –∏–∑-–∑–∞ —Ñ–ª–∞–≥–∞

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:
**–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `uni_farming_active = true` –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ** –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–ª–∞ —Ñ–∞—Ä–º–∏–Ω–≥ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º, —Ö–æ—Ç—è –¥–µ–ø–æ–∑–∏—Ç –±—ã–ª —Å–¥–µ–ª–∞–Ω –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–ª–∏.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 62 —á–µ—Ä–µ–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `uni_farming_active` –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
3. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ farming_sessions –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ