# –û—Ç—á—ë—Ç –æ–± —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π JWT —Å–∏—Å—Ç–µ–º—ã

**–î–∞—Ç–∞:** 7 —è–Ω–≤–∞—Ä—è 2025  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** AI Assistant  
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:** ‚Ññ3 - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ö–∞—Ä–¥–∫–æ–¥–æ–≤ –≤ JWT —Å–∏—Å—Ç–µ–º–µ

---

## 1. –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1.1 –•–∞—Ä–¥–∫–æ–¥—ã JWT_SECRET
–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã fallback –∑–Ω–∞—á–µ–Ω–∏—è –≤ 3 —Ñ–∞–π–ª–∞—Ö:

**core/middleware/telegramAuth.ts** (2 –º–µ—Å—Ç–∞):
```typescript
// –ë—ã–ª–æ:
const jwtSecret = process.env.JWT_SECRET || 'unifarm_jwt_secret_key_2025_production';
```

**modules/user/controller.ts** (2 –º–µ—Å—Ç–∞):
```typescript
// –ë—ã–ª–æ:
const decoded = jwt.verify(token, process.env.JWT_SECRET || 'fallback_secret') as any;
```

### 1.2 –£—Ç–µ—á–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ .env.example
- –†–µ–∞–ª—å–Ω—ã–π Telegram bot token –±—ã–ª —É–∫–∞–∑–∞–Ω –≤ –ø—Ä–∏–º–µ—Ä–µ

---

## 2. –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 2.1 –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è
‚úÖ **core/middleware/telegramAuth.ts** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –º–µ—Å—Ç–∞
‚úÖ **modules/user/controller.ts** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –º–µ—Å—Ç–∞

–¢–µ–ø–µ—Ä—å –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
```typescript
const jwtSecret = process.env.JWT_SECRET;
if (!jwtSecret) {
  throw new Error('JWT_SECRET environment variable not set');
}
```

### 2.2 –û—á–∏—â–µ–Ω .env.example
‚úÖ –ó–∞–º–µ–Ω—ë–Ω —Ä–µ–∞–ª—å–Ω—ã–π Telegram bot token –Ω–∞ –ø—Ä–∏–º–µ—Ä
‚úÖ JWT_SECRET –æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –æ–±—Ä–∞–∑–µ—Ü –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

### 2.3 –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö JWT
- **utils/telegram.ts** - ‚úÖ —É–∂–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
- **core/middleware/telegramAuth.ts** - ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- **modules/user/controller.ts** - ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- **core/envValidator.ts** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ JWT_SECRET
- **config/app.ts** - —Ç—Ä–µ–±—É–µ—Ç JWT_SECRET –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 3.1 –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ —Ç–æ–∫–µ–Ω–∞
```bash
GET /api/v2/wallet/balance
‚Üí {"success": false, "error": "Unauthorized - user authentication required"}

GET /api/v2/farming/status
‚Üí {"success": false, "error": "Unauthorized - user authentication required"}
```

### 3.2 –ó–∞–ø—Ä–æ—Å—ã —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
```bash
Authorization: Bearer invalid-token-here
‚Üí {"success": false, "error": "Unauthorized - user authentication required"}
```

‚úÖ –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω

---

## 4. –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –æ —Ç–µ–∫—É—â–µ–º JWT_SECRET

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï**: –¢–µ–∫—É—â–∏–π JWT_SECRET –≤ .env —Ñ–∞–π–ª–µ:
```
JWT_SECRET=unifarm_jwt_secret_key_2025_production
```

–≠—Ç–æ—Ç —Å–µ–∫—Ä–µ—Ç –±—ã–ª —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω, —Ç–∞–∫ –∫–∞–∫:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∫–∞–∫ fallback –≤ –∫–æ–¥–µ
- –ë—ã–ª –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
1. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π JWT_SECRET (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
3. –•—Ä–∞–Ω–∏—Ç—å –µ–≥–æ —Ç–æ–ª—å–∫–æ –≤ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## 5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- üî¥ 4 –º–µ—Å—Ç–∞ —Å —Ö–∞—Ä–¥–∫–æ–¥–∞–º–∏ JWT —Å–µ–∫—Ä–µ—Ç–æ–≤
- üî¥ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –±–µ–∑ JWT_SECRET –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- üî¥ –£—Ç–µ—á–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –í—Å–µ —Ö–∞—Ä–¥–∫–æ–¥—ã —É–¥–∞–ª–µ–Ω—ã
- ‚úÖ JWT —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ JWT_SECRET - –æ—à–∏–±–∫–∞
- ‚úÖ –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

JWT —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–∞ –æ—Ç —Ö–∞—Ä–¥–∫–æ–¥–æ–≤ –∏ —Ç—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ü–µ—Ä–µ–¥ production –∑–∞–ø—É—Å–∫–æ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JWT_SECRET –Ω–∞ –Ω–æ–≤—ã–π, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Å—Ç–æ–π–∫–∏–π —Å–µ–∫—Ä–µ—Ç.