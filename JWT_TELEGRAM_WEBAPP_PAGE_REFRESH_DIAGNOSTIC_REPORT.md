# JWT Token Authentication Issue –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Telegram WebApp
## –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –æ—Ç 28 –∏—é–ª—è 2025

### üö® –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É "–æ–±–Ω–æ–≤–∏—Ç—å" –≤ Telegram WebApp –∏–ª–∏ —á–µ—Ä–µ–∑ Replit Preview –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```json
{"success":false,"error":"Authentication required","need_jwt_token":true}
```

### üîç –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã JWT —Å–∏—Å—Ç–µ–º—ã

#### 1. –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
**–§–∞–π–ª**: `client/src/contexts/userContext.tsx`
- **–°—Ç—Ä–æ–∫–∞ 272**: `localStorage.setItem('unifarm_jwt_token', authResponse.data.token);`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram initData
- **–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: `const existingToken = localStorage.getItem('unifarm_jwt_token');` (—Å—Ç—Ä–æ–∫–∞ 259)

#### 2. Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
**–§–∞–π–ª**: `core/middleware/telegramAuth.ts`
- **–°—Ç—Ä–æ–∫–∏ 30-114**: –ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ JWT –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: 
  ```typescript
  if (authHeader && authHeader.startsWith('Bearer ')) {
    const token = authHeader.substring(7);
    const decoded = jwt.verify(token, jwtSecret) as any;
  ```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–∫–µ–Ω –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ Authorization header

#### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ API –∑–∞–ø—Ä–æ—Å–∞—Ö
**–§–∞–π–ª**: `client/src/lib/correctApiRequest.ts`
- **–°—Ç—Ä–æ–∫–∏ 42-60**: –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏
```typescript
// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ localStorage
let token = localStorage.getItem('unifarm_jwt_token');
if (token) {
  requestHeaders['Authorization'] = `Bearer ${token}`;
}
```

#### 4. –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
**–§–∞–π–ª**: `client/src/lib/tokenRefreshHandler.ts`
- **–°—Ç—Ä–æ–∫–∏ 34-78**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `/api/v2/auth/refresh`
- **–ü—Ä–æ–±–ª–µ–º–∞**: Endpoint `/api/v2/auth/refresh` –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–æ—É—Ç–∞—Ö

### üêõ –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞ #1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
**–°–∏–º–ø—Ç–æ–º**: –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã UserContext –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω –≤ localStorage
**–ü—Ä–∏—á–∏–Ω–∞**: Race condition –º–µ–∂–¥—É –∑–∞–≥—Ä—É–∑–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —á—Ç–µ–Ω–∏–µ–º localStorage
**–õ–æ–∫–∞—Ü–∏—è**: `userContext.tsx` —Å—Ç—Ä–æ–∫–∏ 258-289

#### –ü—Ä–æ–±–ª–µ–º–∞ #2: Middleware –º–æ–∂–µ—Ç –Ω–µ –ø–æ–ª—É—á–∞—Ç—å Authorization header
**–°–∏–º–ø—Ç–æ–º**: API –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ Authorization header
**–ü—Ä–∏—á–∏–Ω–∞**: `correctApiRequest.ts` –º–æ–∂–µ—Ç –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏
**–õ–æ–∫–∞—Ü–∏—è**: `correctApiRequest.ts` —Å—Ç—Ä–æ–∫–∏ 35-80

#### –ü—Ä–æ–±–ª–µ–º–∞ #3: Missing refresh endpoint
**–°–∏–º–ø—Ç–æ–º**: tokenRefreshHandler.ts –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ `/api/v2/auth/refresh`
**–ü—Ä–∏—á–∏–Ω–∞**: –≠—Ç–æ—Ç endpoint –º–æ–∂–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ server routes
**–õ–æ–∫–∞—Ü–∏—è**: `tokenRefreshHandler.ts` —Å—Ç—Ä–æ–∫–∞ 34

#### –ü—Ä–æ–±–ª–µ–º–∞ #4: Telegram WebApp lifecycle mismatch
**–°–∏–º–ø—Ç–æ–º**: –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Telegram initData –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
**–ü—Ä–∏—á–∏–Ω–∞**: Telegram WebApp –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–∑—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å initData –ø—Ä–∏ refresh
**–õ–æ–∫–∞—Ü–∏—è**: `userContext.tsx` —Å—Ç—Ä–æ–∫–∏ 261-289

### ‚úÖ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã JWT —Ç–æ–∫–µ–Ω–æ–≤

#### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT - –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê ‚úÖ
**–§–∞–π–ª**: `modules/auth/routes.ts` - —Å—Ç—Ä–æ–∫–∞ 66
```typescript
router.post('/refresh', liberalRateLimit, validateBody(refreshTokenSchema), authController.refreshToken.bind(authController));
```

**–§–∞–π–ª**: `modules/auth/controller.ts` - —Å—Ç—Ä–æ–∫–∏ 234-274
- –ú–µ—Ç–æ–¥ `refreshToken()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–§–∞–π–ª**: `modules/auth/service.ts` - —Å—Ç—Ä–æ–∫–∞ 548+
- –ú–µ—Ç–æ–¥ `refreshToken()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –¥–≤–æ–π–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- Fallback –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è user_id
- –ü–æ–ª–Ω–∞—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞

#### –ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ backend - —Å–∏—Å—Ç–µ–º–∞ refresh —Ä–∞–±–æ—Ç–∞–µ—Ç! ‚úÖ

### üîß –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: Frontend timing issues

#### –ü—Ä–æ–±–ª–µ–º–∞ #1: Race condition –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
**–°–∏–º–ø—Ç–æ–º**: UserContext –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Telegram WebApp
**–õ–æ–∫–∞—Ü–∏—è**: `userContext.tsx` —Å—Ç—Ä–æ–∫–∏ 258-289
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ API –∑–∞–ø—Ä–æ—Å–∞–º–∏

#### –ü—Ä–æ–±–ª–µ–º–∞ #2: correctApiRequest –º–æ–∂–µ—Ç –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω
**–°–∏–º–ø—Ç–æ–º**: API –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ Authorization header –ø—Ä–∏ refresh
**–õ–æ–∫–∞—Ü–∏—è**: `correctApiRequest.ts` —Å—Ç—Ä–æ–∫–∏ 42-60
**–†–µ—à–µ–Ω–∏–µ**: –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

#### –ü—Ä–æ–±–ª–µ–º–∞ #3: Telegram initData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ page refresh
**–°–∏–º–ø—Ç–æ–º**: –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `window.Telegram.WebApp.initData` –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º
**–õ–æ–∫–∞—Ü–∏—è**: `userContext.tsx` —Å—Ç—Ä–æ–∫–∞ 261
**–†–µ—à–µ–Ω–∏–µ**: Fallback –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π JWT —Ç–æ–∫–µ–Ω –≤–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### üîß –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #1: –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
```typescript
// –í userContext.tsx - –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ refreshUserData()
const existingToken = localStorage.getItem('unifarm_jwt_token');
if (existingToken) {
  console.log('[UserContext] –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å...');
  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω
  try {
    const testResponse = await correctApiRequest('/api/v2/users/profile');
    if (testResponse.success) {
      console.log('[UserContext] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...');
      return; // –í—ã—Ö–æ–¥–∏–º, —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
    }
  } catch (error) {
    console.log('[UserContext] –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–µ–º refresh...');
  }
}
```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #2: –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ correctApiRequest
```typescript
// –í correctApiRequest.ts - —É—Å–∏–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞
let token = localStorage.getItem('unifarm_jwt_token');
if (!token) {
  console.warn('[correctApiRequest] ‚ö†Ô∏è JWT —Ç–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ');
  // –ù–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ –≤ production
  if (url.includes('/api/v2/') && !url.includes('/auth/')) {
    throw new Error('JWT —Ç–æ–∫–µ–Ω —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤');
  }
}
```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ #3: –ò–∑–±–µ–≥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ refresh
```typescript
// –í userContext.tsx - –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É
// –ï—Å–ª–∏ –µ—Å—Ç—å Telegram initData –∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞, —Å–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–µ–º—Å—è
if (initData && !existingToken && !authorizationAttemptedRef.current) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –Ω–µ page refresh (–µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏)
  const lastSession = localStorage.getItem('unifarm_last_session');
  if (lastSession) {
    console.log('[UserContext] –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Å–µ—Å—Å–∏—è, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é');
    return;
  }
  // –¢–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π –≤—ã–ø–æ–ª–Ω—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
  authorizationAttemptedRef.current = true;
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
}
```

### üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. **‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**: –ü—Ä–æ–≤–µ—Ä–µ–Ω `/api/v2/auth/refresh` endpoint - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
2. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ userContext
3. **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –£—Å–∏–ª–∏—Ç—å –ª–æ–≥–∏–∫—É correctApiRequest –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞
4. **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ò–∑–±–µ–≥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ page refresh (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é)

### üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. –í–æ–π—Ç–∏ –≤ Telegram WebApp
2. –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±—Ä–∞—É–∑–µ—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –≤ localStorage
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É Authorization header –≤ API –∑–∞–ø—Ä–æ—Å–∞—Ö
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç middleware –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã

### üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- **Token persistence rate**: –ü—Ä–æ—Ü–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞ –ø–æ—Å–ª–µ refresh
- **Auth header success rate**: –ü—Ä–æ—Ü–µ–Ω—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º Authorization header
- **Middleware pass rate**: –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ telegramAuth middleware
- **Recovery success rate**: –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ refresh

### üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–ª–∂–Ω–æ:
1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å JWT —Ç–æ–∫–µ–Ω –≤ localStorage
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å Authorization header –≤–æ –≤—Å–µ API –∑–∞–ø—Ä–æ—Å—ã
3. –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É telegramAuth middleware
4. –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É "Authentication required"
5. –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏