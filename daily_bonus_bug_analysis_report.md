# üêû –ê–Ω–∞–ª–∏–∑ —Å–±–æ—è Daily Bonus - UniFarm
**–î–∞—Ç–∞:** 12.07.2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–ª—Å—è, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –∏ –Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚ùå **Undefined –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ daily_bonus_logs**
**–§–∞–π–ª:** `modules/dailyBonus/service.ts:204-205`

```typescript
// –ü–†–û–ë–õ–ï–ú–ê: currentBalance –∏ newBalance –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
previous_balance: currentBalance,  // undefined
new_balance: newBalance,          // undefined
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ:
```typescript
const currentBalance = user.balance_uni || 0;
// ... –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
const newBalance = currentBalance + parseFloat(bonusAmount);
```

### 2. ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** 
**–§–∞–π–ª:** `modules/dailyBonus/service.ts:179, 239, 299`

```typescript
// –ë–´–õ–û: 
type: 'DAILY_BONUS'  // –í –º–æ–¥–µ–ª–∏ —Ç–∞–∫–æ–≥–æ –Ω–µ—Ç!

// –°–¢–ê–õ–û:
type: 'daily_bonus'  // –°–æ–≥–ª–∞—Å–Ω–æ modules/transactions/model.ts:27
```

### 3. ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –æ—à–∏–±–∫–∏**
**–§–∞–π–ª:** `modules/dailyBonus/service.ts:153`

```typescript
// –ë–´–õ–û:
return { success: false, message: result.error || '–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–∞' };

// –°–¢–ê–õ–û:
return { success: false, error: result.error || '–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–∞' };
```

## üìä –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:

1. ‚úÖ **–ë–∞–ª–∞–Ω—Å –Ω–∞—á–∏—Å–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ**
   - –ë—ã–ª–æ: 1,004,900.123 UNI
   - –°—Ç–∞–ª–æ: 1,006,100.12 UNI
   - –ù–∞—á–∏—Å–ª–µ–Ω–æ: ~1,200 UNI (–≤–º–µ—Å—Ç–æ 600 UNI!)

2. ‚ùå **–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ daily_bonus_logs**
   - Undefined –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤—ã–∑–≤–∞–ª–∏ —Å–±–æ–π INSERT
   - –û–ø–µ—Ä–∞—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞ error

3. ‚ùå **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞–ª–∞—Å—å**
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø 'DAILY_BONUS' –≤–º–µ—Å—Ç–æ 'daily_bonus'
   - –û—à–∏–±–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å (—Ç–æ–ª—å–∫–æ logger.warn)

4. ‚ùå **UI –ø–æ–∫–∞–∑–∞–ª –æ—à–∏–±–∫—É**
   - –ò–∑-–∑–∞ –æ—à–∏–±–∫–∏ –≤ daily_bonus_logs –≤–µ—Ä–Ω—É–ª—Å—è success: false
   - –•–æ—Ç—è –±–∞–ª–∞–Ω—Å –±—ã–ª –Ω–∞—á–∏—Å–ª–µ–Ω

## üéØ –î–≤–æ–π–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ (1,200 –≤–º–µ—Å—Ç–æ 600):

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É
2. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
3. Race condition –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

## üìÅ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

1. **modules/dailyBonus/service.ts**
   - –°—Ç—Ä–æ–∫–∏ 143-163: –î–æ–±–∞–≤–ª–µ–Ω—ã currentBalance –∏ newBalance
   - –°—Ç—Ä–æ–∫–∞ 179: type: 'daily_bonus'
   - –°—Ç—Ä–æ–∫–∞ 239: type: 'daily_bonus' –≤ –∏—Å—Ç–æ—Ä–∏–∏
   - –°—Ç—Ä–æ–∫–∞ 299: type: 'daily_bonus' –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
   - –°—Ç—Ä–æ–∫–∞ 153: error –≤–º–µ—Å—Ç–æ message

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
2. **–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞** –≤ UI
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞** - –ø–æ—á–µ–º—É 1,200 –≤–º–µ—Å—Ç–æ 600?

## ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- daily_bonus_logs –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- UI –ø–æ–ª—É—á–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π success: true –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ–∫–∞–∂–µ—Ç DAILY_BONUS –∑–∞–ø–∏—Å–∏

**–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞!