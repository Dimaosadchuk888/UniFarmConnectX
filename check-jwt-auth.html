<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>UniFarm JWT & API –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: #fff; }
        .section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        pre { background: #333; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { background: #4CAF50; color: white; border: none; padding: 10px 20px; 
                border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>üîç UniFarm JWT & API –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
    
    <div class="section">
        <h2>üì¶ LocalStorage –î–∞–Ω–Ω—ã–µ</h2>
        <div id="localStorage-info"></div>
    </div>
    
    <div class="section">
        <h2>üîê JWT –¢–æ–∫–µ–Ω –ê–Ω–∞–ª–∏–∑</h2>
        <div id="jwt-info"></div>
    </div>
    
    <div class="section">
        <h2>üåê API –¢–µ—Å—Ç—ã</h2>
        <button onclick="testAPI('/api/v2/users/profile')">–¢–µ—Å—Ç /api/v2/users/profile</button>
        <button onclick="testAPI('/api/v2/wallet/balance')">–¢–µ—Å—Ç /api/v2/wallet/balance</button>
        <button onclick="testAPI('/api/v2/auth/refresh')">–¢–µ—Å—Ç /api/v2/auth/refresh</button>
        <div id="api-results"></div>
    </div>
    
    <div class="section">
        <h2>üîß –î–µ–π—Å—Ç–≤–∏—è</h2>
        <button onclick="generateNewJWT()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π JWT –¥–ª—è user ID 74</button>
        <button onclick="clearAuth()">–û—á–∏—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage
        function checkLocalStorage() {
            const div = document.getElementById('localStorage-info');
            const jwtToken = localStorage.getItem('unifarm_jwt_token');
            const userId = localStorage.getItem('unifarm_user_id');
            const guestId = localStorage.getItem('unifarm_guest_id');
            
            let html = '<pre>';
            html += `JWT Token: ${jwtToken ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}\n`;
            html += `User ID: ${userId || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}\n`;
            html += `Guest ID: ${guestId || '–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}\n`;
            html += '</pre>';
            
            div.innerHTML = html;
            
            // –ê–Ω–∞–ª–∏–∑ JWT
            if (jwtToken) {
                analyzeJWT(jwtToken);
            }
        }
        
        // –ê–Ω–∞–ª–∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
        function analyzeJWT(token) {
            const div = document.getElementById('jwt-info');
            try {
                const parts = token.split('.');
                if (parts.length !== 3) {
                    div.innerHTML = '<p class="error">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JWT —Ç–æ–∫–µ–Ω–∞</p>';
                    return;
                }
                
                const payload = JSON.parse(atob(parts[1]));
                const exp = new Date(payload.exp * 1000);
                const now = new Date();
                const isExpired = exp < now;
                
                let html = '<pre>';
                html += `User ID: ${payload.userId}\n`;
                html += `Telegram ID: ${payload.telegram_id}\n`;
                html += `Username: ${payload.username || '–ù–µ —É–∫–∞–∑–∞–Ω'}\n`;
                html += `Ref Code: ${payload.ref_code || '–ù–µ —É–∫–∞–∑–∞–Ω'}\n`;
                html += `–ò—Å—Ç–µ–∫–∞–µ—Ç: ${exp.toLocaleString('ru-RU')}\n`;
                html += `–°—Ç–∞—Ç—É—Å: ${isExpired ? '‚ùå –ò—Å—Ç—ë–∫' : '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω'}\n`;
                html += '</pre>';
                
                if (isExpired) {
                    html += '<p class="error">‚ö†Ô∏è –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫! –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.</p>';
                }
                
                div.innerHTML = html;
            } catch (e) {
                div.innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JWT: ' + e.message + '</p>';
            }
        }
        
        // –¢–µ—Å—Ç API
        async function testAPI(endpoint) {
            const resultsDiv = document.getElementById('api-results');
            const token = localStorage.getItem('unifarm_jwt_token');
            
            resultsDiv.innerHTML += `<h3>–¢–µ—Å—Ç ${endpoint}</h3>`;
            
            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'Authorization': token ? `Bearer ${token}` : '',
                        'Content-Type': 'application/json'
                    }
                });
                
                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch {
                    data = text;
                }
                
                let statusClass = response.ok ? 'success' : 'error';
                resultsDiv.innerHTML += `
                    <div class="${statusClass}">
                        –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}<br>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="error">
                        –û—à–∏–±–∫–∞: ${error.message}
                    </div>
                `;
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ JWT
        function generateNewJWT() {
            // JWT –¥–ª—è user ID 74 (telegram_id: 999489)
            const newToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjc0LCJ0ZWxlZ3JhbV9pZCI6OTk5NDg5LCJ1c2VybmFtZSI6InRlc3RfdXNlcl83NCIsInJlZl9jb2RlIjoiUkVGXzE3NTIxNTY3MDAwMDBfdGVzdCIsImlhdCI6MTc1MjE1NjcwMCwiZXhwIjoxNzUyNzYxNTAwfQ.GENERATED_SIGNATURE';
            
            localStorage.setItem('unifarm_jwt_token', newToken);
            localStorage.setItem('unifarm_user_id', '74');
            
            alert('‚úÖ –ù–æ–≤—ã–π JWT —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è user ID 74. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É Preview.');
            checkLocalStorage();
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function clearAuth() {
            localStorage.removeItem('unifarm_jwt_token');
            localStorage.removeItem('unifarm_user_id');
            alert('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—á–∏—â–µ–Ω–∞');
            checkLocalStorage();
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkLocalStorage();
    </script>
</body>
</html>