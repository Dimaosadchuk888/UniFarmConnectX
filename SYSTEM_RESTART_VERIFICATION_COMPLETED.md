# ‚úÖ –°–ò–°–¢–ï–ú–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ò –ó–ê–í–ï–†–®–ï–ù–ê

## –°—Ç–∞—Ç—É—Å: ROLLBACK –ó–ê–©–ò–¢–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê

**–î–∞—Ç–∞**: 29 –∏—é–ª—è 2025  
**–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏**: 12:08 UTC  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ **–í–°–ï –°–ò–°–¢–ï–ú–´ –†–ê–ë–û–¢–ê–Æ–¢ –ö–û–†–†–ï–ö–¢–ù–û**

---

## –ü–†–û–í–ï–†–ö–ê ROLLBACK –ó–ê–©–ò–¢–´

### ‚úÖ –ö–æ–¥ –∑–∞—â–∏—Ç—ã –∞–∫—Ç–∏–≤–µ–Ω
- **–ù–∞–π–¥–µ–Ω–æ 7 —Ç–æ—á–µ–∫ –∑–∞—â–∏—Ç—ã** —Å —Ç–µ–≥–æ–º `[ANTI_ROLLBACK_PROTECTION]` –≤ –∫–æ–¥–µ
- **SQL —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–ª—é—á–µ–Ω**: `2_clean_duplicates.sql.DISABLED_ROLLBACK_PROTECTION` - –¥—É–±–ª–∏–∫–∞—Ç—ã –Ω–µ –±—É–¥—É—Ç —É–¥–∞–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã** –≤ —Ñ–∞–π–ª–∞—Ö:
  - `core/BalanceManager.ts` - –æ—Ç–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω—É–ª–µ–Ω–∏–µ
  - `core/TransactionEnforcer.ts` - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
  - `core/BatchBalanceProcessor.ts` - –º–∞—Å—Å–æ–≤–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
  - `modules/transactions/service.ts` - –ø–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
  - `core/TransactionService.ts` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã

### ‚úÖ –°–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- **–ü—Ä–æ—Ü–µ—Å—Å**: `node tsx server/index.ts` (PID: 795)
- **–ü–∞–º—è—Ç—å**: –ß–∏—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- **API Endpoints**: –û—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∫–∞–∫ –∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è)
- **WebApp**: Frontend –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Preview —Ä–µ–∂–∏–º–µ

---

## –°–ò–°–¢–ï–ú–ù–´–ô –°–¢–ê–¢–£–°

### ‚úÖ Core API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```
GET /api/v2/auth/check ‚Üí {"success":false,"error":"Authorization token required"} ‚úÖ
GET /api/v2/wallet/balance ‚Üí {"success":false,"error":"Authentication required","need_jwt_token":true} ‚úÖ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### ‚úÖ Frontend —Å–æ—Å—Ç–æ—è–Ω–∏–µ  
- **Telegram WebApp**: –£—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- **UniFarm Application**: –ó–∞–ø—É—â–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
- **Preview Mode**: –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (ID: 184)
- **User Balance**: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (881,831.043 UNI, 39.507 TON)
- **WebSocket**: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã

### ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL**: –î–æ—Å—Ç—É–ø–Ω–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- **Transactions Table**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **Users Table**: –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã

---

## –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ ROLLBACK –ó–ê–©–ò–¢–´

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚ùå **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω—É–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤** –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤  
‚ùå **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π** –∫–∞–∫ "–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö"  
‚ùå **–ú–∞—Å—Å–æ–≤–∞—è –ø–æ—Ç–µ—Ä—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤**  
‚ùå **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –±–∞–ª–∞–Ω—Å–æ–≤ –∫ (0, 0)**  
‚ùå **–£–¥–∞–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π-–¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –±–µ–∑ –∞–Ω–∞–ª–∏–∑–∞  
‚ùå **–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∞–Ω–∏—è** —á–µ—Ä–µ–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é  
‚ùå **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ "–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏"** –ø—Ä–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö  

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
‚úÖ **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
‚úÖ **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã** –Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏  
‚úÖ **–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã** –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫  
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –±–∞–ª–∞–Ω—Å–æ–≤  
‚úÖ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∫–∞—Ç–æ–≤** –æ–ø–µ—Ä–∞—Ü–∏–π  

---

## –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ö–û–ù–¢–†–û–õ–¨

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ:
- **–¢–µ–≥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**: `[ANTI_ROLLBACK_PROTECTION]` –¥–ª—è –≤—Å–µ—Ö –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–ª–∞–Ω—Å—ã**: –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–û–ø–µ—Ä–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–ø—ã—Ç–æ–∫ rollback

### –§–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- **`replit.md`**: –û–±–Ω–æ–≤–ª–µ–Ω —Å –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **`ROLLBACK_PROTECTION_STATUS.sql`**: –°—Ç–∞—Ç—É—Å –∑–∞—â–∏—Ç—ã –∏ –ø–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- **`ROLLBACK_PROTECTION_DEPLOYMENT_COMPLETED.md`**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¶–ï–ù–ö–ê

**üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢ –î–û–°–¢–ò–ì–ù–£–¢:**

‚úÖ **–°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∏–ª–∏ –≤ —Å–∏–ª—É  
‚úÖ **Rollback –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞** - 7/7 —Å–∏—Å—Ç–µ–º –æ—Ç–∫–ª—é—á–µ–Ω—ã  
‚úÖ **API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞** - –æ—Å–Ω–æ–≤–Ω—ã–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ **Frontend –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å  
‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–±–∏–ª—å–Ω–∞** - –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - –≤—Å–µ –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è  

**User 25 –∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤.**

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö rollback –æ–ø–µ—Ä–∞—Ü–∏–π.

---

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ú–û–ù–ò–¢–û–†–ò–ù–ì–£

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å User 25**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ "–≤–æ–∑–≤—Ä–∞—Ç—ã" –ø—Ä–µ–∫—Ä–∞—Ç–∏–ª–∏—Å—å
2. **–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ª–æ–≥–∏**: –ò—Å–∫–∞—Ç—å —Ç–µ–≥–∏ `[ANTI_ROLLBACK_PROTECTION]` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
3. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã**: –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏
4. **–ù–∞–±–ª—é–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∑–∞—â–∏—Ç

**–°—Ç–∞—Ç—É—Å**: üü¢ **–°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –°–¢–ê–ë–ò–õ–¨–ù–ê –ò –ó–ê–©–ò–©–ï–ù–ê**