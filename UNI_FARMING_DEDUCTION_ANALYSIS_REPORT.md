# üîç –ê–ù–ê–õ–ò–ó: –°–ø–∏—Å–∞–Ω–∏–µ UNI –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥–∞

**–î–∞—Ç–∞:** 9 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–û–î –ò–°–ü–†–ê–í–õ–ï–ù, –Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–¥–∞

### ‚úÖ –°–ø–∏—Å–∞–Ω–∏–µ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –≤ –∫–æ–¥–µ

–í —Ñ–∞–π–ª–µ `modules/farming/service.ts` –º–µ—Ç–æ–¥ `depositUniForFarming()`:

1. **–°—Ç—Ä–æ–∫–∏ 231-236**: –í—ã–∑–æ–≤ —Å–ø–∏—Å–∞–Ω–∏—è —á–µ—Ä–µ–∑ BalanceManager
```typescript
const balanceUpdateResult = await balanceManager.subtractBalance(
  user.id,
  depositAmount,
  0,
  'UNI farming deposit'
);
```

2. **–°—Ç—Ä–æ–∫–∏ 238-244**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å–ø–∏—Å–∞–Ω–∏—è
```typescript
if (!balanceUpdateResult.success) {
  logger.error('[FarmingService] –≠–¢–ê–ü 6.1: –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞', { 
    error: balanceUpdateResult.error,
    userId: user.id
  });
  return { success: false, message: '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞' };
}
```

3. **–°—Ç—Ä–æ–∫–∏ 292-295**: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ —Å–ø–∏—Å–∞–Ω–∏–µ–º
```typescript
const transactionPayload = {
  user_id: user.id,
  type: 'FARMING_REWARD',  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–∏–ø
  amount_uni: (-depositAmount).toString(),  // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞ = —Å–ø–∏—Å–∞–Ω–∏–µ
  amount_ton: '0',
  status: 'confirmed',
  description: `UNI farming deposit: ${amount}`
};
```

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–¥ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –°–∏–º–ø—Ç–æ–º—ã:
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 62 —Ä–∞—Å—Ç—ë—Ç: 448.232969 ‚Üí 448.233698
- –§–ª–∞–≥ `uni_farming_active` = false (—Ö–æ—Ç—è –≤ –∫–æ–¥–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è true)
- –°–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–∞—Ö

### –ü—Ä–∏—á–∏–Ω–∞:
**–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ –°–¢–ê–†–û–ô –≤–µ—Ä—Å–∏–µ–π –∫–æ–¥–∞**, –≥–¥–µ:
- –ù–µ—Ç –≤—ã–∑–æ–≤–∞ `balanceManager.subtractBalance()`
- –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ `uni_farming_active = true`
- –ù–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `farming_sessions`

## üõ† –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----------|-----------|---------|
| –°–ø–∏—Å–∞–Ω–∏–µ UNI | –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `subtractBalance()` | ‚úÖ –í –∫–æ–¥–µ |
| –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `uni_farming_active = true` | ‚úÖ –í –∫–æ–¥–µ |
| –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π | –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `farming_sessions` | ‚úÖ –í –∫–æ–¥–µ |
| –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–ª–∞–≥ `uni_farming_active` | ‚úÖ –í –∫–æ–¥–µ |
| –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –°–æ–∑–¥–∞—ë—Ç—Å—è —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π | ‚úÖ –í –∫–æ–¥–µ |

## üìå –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ñ–ª–∞–≥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 62** —á–µ—Ä–µ–∑ `fix-user-62-active-farming.html`
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç** –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ `FARMING_REWARD` –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è (—Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º–æ–π). –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ:
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø `FARMING_DEPOSIT` –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏–π
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ç–∏–ø `DEBIT` / `WITHDRAW`

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ:

–ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Å–ø–∏—Å–∞–Ω–∏—è. –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ **—Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π –∫–æ–¥–∞**. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.