# üîç –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ - –ê–ù–ê–õ–ò–ó –î–£–ë–õ–ò–ö–ê–¢–û–í –¢–†–ê–ù–ó–ê–ö–¶–ò–ô

**–î–∞—Ç–∞:** 3 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –ù–ê–ô–î–ï–ù–ê  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  

## üìä –û–°–ù–û–í–ù–´–ï –í–´–í–û–î–´

### –†–µ–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
**–°–∏—Å—Ç–µ–º–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ —Ñ–∞—Ä–º–∏–Ω–≥–∞**

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:
- **405 –≥—Ä—É–ø–ø –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
- **1000 REFERRAL_REWARD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - –≤—Å–µ –±–µ–∑ tx_hash_unique
- **0% –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏** –¥–ª—è REFERRAL_REWARD —Ç–∏–ø–∞
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏:** 101 —Å–µ–∫—É–Ω–¥–∞

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
1. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ñ–∞—Ä–º–∏–Ω–≥–∞** (`core/scheduler/farmingScheduler.ts:321-337`) –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
2. **–í—ã–∑—ã–≤–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É** (`modules/referral/service.ts:331-345`)
3. **–°–æ–∑–¥–∞–µ—Ç REFERRAL_REWARD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
4. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** –ø–æ—Ç–æ–º—É —á—Ç–æ REFERRAL_REWARD –Ω–µ –∏–º–µ—é—Ç tx_hash_unique

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏:
```typescript
// core/scheduler/farmingScheduler.ts:321-337
const referralResult = await referralService.distributeReferralRewards(
  farmer.user_id.toString(),
  income,
  'UNI',
  'farming'
);

// modules/referral/service.ts:331-345
await transactionService.createTransaction({
  user_id: parseInt(commission.userId),
  type: 'REFERRAL_REWARD',
  // ‚ùå –ù–ï–¢ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
});

// core/TransactionService.ts:105-156
const txHashToCheck = metadata?.tx_hash || metadata?.ton_tx_hash;
if (txHashToCheck) {
  // ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å tx_hash
}
// ‚ùå –ù–ï–¢ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è REFERRAL_REWARD
```

## üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –†–ï–®–ï–ù–ò–Ø

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥:
**–î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è REFERRAL_REWARD –≤ TransactionService**

### –õ–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:
1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø** `type === 'REFERRAL_REWARD'`
2. **–°–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á** –∏–∑ `user_id + source_user_id + level + amount`
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏** –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã** –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ:
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** 10 –º–∏–Ω—É—Ç (600 —Å–µ–∫—É–Ω–¥)
- **–ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö:** –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ 296 —Å–µ–∫—É–Ω–¥

## üîí –ü–õ–ê–ù –ë–ï–ó–û–ü–ê–°–ù–û–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. ‚úÖ **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞** - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
2. ‚úÖ **–¢–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - TransactionService.ts
3. ‚ùå **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä–∫–µ
4. ‚ùå **–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞** —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –≠—Ç–∞–ø 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
1. ‚ùå **–î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é REFERRAL_REWARD** –≤ createTransaction()
2. ‚ùå **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
3. ‚ùå **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**
4. ‚ùå **–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω**

### –≠—Ç–∞–ø 3: –í–∞–ª–∏–¥–∞—Ü–∏—è
1. ‚ùå **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
2. ‚ùå **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π**
3. ‚ùå **–ê—É–¥–∏—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **–ù–ï –ù–ê–†–£–®–ê–¢–¨** —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É
- **–ù–ï –í–õ–ò–Ø–¢–¨** –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–°–û–•–†–ê–ù–ò–¢–¨** –≤—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- **–î–û–ë–ê–í–ò–¢–¨** —Ç–æ–ª—å–∫–æ –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ –º–∞–ª–æ–π –≤—ã–±–æ—Ä–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
- **–£–±–µ–¥–∏—Ç—å—Å—è** –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ:
- ‚úÖ **–ü–æ–ª–Ω–æ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ** –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ REFERRAL_REWARD
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:
- ‚úÖ **–ß–∏—Å—Ç–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å** –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å**

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

**–°—Ç–∞—Ç—É—Å:** –ì–û–¢–û–í –ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò  
**–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å:** 95%  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 15-30 –º–∏–Ω—É—Ç  
**–†–∏—Å–∫–∏:** –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ï –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –≤–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π