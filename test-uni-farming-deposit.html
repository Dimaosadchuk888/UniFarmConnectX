<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test UNI Farming Deposit</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background: #333;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test UNI Farming Deposit</h1>
        <button onclick="testDeposit(5)">Deposit 5 UNI</button>
        <button onclick="testDeposit(10)">Deposit 10 UNI</button>
        <button onclick="testDeposit(25)">Deposit 25 UNI</button>
        <button onclick="checkBalance()">Check Balance</button>
        <button onclick="checkFarmingStatus()">Check Farming Status</button>
        <div id="result" class="result"></div>
    </div>

    <script>
        const JWT_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjc0LCJ0ZWxlZ3JhbV9pZCI6OTk5NDg5LCJ1c2VybmFtZSI6InRlc3RfdXNlcl8xNzUyMTI5ODQwOTA1IiwicmVmX2NvZGUiOiJSRUZfMTc1MjEyOTg0MDkwNl9hNGRha3ciLCJpYXQiOjE3NTIxMjk4NDIsImV4cCI6MTc1MjczNDY0Mn0.wbXSPiEkUrXgvGJqFcJEaGeFMD3zM0sQzl_-tYg_lro';
        
        function log(message) {
            const result = document.getElementById('result');
            result.textContent += `[${new Date().toISOString()}] ${message}\n`;
            console.log(message);
        }

        async function makeRequest(url, method = 'GET', body = null) {
            const options = {
                method,
                headers: {
                    'Authorization': `Bearer ${JWT_TOKEN}`,
                    'Content-Type': 'application/json'
                }
            };
            
            if (body) {
                options.body = JSON.stringify(body);
            }

            log(`Making ${method} request to ${url}`);
            if (body) log(`Request body: ${JSON.stringify(body)}`);

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                log(`Response: ${JSON.stringify(data, null, 2)}`);
                return data;
            } catch (error) {
                log(`Error: ${error.message}`);
                throw error;
            }
        }

        async function checkBalance() {
            log('=== Checking Balance ===');
            await makeRequest('/api/v2/wallet/balance?user_id=74');
        }

        async function checkFarmingStatus() {
            log('=== Checking Farming Status ===');
            await makeRequest('/api/v2/uni-farming/status?user_id=74');
        }

        async function testDeposit(amount) {
            log(`\n=== Testing Deposit of ${amount} UNI ===`);
            
            // Check balance before
            log('Step 1: Balance before deposit');
            const balanceBefore = await makeRequest('/api/v2/wallet/balance?user_id=74');
            
            // Make deposit
            log(`Step 2: Making deposit of ${amount} UNI`);
            const depositResponse = await makeRequest(
                '/api/v2/uni-farming/deposit',
                'POST',
                { amount: amount.toString(), user_id: 74 }
            );
            
            // Wait a bit
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Check balance after
            log('Step 3: Balance after deposit');
            const balanceAfter = await makeRequest('/api/v2/wallet/balance?user_id=74');
            
            // Check farming status
            log('Step 4: Farming status after deposit');
            const farmingStatus = await makeRequest('/api/v2/uni-farming/status?user_id=74');
            
            // Summary
            log('\n=== Summary ===');
            log(`Balance before: ${balanceBefore.data?.balance_uni || 'N/A'} UNI`);
            log(`Balance after: ${balanceAfter.data?.balance_uni || 'N/A'} UNI`);
            log(`Difference: ${(parseFloat(balanceBefore.data?.balance_uni || 0) - parseFloat(balanceAfter.data?.balance_uni || 0)).toFixed(3)} UNI`);
            log(`Farming active: ${farmingStatus.data?.uni_farming_active ? 'Yes' : 'No'}`);
            log(`Deposit amount: ${farmingStatus.data?.uni_deposit_amount || 0} UNI`);
        }

        // Initial check
        window.onload = async () => {
            log('Page loaded, checking initial state...');
            await checkBalance();
            await checkFarmingStatus();
        };
    </script>
</body>
</html>