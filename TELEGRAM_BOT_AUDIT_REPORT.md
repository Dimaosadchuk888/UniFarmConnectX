# üìã –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç Telegram-–±–æ—Ç–∞ UniFarm

## üìÅ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–æ—Ç–∞
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `modules/telegram/controller.ts`
**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Telegram Bot API —á–µ—Ä–µ–∑ fetch (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç node-telegram-bot-api –∏–ª–∏ telegraf)
**–ó–∞–ø—É—Å–∫:** –ß–µ—Ä–µ–∑ webhook endpoint –≤ `server/index.ts`
**–ú–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç—ã:** Webhook + polling fallback

### 2. –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `modules/telegram/service.ts`
**–§—É–Ω–∫—Ü–∏–∏:** –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å–∞, —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

### 3. Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `core/middleware/adminAuth.ts`
**–ú–µ—Ö–∞–Ω–∏–∑–º:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—è `is_admin` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`

---

## üõ†Ô∏è –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|---------|-------------------|---------|------|---------------|
| `/admin` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:84 | –§—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:86 | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –±–∞–ª–∞–Ω—Å—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| `/users` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:88 | –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –≤—ã–≤–æ–¥, 10 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É |
| `/user <id>` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:91 | –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ telegram_id |
| `/missions` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏—Å—Å–∏—è–º–∏ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:93 | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –º–∏—Å—Å–∏–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `/mission_complete <id>` | –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏—Å—Å–∏—é | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:98 | –û—Ç–º–µ—á–∞–µ—Ç –º–∏—Å—Å–∏—é –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é |
| `/mission_reward <id>` | –í—ã–¥–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:100 | –ù–∞—á–∏—Å–ª—è–µ—Ç –Ω–∞–≥—Ä–∞–¥—É –∑–∞ –º–∏—Å—Å–∏—é |
| `/ban <id>` | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | controller.ts:96 | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç is_active=false |

---

## üí∏ –ú–æ–¥—É–ª—å –≤—ã–ø–ª–∞—Ç

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|----------|
| **–¢–∞–±–ª–∏—Ü–∞ payout_requests** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –í –ë–î –Ω–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–ø–ª–∞—Ç—ã |
| **–ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–ª–∞—Ç** | ‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã | –ù–µ—Ç –∫–æ–º–∞–Ω–¥ `/payouts`, `/confirm`, `/reject` |
| **API –≤—ã–ø–ª–∞—Ç** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ù–µ—Ç endpoints –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–ø–ª–∞—Ç |
| **–í–Ω–µ—à–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∏** | ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ | –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –±–∞–ª–∞–Ω—Å–∞–º–∏ |

### –í—ã–≤–æ–¥ –ø–æ –≤—ã–ø–ª–∞—Ç–∞–º:
**–°–∏—Å—Ç–µ–º–∞ UniFarm –ù–ï –ò–ú–ï–ï–¢ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–ø–ª–∞—Ç**. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –±–∞–ª–∞–Ω—Å–∞–º–∏ (UNI, TON). –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∏.

---

## üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|----------|
| **sendMessage()** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | service.ts:174 - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π |
| **sendTelegramNotification()** | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ | service.ts:100 - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º |
| **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ã–ø–ª–∞—Ç–∞—Ö** | ‚ùå –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ | –ù–µ—Ç –º–æ–¥—É–ª—è –≤—ã–ø–ª–∞—Ç |
| **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–∏ –∫–æ–º–∞–Ω–¥–µ /start |

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–æ–≤

### –ú–µ—Ö–∞–Ω–∏–∑–º:
1. **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –ü–æ–ª–µ `is_admin` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `checkAdminStatus()` –≤ service.ts:233
3. **Middleware:** `requireAdminAuth` –≤ core/middleware/adminAuth.ts
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–æ–≤ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ core/logger

### –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤:
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ë–î (users.is_admin = true)
- –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ admin_user_ids –≤ –∫–æ–¥–µ
- –ê–¥–º–∏–Ω –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ SQL: `UPDATE users SET is_admin = true WHERE telegram_id = '...'`

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| **TEST_MODE** | ‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω | –ù–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ |
| **NODE_ENV** | production/development | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—ã |
| **BYPASS_AUTH** | false –≤ production | –û—Ç–∫–ª—é—á–∞–µ—Ç –æ–±—Ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ webhook/polling

### Webhook:
- **Endpoints:** `/webhook`, `/api/webhook`, `/bot/webhook`, `/telegram/webhook`
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** server/index.ts:527
- **Fallback:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ polling –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ webhook

### Polling (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π):
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è:** –ü—Ä–∏ 404 –æ—à–∏–±–∫–µ webhook
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 1 —Å–µ–∫—É–Ω–¥–∞
- **–û–±—Ä–∞–±–æ—Ç–∫–∞:** –¢–µ –∂–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ getUpdates API

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:
- ‚ö†Ô∏è **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å –≤—ã–ø–ª–∞—Ç** –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–ª–∞—Ç** –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
- ‚ö†Ô∏è **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É payout_requests** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞—è–≤–æ–∫

### 2. –£–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/help` –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤ `/users` (–ø–æ –±–∞–ª–∞–Ω—Å—É, –¥–∞—Ç–µ)
- ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/notify <user_id> <message>` –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è –∫–æ–º–∞–Ω–¥
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìå –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏: 85%**
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –∞–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –º–∏—Å—Å–∏—è–º–∏
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥—É–ª—å –≤—ã–ø–ª–∞—Ç
- ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**, –Ω–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∏.