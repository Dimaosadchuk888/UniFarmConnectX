# üîç –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢: –ü—Ä–æ–±–ª–µ–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥-–ø–∞–∫–µ—Ç–æ–≤

**–î–∞—Ç–∞:** 08 –∏—é–ª—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

---

## üìã –ö–†–ê–¢–ö–ê–Ø –°–í–û–î–ö–ê

–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥-–ø–∞–∫–µ—Ç–æ–≤ UNI **–¥–µ–ø–æ–∑–∏—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è**, –Ω–æ **–±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** –∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤ `BalanceManager.ts`.

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –î–µ–ø–æ–∑–∏—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Ñ–∞—Ä–º–∏–Ω–≥–µ (totalDepositAmount —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è)
- –§–∞—Ä–º–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –î–æ—Ö–æ–¥—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- API endpoints –æ—Ç–≤–µ—á–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

### ‚ùå –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤

**–¢–µ—Å—Ç 1: –î–µ–ø–æ–∑–∏—Ç 100 UNI**
```bash
curl -X POST "http://localhost:3000/api/v2/uni-farming/deposit" \
  -H "Authorization: Bearer [JWT_TOKEN]" \
  -d '{"amount": "100"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- API –æ—Ç–≤–µ—Ç: `{"success": true, "data": {"success": false, "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ø–æ–∑–∏—Ç–∞"}}`
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 550 UNI (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –î–µ–ø–æ–∑–∏—Ç –≤ —Ñ–∞—Ä–º–∏–Ω–≥–µ: —É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 100 UNI

**–¢–µ—Å—Ç 2: –î–µ–ø–æ–∑–∏—Ç 50 UNI**
```bash
curl -X POST "http://localhost:3000/api/v2/uni-farming/deposit" \
  -H "Authorization: Bearer [JWT_TOKEN]" \
  -d '{"amount": "50"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- API –æ—Ç–≤–µ—Ç: `{"success": true, "data": {"success": false, "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ø–æ–∑–∏—Ç–∞"}}`
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: 550 UNI (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –î–µ–ø–æ–∑–∏—Ç –≤ —Ñ–∞—Ä–º–∏–Ω–≥–µ: —É–≤–µ–ª–∏—á–∏–ª—Å—è –µ—â–µ –Ω–∞ 50 UNI

### 2. –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID 62:**
- **–ë–∞–ª–∞–Ω—Å:** 550 UNI (–Ω–µ–∏–∑–º–µ–Ω–µ–Ω)
- **–§–∞—Ä–º–∏–Ω–≥ –¥–µ–ø–æ–∑–∏—Ç:** 1210.1 UNI (—É–≤–µ–ª–∏—á–∏–ª—Å—è –Ω–∞ 150 UNI)
- **–°—Ç–∞—Ç—É—Å:** –§–∞—Ä–º–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏

**–î–∞–Ω–Ω—ã–µ –∏–∑ API:**
```json
{
  "balance_uni": 550,
  "totalDepositAmount": 1210.1,
  "dailyIncomeUni": "0.240000",
  "isActive": true
}
```

---

## üéØ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### –û—à–∏–±–∫–∞ –≤ `core/BalanceManager.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Å—Ç—Ä–æ–∫–µ 110 BalanceManager –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–æ–Ω–∫—É `last_active`:

```typescript
// core/BalanceManager.ts:110
.update({
  balance_uni: parseFloat(newUniBalance.toFixed(6)),
  balance_ton: parseFloat(newTonBalance.toFixed(6)),
  last_active: new Date().toISOString()  // ‚ùå –ö–û–õ–û–ù–ö–ê –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢
})
```

**–°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã users (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è):**
```json
[
  "balance_ton",
  "balance_uni", 
  "first_name",
  "id",
  "ref_code",
  "telegram_id",
  "username"
]
```

**–û—à–∏–±–∫–∞ –∏–∑ –ª–æ–≥–æ–≤:**
```
[ERROR] [BalanceManager] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞: {
  "user_id": 62,
  "error": "column users.last_active does not exist"
}
```

### –¶–µ–ø–æ—á–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **Frontend:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST `/api/v2/uni-farming/deposit` —Å amount: "100"
2. **Controller:** `farmingController.depositUni()` –≤—ã–∑—ã–≤–∞–µ—Ç `farmingService.depositUniForFarming()`
3. **Service:** `depositUniForFarming()` –≤—ã–∑—ã–≤–∞–µ—Ç `balanceManager.subtractBalance()`
4. **BalanceManager:** –ü—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å `last_active` ‚Üí **–û–®–ò–ë–ö–ê**
5. **Service:** –ü–æ–ª—É—á–∞–µ—Ç `result.success = false` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
6. **Controller:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"success": false, "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ø–æ–∑–∏—Ç–∞"}`

### –í–∞–∂–Ω–æ!
–°–∞–º –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–æ–∑–∏—Ç–∞ –≤ —Ñ–∞—Ä–º–∏–Ω–≥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç **–ø–æ—Å–ª–µ** —Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞, –ø–æ—ç—Ç–æ–º—É:
- –î–µ–ø–æ–∑–∏—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ `uni_deposit_amount` 
- –§–∞—Ä–º–∏–Ω–≥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –ù–æ –±–∞–ª–∞–Ω—Å –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –≤ BalanceManager

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –†–ï–®–ï–ù–ò–ï

### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç A: –£–¥–∞–ª–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_active**
```typescript
// core/BalanceManager.ts:105-114
const { data: updatedUser, error: updateError } = await supabase
  .from('users')
  .update({
    balance_uni: parseFloat(newUniBalance.toFixed(6)),
    balance_ton: parseFloat(newTonBalance.toFixed(6))
    // –£–±—Ä–∞—Ç—å: last_active: new Date().toISOString()
  })
  .eq('id', user_id)
  .select('id, balance_uni, balance_ton') // –£–±—Ä–∞—Ç—å last_active –∏–∑ select
  .single();
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É last_active**
```sql
ALTER TABLE users ADD COLUMN last_active TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –≤—Ö–æ–∂–¥–µ–Ω–∏–π

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–π—Ç–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `last_active`:
```bash
grep -r "last_active" core/ modules/ --include="*.ts"
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –î–µ–ø–æ–∑–∏—Ç 100 UNI –¥–æ–ª–∂–µ–Ω —Å–ø–∏—Å–∞—Ç—å –±–∞–ª–∞–Ω—Å —Å 550 –¥–æ 450 UNI
2. –§–∞—Ä–º–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏

---

## üìä –í–õ–ò–Ø–ù–ò–ï –ù–ê –°–ò–°–¢–ï–ú–£

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã
- –ë–∞–ª–∞–Ω—Å –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–∞—Ö
- –ù–∞—Ä—É—à–µ–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### üü° –í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ç–∏–ø–∞ UNI_FARMING_DEPOSIT
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –ø–æ –¥–µ–ø–æ–∑–∏—Ç–∞–º

### ‚úÖ –ù–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ:
- –§–∞—Ä–º–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –î–æ—Ö–æ–¥—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –î—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É `last_active` –≤ BalanceManager
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ

### 2. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –≤ –¥–µ–ø–æ–∑–∏—Ç—ã
2. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** - —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π.

---

## üìà –ì–û–¢–û–í–ù–û–°–¢–¨ –°–ò–°–¢–ï–ú–´

- **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 95% ‚Üí 93% (—Å–Ω–∏–∂–µ–Ω–∏–µ –∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—à–∏–±–∫–∏)
- **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 95% ‚Üí 98% (–ø–æ–≤—ã—à–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã)

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ —á–µ—Ç–∫–æ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –∫–æ–¥–∞.

---

*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: 08.07.2025, 14:31 UTC*