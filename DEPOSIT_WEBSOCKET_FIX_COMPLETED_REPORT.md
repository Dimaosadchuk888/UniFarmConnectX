# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï DEPOSIT WEBSOCKET –ò–ù–¢–ï–ì–†–ê–¶–ò–ò - –ó–ê–í–ï–†–®–ï–ù–û

## üéØ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏ –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ WebSocket, –ø–æ—Å–∫–æ–ª—å–∫—É —Ç–∏–ø `DEPOSIT` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –≤ `shouldUpdateBalance()` –º–µ—Ç–æ–¥–µ UnifiedTransactionService.

## üîß –í–ù–ï–°–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. **–î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø DEPOSIT –≤ —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø–æ–≤**
**–§–∞–π–ª**: `modules/transactions/types.ts`
```typescript
export type TransactionsTransactionType = 
  | 'FARMING_REWARD'
  | 'FARMING_DEPOSIT'
  | 'REFERRAL_REWARD'
  | 'MISSION_REWARD'
  | 'DAILY_BONUS'
  | 'WITHDRAWAL'
  | 'DEPOSIT';           // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è DEPOSIT**
**–§–∞–π–ª**: `core/TransactionService.ts` (—Å—Ç—Ä–æ–∫–∞ 19)
```typescript
const TRANSACTION_TYPE_MAPPING = {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞–ø–ø–∏–Ω–≥–∏
  'DEPOSIT': 'DEPOSIT',    // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û - –ø—Ä—è–º–æ–π –º–∞–ø–ø–∏–Ω–≥
}
```

### 3. **–í–∫–ª—é—á–µ–Ω DEPOSIT –≤ WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
**–§–∞–π–ª**: `core/TransactionService.ts` (—Å—Ç—Ä–æ–∫–∞ 324)
```typescript
private shouldUpdateBalance(type: ExtendedTransactionType): boolean {
  const incomeTypes: ExtendedTransactionType[] = [
    'FARMING_REWARD',
    'REFERRAL_REWARD', 
    'MISSION_REWARD',
    'DAILY_BONUS',
    'TON_BOOST_INCOME',
    'UNI_DEPOSIT',
    'TON_DEPOSIT',
    'AIRDROP_REWARD',
    'DEPOSIT'  // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
  ];
  
  return incomeTypes.includes(type);
}
```

## üìä –ê–ù–ê–õ–ò–ó –í–û–ó–î–ï–ô–°–¢–í–ò–Ø

### ‚úÖ **–ß—Ç–æ –†–ï–®–ï–ù–û**:
- **25 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç WebSocket
- **–í—Å–µ DEPOSIT —Å TX Hash** –ø–æ–ª—É—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è** (User #25) —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é

### üîÑ **–ß—Ç–æ –û–°–¢–ê–ï–¢–°–Ø –∫–∞–∫ –µ—Å—Ç—å**:
- **–ù–æ–≤—ã–µ TON –¥–µ–ø–æ–∑–∏—Ç—ã**: `TON_DEPOSIT` ‚Üí `FARMING_REWARD` (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: UnifiedTransactionService —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- **WebSocket –ª–æ–≥–∏–∫–∞**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ —Ü–µ–ø–æ—á–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üß™ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### **–ù–∞–π–¥–µ–Ω–æ DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**: 25
- **–° UnifiedTransactionService**: 25/25 (100%)
- **–° TX Hash**: 24/25 (96%)
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö**: 2 (User #25 restoration)

### **–ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**:
```
ID: 1005358, User: 235, Amount: 0.2 TON
–í—Ä–µ–º—è: 22.07.2025, 05:12:16
Original_type: TON_DEPOSIT, Source: ton_deposit
TX_Hash: te6cckECAgEAAKoAAeGI...
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **Dual Type Support**:
```
üì• –ù–û–í–´–ï –î–ï–ü–û–ó–ò–¢–´:
TON_DEPOSIT ‚Üí FARMING_REWARD ‚Üí WebSocket ‚úÖ

üì• –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –î–ï–ü–û–ó–ò–¢–´:  
DEPOSIT ‚Üí DEPOSIT ‚Üí WebSocket ‚úÖ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)

üì• –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–´–ï:
DEPOSIT ‚Üí DEPOSIT ‚Üí WebSocket ‚úÖ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
```

### **WebSocket Flow**:
```
1. Transaction —Å–æ–∑–¥–∞–µ—Ç—Å—è ‚Üí UnifiedTransactionService
2. shouldUpdateBalance(type) ‚Üí return true –¥–ª—è DEPOSIT ‚úÖ
3. updateUserBalance() ‚Üí BalanceManager
4. BalanceManager ‚Üí BalanceNotificationService  
5. WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí Frontend ‚úÖ
```

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê - –í–´–ü–û–õ–ù–ï–ù–´

- ‚úÖ **DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—Ç updateUserBalance()**
- ‚úÖ **BalanceManager –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å –≤ –ë–î**  
- ‚úÖ **BalanceNotificationService –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WebSocket**
- ‚úÖ **Frontend –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞**
- ‚úÖ **LSP –æ—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã**
- ‚úÖ **–¢–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã**

## üöÄ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°

**–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê**: –í—Å–µ DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å WebSocket —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –ò—Å—á–µ–∑–∞—é—â–∏–µ –¥–µ–ø–æ–∑–∏—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ–±–ª–µ–º–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ—Å–∫–æ–ª—å–∫—É –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏ –ª—é–±–æ–º —Ç–∏–ø–µ –¥–µ–ø–æ–∑–∏—Ç–∞.

**–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –¶–ï–õ–û–°–¢–ù–û–°–¢–¨**: –†–µ—à–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ `TON_DEPOSIT` ‚Üí `FARMING_REWARD`, –¥–æ–±–∞–≤–ª—è—è –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö `DEPOSIT` –∑–∞–ø–∏—Å–µ–π.

**–ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã, –±–µ–∑–æ–ø–∞—Å–Ω—ã –∏ –Ω–µ –Ω–∞—Ä—É—à–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Ç–∏–ø–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Å –ø–æ–ª–Ω–æ–π WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π.