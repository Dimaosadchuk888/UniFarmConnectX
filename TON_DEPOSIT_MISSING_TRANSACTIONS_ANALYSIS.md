# üîç –ê–ù–ê–õ–ò–ó: –ü–û–ß–ï–ú–£ –ù–ï–ö–û–¢–û–†–´–ï –î–ï–ü–û–ó–ò–¢–´ –ù–ï –°–û–ó–î–ê–Æ–¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–ò

## –î–∞—Ç–∞: 06.08.2025
## –°—Ç–∞—Ç—É—Å: –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô –ö–û–î–ê

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê
–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö TON –¥–µ–ø–æ–∑–∏—Ç—ã:
- ‚úÖ TON —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –î–µ–ø–æ–∑–∏—Ç –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- ‚ùå –ë–∞–ª–∞–Ω—Å –ù–ï —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è

## üìä –ü–û–õ–ù–ê–Ø –¶–ï–ü–û–ß–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò –î–ï–ü–û–ó–ò–¢–ê

### 1Ô∏è‚É£ **Frontend: –ò–Ω–∏—Ü–∏–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
```
client/src/services/tonConnectService.ts -> sendTonTransactionWithBackend()
```
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –¥–µ–ø–æ–∑–∏—Ç–∞
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ TON Connect
- –ü–æ–ª—É—á–∞–µ–º BOC (Bag of Cells) –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### 2Ô∏è‚É£ **Frontend: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ Backend**
```javascript
await apiRequest('/api/v2/wallet/ton-deposit', {
  method: 'POST',
  body: {
    ton_tx_hash: result.txHash,  // BOC –¥–∞–Ω–Ω—ã–µ
    amount: parseFloat(amount),
    wallet_address: walletAddress
  }
})
```

### 3Ô∏è‚É£ **Backend: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞**
```
modules/wallet/controller.ts -> tonDeposit()
```
- –í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í—ã–∑–æ–≤ walletService.processTonDeposit()

### 4Ô∏è‚É£ **Backend: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
```
modules/wallet/service.ts -> processTonDeposit()
core/TransactionService.ts -> createTransaction()
```
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –¢–û–ß–ö–ò –û–¢–ö–ê–ó–ê

### üî¥ **–¢–û–ß–ö–ê –û–¢–ö–ê–ó–ê #1: JWT TOKEN EXPIRED**
**–õ–æ–∫–∞—Ü–∏—è:** `client/src/lib/queryClient.ts -> apiRequest()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. JWT —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç (TTL = 24 —á–∞—Å–∞)
2. apiRequest –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
3. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 "Authentication required"
4. Frontend –ù–ï –ø–µ—Ä–µ–∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –î–µ–ø–æ–∑–∏—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –∫–∞–∫ "failed_ton_deposit"

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏: `401 Unauthorized`
- TON —Å–ø–∏—Å–∞–Ω, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage –¥–ª—è retry

**–ü–æ—á–µ–º—É –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–µ —É –≤—Å–µ—Ö:**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç —Å–≤–µ–∂–∏–µ —Ç–æ–∫–µ–Ω—ã
- –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π

---

### üî¥ **–¢–û–ß–ö–ê –û–¢–ö–ê–ó–ê #2: USER ID MISMATCH**
**–õ–æ–∫–∞—Ü–∏—è:** `modules/wallet/controller.ts -> tonDeposit()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. JWT —Å–æ–¥–µ—Ä–∂–∏—Ç `user_id` –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. –ù–æ –∫–æ–¥ –∏–Ω–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `telegram_id` –≤–º–µ—Å—Ç–æ `user_id`
3. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º telegram_id
4. –î–µ–ø–æ–∑–∏—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–µ —Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–°–∏–º–ø—Ç–æ–º—ã:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ user_id
- –í –±–∞–∑–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–µ–ø–æ–∑–∏—Ç –Ω–µ –≤–∏–¥–Ω–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 05-06.08.2025, –Ω–æ —Å—Ç–∞—Ä—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –ø–æ—Ç–µ—Ä—è–Ω—ã

---

### üî¥ **–¢–û–ß–ö–ê –û–¢–ö–ê–ó–ê #3: NETWORK TIMEOUT**
**–õ–æ–∫–∞—Ü–∏—è:** `client/src/services/tonConnectService.ts -> sendTonTransactionWithBackend()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –±–ª–æ–∫—á–µ–π–Ω
2. –ó–∞–ø—Ä–æ—Å –∫ backend –∑–∞–≤–∏—Å–∞–µ—Ç (timeout)
3. Frontend –ø–æ–ª—É—á–∞–µ—Ç network error
4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ù–ï —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ë–î

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏: `Failed to fetch` –∏–ª–∏ `Network error`
- TON —Å–ø–∏—Å–∞–Ω, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ –µ—Å—Ç—å
- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç

**–ú–µ—Ö–∞–Ω–∏–∑–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```javascript
// –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
localStorage.setItem('failed_ton_deposit', JSON.stringify({
  txHash: result.txHash,
  amount: parseFloat(amount),
  walletAddress,
  timestamp: Date.now(),
  error: 'Network error'
}));
```

---

### üî¥ **–¢–û–ß–ö–ê –û–¢–ö–ê–ó–ê #4: BOC HASH EXTRACTION FAILURE**
**–õ–æ–∫–∞—Ü–∏—è:** `modules/wallet/service.ts -> processTonDeposit()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç BOC –¥–∞–Ω–Ω—ã–µ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å "te6...")
2. Backend –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å hash –∏–∑ BOC
3. –§—É–Ω–∫—Ü–∏—è extractHashFromBoc() –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è BOC –∫–∞–∫ hash (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ò–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç - –≤–∞–ª–∏–¥–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –í –ª–æ–≥–∞—Ö: `[WalletService] –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è hash –∏–∑ BOC`

---

### üî¥ **–¢–û–ß–ö–ê –û–¢–ö–ê–ó–ê #5: DATABASE CONSTRAINT VIOLATION**
**–õ–æ–∫–∞—Ü–∏—è:** `core/TransactionService.ts -> createTransaction()`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
2. –ü–æ–ø—ã—Ç–∫–∞ INSERT –≤ —Ç–∞–±–ª–∏—Ü—É transactions
3. –ù–∞—Ä—É—à–µ–Ω–∏–µ unique constraint (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ tx_hash)
4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
5. –û—à–∏–±–∫–∞ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: `duplicate key value violates unique constraint`
- TON —Å–ø–∏—Å–∞–Ω, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±—â—É—é –æ—à–∏–±–∫—É

---

## üîç –ü–û–ß–ï–ú–£ –ü–†–û–ë–õ–ï–ú–ê –ü–†–û–Ø–í–õ–Ø–ï–¢–°–Ø –ù–ï –£ –í–°–ï–•

### ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ—Ç–æ—Ä—ã–µ:**
1. –ù–µ–¥–∞–≤–Ω–æ –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É (—Å–≤–µ–∂–∏–π JWT —Ç–æ–∫–µ–Ω)
2. –ò–º–µ—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
3. –î–µ–ª–∞—é—Ç –ø–µ—Ä–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç (–Ω–µ—Ç —Ä–∏—Å–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
4. –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π user_id –≤ —Å–∏—Å—Ç–µ–º–µ

### ‚ùå **–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ—Ç–æ—Ä—ã–µ:**
1. –î–æ–ª–≥–æ –Ω–µ –∑–∞—Ö–æ–¥–∏–ª–∏ (–∏—Å—Ç–µ–∫—à–∏–π JWT —Ç–æ–∫–µ–Ω)
2. –ò–º–µ—é—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (network timeouts)
3. –ü—ã—Ç–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç
4. –ò–º–µ—é—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ user_id/telegram_id
5. –°—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å race condition –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–∞—Ö

---

## üìù –õ–û–ì–ò –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### Frontend Console:
```javascript
[TON_TRANSACTION_WITH_BACKEND] Starting transaction
[TON_TRANSACTION_WITH_BACKEND] Transaction sent, BOC received
[TON_TRANSACTION_WITH_BACKEND] Sending to backend
// –ó–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π
[TON_TRANSACTION_WITH_BACKEND] Backend call failed
// –ò–ª–∏
401 Unauthorized - Authentication required
```

### Backend Logs:
```
[TON_DEPOSIT_RECEIVED] - –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
[TelegramAuth] JWT token validation failed - –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–æ–º
[TON_DEPOSIT] Missing required fields - –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö
[WalletService] –û—à–∏–±–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è hash –∏–∑ BOC - –ø—Ä–æ–±–ª–µ–º–∞ —Å BOC
[UnifiedTransactionService] –î—É–±–ª–∏–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω - –µ—Å–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç
```

---

## üõ†Ô∏è –ú–ï–•–ê–ù–ò–ó–ú–´ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

### 1. **LocalStorage Recovery**
Frontend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã:
- `pending_ton_deposit` - –æ–∂–∏–¥–∞—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `failed_ton_deposit` - –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

### 2. **Manual Retry**
–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è localStorage –∏ –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞.

### 3. **JWT Token Recovery**
–°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —á–µ—Ä–µ–∑ `useJwtTokenWatcher`.

---

## ‚ö†Ô∏è –ì–õ–ê–í–ù–´–ï –í–´–í–û–î–´

### üéØ **–ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø–æ—Ç–µ—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**

1. **JWT Token Expiration** - —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞
   - –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞
   - –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ refresh –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ
   - apiRequest –Ω–µ retry —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º

2. **Network Failures** 
   - Timeout –º–µ–∂–¥—É frontend –∏ backend
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ –µ—Å—Ç—å, –≤ –ë–î –Ω–µ—Ç

3. **User ID Architecture Issues**
   - –ü—É—Ç–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É user_id –∏ telegram_id
   - –°–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

4. **BOC Processing Errors**
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ hash –∏–∑ BOC
   - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

5. **Database Constraints**
   - Unique constraint violations
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ó–ê–ú–ï–ß–ê–ù–ò–ï

**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ —Ç–æ–º, —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞** (—ç—Ç–æ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ).

**–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤–æ–æ–±—â–µ –ù–ï –°–û–ó–î–ê–ï–¢–°–Ø** –∏–∑-–∑–∞ —Å–±–æ–µ–≤ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —ç—Ç–∞–ø–∞—Ö —Ü–µ–ø–æ—á–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ - **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–¥–µ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤** –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç—Ç–∞–ø–∞—Ö.

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ö–û–î–ê)

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh JWT —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ**
2. **–î–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º –≤ apiRequest —Å exponential backoff**
3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É network errors —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º retry**
4. **–°–æ–∑–¥–∞—Ç—å background job –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ pending –¥–µ–ø–æ–∑–∏—Ç–æ–≤**
5. **–î–æ–±–∞–≤–∏—Ç—å webhook –æ—Ç –±–ª–æ–∫—á–µ–π–Ω–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
6. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å idempotency keys –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**
7. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏**

---

**–ê–≤—Ç–æ—Ä:** Replit Agent
**–î–∞—Ç–∞:** 06.08.2025
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω, –∫–æ–¥ –Ω–µ –∏–∑–º–µ–Ω—è–ª—Å—è