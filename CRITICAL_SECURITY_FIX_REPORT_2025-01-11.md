# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò–°–ü–†–ê–í–õ–ï–ù–ê
**–î–∞—Ç–∞**: 11 —è–Ω–≤–∞—Ä—è 2025, 15:35
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: UniFarmingCard.tsx
**–°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å**: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø

## –û–ø–∏—Å–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–ø–∏—Å—ã–≤–∞–ª –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (401 Unauthorized) –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.

### –°–∏–º–ø—Ç–æ–º—ã:
1. JWT —Ç–æ–∫–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É "invalid signature"
2. API endpoint `/api/v2/uni-farming/direct-deposit` –æ—Ç–≤–µ—á–∞–ª 401 Unauthorized
3. –ë–∞–ª–∞–Ω—Å –≤—Å–µ —Ä–∞–≤–Ω–æ —É–º–µ–Ω—å—à–∞–ª—Å—è –ª–æ–∫–∞–ª—å–Ω–æ: 362237 ‚Üí 362200 UNI
4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ù–ï —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ–ª —É—Å–ø–µ—à–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
- `onSuccess` callback –≤ `depositMutation` –≤—ã–∑—ã–≤–∞–ª—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞
- `refreshBalance(true)` –æ–±–Ω–æ–≤–ª—è–ª –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `response.success` –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º UI

## –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –§–∞–π–ª: `client/src/components/farming/UniFarmingCard.tsx`

```typescript
onSuccess: async (response) => {
  try {
    console.log('[UniFarmingCard] –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –¥–µ–ø–æ–∑–∏—Ç–∞:', response);
    
    // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê: —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –∑–∞–ø—Ä–æ—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É—Å–ø–µ—à–µ–Ω
    if (!response || !response.success) {
      console.error('[UniFarmingCard] ‚ùå –ü–æ–ª—É—á–µ–Ω –Ω–µ—É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:', response);
      setError(response?.error || response?.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞');
      // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ!
      return;
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
```

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (!response || !response.success)` –≤ –Ω–∞—á–∞–ª–µ `onSuccess`
2. ‚úÖ –ü—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –æ—Ç–≤–µ—Ç–µ –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `refreshBalance()`
3. ‚úÖ –ü—Ä–∏ –Ω–µ—É—Å–ø–µ—à–Ω–æ–º –æ—Ç–≤–µ—Ç–µ –ù–ï –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫—ç—à–∏ React Query
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≤–º–µ—Å—Ç–æ —É—Å–ø–µ—Ö–∞
5. ‚úÖ –ë–∞–ª–∞–Ω—Å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ë–∞–ª–∞–Ω—Å —Å–ø–∏—Å—ã–≤–∞–ª—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –¥–∞–∂–µ –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥—É–º–∞–ª, —á—Ç–æ –¥–µ–ø–æ–∑–∏—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ
- –í–æ–∑–Ω–∏–∫–∞–ª–∞ –¥–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É UI –∏ —Ä–µ–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ (response.success === true)
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É UI –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω –¥–ª—è user 74:
```javascript
localStorage.setItem('unifarm_jwt_token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...');
```

### 2. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `update-jwt-token-user-74.html` —Å UI –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞

## –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

‚úÖ `UniFarmingCard.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
‚úÖ `UnifiedBalanceDisplay.tsx` - –±–µ–∑–æ–ø–∞—Å–Ω–æ (refreshBalance –≤ try-catch)
‚úÖ `correctApiRequest.ts` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ 401

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **Code Review**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `useMutation` —Å `onSuccess`
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–ª—É—á–∞–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ optimistic updates —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º rollback

## –°—Ç–∞—Ç—É—Å: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞. –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â–µ–Ω –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.