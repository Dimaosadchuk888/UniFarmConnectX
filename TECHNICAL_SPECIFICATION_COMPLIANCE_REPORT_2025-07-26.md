# üßæ –û–¢–ß–ï–¢ –û –°–û–û–¢–í–ï–¢–°–¢–í–ò–ò –¢–ï–•–ù–ò–ß–ï–°–ö–û–ú–£ –ó–ê–î–ê–ù–ò–Æ

**–î–∞—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:** 26 –∏—é–ª—è 2025, 05:32  
**–¢–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏:** –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞)  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´**

---

## üìä –ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –†–ï–ó–Æ–ú–ï

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| **–¢–ó 1: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤** | ‚ùå **FAILED** | –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤ |
| **–¢–ó 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ** | ‚ùå **FAILED** | –û—à–∏–±–∫–∞ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–µ |
| **–¢–ó 3: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Boost-–ø–∞–∫–µ—Ç–æ–≤** | ‚ùå **FAILED** | –û—à–∏–±–∫–∞ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–µ |
| **–¢–ó 4: –°–æ–∑–¥–∞–Ω–∏–µ ToneFarmingData** | ‚úÖ **PASSED** | –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç –∑–∞–ø–∏—Å–∏ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** üî¥ **–¢–†–ï–ë–£–ï–¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ì–û –í–ù–ò–ú–ê–ù–ò–Ø**

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### ‚ùå **–¢–ó 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï TON –î–ï–ü–û–ó–ò–¢–û–í**

**–°—Ç–∞—Ç—É—Å:** –ü–†–û–í–ê–õ–ï–ù–û  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø

#### **–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –ü–æ–ª–µ `tx_hash_unique` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå **–ö–†–ò–¢–ò–ß–ù–û:** –ù–∞–π–¥–µ–Ω–æ **2 –≥—Ä—É–ø–ø—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤** –∑–∞ 24 —á–∞—Å–∞
- üìä –û–±—â–∏–π –æ–±—ä–µ–º: 20 TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤, –∏–∑ –Ω–∏—Ö 4 –¥—É–±–ª–∏–∫–∞—Ç–∞

#### **–î–µ—Ç–∞–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
–ì—Ä—É–ø–ø–∞ 1: TX Hash te6cckECBAEAAL0AAfGI...
‚îú‚îÄ‚îÄ User 25: 0.1 TON (–¥—É–±–ª–∏–∫–∞—Ç)
‚îî‚îÄ‚îÄ User 25: 0.1 TON (–¥—É–±–ª–∏–∫–∞—Ç)

–ì—Ä—É–ø–ø–∞ 2: TX Hash te6cckECBAEAAL0AAfGI...  
‚îú‚îÄ‚îÄ User 25: 1 TON (–¥—É–±–ª–∏–∫–∞—Ç)
‚îî‚îÄ‚îÄ User 25: 1 TON (–¥—É–±–ª–∏–∫–∞—Ç)
```

#### **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
–ü—Ä–æ–±–ª–µ–º–∞ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É `WalletService` –∏ `TransactionService`:

**–í –∫–æ–¥–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
1. **WalletService** —Å–æ–∑–¥–∞–µ—Ç: `metadata.tx_hash = ton_tx_hash` ‚úÖ
2. **WalletService** —Å–æ–∑–¥–∞–µ—Ç: `metadata.ton_tx_hash = ton_tx_hash` ‚úÖ  
3. **TransactionService** –∏—â–µ—Ç: `metadata?.tx_hash || metadata?.ton_tx_hash` ‚úÖ
4. **–ù–û:** Unique constraint –Ω–∞ `tx_hash_unique` –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: `CREATE UNIQUE INDEX IF NOT EXISTS idx_tx_hash_unique ON transactions(tx_hash_unique)`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥—É–±–ª–µ–π –Ω–∞ —É—Ä–æ–≤–Ω–µ API –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å frontend –∑–∞—â–∏—Ç—É –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫–ª–∏–∫–æ–≤

---

### ‚úÖ **–¢–ó 4: –û–¢–õ–ò–ß–ù–û - –°–û–ó–î–ê–ù–ò–ï TONEFARMINGDATA**

**–°—Ç–∞—Ç—É—Å:** –£–°–ü–ï–®–ù–û –ü–†–û–ô–î–ï–ù–û  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø

#### **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã:**
- ‚úÖ **10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ TON Boost –ø–∞–∫–µ—Ç–∞–º–∏
- ‚úÖ **0 –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö** –∑–∞–ø–∏—Å–µ–π –≤ `ton_farming_data`
- ‚úÖ **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç** (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ: 0 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)
- ‚úÖ **5 –Ω–µ–¥–∞–≤–Ω–∏—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π** –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑:**
- `BoostService.purchaseWithInternalWallet()` ‚Üí –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `TonFarmingRepository.activateBoost()`
- `TonFarmingRepository.activateBoost()` ‚Üí –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `user_id` —Ç–∏–ø–æ–º STRING
- `tonBoostIncomeScheduler` ‚Üí –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

---

### ‚ùå **–¢–ó 2 & –¢–ó 3: –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –í –î–ò–ê–ì–ù–û–°–¢–ò–ö–ï**

**–°—Ç–∞—Ç—É—Å:** –û–®–ò–ë–ö–ê –°–ö–†–ò–ü–¢–ê  
**–ü—Ä–æ–±–ª–µ–º–∞:** `ReferenceError: yesterday is not defined`

–≠—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–µ, –∞ –Ω–µ –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô –ü–û –£–°–¢–†–ê–ù–ï–ù–ò–Æ

### **–ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô)**

#### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'transactions' AND indexdef LIKE '%tx_hash_unique%';

-- –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞—Ç—å:
CREATE UNIQUE INDEX CONCURRENTLY idx_tx_hash_unique_dedup 
ON transactions(tx_hash_unique) 
WHERE tx_hash_unique IS NOT NULL;
```

#### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ WalletService mapping:**
–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ `modules/wallet/service.ts` —Å—Ç—Ä–æ–∫–∞ 404-405:
```typescript
tx_hash: ton_tx_hash,           // ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ
ton_tx_hash: ton_tx_hash        // ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
```

#### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `TransactionService.createTransaction()`:
```typescript
if (metadata?.tx_hash && existingTx) {
  logger.warn('[DUPLICATE_DETECTED]', { tx_hash, user_id, amount });
  return { success: false, error: 'Duplicate transaction detected' };
}
```

### **–î–û–õ–ì–û–°–†–û–ß–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)**

#### **1. Frontend –∑–∞—â–∏—Ç–∞:**
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ `isProcessing` –≤ –∫–Ω–æ–ø–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å debounce –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏–Ω–Ω–µ—Ä –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### **2. Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å rate limiting –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å idempotency tokens
- –£–ª—É—á—à–∏—Ç—å error handling –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

---

## üìà –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### **–¢–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–µ–ø–æ–∑–∏—Ç–æ–≤:**
```
TON Connect ‚Üí Frontend ‚Üí WalletService ‚Üí TransactionService ‚Üí Database
                ‚Üì              ‚Üì              ‚Üì              ‚Üì
            [UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ] [metadata]  [–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è]  [unique index]
```

### **–ü—Ä–æ–±–ª–µ–º–Ω–æ–µ –º–µ—Å—Ç–æ:**
```
TransactionService.createTransaction() {
  tx_hash_unique: metadata?.tx_hash || metadata?.ton_tx_hash || null
  // ‚Üë –ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
}
```

---

## üîÆ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï –ò –ü–†–û–ì–ù–û–ó

### **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞:**
–°–∏—Å—Ç–µ–º–∞ –≤ —Ü–µ–ª–æ–º **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è**, –Ω–æ –∏–º–µ–µ—Ç **—Å–µ—Ä—å–µ–∑–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–µ–ø–æ–∑–∏—Ç–æ–≤**. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–º –ø–æ—Ç–µ—Ä—è–º –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
- –ü–æ–¥—Ä—ã–≤—É –¥–æ–≤–µ—Ä–∏—è –∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ

### **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:**
- ‚úÖ TON Boost —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç farming –¥–æ—Ö–æ–¥—ã
- ‚úÖ –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º

### **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:**
**70%** - –°–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º.

---

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞:** 26 –∏—é–ª—è 2025  
**–°–ª–µ–¥—É—é—â–∏–π –∞—É–¥–∏—Ç:** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Development Team  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô