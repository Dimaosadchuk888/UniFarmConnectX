# TonConnect Payment System Deep Audit Report

## –î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞: 05 —è–Ω–≤–∞—Ä—è 2025

## –†–µ–∑—é–º–µ
–ü—Ä–æ–≤–µ–¥–µ–Ω –≥–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã TonConnect –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è UniFarm. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –º–µ–∂–¥—É frontend –∏ backend.

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. TonConnect Manifest
- **–§–∞–π–ª**: `client/public/tonconnect-manifest.json`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- **–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ**: Express endpoint –Ω–∞ `/tonconnect-manifest.json` (server/index.ts:597)
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON —Å url, name, iconUrl

### 2. TonConnectUIProvider
- **–§–∞–π–ª**: `client/src/App.tsx`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `manifestUrl="/tonconnect-manifest.json"` (—Å—Ç—Ä–æ–∫–∞ 158)

### 3. Frontend –æ–ø–ª–∞—Ç–∞
- **–§–∞–π–ª**: `client/src/services/tonConnectService.ts`
- **–§—É–Ω–∫—Ü–∏—è**: `sendTonTransaction`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç TON –≤ nanoTON
  - –§–æ—Ä–º–∏—Ä—É–µ—Ç payload —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º `UniFarmBoost:userId:boostId`
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–¥—Ä–µ—Å –∏–∑ `VITE_TON_BOOST_RECEIVER_ADDRESS`

### 4. Backend –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Endpoint**: `/api/v2/boost/verify-ton-payment`
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ó–∞—â–∏—â–µ–Ω middleware `requireTelegramAuth`
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —á–µ—Ä–µ–∑ tonapi.io
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ê)

### –ü—Ä–æ–±–ª–µ–º–∞
Frontend –∏ backend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è TON:
- **Frontend**: `VITE_TON_BOOST_RECEIVER_ADDRESS`
- **Backend**: `TON_BOOST_WALLET_ADDRESS`

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ:
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª –ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ –æ–¥–∏–Ω –∞–¥—Ä–µ—Å
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –¥—Ä—É–≥–æ–º –∞–¥—Ä–µ—Å–µ
3. –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–∫–ª–æ–Ω—è–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π "–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å"

### –†–µ—à–µ–Ω–∏–µ
1. –°–æ–∑–¥–∞–Ω –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `config/tonBoostPayment.ts`
2. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `TON_BOOST_RECEIVER_ADDRESS`
3. –û–±–Ω–æ–≤–ª–µ–Ω `config/tonBoost.ts` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
4. –¢–µ–ø–µ—Ä—å –∏ –∫–ª–∏–µ–Ω—Ç, –∏ —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∞–¥—Ä–µ—Å

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª—è TON –ø–ª–∞—Ç–µ–∂–µ–π —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```bash
# –î–ª—è frontend (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å)
VITE_TON_BOOST_RECEIVER_ADDRESS=UQYourCustomTonWalletAddress

# –î–ª—è backend (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å)
TON_BOOST_RECEIVER_ADDRESS=UQYourCustomTonWalletAddress
```

### Fallback –∞–¥—Ä–µ—Å
–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–¥—Ä–µ—Å:
`UQBlrUfJMIlAcyYzttyxV2xrrvaHHIKEKeetGZbDoitTRWT8`

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
–°–∏—Å—Ç–µ–º–∞ TonConnect –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ —Å –µ–¥–∏–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è.