# ‚úÖ –§–ê–ó–ê 2 –ó–ê–í–ï–†–®–ï–ù–ê: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

**–î–∞—Ç–∞**: 19 —è–Ω–≤–∞—Ä—è 2025  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 5 –º–∏–Ω—É—Ç  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û  
**–†–∏—Å–∫**: –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô

---

## üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### **1. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ TON –∞–¥—Ä–µ—Å–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ regex –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–µ–∑ @ton/core –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–†–µ—à–µ–Ω–∏–µ**: –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `isValidTonAddress()` –≤ WalletController
```typescript
// –î–û (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, —Ç–æ–ª—å–∫–æ regex):
private isValidTonAddress(address: string): boolean {
  const rawAddressRegex = /^[0-9a-fA-F]{64}$/;
  const userFriendlyRegex = /^(EQ|UQ)[A-Za-z0-9_-]{46}$/;
  return rawAddressRegex.test(address) || userFriendlyRegex.test(address);
}

// –ü–û–°–õ–ï (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, @ton/core + fallback):
private async isValidTonAddress(address: string): Promise<boolean> {
  try {
    const { Address } = await import('@ton/core');
    const parsed = Address.parse(address);
    return true; // @ton/core —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª
  } catch (error) {
    // Fallback –Ω–∞ regex –µ—Å–ª–∏ @ton/core –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    const rawAddressRegex = /^[0-9a-fA-F]{64}$/;
    const userFriendlyRegex = /^(EQ|UQ)[A-Za-z0-9_-]{46}$/;
    return rawAddressRegex.test(address) || userFriendlyRegex.test(address);
  }
}
```

**–û–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤**: `if (!(await this.isValidTonAddress(walletAddress)))`

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è WebSocket**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥ —Å–æ–∑–¥–∞—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É

**–†–µ—à–µ–Ω–∏–µ**: –ò–Ω—Ç–µ—Ä–≤–∞–ª –∏–∑–º–µ–Ω–µ–Ω —Å 15 –Ω–∞ 30 —Å–µ–∫—É–Ω–¥ –≤ `useWebSocketBalanceSync.ts`
```typescript
// –î–û:
}, 15000); // 15 —Å–µ–∫—É–Ω–¥

// –ü–û–°–õ–ï:
}, 30000); // 30 —Å–µ–∫—É–Ω–¥ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å 15 —Å–µ–∫)
```

---

## ‚úÖ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤**:
- ‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - @ton/core –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —Ñ–æ—Ä–º–∞—Ç—ã TON –∞–¥—Ä–µ—Å–æ–≤
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - fallback –Ω–∞ regex –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ @ton/core  
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏

### **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
- ‚úÖ **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** - –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ (120/—á–∞—Å ‚Üí 60/—á–∞—Å)
- ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** - –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ UX** - 30 —Å–µ–∫—É–Ω–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∑–∞–º–µ—Ç–Ω—ã–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üîß –ó–ê–¢–†–û–ù–£–¢–´–ï –§–ê–ô–õ–´

### **Backend** (1 —Ñ–∞–π–ª):
- `modules/wallet/controller.ts` 
  - –°—Ç—Ä–æ–∫–∞ 57: –º–µ—Ç–æ–¥ —Å—Ç–∞–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º
  - –°—Ç—Ä–æ–∫–∞ 27: –æ–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤ —Å await

### **Frontend** (1 —Ñ–∞–π–ª):
- `client/src/hooks/useWebSocketBalanceSync.ts`
  - –°—Ç—Ä–æ–∫–∞ 30: –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏–∑–º–µ–Ω–µ–Ω 15000 ‚Üí 30000

---

## üìä –í–û–ó–î–ï–ô–°–¢–í–ò–ï –ù–ê –°–ò–°–¢–ï–ú–£

### **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã**: 94% ‚Üí 96%

**–£–ª—É—á—à–µ–Ω–∏—è**:
- üü¢ –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π (Regex + @ton/core)
- üü¢ –°–Ω–∏–∂–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ API –≤ 2 —Ä–∞–∑–∞ (15‚Üí30 —Å–µ–∫)
- üü¢ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (fallback –Ω–∞ regex)

**–†–∏—Å–∫–∏**: 
- üü° –ú–µ—Ç–æ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞–ª –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º (–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

---

## üõ°Ô∏è –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–¨

### **Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**:
- –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ @ton/core ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ regex
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ @ton/core ‚Üí regex –ø—Ä–æ–≤–µ—Ä–∫–∞
- –ù–∏–∫–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω–æ

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- [x] –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫  
- [ ] ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ TON –∞–¥—Ä–µ—Å–æ–≤ –≤ UI
- [ ] ‚è≥ –ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–æ—Ç—ã –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ DevTools

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –§–ê–ó–´ 2

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (8 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞) –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É—é—Ç:**
- –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ TON –∞–¥—Ä–µ—Å–æ–≤
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π  
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å @ton/core –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞**: –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞ 96%

**–§–∞–∑–∞ 3**: WebSocket —Å–∏—Å—Ç–µ–º–∞, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ - –ù–ï –¢–†–û–ì–ê–ï–ú (—Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ)

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–º–µ—Ä–µ–Ω–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.*