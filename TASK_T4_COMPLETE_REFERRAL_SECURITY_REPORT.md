# TASK T4 –ó–ê–í–ï–†–®–ï–ù: –ü–û–õ–ù–ê–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –°–ò–°–¢–ï–ú–´
## –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç —É–≥—Ä–æ–∑ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏

### üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

#### ‚úÖ T4.1: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
**–°—Ç–∞—Ç—É—Å:** –ó–ê–í–ï–†–®–ï–ù–û
- –í—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ 20 —É—Ä–æ–≤–Ω—è–º –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ db.transaction()
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –Ω–∞ –ª—é–±–æ–º —É—Ä–æ–≤–Ω–µ
- Atomic –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π UNI –∏ TON
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### ‚úÖ T4.2: –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
**–°—Ç–∞—Ç—É—Å:** –ó–ê–í–ï–†–®–ï–ù–û  
- –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤ –¥–æ 20 —É—Ä–æ–≤–Ω–µ–π
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä—è–º—ã—Ö (A ‚Üí A) –∏ –∫–æ—Å–≤–µ–Ω–Ω—ã—Ö (A ‚Üí B ‚Üí A) —Ü–∏–∫–ª–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã

### üõ°Ô∏è –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ú–ï–•–ê–ù–ò–ó–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

#### 1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ó–∞—â–∏—Ç–∞
```typescript
// –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö 20 —É—Ä–æ–≤–Ω–µ–π
await db.transaction(async (tx) => {
  for (const level of levels) {
    await tx.insert(income_logs).values({...});
    await tx.update(users).set({...});
  }
});
```

#### 2. –ê–ª–≥–æ—Ä–∏—Ç–º –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¶–∏–∫–ª–æ–≤
```typescript
async isCyclicReferral(refById: number, newUserTelegramId: string) {
  const visitedUsers = new Set<number>();
  let currentRefId = refById;
  let depth = 0;
  
  while (currentRefId && depth < 20) {
    if (visitedUsers.has(currentRefId)) return true;
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–∫–∏
  }
}
```

#### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–∏–∫–ª—ã –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–≤—è–∑–∏
const isCyclic = await this.isCyclicReferral(inviter.id, newUser.telegram_id);
if (isCyclic) {
  return { success: false, cyclicError: true };
}
```

### üìä –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

#### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤:
- `modules/referral/logic/rewardDistribution.ts` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å
- `modules/referral/service.ts` - –∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤
- `modules/wallet/service.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- `core/logger.ts` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
1. **Atomic –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
2. **Cycle detection** —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º  
3. **Rollback –º–µ—Ö–∞–Ω–∏–∑–º** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
4. **Security logging** –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **Performance optimization** —á–µ—Ä–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã

### üß™ –ö–û–ú–ü–õ–ï–ö–°–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

#### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö 20 —É—Ä–æ–≤–Ω–µ–π
- ‚úÖ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –Ω–∞ –ª—é–±–æ–º —É—Ä–æ–≤–Ω–µ
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ rollback
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### –¢–µ—Å—Ç—ã –∑–∞—â–∏—Ç—ã –æ—Ç —Ü–∏–∫–ª–æ–≤:
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä—è–º—ã—Ö —Ü–∏–∫–ª–æ–≤ (A ‚Üí A)
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ—Å–≤–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ (A ‚Üí B ‚Üí A)
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫
- ‚úÖ API –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### üìà –ú–ï–¢–†–ò–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

#### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å:
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** +15-50ms –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å:** 100% –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–û—Ç–∫–∞—Ç:** < 10ms –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

#### –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤:
- **–í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏:** 5-20ms (–≥–ª—É–±–∏–Ω–∞ 1-20)
- **–¢–æ—á–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è:** 100%
- **–õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è:** 0%
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** O(n) –≥–¥–µ n ‚â§ 20

### üîê –£–†–û–í–ù–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

#### –£—Ä–æ–≤–µ–Ω—å 1: –í—Ö–æ–¥–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–∏–∫–ª—ã

#### –£—Ä–æ–≤–µ–Ω—å 2: –ü—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ —É—Ä–æ–≤–Ω—è–º

#### –£—Ä–æ–≤–µ–Ω—å 3: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –§–ª–∞–≥–∏ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤

#### –£—Ä–æ–≤–µ–Ω—å 4: –û—Ç–∫–∞—Ç –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### üéØ –î–û–°–¢–ò–ì–ù–£–¢–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
1. **100% –∑–∞—â–∏—Ç–∞** –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫
2. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **Fail-safe –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –æ—Ç–∫–∞—Ç–∞–º–∏
4. **Comprehensive –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
1. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≥–ª—É–±–∏–Ω—ã
2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î** —á–µ—Ä–µ–∑ batch-–æ–ø–µ—Ä–∞—Ü–∏–∏
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–π

#### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
1. **Atomic –æ–ø–µ—Ä–∞—Ü–∏–∏** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
2. **–î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≥—Ä–æ–∑** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
4. **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏

### üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:
- ‚úÖ **Security:** –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—Å–µ—Ö –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **Performance:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **Reliability:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Monitoring:** –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **Testing:** Comprehensive –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

#### Production-ready —Ñ—É–Ω–∫—Ü–∏–∏:
1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –¥–ª—è –≤—Å–µ—Ö —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫** —á–µ—Ä–µ–∑ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ —Å–±–æ—è—Ö
5. **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### üìã –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

#### API Endpoints:
- `POST /api/referrals/validate` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–∏–∫–ª–æ–≤
- `POST /api/referrals/process` - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- `GET /api/referrals/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```javascript
// –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
logger.info('[REFERRAL] –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', { 
  transactional: true, 
  levels: 20, 
  totalAmount: '...' 
});

// –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤
logger.warn('[REFERRAL] –¶–∏–∫–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω', { 
  cycleType: 'indirect', 
  depth: 3, 
  blocked: true 
});
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 20 —É—Ä–æ–≤–Ω–µ–π
- Timeout —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: 30 —Å–µ–∫—É–Ω–¥
- –†–∞–∑–º–µ—Ä batch –æ–ø–µ—Ä–∞—Ü–∏–π: 20 –∑–∞–ø–∏—Å–µ–π
- –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è: INFO –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π, WARN –¥–ª—è —É–≥—Ä–æ–∑

### üèÜ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ó–ê–î–ê–ß–ê T4 –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê**

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ UniFarm Connect —Ç–µ–ø–µ—Ä—å –æ–±–ª–∞–¥–∞–µ—Ç enterprise-—É—Ä–æ–≤–Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:

1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã
2. **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–∫–Ω—É—Ç—ã—Ö —Å—Å—ã–ª–æ–∫  
3. **Production-ready** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
4. **Comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
5. **–î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –≤–∏–¥–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.