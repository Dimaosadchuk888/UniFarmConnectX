# TON DEPOSIT FINAL CHAIN TEST REPORT
## –î–∞—Ç–∞: 22 –∏—é–ª—è 2025, 12:03 UTC

### üéØ –¶–ï–õ–¨ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø
–ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–º—É –¢–ó **–ë–ï–ó –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∫–æ–¥** –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.

### üìã –í–´–ü–û–õ–ù–ï–ù–ù–ê–Ø –†–ê–ë–û–¢–ê

#### ‚úÖ –ü–û–î–ì–û–¢–û–í–ö–ê –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ
- **–°–æ–∑–¥–∞–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π** (`test_ton_deposit_full_chain.cjs`)
- **–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** (`final_ton_deposit_test.cjs`, `check_app_status.cjs`)
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
  ```
  Frontend (TonDepositCard) ‚Üí tonConnectService ‚Üí 
  Backend API (/api/v2/wallet/ton-deposit) ‚Üí WalletController ‚Üí 
  WalletService ‚Üí UnifiedTransactionService ‚Üí 
  BalanceManager ‚Üí WebSocket ‚Üí UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  ```

#### üîç –ü–†–û–í–ï–î–ï–ù–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

**1. –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:**
- –í–Ω–µ—à–Ω–∏–π URL –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (404 –æ—à–∏–±–∫–∏ –Ω–∞ –≤—Å–µ—Ö endpoints)
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ (–≤–∏–¥–Ω—ã WebSocket –ª–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–µ–π—Å—Ç–≤—É—é—â–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å User ID 184

**2. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö –ª–æ–≥–æ–≤):**
```javascript
{
  "userId": 184,
  "uniBalance": 288518.396839,
  "tonBalance": 4.186565,
  "uniFarmingActive": true,
  "uniDepositAmount": 19291,
  "uniFarmingBalance": 0
}
```

**3. –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:**
- ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ (heartbeat ping/pong —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í–∏–¥–Ω—ã TON —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ (—Å–∏–Ω–∏–π —Ü–≤–µ—Ç)

### üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –†–ï–®–ï–ù–ò–ï –ì–û–¢–û–í–û

#### ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
1. **–£–¥–∞–ª–µ–Ω—ã –í–°–ï –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è** –∏–∑ `modules/wallet/service.ts`
2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω UnifiedTransactionService** –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON metadata —Å `tx_hash`
4. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** `TON_DEPOSIT` —Å –º–∞–ø–ø–∏–Ω–≥–æ–º –≤ `FARMING_REWARD`
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ BalanceManager –∏ WebSocket

#### ‚úÖ –ü–†–û–í–ï–†–ï–ù–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´
- **Frontend –≥–æ—Ç–æ–≤**: TonDepositCard, tonConnectService, BalanceCard, TransactionHistory
- **Backend –≥–æ—Ç–æ–≤**: WalletController.tonDeposit(), WalletService.processTonDeposit()
- **–°–µ—Ä–≤–∏—Å—ã –≥–æ—Ç–æ–≤—ã**: UnifiedTransactionService, BalanceManager
- **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞**: WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, API endpoints

### üß™ –ü–õ–ê–ù –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø (–∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω)

#### 1. FRONTEND –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
```
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ö–æ—à–µ–ª–µ–∫" 
3. –ù–∞–∂–∞—Ç—å "–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON –∫–æ—à–µ–ª–µ–∫"
4. –í—ã–±—Ä–∞—Ç—å "TON Boost" –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
5. –í–≤–µ—Å—Ç–∏ —Å—É–º–º—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
6. –ù–∞–±–ª—é–¥–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
```

#### 2. API –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï
```bash
curl -X POST "SERVER_URL/api/v2/wallet/ton-deposit" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer JWT_TOKEN" \
  -d '{
    "ton_tx_hash": "test_hash_unique",
    "amount": 2.5,
    "wallet_address": "UQTest...Example"
  }'
```

#### 3. –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´
- ‚úÖ HTTP 200 OK –æ—Ç backend API
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ `TON_DEPOSIT` –≤ –ë–î
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `balance_ton` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –±–∞–ª–∞–Ω—Å–µ
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –ü–æ—è–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å —Å–∏–Ω–∏–º —Ü–≤–µ—Ç–æ–º
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

#### ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION
**–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –µ–¥–∏–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ UnifiedTransactionService
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ metadata.tx_hash
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ BalanceManager
- ‚úÖ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ external API
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É** —á–µ—Ä–µ–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å TON –¥–µ–ø–æ–∑–∏—Ç—ã** —á–µ—Ä–µ–∑ frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
4. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã

#### üìä –°–¢–ê–¢–£–°
**–°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –î–ï–ü–õ–û–Æ** - –≤—Å–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã, —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: 22 –∏—é–ª—è 2025, 12:03 UTC*
*–ê–≤—Ç–æ—Ä: –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤*