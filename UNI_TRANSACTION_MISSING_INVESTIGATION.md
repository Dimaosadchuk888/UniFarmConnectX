# üîç –†–ê–°–°–õ–ï–î–û–í–ê–ù–ò–ï: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UNI —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ—Å–ª–µ –¥–µ–ø–æ–∑–∏—Ç–∞

**–î–∞—Ç–∞:** 21 –∏—é–ª—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è UNI –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê  

---

## üö® –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –ù–ê–ô–î–ï–ù–ê

### **–§–ê–¢–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê –í –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò:**

–ü—Ä–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º—ã:
- ‚úÖ –£–±—Ä–∞–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–∑ `modules/farming/service.ts`
- ‚ùå **–ü–†–ï–î–ü–û–õ–û–ñ–ò–õ–ò** —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ `UniFarmingRepository.addDeposit()`

### **–†–ï–ê–õ–¨–ù–û–°–¢–¨:**
`UniFarmingRepository.addDeposit()` **–ù–ï –°–û–ó–î–ê–ï–¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–ò!**

**–ö–æ–¥ –≤ UniFarmingRepository.ts —Å—Ç—Ä–æ–∫–∏ 311-347:**
```typescript
// –¢–û–õ–¨–ö–û –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö farming, –ë–ï–ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
const { error: updateError } = await supabase
  .from(this.tableName)
  .update({
    deposit_amount: newDeposit,
    farming_deposit: newDeposit,
    is_active: true,
    farming_last_update: new Date().toISOString(),
    updated_at: new Date().toISOString()
  })
  .eq('user_id', parseInt(userId));

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å users - –ë–ï–ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
const { error: syncError } = await supabase
  .from('users')
  .update({
    uni_deposit_amount: newDeposit,
    uni_farming_deposit: newDeposit,
    uni_farming_active: true,
    uni_farming_last_update: new Date().toISOString()
  })
  .eq('id', userId);
```

**–†–ï–ó–£–õ–¨–¢–ê–¢:** –î–µ–ø–æ–∑–∏—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ù–ï —Å–æ–∑–¥–∞—é—Ç—Å—è!

---

## üìä –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê –ü–†–û–ë–õ–ï–ú–´

### **–ò–ó –õ–û–ì–û–í –ë–†–ê–£–ó–ï–†–ê:**
```
[UserContext Reducer] SET_BALANCE –¥–µ–π—Å—Ç–≤–∏–µ, –Ω–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:
{
  "uniBalance": 184358.617405,      // –ë–ê–õ–ê–ù–° –°–ü–ò–°–ê–õ–°–Ø
  "uniDepositAmount": 14291,        // –î–ï–ü–û–ó–ò–¢ –£–í–ï–õ–ò–ß–ò–õ–°–Ø
  "uniFarmingActive": true          // –§–ê–†–ú–ò–ù–ì –ê–ö–¢–ò–í–ï–ù
}
```

**–í–´–í–û–î:** –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è!

### **API –ü–†–û–í–ï–†–ö–ê:**
```bash
curl /api/v2/transactions?user_id=184&limit=5
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ä—ã–µ REFERRAL_REWARD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
# –ù–ï–¢ –ù–û–í–´–• FARMING_DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```

---

## üîç –ü–û–õ–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### **–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (—Ä–∞–±–æ—Ç–∞–ª–æ —Å –¥—É–±–ª—è–º–∏):**
```
FarmingService.depositUniForFarming()
‚îú‚îÄ‚îÄ –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ ‚úÖ
‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚úÖ (–ü–ï–†–í–ê–Ø)
‚îú‚îÄ‚îÄ UniFarmingRepository.addDeposit() ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ farming_data ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚úÖ (–í–¢–û–†–ê–Ø - –¥—É–±–ª—å)
‚îÇ   ‚îî‚îÄ‚îÄ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è users ‚úÖ
‚îî‚îÄ‚îÄ Return success ‚úÖ
```

### **–ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (—Å–ª–æ–º–∞–ª–æ—Å—å):**
```
FarmingService.depositUniForFarming()
‚îú‚îÄ‚îÄ –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ ‚úÖ
‚îú‚îÄ‚îÄ –£–ë–†–ê–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚ùå
‚îú‚îÄ‚îÄ UniFarmingRepository.addDeposit() ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ farming_data ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ –ù–ï–¢: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚ùå (–ú–´ –û–®–ò–ë–õ–ò–°–¨!)
‚îÇ   ‚îî‚îÄ‚îÄ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è users ‚úÖ
‚îî‚îÄ‚îÄ Return success ‚úÖ
```

**–†–ï–ó–£–õ–¨–¢–ê–¢:** –î–µ–ø–æ–∑–∏—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å—á–µ–∑–ª–∏!

---

## üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **–í–ê–†–ò–ê–ù–¢ 1: –í–µ—Ä–Ω—É—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ FarmingService**
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π 
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ UniFarmingRepository –ù–ï–¢ –¥—É–±–ª–µ–π

### **–í–ê–†–ò–ê–ù–¢ 2: –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ UniFarmingRepository**  
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ addDeposit()
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### **–í–ê–†–ò–ê–ù–¢ 3: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥**
- –í–µ—Ä–Ω—É—Ç—å backup –∏–∑ ORIGINAL_CODE_BACKUP_BEFORE_DOUBLE_DEPOSIT_FIX.md
- –ù–∞–π—Ç–∏ —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –¥—É–±–ª–µ–π

---

## üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–°–†–û–ß–ù–û:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:** –†–µ–∞–ª—å–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è  
3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–í–ê–†–ò–ê–ù–¢ 1** - –≤–µ—Ä–Ω—É—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ FarmingService, –Ω–æ —Å–Ω–∞—á–∞–ª–∞ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ UniFarmingRepository –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ù–ï–¢ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–†–´–¢–ò–ï

**–ú–´ –°–õ–û–ú–ê–õ–ò –°–û–ó–î–ê–ù–ò–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ô!**

–£–±—Ä–∞–≤ –ª–æ–≥–∏–∫—É –∏–∑ FarmingService, –º—ã –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–ª–∏ —á—Ç–æ –æ–Ω–∞ –µ—Å—Ç—å –≤ Repository, –Ω–æ —ç—Ç–æ –æ–∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–≤–µ—Ä–Ω–æ. –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –≤–∏–¥—è—Ç —Å–≤–æ–∏ –¥–µ–ø–æ–∑–∏—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

**–¢–†–ï–ë–£–ï–¢–°–Ø –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**