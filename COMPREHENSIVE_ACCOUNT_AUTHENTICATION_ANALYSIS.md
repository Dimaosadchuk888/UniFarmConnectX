# –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò –ò BREAKPOINT –¶–ï–ü–û–ß–ö–ò
**–î–∞—Ç–∞:** 21 –∏—é–ª—è 2025  
**–°—Ç–∞—Ç—É—Å:** –¢–û–ß–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê

## üîç –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø

### üìä –ö–õ–Æ–ß–ï–í–´–ï –ù–ê–•–û–î–ö–ò:

**1Ô∏è‚É£ JWT –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø - –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**
- **–í—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 401:** "Invalid or expired JWT token"
- **–ü–æ–¥–ø–∏—Å—å JWT invalid:** —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é
- **Real production tokens:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT –¥–ª–∏–Ω–æ–π 273 —Å–∏–º–≤–æ–ª–∞

**2Ô∏è‚É£ –°–¢–†–£–ö–¢–£–†–ê JWT –¢–û–ö–ï–ù–û–í –ö–û–†–†–ï–ö–¢–ù–ê**
```json
User 184: {
  "user_id": 184,
  "telegram_id": 508972464, 
  "username": "AdminBot"
}

User 25: {
  "user_id": 25,
  "telegram_id": 425855744,
  "username": "DimaOsadchuk"  
}
```

**3Ô∏è‚É£ BREAKPOINT –õ–û–ö–ê–õ–ò–ó–û–í–ê–ù**
- **–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ processTonDeposit()** - –æ–Ω –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- **–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **BREAKPOINT: JWT validation –≤ controller** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## üö® –¢–û–ß–ù–ê–Ø –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–û–ë–õ–ï–ú–´

### ‚ùå –°–¶–ï–ù–ê–†–ò–ô "–†–ê–ó–ù–´–• –ö–ê–ë–ò–ù–ï–¢–û–í":

**–®–∞–≥ 1:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç UniFarm ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT  
**–®–∞–≥ 2:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë –¥–µ–ª–∞–µ—Ç TON –¥–µ–ø–æ–∑–∏—Ç –Ω–∞ —Ç–æ–º –∂–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ  
**–®–∞–≥ 3:** Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å JWT –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ê  
**–®–∞–≥ 4:** Backend –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `telegram_id` –∏–∑ JWT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ê  
**–®–∞–≥ 5:** **–ù–û –¥–µ–ø–æ–∑–∏—Ç —Å–¥–µ–ª–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë —Å –¥—Ä—É–≥–∏–º telegram_id!**  
**–®–∞–≥ 6:** `getUserByTelegramId()` –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí **404 "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"**

### üéØ –ö–û–ù–ö–†–ï–¢–ù–´–ô –ú–ï–•–ê–ù–ò–ó–ú –ü–†–û–ë–õ–ï–ú–´:

```typescript
// –í tonDeposit() controller:
const telegram = this.validateTelegramAuth(req, res); // JWT –æ—Ç User A
const { user_id } = req.body; // user_id –æ—Ç User B (–∏–∑ –¥–µ–ø–æ–∑–∏—Ç–∞)

// –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç User A (–∏–∑ JWT), –Ω–æ –¥–µ–ø–æ–∑–∏—Ç –¥–ª—è User B
const user = await userRepository.getUserByTelegramId(telegram.user.id); // User A telegram_id
// User A –ù–ï –ù–ê–ô–î–ï–ù ‚Üí 404 error
// processTonDeposit() –ù–ò–ö–û–ì–î–ê –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø
```

---

## üìã –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê –ü–†–û–ë–õ–ï–ú–´

### üîç –ê–ù–ê–õ–ò–ó –ë–†–ê–£–ó–ï–†–ù–´–• –õ–û–ì–û–í:
- **TON –±–∞–ª–∞–Ω—Å —Å—Ç–∞–±–∏–ª–µ–Ω:** 3.355847 ‚Üí 3.359317 (—Ç–æ–ª—å–∫–æ —Ñ–∞—Ä–º–∏–Ω–≥)
- **–ù–ï–¢ –ª–æ–≥–æ–≤:** –≤—ã–∑–æ–≤–æ–≤ `/api/v2/wallet/ton-deposit`
- **–ù–ï–¢ –æ—à–∏–±–æ–∫:** –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–æ—à–∏–±–∫–∏ –º–æ–ª—á–∞ –ø–æ–≥–ª–æ—â–∞—é—Ç—Å—è)
- **–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:** UNI —Ñ–∞—Ä–º–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### üìä –ê–ù–ê–õ–ò–ó API ENDPOINTS:
- **Balance API —Ä–∞–±–æ—Ç–∞–µ—Ç:** 200 OK –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **UNI Farming API —Ä–∞–±–æ—Ç–∞–µ—Ç:** —É—Å–ø–µ—à–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫
- **TON Deposit API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:** –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –Ω–∞ auth level

---

## üí° –°–ü–ï–¶–ò–§–ò–ö–ê –ü–†–û–ë–õ–ï–ú–´ –ê–ö–ö–ê–£–ù–¢–û–í 25 –ò 227

### üéØ –î–£–ë–õ–ò–ö–ê–¢ USERNAME - –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

**User 25:**
- telegram_id: `425855744`
- username: `"DimaOsadchuk"`

**User 227:**  
- telegram_id: `25` (–¥—Ä—É–≥–æ–π!)
- username: `"DimaOsadchuk"` (—Ç–æ—Ç –∂–µ!)

**–ö–û–ù–§–õ–ò–ö–¢:** –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –≥–¥–µ-—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getUserByUsername()`, –æ–Ω–∞ –Ω–µ –∑–Ω–∞–µ—Ç –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–±—Ä–∞—Ç—å!

---

## üö® –í–°–ï –ê–ö–ö–ê–£–ù–¢–´ –ó–ê–¢–†–û–ù–£–¢–´

### ‚ùå –°–ò–°–¢–ï–ú–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:
- **–ù–ï —Ç–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç—ã 25/227:** –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
- **–õ—é–±–æ–π "–ø–µ—Ä–µ—Ö–æ–¥ –∫–∞–±–∏–Ω–µ—Ç–∞"** –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å TON –¥–µ–ø–æ–∑–∏—Ç—ã
- **–ü—Ä–æ–±–ª–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è:** —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = 1 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

### üìä –í–õ–ò–Ø–ù–ò–ï –ù–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:
- **–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:** —Ç–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ TON –ø—Ä–∏ –¥–µ–ø–æ–∑–∏—Ç–∞—Ö
- **–°–∏—Å—Ç–µ–º–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–æ–º–∞–Ω–Ω–æ–π:** –¥–µ–ø–æ–∑–∏—Ç—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –∫–æ—à–µ–ª—å–∫–∞, –Ω–æ –±–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- **–ù–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –∑–Ω–∞—é—Ç —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

---

## üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### üö® –ù–ï–ú–ï–î–õ–ï–ù–ù–û –¢–†–ï–ë–£–ï–¢–°–Ø:

**1Ô∏è‚É£ –£–õ–£–ß–®–ï–ù–ò–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø**
```typescript
// –í modules/wallet/controller.ts tonDeposit():
logger.error('[TON Deposit] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è failed', {
  jwt_telegram_id: telegram.user.id,
  request_user_id: req.body.user_id,
  jwt_username: telegram.user.username,
  error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω'
});
```

**2Ô∏è‚É£ –ü–û–ö–ê–ó –û–®–ò–ë–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ**
```typescript
// Frontend –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 404/401 –æ—à–∏–±–∫–∏ –≤–º–µ—Å—Ç–æ –º–æ–ª—á–∞–Ω–∏—è
if (!response.ok) {
  showError(`–û—à–∏–±–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–∞: ${response.status} - ${data.error}`);
}
```

**3Ô∏è‚É£ FALLBACK –ú–ï–•–ê–ù–ò–ó–ú**
```typescript
// –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ä–∞–∑–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:
let user = await getUserByTelegramId(telegram.user.id);
if (!user && req.body.user_id) {
  user = await getUserById(req.body.user_id);
  logger.warn('[TON Deposit] Fallback to user_id from body');
}
```

### üîÑ –î–û–õ–ì–û–°–†–û–ß–ù–´–ï –†–ï–®–ï–ù–ò–Ø:

**1Ô∏è‚É£ WALLET-BASED AUTHENTICATION**
- –ü—Ä–∏–≤—è–∑–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∫ wallet_address –≤–º–µ—Å—Ç–æ telegram_id
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫–æ—à–µ–ª—å–∫–æ–≤

**2Ô∏è‚É£ MULTI-ACCOUNT SUPPORT** 
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö telegram_id –¥–ª—è –æ–¥–Ω–æ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
- Unified user identity system

**3Ô∏è‚É£ PENDING DEPOSITS SYSTEM**
- –î–µ–ø–æ–∑–∏—Ç—ã –æ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–ø–∞–¥–∞—é—Ç –≤ pending
- –°–∏—Å—Ç–µ–º–∞ manual claiming —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**BREAKPOINT –¢–û–ß–ù–û –û–ü–†–ï–î–ï–õ–ï–ù:** JWT authentication mismatch –≤ `tonDeposit()` controller –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ TON –¥–µ–ø–æ–∑–∏—Ç—ã –æ—Ç "—Å–º–µ—à–∞–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤".

**–ú–ê–°–®–¢–ê–ë:** –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–µ —Ç–æ–ª—å–∫–æ 25/227.

**–°–†–û–ß–ù–û–°–¢–¨:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø - —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Ç–µ—Ä—è—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–∞—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.

**–†–ï–®–ï–ù–ò–ï:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ controller authentication + —É–ª—É—á—à–µ–Ω–∏–µ error handling + fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã.