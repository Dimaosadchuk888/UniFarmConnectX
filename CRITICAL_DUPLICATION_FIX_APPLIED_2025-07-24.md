# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–û

**–î–∞—Ç–∞:** 24 –∏—é–ª—è 2025 18:18 MSK  
**–ü—Ä–æ–±–ª–µ–º–∞:** TON –¥–µ–ø–æ–∑–∏—Ç—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å (1 TON ‚Üí +2 TON –Ω–∞ –±–∞–ª–∞–Ω—Å)  
**–°—Ç–∞—Ç—É—Å:** üéØ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ì–û–¢–û–í–û –ö DEPLOYMENT**

---

## üìã –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

### **–ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:**
–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–µ–π metadata –º–µ–∂–¥—É WalletService –∏ TransactionService:
- **WalletService –æ—Ç–ø—Ä–∞–≤–ª—è–ª**: `metadata.tx_hash = "hash123"`
- **TransactionService –∏—Å–∫–∞–ª**: `metadata.ton_tx_hash`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ù–ï –†–ê–ë–û–¢–ê–õ–ê ‚Üí —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –¥—É–±–ª–∏–∫–∞—Ç—ã

### **–¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:**
**–§–∞–π–ª**: `modules/wallet/service.ts`  
**–°—Ç—Ä–æ–∫–∞**: 407  
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ**:
```typescript
// ‚ùå –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
metadata: {
  source: 'ton_deposit',
  original_type: 'TON_DEPOSIT',
  wallet_address,
  tx_hash: ton_tx_hash  // –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–õ–ï!
}

// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:
metadata: {
  source: 'ton_deposit',
  original_type: 'TON_DEPOSIT', 
  wallet_address,
  ton_tx_hash: ton_tx_hash  // –ü–†–ê–í–ò–õ–¨–ù–û–ï –ü–û–õ–ï!
}
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**
```
User –¥–µ–ø–æ–∑–∏—Ç 1 TON ‚Üí
metadata.tx_hash = "hash123" ‚Üí
TransactionService –∏—â–µ—Ç metadata.ton_tx_hash ‚Üí
–ù–ï –ù–ê–•–û–î–ò–¢! ‚Üí
tx_hash_unique = null ‚Üí
–î—É–±–ª–∏–∫–∞—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è ‚Üí
+2 TON –Ω–∞ –±–∞–ª–∞–Ω—Å üö®
```

### **–ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**
```
User –¥–µ–ø–æ–∑–∏—Ç 1 TON ‚Üí
metadata.ton_tx_hash = "hash123" ‚Üí
TransactionService –Ω–∞—Ö–æ–¥–∏—Ç metadata.ton_tx_hash ‚Üí
–ù–ê–•–û–î–ò–¢! ‚Üí
tx_hash_unique = "hash123" ‚Üí
–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí
+1 TON –Ω–∞ –±–∞–ª–∞–Ω—Å ‚úÖ
```

---

## üìä –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø

### **‚úÖ LSP –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
### **‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π**:
- Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: `ton_tx_hash`
- WalletService –ø–µ—Ä–µ–¥–∞–µ—Ç: `metadata.ton_tx_hash` 
- TransactionService –∏—â–µ—Ç: `metadata.ton_tx_hash`
- **–°–û–í–ü–ê–î–ï–ù–ò–ï –ü–û–õ–ù–û–ï!**

### **‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å**:
```
Frontend (tonConnectService.ts) ‚Üí
API (/api/v2/wallet/ton-deposit) ‚Üí
WalletService.processTonDeposit() ‚Üí
UnifiedTransactionService.createTransaction() ‚Üí
TransactionService (—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π) ‚Üí
Database (—Å unique constraint) ‚Üí
WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí
UI update
```

---

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö DEPLOYMENT

### **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ**
### **‚úÖ –ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω** 
### **‚úÖ –ë–µ–∑ LSP –æ—à–∏–±–æ–∫**
### **‚úÖ Backward compatibility** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
### **‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞**

### **‚è≥ –¢–†–ï–ë–£–ï–¢ REDEPLOY –î–õ–Ø –ü–†–û–î–ê–ö–®–ù**

---

## üìù –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ê

- ‚úÖ `replit.md` - –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª –æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
- ‚úÖ `CRITICAL_DUPLICATION_SOURCE_FOUND_2025-07-24.md` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- ‚úÖ `CRITICAL_DUPLICATION_FIX_APPLIED_2025-07-24.md` - —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

**üéØ –°–¢–ê–¢–£–°**: –ì–û–¢–û–í–û –ö –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ú–£ DEPLOYMENT –î–õ–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø –§–ò–ù–ê–ù–°–û–í–û–ô –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–ò