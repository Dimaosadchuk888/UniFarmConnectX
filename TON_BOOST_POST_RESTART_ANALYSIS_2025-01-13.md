# üîç –ì–õ–£–ë–û–ö–û–ï –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï –°–ò–°–¢–ï–ú–´ UniFarm
**–î–∞—Ç–∞:** 13 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞  
**–ê–≤—Ç–æ—Ä:** AI Assistant

## üìã –†–µ–∑—é–º–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç—Ä–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º UniFarm:
1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π TON Boost –≤ –∏—Å—Ç–æ—Ä–∏–∏
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö UNI Farming –ø–∞–∫–µ—Ç–æ–≤  
3. –†–∞–±–æ—Ç–∞ CRON-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–≤ –∏ –∏—Ö —Å–≤—è–∑—å —Å –ë–î

## üéØ –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### 1. TON Boost —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ù–ï –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

#### –¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤:
```
tonBoostIncomeScheduler.ts ‚Üí UnifiedTransactionService ‚Üí –ë–î ‚Üí API ‚Üí Frontend
```

#### –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** (`modules/scheduler/tonBoostIncomeScheduler.ts:158`):
  ```typescript
  type: 'FARMING_REWARD',  // –ù–ï 'TON_BOOST_REWARD'
  metadata: {
    original_type: 'TON_BOOST_INCOME'  // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ metadata
  }
  ```

- **–ë–î –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç:** 131 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–∏–ø–∞ `FARMING_REWARD` —Å `amount_ton > 0`
- **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–∂–∏–¥–∞–µ—Ç:** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ `TON_BOOST_REWARD`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è, –Ω–æ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è —Å UNI farming —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### 2. UNI Farming —Å–æ–∑–¥–∞–µ—Ç –û–î–ù–£ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤–º–µ—Å—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

#### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:
- **farmingScheduler.ts:98** - –≤—ã–∑—ã–≤–∞–µ—Ç `calculateUniFarmingIncome`
- **farmingScheduler.ts:335-359** - –º–µ—Ç–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –æ—Ç –û–î–ù–û–ì–û –¥–µ–ø–æ–∑–∏—Ç–∞:
  ```typescript
  const depositAmount = parseFloat(farmer.deposit_amount || '0');
  const income = depositAmount * rate * daysElapsed;
  ```

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ `uni_deposit_amount` (–æ–±—â–∏–π –¥–µ–ø–æ–∑–∏—Ç)
- –ù–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞—Ä–º–∏–Ω–≥ –ø–∞–∫–µ—Ç–æ–≤
- –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ –≤—Å—é —Å—É–º–º—É

### 3. CRON-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ –∏ –∏—Ö —Å–≤—è–∑—å —Å –ë–î

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–≤:

**TON Boost –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:**
- **–ó–∞–ø—É—Å–∫:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (`*/5 * * * *`)
- **–¢–∞–±–ª–∏—Ü—ã:** `ton_farming_data` ‚Üí `users` (–¥–ª—è –±–∞–ª–∞–Ω—Å–æ–≤)
- **–ü—Ä–æ—Ü–µ—Å—Å:**
  1. –ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `ton_farming_data`
  2. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å—ã –∏–∑ `users`
  3. –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `transactions`
  4. –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å—ã —á–µ—Ä–µ–∑ `BalanceManager`

**UNI Farming –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:**
- **–ó–∞–ø—É—Å–∫:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (`*/5 * * * *`)
- **–¢–∞–±–ª–∏—Ü—ã:** `users` (—á–µ—Ä–µ–∑ `UniFarmingRepository`)
- **–ü—Ä–æ—Ü–µ—Å—Å:**
  1. –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `uni_farming_active = true`
  2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –æ—Ç –µ–¥–∏–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
  3. –°–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ `BatchBalanceProcessor`
  4. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã

## üìä –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Ç–∞–±–ª–∏—Ü–∞ `transactions`):
```
- FARMING_REWARD —Å currency=TON: 131 –∑–∞–ø–∏—Å–µ–π
- FARMING_REWARD —Å currency=UNI: 3000+ –∑–∞–ø–∏—Å–µ–π  
- TON_BOOST_REWARD: 0 –∑–∞–ø–∏—Å–µ–π (—Ç–∏–ø –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
```

### –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- TON Boost: 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `farming_balance = 0`
- UNI Farming: 36 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –µ–¥–∏–Ω—ã–º –¥–µ–ø–æ–∑–∏—Ç–æ–º

## üîó –ü–æ–ª–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤

### TON Boost Income:
```
1. server/index.ts ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç schedulerManager
2. schedulerManager ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç tonBoostIncomeScheduler  
3. tonBoostIncomeScheduler.processTonBoostIncome()
   ‚Üí TonFarmingRepository.getActiveBoostUsers()
   ‚Üí supabase.from('users').select() // –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
   ‚Üí UnifiedTransactionService.createTransaction()
   ‚Üí BalanceNotificationService.notifyBalanceUpdate()
   ‚Üí ReferralService.distributeReferralRewards()
```

### UNI Farming Income:
```
1. farmingScheduler.processUniFarmingIncome()
   ‚Üí UniFarmingRepository.getActiveFarmers()
   ‚Üí calculateUniFarmingIncome() // –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞—Ä–º–µ—Ä–∞
   ‚Üí BatchBalanceProcessor.processFarmingIncome()
   ‚Üí supabase.from('transactions').insert()
   ‚Üí ReferralService.distributeReferralRewards()
```

## ‚ùå –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ —Å–±–æ—è

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ì–¥–µ:** `tonBoostIncomeScheduler.ts:158`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `FARMING_REWARD` –≤–º–µ—Å—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ —Ç–∏–ø–∞
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å TON Boost –æ—Ç UNI Farming –≤ UI

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- **–ì–¥–µ:** –ù–µ—Ç —Ç–∞–±–ª–∏—Ü—ã `farming_packages` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏—Å—Ç–µ–º–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–±—â–∏–π –¥–µ–ø–æ–∑–∏—Ç
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞—á–∏—Å–ª—è—Ç—å –¥–æ—Ö–æ–¥ –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

### 3. farming_balance = 0 –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- **–ì–¥–µ:** `ton_farming_data.farming_balance`
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ª–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ (—Ç—Ä–µ–±—É–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ–∫—É–ø–æ–∫)
- **–≠—Ñ—Ñ–µ–∫—Ç:** –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ –æ—Ç 0

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞)

### –î–ª—è TON Boost —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
1. –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø —Å `FARMING_REWARD` –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
2. –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ metadata.original_type

### –î–ª—è UNI Farming –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:
1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞
3. –°–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—É—é —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π TON Boost:
1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ farming_balance
2. –ò–ª–∏ –∂–¥–∞—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–∫—É–ø–æ–∫ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## üîç –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –∏–º–µ–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∏–∑-–∑–∞ —Ç–∏–ø–∞
- UNI Farming –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –Ω–æ–≤—ã—Ö –ø–æ–∫—É–ø–æ–∫ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∞–Ω–∞–ª–∏–∑–æ–º –∫–æ–¥–∞ –∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î.**