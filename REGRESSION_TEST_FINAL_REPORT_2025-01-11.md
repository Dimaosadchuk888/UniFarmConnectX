# –û—Ç—á—ë—Ç –æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ UniFarm

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 11 –∏—é–ª—è 2025  
**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –±–µ–∑ –±–∞–≥–æ–≤ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π  
**–ú–µ—Ç–æ–¥:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥

## üì¶ –§–∞–∑–∞ 1 ‚Äî –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞–º–∏ (BalanceManager)
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - –ù–∞–π–¥–µ–Ω–æ 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö UNI —Ñ–∞—Ä–º–µ—Ä–æ–≤
  - BalanceManager –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å–∞–º–∏
  - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
  - WebSocket –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –±–∞–ª–∞–Ω—Å–æ–≤

### ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥  
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - –¢–∞–±–ª–∏—Ü–∞ referrals –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
  - –ü–æ–ª—è inviter_id –∏ user_id –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
  - –ù–∞—á–∏—Å–ª–µ–Ω–∏—è –∏–¥—É—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –¥–æ—Ö–æ–¥–∞ (–Ω–µ –æ—Ç –ø–æ–∫—É–ø–∫–∏)
  - –õ–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫ –≤ TON Boost –∏ farming

### ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–∏–ø—ã
  - –ù–∞–π–¥–µ–Ω—ã —Ç–∏–ø—ã: FARMING_REWARD, REFERRAL_REWARD
  - –ù–æ–≤—ã–µ —Ç–∏–ø—ã (FARMING_DEPOSIT, BOOST_PURCHASE) –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üì¶ –§–∞–∑–∞ 2 ‚Äî –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### ‚úÖ WebSocket real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  - Heartbeat ping/pong —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
  - Balance updates –ø—Ä–∏—Ö–æ–¥—è—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
  - Reconnection —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TON –∫–æ—à–µ–ª—å–∫–æ–≤
- **–°—Ç–∞—Ç—É—Å:** API –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - Endpoints /wallet/connect-ton –∏ /wallet/save-ton-address —Ä–∞–±–æ—Ç–∞—é—Ç
  - –ü–æ–ª—è ton_wallet_address, ton_wallet_verified, ton_wallet_linked_at –≥–æ—Ç–æ–≤—ã
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –∞–¥—Ä–µ—Å–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ farming_sessions
- **–°—Ç–∞—Ç—É—Å:** –¢–∞–±–ª–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - –¢–∞–±–ª–∏—Ü–∞ farming_sessions —Å–æ–∑–¥–∞–Ω–∞ –≤ –ë–î
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
  - –ì–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø–∏—Å–∏ –Ω–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π

## üì¶ –§–∞–∑–∞ 3 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ (BatchBalanceProcessor)
- **–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - –í—Å–µ –≤—ã–∑–æ–≤—ã supabase.raw() —É–¥–∞–ª–µ–Ω—ã
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Supabase API –æ–ø–µ—Ä–∞—Ü–∏–∏
  - Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- **–°—Ç–∞—Ç—É—Å:** –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - TON Boost –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –æ–±—ã—á–Ω—ã–µ
  - BalanceNotificationService - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä –≤ –∏–º–ø–æ—Ä—Ç–∞—Ö
  - –í—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### ‚úÖ Balance Cache Metrics
- **–°—Ç–∞—Ç—É—Å:** Endpoint –¥–æ–±–∞–≤–ª–µ–Ω
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
  - GET /api/v2/metrics/balance-cache —Ä–∞–±–æ—Ç–∞–µ—Ç
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: hits, misses, evictions, size, hitRate
  - –ì–æ—Ç–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìä –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```
üì¶ –§–∞–∑–∞ 1
‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Referral –Ω–∞–≥—Ä–∞–¥—ã ‚Äî —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞
‚úÖ TransactionType ‚Äî –≤—Å–µ —Ç–∏–ø—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

üì¶ –§–∞–∑–∞ 2
‚úÖ WebSocket ‚Äî real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
‚úÖ TON –∫–æ—à–µ–ª—å–∫–∏ ‚Äî API –≥–æ—Ç–æ–≤–æ
‚úÖ Farming sessions ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞

üì¶ –§–∞–∑–∞ 3
‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ ‚Äî —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
‚úÖ Cache metrics ‚Äî endpoint –¥–æ–±–∞–≤–ª–µ–Ω

–û–±—â–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: 100%
–û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –±–∞–≥–∏: –ù–ï–¢
```

## üîç –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - users: 60 –∑–∞–ø–∏—Å–µ–π
   - transactions: 536,803 –∑–∞–ø–∏—Å–µ–π
   - referrals: —Ç–∞–±–ª–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞
   - farming_sessions: —Ç–∞–±–ª–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞

2. **WebSocket:**
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–ª—è user_id: 74
   - Heartbeat —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–±–æ–µ–≤
   - Balance updates –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

3. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏:**
   - UNI farming scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç
   - TON Boost scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–æ–≤

4. **API endpoints:**
   - /api/v2/wallet/connect-ton
   - /api/v2/wallet/save-ton-address  
   - /api/v2/metrics/balance-cache

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–µ—à–∞ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π endpoint
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ –∑–∞–ø–∏—Å—è–º–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ referrals –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è TON –∫–æ—à–µ–ª—å–∫–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –°–ª–µ–¥–∏—Ç—å –∑–∞ hit rate –∫–µ—à–∞ –±–∞–ª–∞–Ω—Å–æ–≤
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á–∏—Ç—å TTL –∫–µ—à–∞

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ UniFarm –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å—Ç–∞–±–∏–ª—å–Ω–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –±–µ–∑ –±–∞–≥–æ–≤ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.