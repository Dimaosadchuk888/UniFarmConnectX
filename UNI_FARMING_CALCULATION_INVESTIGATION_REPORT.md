# üîç –û–¢–ß–ï–¢: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–æ—Ö–æ–¥–∞ UniFarming

**–î–∞—Ç–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:** 14 —è–Ω–≤–∞—Ä—è 2025  
**–ú–µ—Ç–æ–¥:** –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π  
**–ê–≤—Ç–æ—Ä:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã

## üìä –ö–†–ê–¢–ö–ò–ï –í–´–í–û–î–´

**–ö–ª—é—á–µ–≤–∞—è –Ω–∞—Ö–æ–¥–∫–∞:** –°–∏—Å—Ç–µ–º–∞ UniFarming —Ä–∞–±–æ—Ç–∞–µ—Ç **–Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Ö–æ–¥ –æ—Ç `deposit_amount` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ), –¥—Ä—É–≥–∏–µ –æ—Ç `balance_uni` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ).

## üîß 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô –ê–ù–ê–õ–ò–ó

### 1.1 –¶–µ–ø–æ—á–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –¥–æ—Ö–æ–¥–∞ UniFarming

```
farmingScheduler.ts
    ‚Üì
processUniFarmingIncome()
    ‚Üì
UniFarmingRepository.getActiveFarmers()
    ‚Üì (fallback –Ω–∞ —Ç–∞–±–ª–∏—Ü—É users)
calculateUniFarmingIncome(farmer)
    ‚Üì
income = depositAmount * rate * daysElapsed
```

**–ö–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ (farmingScheduler.ts):**
```typescript
const depositAmount = parseFloat(farmer.deposit_amount || '0');
const income = depositAmount * rate * daysElapsed;
```

**–í—ã–≤–æ–¥:** –ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `deposit_amount`, –ù–ï `balance_uni`.

### 1.2 UniFarmingRepository Fallback –º–µ—Ö–∞–Ω–∏–∑–º

Repository –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `uni_farming_data`, –Ω–æ –ø—Ä–∏ –µ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –Ω–∞ —Ç–∞–±–ª–∏—Ü—É `users`:

```typescript
// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ users
deposit_amount: user.uni_deposit_amount || '0'
```

## üìà 2. –ê–ù–ê–õ–ò–ó –†–ï–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•

### 2.1 USER 74 (–ê–Ω–æ–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
- **Balance UNI:** 53,040.30
- **Deposit Amount:** 6,440,942.00
- **–û–∂–∏–¥–∞–µ–º—ã–π –¥–æ—Ö–æ–¥ –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞ (5 –º–∏–Ω):** 223.64 UNI
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
  - 4428.81 UNI ‚Üí **x20 –ø–µ—Ä–∏–æ–¥–æ–≤** –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
  - 4205.12 UNI ‚Üí **x19 –ø–µ—Ä–∏–æ–¥–æ–≤**
  - 3981.35 UNI ‚Üí **x18 –ø–µ—Ä–∏–æ–¥–æ–≤**

**–í—ã–≤–æ–¥:** –î–æ—Ö–æ–¥ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–∞, –Ω–æ —Å –æ–≥—Ä–æ–º–Ω—ã–º–∏ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è–º–∏ (–¥–æ 20 –ø–µ—Ä–∏–æ–¥–æ–≤ = 100 –º–∏–Ω—É—Ç).

### 2.2 USER 64 (NULL –¥–µ–ø–æ–∑–∏—Ç)
- **Balance UNI:** 495.25
- **Deposit Amount:** NULL (–≤ –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Üí NaN)
- **–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** 0.000921, 0.000784, 0.000854 UNI (>6000 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)

**–í—ã–≤–æ–¥:** –ü—Ä–∏ NULL –≤ `uni_deposit_amount` —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback —Ä–∞—Å—á–µ—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞.

### 2.3 USER 14 & 21 (–≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è)
- **Deposit Amount:** 100 UNI
- **–ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã:** 898-901 (4490-4505 –º–∏–Ω—É—Ç = ~75 —á–∞—Å–æ–≤!)

**–í—ã–≤–æ–¥:** –°–∏—Å—Ç–µ–º–∞ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–∏–æ–¥—ã –ø—Ä–∏ —Å–±–æ—è—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.

## üîç 3. –°–†–ê–í–ù–ï–ù–ò–ï –° TON BOOST

### TON Boost –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
tonBoostIncomeScheduler.ts
    ‚Üì
TonFarmingRepository.getActiveBoostUsers()
    ‚Üì (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ ton_farming_data)
–†–∞—Å—á–µ—Ç: farming_balance * farming_rate * time
```

### USER 74 –≤ TON Boost:
- **Farming Balance:** 412 TON (–∏–∑ ton_farming_data)
- **Farming Rate:** 0.00025 (0.025% –≤ –¥–µ–Ω—å)
- **–û–∂–∏–¥–∞–µ–º—ã–π –¥–æ—Ö–æ–¥ (5 –º–∏–Ω):** 0.000358 TON
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:** 0.035764 TON ‚Üí **x100 –ø–µ—Ä–∏–æ–¥–æ–≤!**

**–í—ã–≤–æ–¥:** TON Boost –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `farming_balance` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ —Ç–∞–∫–∂–µ —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π.

## ‚ö†Ô∏è 4. –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç NULL –≤ `uni_deposit_amount`
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–∞—Å—á–µ—Ç—É –æ—Ç –±–∞–ª–∞–Ω—Å–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤
- User 74: –¥–æ 20 –ø–µ—Ä–∏–æ–¥–æ–≤ (100 –º–∏–Ω—É—Ç)
- Users 14, 21: –¥–æ 901 –ø–µ—Ä–∏–æ–¥–∞ (75 —á–∞—Å–æ–≤!)
- –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ `deposit_amount !== null` –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤

## üéØ 5. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ farmingScheduler:**
   ```typescript
   if (!farmer.deposit_amount || farmer.deposit_amount === '0') {
     logger.warn(`Skip user ${farmer.user_id}: no deposit`);
     continue;
   }
   ```

2. **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ NULL –∑–Ω–∞—á–µ–Ω–∏–π:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤
   - –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å `uni_farming_active=true` –Ω–æ `uni_deposit_amount=NULL`

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏:**
   - –ò—Å–∫–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ cron –∑–∞–¥–∞—á–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–°–æ–∑–¥–∞—Ç—å UnifiedFarmingCalculator** - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Ä–∞—Å—á–µ—Ç–∞
2. **–í–Ω–µ–¥—Ä–∏—Ç—å idempotency keys** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–î–æ–±–∞–≤–∏—Ç—å rate limiting** - –º–∞–∫—Å–∏–º—É–º 1 –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–Ω–æ–º–∞–ª–∏–π** - –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö >1000 UNI

## üìã 6. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è balance_uni –≤ –∫–æ–¥–µ:
1. **–ü—Ä—è–º–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ù–ï–¢** - –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `deposit_amount`
2. **–ö–æ—Å–≤–µ–Ω–Ω–æ–µ —á–µ—Ä–µ–∑ fallback** - –∫–æ–≥–¥–∞ `uni_deposit_amount = NULL`

### Fallback –ª–æ–≥–∏–∫–∞:
- –ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `UniFarmingRepository.getActiveFarmersFallback()`
- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–∞–±–ª–∏—Ü—ã `uni_farming_data`
- –ú–∞–ø–ø–∏–Ω–≥: `deposit_amount: user.uni_deposit_amount || '0'`

## üèÅ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –∫–æ–¥–µ —Ä–∞—Å—á–µ—Ç–∞ (–æ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω), –∞ –≤ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –Ω–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**:
1. –î–∞–Ω–Ω—ã–µ –æ –¥–µ–ø–æ–∑–∏—Ç–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å NULL
2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–∏–æ–¥—ã
3. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª—ã —Ä–∞—Å—á–µ—Ç–∞, –∞ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–π.

---

*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö production —Å–∏—Å—Ç–µ–º—ã UniFarm.*