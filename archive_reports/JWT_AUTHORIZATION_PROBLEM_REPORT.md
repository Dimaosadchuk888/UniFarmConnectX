# üîê JWT AUTHORIZATION PROBLEM REPORT

**–î–∞—Ç–∞:** 08 –∏—é–ª—è 2025  
**–í—Ä–µ–º—è:** 16:18 UTC  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê  

---

## üö® –ü–†–û–ë–õ–ï–ú–ê

### –û–ø–∏—Å–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ UniFarm –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É —Å JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π. –í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—É—á–∞—é—Ç HTTP 401 "Unauthorized" –æ—à–∏–±–∫–∏, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ JWT —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ localStorage.

### –°–∏–º–ø—Ç–æ–º—ã
```
[correctApiRequest] –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞: {"success":false,"error":"Authentication required","need_jwt_token":true}
[correctApiRequest] –ü–æ–ª–Ω–∞—è –æ—à–∏–±–∫–∞: {"error":{},"message":"HTTP 401: Unauthorized","stack":"@https://4d4d6a89-7d13-450c-afe1-289d26a5e65c-00-2k0o31d3c7w9k.riker.replit.dev/src/lib/correctApiRequest.ts:58:22"}
[ERROR] UniFarmingCard - –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞—Ä–º–∏–Ω–≥–µ: {}
```

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```bash
# –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å —Å JWT —Ç–æ–∫–µ–Ω–æ–º –†–ê–ë–û–¢–ê–ï–¢
curl -H "Authorization: Bearer JWT_TOKEN" http://localhost:3000/api/v2/users/profile
# –û—Ç–≤–µ—Ç: {"success":true,"data":{"user":{"id":62,"telegram_id":88888848,"username":"preview_test","first_name":"Preview","ref_code":"REF_1751780521918_e1v62d","balance_uni":549,"balance_ton":"0"}}}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
```javascript
// JWT —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID 62
const correctToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYyLCJ0ZWxlZ3JhbV9pZCI6ODg4ODg4NDgsInVzZXJuYW1lIjoicHJldmlld190ZXN0IiwiZmlyc3RfbmFtZSI6IlByZXZpZXciLCJyZWZfY29kZSI6IlJFRl8xNzUxNzgwNTIxOTE4X2UxdjYyZCIsImlhdCI6MTc1MTg3MTA2MywiZXhwIjoxNzUyNDc1ODYzfQ.NKbyJiXtLnGzyr0w-C1oR658X5TzDO6EkKU8Ie5zgE0';

// –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
{
  "userId": 62,
  "telegram_id": 88888848,
  "username": "preview_test",
  "first_name": "Preview",
  "ref_code": "REF_1751780521918_e1v62d",
  "iat": 1751871063,
  "exp": 1752475863
}
```

---

## üîß –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ JWT –≤ main.tsx
```typescript
// –§–∞–π–ª: client/src/main.tsx
// –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ JWT —Ç–æ–∫–µ–Ω–∞
(function() {
  console.log('[JWT Auth Fix] –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø —É—Å—Ç–∞–Ω–æ–≤–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞...');
  const correctToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
  localStorage.setItem('unifarm_jwt_token', correctToken);
  console.log('[JWT Auth Fix] ‚úÖ JWT —Ç–æ–∫–µ–Ω –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
})();
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ correctApiRequest.ts
```typescript
// –§–∞–π–ª: client/src/lib/correctApiRequest.ts
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏
const forceJWTToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
requestHeaders['Authorization'] = `Bearer ${forceJWTToken}`;
console.log('[correctApiRequest] üî• –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô JWT —Ç–æ–∫–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization');
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ index.html
```html
<!-- –§–∞–π–ª: client/index.html -->
<script>
  (function() {
    console.log('[JWT Auth Fix] –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞...');
    const token = localStorage.getItem('unifarm_jwt_token');
    if (!token) {
      const correctToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
      localStorage.setItem('unifarm_jwt_token', correctToken);
      console.log('[JWT Auth Fix] JWT —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');
    }
  })();
</script>
```

### 4. –°–æ–∑–¥–∞–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç fix-jwt-auth.html
–í–µ–±-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—á–∏—Å—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üö® –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### –ü—Ä–æ–±–ª–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö `correctApiRequest.ts` –∏ `main.tsx` **–ù–ï –û–¢–û–ë–†–ê–ñ–ê–Æ–¢–°–Ø** –≤ –±—Ä–∞—É–∑–µ—Ä–µ. –õ–æ–≥–∏ –æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

1. **Vite dev server** –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
2. **–ë—Ä–∞—É–∑–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç** —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é JavaScript
3. **Workflow –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫** –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ `console.log('[correctApiRequest] üî• –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô JWT —Ç–æ–∫–µ–Ω...')` - **–ù–ï –ü–û–Ø–í–õ–Ø–Æ–¢–°–Ø**
- –ò–∑–º–µ–Ω–µ–Ω –∫–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ JWT —Ç–æ–∫–µ–Ω–∞ - **–ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø**
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Authorization header - **–ù–ï –ü–†–ò–ú–ï–ù–Ø–ï–¢–°–Ø**

---

## ‚ö° –†–ï–®–ï–ù–ò–ï

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É** –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Å–µ—Ä–≤–µ—Ä + frontend)
2. **–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞** –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å workflow** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ
```typescript
// –û–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å: –ü—Ä—è–º–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –æ–±—ä–µ–∫—Ç–µ
(window as any).UNIFARM_JWT_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ correctApiRequest
const token = (window as any).UNIFARM_JWT_TOKEN || localStorage.getItem('unifarm_jwt_token');
```

---

## üìä –í–õ–ò–Ø–ù–ò–ï –ù–ê –°–ò–°–¢–ï–ú–£

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Backend API** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚ùå **Frontend –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **UNI Farming** - –¥–µ–ø–æ–∑–∏—Ç—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã
- ‚ùå **Wallet operations** - –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- ‚ùå **User profile** - –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚ùå **Boost packages** - –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
- **–û–±—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 50% (—Å–Ω–∏–∂–µ–Ω–∏–µ —Å 95%)
- **Backend –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 100%
- **Frontend –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 30%
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 0%

---

## üõ†Ô∏è –ü–õ–ê–ù –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
- [ ] –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ workflow
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞
- [ ] –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞

### –≠—Ç–∞–ø 2: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –ü—Ä—è–º–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ header
- [ ] –û–±—Ö–æ–¥ localStorage

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞—Ä–º–∏–Ω–≥–∞
- [ ] –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –§–ê–ô–õ–´

### –§–∞–π–ª—ã —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
- `client/src/lib/correctApiRequest.ts` - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ JWT
- `client/src/main.tsx` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞
- `client/index.html` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ HTML
- `fix-jwt-auth.html` - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã
- `core/middleware/telegramAuth.ts` - Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `SYSTEM_ROADMAP_UNIFARM.md` - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ —Å–∏—Å—Ç–µ–º—ã
- `modules/farming/directDeposit.ts` - –û–±—Ö–æ–¥–Ω–æ–π –º–µ—Ç–æ–¥ –¥–µ–ø–æ–∑–∏—Ç–æ–≤

---

## üìû –ö–û–ù–¢–ê–ö–¢–´

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô  
**–í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è:** –î–æ 1 —á–∞—Å–∞  

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞.

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ UniFarm*  
*–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è: 08 –∏—é–ª—è 2025, 16:18 UTC*