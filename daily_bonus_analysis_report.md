# üéØ –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã Daily Bonus - UniFarm
**–î–∞—Ç–∞:** 12.07.2025  
**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID 74

## ‚úÖ –û—Ç–≤–µ—Ç: –î–∞, –±–æ–Ω—É—Å 600 UNI –±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!

### üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID 74:
```json
{
  "canClaim": true,
  "streak": 1,
  "bonusAmount": 600
}
```

## üîó –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Daily Bonus:

### 1Ô∏è‚É£ Frontend Layer

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `client/src/components/dashboard/DailyBonusCard.tsx`

**–ò–Ω–∏—Ü–∏–∞—Ü–∏—è claim:**
```typescript
// –°—Ç—Ä–æ–∫–∞ 42-43: –ú—É—Ç–∞—Ü–∏—è –¥–ª—è claim –±–æ–Ω—É—Å–∞
const claimBonusMutation = useMutation({
  mutationFn: async () => {
    const endpoint = '/api/v2/daily-bonus/claim';
    const response = await correctApiRequest(endpoint, 'POST', { user_id: userId || 1 });
```

**API –∑–∞–ø—Ä–æ—Å:** `POST /api/v2/daily-bonus/claim`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `correctApiRequest` —Å JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –ü–µ—Ä–µ–¥–∞–µ—Ç `user_id: 74` –≤ body

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç
- –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ `invalidateQueryWithUserId`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —Å—É–º–º–æ–π

### 2Ô∏è‚É£ Backend Layer

**–ú–∞—Ä—à—Ä—É—Ç:** `modules/dailyBonus/routes.ts:77-82`
```typescript
router.post('/claim', requireTelegramAuth, (req, res) => 
  dailyBonusController.claimDailyBonus(req, res)
);
```

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `modules/dailyBonus/controller.ts:58-79`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `user_id` –≤ body
- –í—ã–∑—ã–≤–∞–µ—Ç `dailyBonusService.claimDailyBonus(user_id)`

**–°–µ—Ä–≤–∏—Å:** `modules/dailyBonus/service.ts:96-220`

**–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ 109)
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥–∞—Ç—ã claim (—Å—Ç—Ä–æ–∫–∞ 122-128)
3. –†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–π —Å–µ—Ä–∏–∏ –¥–Ω–µ–π streak (—Å—Ç—Ä–æ–∫–∞ 131-138)

**–†–∞—Å—á–µ—Ç —Å—É–º–º—ã –±–æ–Ω—É—Å–∞:** (—Å—Ç—Ä–æ–∫–∞ 258-264)
```typescript
private calculateBonusAmount(streakDays: number): string {
  const baseAmount = 500; // Base 500 UNI
  const bonusMultiplier = Math.min(streakDays * 0.1, 2.0);
  const finalAmount = baseAmount * (1 + bonusMultiplier);
  return finalAmount.toFixed(6);
}
```

–î–ª—è streak = 1: `500 * (1 + 0.1) = 550 UNI`

**–ù–û!** –í `routes.ts:61` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∞—è —Ñ–æ—Ä–º—É–ª–∞:
```typescript
const bonusAmount = Math.min(500 + (streakDays * 100), 2000);
```
–î–ª—è streak = 1: `500 + (1 * 100) = 600 UNI` ‚úÖ

### 3Ô∏è‚É£ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:**
1. **BalanceManager.addBalance()** (—Å—Ç—Ä–æ–∫–∞ 143-149)
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users`:
     - `balance_uni` = —Ç–µ–∫—É—â–∏–π + 600
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–µ—à –±–∞–ª–∞–Ω—Å–∞
   - –í—ã–∑—ã–≤–∞–µ—Ç WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ streak:** (—Å—Ç—Ä–æ–∫–∞ 157-163)
   - –¢–∞–±–ª–∏—Ü–∞: `users`
   - –ü–æ–ª—è: `checkin_last_date`, `checkin_streak`

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** (—Å—Ç—Ä–æ–∫–∞ 178-190)
   - –¢–∞–±–ª–∏—Ü–∞: `transactions`
   - –¢–∏–ø: `DAILY_BONUS`
   - –°—É–º–º–∞: 600 UNI
   - –û–ø–∏—Å–∞–Ω–∏–µ: "Daily bonus day 1"

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** (—Å—Ç—Ä–æ–∫–∞ 196-207)
   - –¢–∞–±–ª–∏—Ü–∞: `daily_bonus_logs`
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–µ—Ç–∞–ª–∏ claim

### 4Ô∏è‚É£ WebSocket & UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:**
- `BalanceManager` –≤—ã–∑—ã–≤–∞–µ—Ç `onBalanceUpdate(user_id)` (—Å—Ç—Ä–æ–∫–∞ 170-176)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `balance_update` –≤—Å–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º
- Frontend —á–µ—Ä–µ–∑ `useWebSocketBalanceSync` –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ WebSocket
2. –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º claim
3. Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å 600 UNI —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω!"
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## üîí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

‚úÖ **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
- `requireTelegramAuth` middleware –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–µ
- JWT —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ `correctApiRequest`
- –í–∞–ª–∏–¥–∞—Ü–∏—è `user_id` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ

## üìÑ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –∏ —Å—Ç—Ä–æ–∫–∏:

1. **Frontend –∏–Ω–∏—Ü–∏–∞—Ü–∏—è:** 
   - `client/src/components/dashboard/DailyBonusCard.tsx:42-79`

2. **API endpoint:** 
   - `modules/dailyBonus/routes.ts:77-82`

3. **–ë–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞:** 
   - `modules/dailyBonus/service.ts:96-220`

4. **–†–∞—Å—á–µ—Ç —Å—É–º–º—ã (600 UNI):** 
   - `modules/dailyBonus/routes.ts:61`

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:** 
   - `core/BalanceManager.ts:143-149`

6. **WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** 
   - `core/BalanceManager.ts:170-176`

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å":
1. ‚úÖ 600 UNI –±—É–¥–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–æ –Ω–∞ –±–∞–ª–∞–Ω—Å
2. ‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è —Å 1,004,900.123 –¥–æ 1,005,500.123 UNI
3. ‚úÖ –°–æ–∑–¥–∞—Å—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–∏–ø–∞ DAILY_BONUS
4. ‚úÖ UI –ø–æ–ª—É—á–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
5. ‚úÖ –ü–æ—è–≤–∏—Ç—Å—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
6. ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ–±–Ω–æ–≤–∏—Ç—Å—è

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é Daily Bonus!**