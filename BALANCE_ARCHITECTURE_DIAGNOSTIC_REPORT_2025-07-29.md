# üîç –î–ï–¢–ê–õ–¨–ù–´–ô –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢: –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´ –ë–ê–õ–ê–ù–°–û–í
**–î–∞—Ç–∞**: 29.07.2025  
**–¶–µ–ª—å**: –ê–Ω–∞–ª–∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–∞ 1 - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–æ–≤

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´

### 1. –û–¢–ö–õ–Æ–ß–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò (ANTI_ROLLBACK_PROTECTION)
```
‚ùå UnifiedTransactionService.updateUserBalance() - –ü–û–õ–ù–û–°–¢–¨–Æ –û–¢–ö–õ–Æ–ß–ï–ù
‚ùå BalanceManager.subtractBalance() - –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù
‚ùå TransactionsService.recalculateUserBalance() - –í–´–ë–†–ê–°–´–í–ê–ï–¢ –û–®–ò–ë–ö–£
‚ùå TransactionEnforcer.enforcePolicy() - –í–°–ï–ì–î–ê –†–ê–ó–†–ï–®–ê–ï–¢
‚ùå TransactionEnforcer.detectDirectSQLUpdates() - –ù–ï –ü–†–û–í–ï–†–Ø–ï–¢
```

### 2. –ê–ö–¢–ò–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
```
‚úÖ BalanceManager.addBalance() - –†–ê–ë–û–¢–ê–ï–¢
‚úÖ BalanceManager.setBalance() - –†–ê–ë–û–¢–ê–ï–¢  
‚úÖ BalanceManager.updateUserBalance() - –†–ê–ë–û–¢–ê–ï–¢ (–Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è)
‚úÖ TransactionService.createTransaction() - –°–û–ó–î–ê–ï–¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
```

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ë–ê–õ–ê–ù–°–û–í

### –ü–û–¢–û–ö –î–ê–ù–ù–´–• (–ö–ê–ö –î–û–õ–ñ–ù–û –†–ê–ë–û–¢–ê–¢–¨):
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç TON
   ‚Üì
2. WalletService.processTonDeposit()
   ‚Üì
3. UnifiedTransactionService.createTransaction()
   ‚Üì
4. shouldUpdateBalance(TON_DEPOSIT) = TRUE
   ‚Üì
5. updateUserBalance() ‚Üí BalanceManager.addBalance()
   ‚Üì
6. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   ‚Üì
7. WebSocket –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   ‚Üì
8. –ö–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç UI
```

### –ü–û–¢–û–ö –î–ê–ù–ù–´–• (–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –°–ï–ô–ß–ê–°):
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç TON
   ‚Üì
2. WalletService.processTonDeposit()
   ‚Üì
3. UnifiedTransactionService.createTransaction()
   ‚Üì
4. shouldUpdateBalance(TON_DEPOSIT) = TRUE
   ‚Üì
5. updateUserBalance() ‚Üí üö® –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ô –í–´–•–û–î (–æ—Ç–∫–ª—é—á–µ–Ω–æ)
   ‚Üì
6. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚ùå
   ‚Üì
7. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –±–∞–ª–∞–Ω—Å —Å—Ç–∞—Ä—ã–π
   ‚Üì
8. –ö–ª–∏–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—á–µ–∑–Ω—É–≤—à–∏–π –¥–µ–ø–æ–∑–∏—Ç
```

## üîÑ –°–ò–°–¢–ï–ú–´ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –ë–ê–õ–ê–ù–°–û–í

### 1. **FRONTEND (CLIENT)**
- **–ö–µ—à**: 10 —Å–µ–∫—É–Ω–¥ (`balanceService.ts`)
- **WebSocket**: Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `balance_update`
- **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —á–µ—Ä–µ–∑ `useWebSocketBalanceSync`
- **Force refresh**: –ü—Ä–∏ `refreshBalance(true)` –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –∫–µ—à

### 2. **BACKEND (SERVER)**
- **BalanceManager**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏
- **TransactionService**: –î–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å –±–∞–ª–∞–Ω—Å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏**: –ú–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ (farming rewards)
- **WebSocket**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### 3. **–ë–ê–ó–ê –î–ê–ù–ù–´–•**
- **users —Ç–∞–±–ª–∏—Ü–∞**: `balance_uni`, `balance_ton` (NUMERIC –ø–æ–ª—è)
- **transactions —Ç–∞–±–ª–∏—Ü–∞**: –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Constraint**: `idx_tx_hash_unique_safe` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –¢–ï–ö–£–©–ï–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–´

### –ü–†–û–ë–õ–ï–ú–ê 1: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤
```typescript
// core/TransactionService.ts —Å—Ç—Ä–æ–∫–∏ 387-399
private async updateUserBalance(...): Promise<void> {
  // –û–¢–ö–õ–Æ–ß–ï–ù–û: updateUserBalance –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –±–∞–ª–∞–Ω—Å–æ–≤
  logger.warn('[ANTI_ROLLBACK_PROTECTION] UnifiedTransactionService.updateUserBalance –û–¢–ö–õ–Æ–ß–ï–ù', {
    reason: '–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ unexpected —Å–ø–∏—Å–∞–Ω–∏–π'
  });
  
  // –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ô –í–´–•–û–î - –ù–ï –û–ë–ù–û–í–õ–Ø–ï–ú –ë–ê–õ–ê–ù–°–´ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò
  return;
}
```
**–≠—Ñ—Ñ–µ–∫—Ç**: TON –¥–µ–ø–æ–∑–∏—Ç—ã —Å–æ–∑–¥–∞—é—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ –±–∞–ª–∞–Ω—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–º–∏

### –ü–†–û–ë–õ–ï–ú–ê 2: –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å–∏—Å—Ç–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- WebSocket –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ
- API –∫–µ—à —Ö—Ä–∞–Ω–∏—Ç —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è 10 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ —Å–æ–∑–¥–∞–µ—Ç race conditions

### –ü–†–û–ë–õ–ï–ú–ê 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø—Ä–∞–≤–¥—ã
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ù–æ –±–∞–ª–∞–Ω—Å—ã –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üí° –ê–ù–ê–õ–ò–ó –í–ê–†–ò–ê–ù–¢–ê 1: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò

### –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨:
1. **–í–∫–ª—é—á–∏—Ç—å `updateUserBalance()`** –≤ `UnifiedTransactionService`
2. **–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É** –æ—Ç –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç–∫–∞—Ç–æ–≤
3. **–£—Å–∏–ª–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–æ–≤

### –ö–û–î –ò–ó–ú–ï–ù–ï–ù–ò–Ø (–ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï):
```typescript
// core/TransactionService.ts
async updateUserBalance(...) {
  try {
    // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û –° –ó–ê–©–ò–¢–û–ô
    logger.warn('[BALANCE_SYNC_RESTORED] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å –∑–∞—â–∏—Ç–æ–π', {
      user_id,
      amount_uni,
      amount_ton,
      type,
      timestamp: new Date().toISOString()
    });
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    if (this.isSuspiciousUpdate(user_id, amount_uni, amount_ton, type)) {
      logger.error('[SUSPICIOUS_UPDATE_BLOCKED]', { user_id, type });
      return; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ
    }
    
    // –í—ã–∑—ã–≤–∞–µ–º BalanceManager
    const { BalanceManager } = await import('./BalanceManager');
    const balanceManager = BalanceManager.getInstance();
    
    if (amount_uni > 0) {
      await balanceManager.addBalance(user_id, amount_uni, 0);
    }
    
    if (amount_ton > 0) {
      await balanceManager.addBalance(user_id, 0, amount_ton);
    }
    
  } catch (error) {
    logger.error('[updateUserBalance] –û—à–∏–±–∫–∞', { error });
  }
}
```

## ‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ö–û–ù–§–õ–ò–ö–¢–´

### 1. **–° –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏**
- `subtractBalance` –≤—Å–µ –µ—â–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - —Å–ø–∏—Å–∞–Ω–∏—è –Ω–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- `recalculateUserBalance` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É - –ø–µ—Ä–µ—Å—á–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω

### 2. **–° –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞–º–∏**
- Farming –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω—ã race conditions –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö

### 3. **–° WebSocket**
- –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î
- –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–µ—Ä—Ü–∞—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï:
‚úÖ –î–µ–ø–æ–∑–∏—Ç—ã –±—É–¥—É—Ç —Å—Ä–∞–∑—É –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å–µ  
‚úÖ –ò—Å—á–µ–∑–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º–∞ —Å "–ø—Ä–æ–ø–∞–¥–∞—é—â–∏–º–∏" —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏  
‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –±–∞–ª–∞–Ω—Å—ã –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã  
‚úÖ –£–ª—É—á—à–∏—Ç—Å—è UX - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –†–ò–°–ö–ò:
‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∫–∞—Ç–æ–≤  
‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions  
‚ö†Ô∏è –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î –∏–∑-–∑–∞ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π  
‚ö†Ô∏è –ù–µ–æ–±—Ö–æ–¥–∏–º —Ç—â–∞—Ç–µ–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–µ—Ä–≤—ã–µ 48 —á–∞—Å–æ–≤

## üõ°Ô∏è –ü–õ–ê–ù –ó–ê–©–ò–¢–´

### 1. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –í–°–ï –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ —Å stack trace
- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥ —Ñ–∞–π–ª –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö

### 2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π**
```typescript
isSuspiciousUpdate(user_id, amount_uni, amount_ton, type) {
  // –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏:
  // - –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (>10 –≤ –º–∏–Ω—É—Ç—É)
  // - –û–≥—Ä–æ–º–Ω—ã–µ —Å—É–º–º—ã (>1000000)
  // - –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
  // - –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–∫–∞—Ç–æ–≤
}
```

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- Dashboard —Å real-time –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –ê–ª–µ—Ä—Ç—ã –≤ Telegram –ø—Ä–∏ –∞–Ω–æ–º–∞–ª–∏—è—Ö
- –ï–∂–µ—á–∞—Å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–µ—Ä–≤—ã–µ 48 —á–∞—Å–æ–≤

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ü–û–≠–¢–ê–ü–ù–û–ï –í–ù–ï–î–†–ï–ù–ò–ï:
1. **–≠—Ç–∞–ø 1**: –í–∫–ª—é—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è TON_DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
2. **–≠—Ç–∞–ø 2**: –î–æ–±–∞–≤–∏—Ç—å UNI_DEPOSIT –ø–æ—Å–ª–µ 24 —á–∞—Å–æ–≤
3. **–≠—Ç–∞–ø 3**: –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ 48 —á–∞—Å–æ–≤ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### FALLBACK –ü–õ–ê–ù:
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ–¥ –≤ `.backup` —Ñ–∞–π–ª–∞—Ö
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

## üèÅ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–í–∞—Ä–∏–∞–Ω—Ç 1** —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É –∏—Å—á–µ–∑–∞—é—â–∏—Ö –±–∞–ª–∞–Ω—Å–æ–≤, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç:
1. –¢—â–∞—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –∑–∞—â–∏—Ç–Ω—ã–º–∏ –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏
2. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–µ—Ä–≤—ã–µ –¥–Ω–∏
3. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –±—ã—Å—Ç—Ä–æ–º—É –æ—Ç–∫–∞—Ç—É –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

–°–∏—Å—Ç–µ–º–∞ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **–∞–≤–∞—Ä–∏–π–Ω–æ–º —Ä–µ–∂–∏–º–µ** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è, –Ω–æ –±–∞–ª–∞–Ω—Å—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã UX –∏ —Ç—Ä–µ–±—É–µ—Ç —Å—Ä–æ—á–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.

---
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –≤–∞—à–µ–º —Ä–µ—à–µ–Ω–∏–∏  
**–†–∏—Å–∫**: –°—Ä–µ–¥–Ω–∏–π (—Å –∑–∞—â–∏—Ç–Ω—ã–º–∏ –º–µ—Ä–∞–º–∏)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô