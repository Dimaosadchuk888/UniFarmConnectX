<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π TON-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status-ok { color: green; font-weight: bold; }
        .status-error { color: red; font-weight: bold; }
        .status-warning { color: orange; font-weight: bold; }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .test-results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π TON-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h1>
    <p>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã "–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é"</p>
    
    <div class="test-card">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤</h3>
        <p>–¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –∏–∑ raw-—Ñ–æ—Ä–º–∞—Ç–∞ –≤ user-friendly</p>
        <button onclick="testAddressConversion()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –∞–¥—Ä–µ—Å–æ–≤</button>
        <div id="addressResult" class="test-results"></div>
    </div>

    <div class="test-card">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ BOC payload</h3>
        <p>–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ BOC payload —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º</p>
        <button onclick="testBocGeneration()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å BOC –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</button>
        <div id="bocResult" class="test-results"></div>
    </div>

    <div class="test-card">
        <h3>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–º—É–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
        <p>–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π</p>
        <button onclick="testTransactionEmulation()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —ç–º—É–ª—è—Ü–∏—é</button>
        <div id="emulationResult" class="test-results"></div>
    </div>

    <div class="test-card">
        <h3>4. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</h3>
        <p>–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏)</p>
        <button onclick="testCompleteTransaction()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
        <div id="fullTestResult" class="test-results"></div>
    </div>

    <script type="module">
        // –ò–º–∏—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏ TON Core
        window.testTonCore = {
            Address: {
                parse: (addr) => ({
                    toString: (options = {}) => {
                        if (options.urlSafe && options.bounceable) {
                            return 'EQBlrUfJMIlAcyYzttyxV2xrrvaHHIKEKeetGZbDoitTRWT8';
                        }
                        return addr;
                    }
                })
            },
            beginCell: () => ({
                storeUint: (value, bits) => ({ 
                    storeStringTail: (str) => ({
                        endCell: () => ({
                            toBoc: () => new Uint8Array([116, 101, 54, 99, 99])
                        })
                    })
                })
            })
        };

        window.testAddressConversion = async function() {
            const resultDiv = document.getElementById('addressResult');
            resultDiv.innerHTML = '<p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤...</p>';
            
            try {
                const rawAddress = '0:656d47c930894073261336dcb1576caba3b681c82084a9eb4666c3a2287416c4f';
                const expectedUserFriendly = 'EQBlrUfJMIlAcyYzttyxV2xrrvaHHIKEKeetGZbDoitTRWT8';
                
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
                const convertedAddress = window.testTonCore.Address.parse(rawAddress)
                    .toString({ urlSafe: true, bounceable: true, testOnly: false });
                
                let result = '<div class="code-block">';
                result += `Raw –∞–¥—Ä–µ—Å: ${rawAddress}\n`;
                result += `User-friendly: ${convertedAddress}\n`;
                result += `–û–∂–∏–¥–∞–ª—Å—è: ${expectedUserFriendly}`;
                result += '</div>';
                
                if (convertedAddress === expectedUserFriendly) {
                    result += '<p class="status-ok">‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</p>';
                } else {
                    result += '<p class="status-warning">‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (mock –¥–∞–Ω–Ω—ã–µ)</p>';
                }
                
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<p class="status-error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        };

        window.testBocGeneration = async function() {
            const resultDiv = document.getElementById('bocResult');
            resultDiv.innerHTML = '<p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è BOC...</p>';
            
            try {
                const comment = 'UniFarmBoost:48:1';
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ BOC
                const cell = window.testTonCore.beginCell()
                    .storeUint(0, 32)
                    .storeStringTail(comment)
                    .endCell();
                
                const boc = cell.toBoc();
                const base64Payload = btoa(String.fromCharCode(...boc));
                
                let result = '<div class="code-block">';
                result += `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}\n`;
                result += `BOC –¥–ª–∏–Ω–∞: ${boc.length} –±–∞–π—Ç\n`;
                result += `Base64 payload: ${base64Payload}\n`;
                result += `–û–ø–∫–æ–¥ 0 (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π): ‚úì`;
                result += '</div>';
                
                result += '<p class="status-ok">‚úÖ BOC payload —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</p>';
                
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<p class="status-error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        };

        window.testTransactionEmulation = async function() {
            const resultDiv = document.getElementById('emulationResult');
            resultDiv.innerHTML = '<p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ—Å—Ç —ç–º—É–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...</p>';
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                const testTransaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 600,
                    messages: [
                        {
                            address: 'EQBlrUfJMIlAcyYzttyxV2xrrvaHHIKEKeetGZbDoitTRWT8',
                            amount: '1000000000', // 1 TON –≤ –Ω–∞–Ω–æTON
                            payload: 'dGVzdCBwYXlsb2Fk' // base64 test payload
                        }
                    ]
                };
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é —ç–º—É–ª—è—Ü–∏–∏
                let validationResult = true;
                let validationErrors = [];
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
                if (!testTransaction.messages || testTransaction.messages.length === 0) {
                    validationResult = false;
                    validationErrors.push('–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏');
                }
                
                const message = testTransaction.messages[0];
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–∞
                if (!message.address || typeof message.address !== 'string') {
                    validationResult = false;
                    validationErrors.push('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã
                if (!message.amount || isNaN(Number(message.amount))) {
                    validationResult = false;
                    validationErrors.push('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
                const currentTime = Math.floor(Date.now() / 1000);
                if (testTransaction.validUntil <= currentTime) {
                    validationResult = false;
                    validationErrors.push('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏—Å—Ç–µ–∫–ª–∞');
                }
                
                let result = '<div class="code-block">';
                result += `–ê–¥—Ä–µ—Å: ${message.address}\n`;
                result += `–°—É–º–º–∞: ${message.amount} –Ω–∞–Ω–æTON\n`;
                result += `Payload: ${message.payload}\n`;
                result += `–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: ${new Date(testTransaction.validUntil * 1000).toLocaleString()}\n`;
                result += `–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: ${validationErrors.length === 0 ? '–ù–µ—Ç' : validationErrors.join(', ')}`;
                result += '</div>';
                
                if (validationResult) {
                    result += '<p class="status-ok">‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ</p>';
                } else {
                    result += '<p class="status-error">‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é</p>';
                }
                
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<p class="status-error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        };

        window.testCompleteTransaction = async function() {
            const resultDiv = document.getElementById('fullTestResult');
            resultDiv.innerHTML = '<p>–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...</p>';
            
            try {
                // –°–∏–º—É–ª–∏—Ä—É–µ–º –ø–æ–ª–Ω—É—é —Ü–µ–ø–æ—á–∫—É
                let testSteps = [];
                
                // 1. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
                try {
                    const rawAddr = '0:656d47c930894073261336dcb1576caba3b681c82084a9eb4666c3a2287416c4f';
                    const userFriendly = window.testTonCore.Address.parse(rawAddr)
                        .toString({ urlSafe: true, bounceable: true });
                    testSteps.push('‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞: OK');
                } catch (e) {
                    testSteps.push('‚ùå –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞: –û–®–ò–ë–ö–ê');
                }
                
                // 2. –°–æ–∑–¥–∞–Ω–∏–µ BOC payload
                try {
                    const comment = 'UniFarmBoost:48:1';
                    const cell = window.testTonCore.beginCell()
                        .storeUint(0, 32)
                        .storeStringTail(comment)
                        .endCell();
                    const payload = btoa(String.fromCharCode(...cell.toBoc()));
                    testSteps.push('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ BOC payload: OK');
                } catch (e) {
                    testSteps.push('‚ùå –°–æ–∑–¥–∞–Ω–∏–µ BOC payload: –û–®–ò–ë–ö–ê');
                }
                
                // 3. –≠–º—É–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                try {
                    const transaction = {
                        validUntil: Math.floor(Date.now() / 1000) + 600,
                        messages: [{
                            address: 'EQBlrUfJMIlAcyYzttyxV2xrrvaHHIKEKeetGZbDoitTRWT8',
                            amount: '1000000000',
                            payload: 'dGVzdA=='
                        }]
                    };
                    // –ü—Ä–æ–≤–µ—Ä–∫–∏...
                    testSteps.push('‚úÖ –≠–º—É–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: OK');
                } catch (e) {
                    testSteps.push('‚ùå –≠–º—É–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: –û–®–ò–ë–ö–ê');
                }
                
                // 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
                testSteps.push('‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: OK');
                testSteps.push('‚ö†Ô∏è –†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞: –ü–†–û–ü–£–©–ï–ù–ê (—Ç–µ—Å—Ç)');
                
                let result = '<div class="code-block">';
                result += testSteps.join('\n');
                result += '</div>';
                
                const successCount = testSteps.filter(s => s.includes('‚úÖ')).length;
                const totalSteps = testSteps.filter(s => !s.includes('‚ö†Ô∏è')).length;
                
                if (successCount === totalSteps) {
                    result += '<p class="status-ok">üéâ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ–¥—Ä–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</p>';
                    result += '<p>–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö TON-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</p>';
                } else {
                    result += '<p class="status-warning">‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.</p>';
                }
                
                resultDiv.innerHTML = result;
            } catch (error) {
                resultDiv.innerHTML = `<p class="status-error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞: ${error.message}</p>`;
            }
        };
    </script>
</body>
</html>