# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø TON –¢–†–ê–ù–ó–ê–ö–¶–ò–ô - –ó–ê–í–ï–†–®–ï–ù–û

## üéØ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—é –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑.

## üîß –í–ù–ï–°–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID
**–§–∞–π–ª**: `client/src/services/tonConnectService.ts`
- **–î–û**: `const uniqueDepositId = ${result.boc}_${Date.now()}_${Math.random()...}`
- **–ü–û–°–õ–ï**: `const cleanBocHash = result.boc;` (–±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤)
- **–≠—Ñ—Ñ–µ–∫—Ç**: –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–∏—Å—Ç—ã–π BOC –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

### 2. –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
**–§–∞–π–ª**: `core/TransactionService.ts`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `extractBaseBoc()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–≥–æ BOC
- –£–ª—É—á—à–µ–Ω OR-–∑–∞–ø—Ä–æ—Å: —Ç–µ–ø–µ—Ä—å –∏—â–µ—Ç –∏ —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, –∏ –±–∞–∑–æ–≤—ã–µ BOC
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É `tx_hash_unique.like.${baseBoc}%`

### 3. –ù–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è `tx_hash_unique`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ BOC –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ metadata –ø–æ–ª—è—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ description –ø–æ–ª–µ

## üß™ –ú–ï–•–ê–ù–ò–ó–ú –†–ê–ë–û–¢–´

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ BOC
```typescript
private extractBaseBoc(hash: string): string {
  if (hash.startsWith('te6')) {
    const suffixPattern = /_\d{13}_[a-z0-9]+$/;
    return hash.replace(suffixPattern, '');
  }
  return hash;
}
```

### –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
```sql
SELECT * FROM transactions WHERE 
  tx_hash_unique = '–ø–æ–ª–Ω—ã–π_—Ö–µ—à' OR
  tx_hash_unique LIKE '–±–∞–∑–æ–≤—ã–π_boc%' OR
  metadata->>'tx_hash' = '–ø–æ–ª–Ω—ã–π_—Ö–µ—à' OR
  description ILIKE '%–±–∞–∑–æ–≤—ã–π_boc%'
```

## ‚úÖ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢
- **–ù–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã**: –ù–µ –±—É–¥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥—É–±–ª–∏–∫–∞—Ç—ã**: –û—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üîç –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´
–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç-—Å–∫—Ä–∏–ø—Ç `test-duplication-fix.ts` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
- **–ü–∞—Ç—Ç–µ—Ä–Ω —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤**: `_\d{13}_[a-z0-9]+$` (timestamp + random)
- **BOC —Ñ–æ—Ä–º–∞—Ç**: –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `te6`
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£–ª—É—á—à–µ–Ω–æ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞