# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê - –ò–°–ß–ï–ó–ù–û–í–ï–ù–ò–ï –î–ï–ü–û–ó–ò–¢–û–í

**–î–∞—Ç–∞**: 24 –∏—é–ª—è 2025, 07:05 UTC  
**–°—Ç–∞—Ç—É—Å**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì  
**–ü—Ä–æ–±–ª–µ–º–∞**: –î–µ–ø–æ–∑–∏—Ç—ã TON –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –∏ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—ã –∏—Å—á–µ–∑–∞—é—Ç

## üéØ –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

**–°—Ü–µ–Ω–∞—Ä–∏–π**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (25 TON –æ—Ç Dima Osadchuk + 2 Connect Wallet –¥–µ–ø–æ–∑–∏—Ç–∞)
2. –î–µ–ø–æ–∑–∏—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å–µ 
3. –ß–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–µ–ø–æ–∑–∏—Ç—ã –∏—Å—á–µ–∑–∞—é—Ç
4. –ë–∞–ª–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

## üîç –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê - –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê

### **1. –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï TX_HASH –ó–ê–©–ò–¢–´**

**–ù–∞–π–¥–µ–Ω–æ –≤ `core/TransactionService.ts` —Å—Ç—Ä–æ–∫–∞ 114:**
```typescript
tx_hash_unique: metadata?.tx_hash || null,  // –ó–ê–©–ò–¢–ê –û–¢ –î–£–ë–õ–ò–ö–ê–¢–û–í
```

**‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:**
- –≠—Ç–æ –ø–æ–ª–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –°–ï–ì–û–î–ù–Ø –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å **unique index** –Ω–∞ –ø–æ–ª–µ `tx_hash_unique`
- –ï—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç —Å —Ç–µ–º –∂–µ `tx_hash` –¥–≤–∞–∂–¥—ã - –≤—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø
- –ü–µ—Ä–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è, –Ω–æ –ø–æ—Ç–æ–º –û–¢–ö–ê–¢–´–í–ê–¢–¨–°–Ø –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

### **2. –ê–ù–ê–õ–ò–ó LSP –û–®–ò–ë–û–ö**

**–í `modules/wallet/service.ts` –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:**
- `Argument of type 'string' is not assignable to parameter of type 'number'`
- `No value exists in scope for the shorthand property 'newBalance'`

**üö® –≠–¢–ò –û–®–ò–ë–ö–ò –ú–û–ì–£–¢ –ü–†–ò–í–û–î–ò–¢–¨ –ö:**
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º –±–∞–ª–∞–Ω—Å–∞
- –ß–∞—Å—Ç–∏—á–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –û—Ç–∫–∞—Ç–∞–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### **3. –ê–ù–ê–õ–ò–ó –°–ò–°–¢–ï–ú–ù–´–• –õ–û–ì–û–í**

**–ò–∑ webview_console_logs –≤–∏–¥–Ω–æ:**
```
tonBalance":3.102298  -> tonBalance":3.109238  (–ø—Ä–∏—Ä–æ—Å—Ç –Ω–∞ 0.007 TON)
```

**‚ö†Ô∏è –ü–û–î–û–ó–†–ï–ù–ò–ï:** 
- –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ù–ê –ú–ê–õ–´–ï –°–£–ú–ú–´ (—Ñ–∞—Ä–º–∏–Ω–≥ –¥–æ—Ö–æ–¥—ã)
- –ù–û –ö–†–£–ü–ù–´–ï –î–ï–ü–û–ó–ò–¢–´ (25 TON) –ù–ï –í–ò–î–ù–´
- –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫—Ä—É–ø–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –¶–ï–ü–û–ß–ö–ê –ü–†–û–ë–õ–ï–ú–´

### **–°—Ü–µ–Ω–∞—Ä–∏–π A: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ tx_hash**
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 25 TON
2. Webhook –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–µ–ø–æ–∑–∏—Ç–µ
3. processTonDeposit() —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å tx_hash
4. –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (+25 TON)
5. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –ü–û–í–¢–û–†–ù–û–ï —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–±–ª–æ–∫—á–µ–π–Ω –¥—É–±–ª–∏—Ä—É–µ—Ç?)
6. –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å tx_hash_unique FAILED (UNIQUE VIOLATION)
7. –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç ROLLBACK –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
8. –ë–∞–ª–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
```

### **–°—Ü–µ–Ω–∞—Ä–∏–π B: LSP –æ—à–∏–±–∫–∏ –≤ updateBalance**
```
1. –î–µ–ø–æ–∑–∏—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
2. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç type error
3. balanceManager.updateUserBalance() –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
4. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
5. –î–µ–ø–æ–∑–∏—Ç –∏—Å—á–µ–∑–∞–µ—Ç
```

## üìä –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê –ü–†–û–ë–õ–ï–ú–´

### **1. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏–∑ –ª–æ–≥–æ–≤:**
```
07:05:51 - tonBalance: 3.102298  (—Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
07:07:18 - tonBalance: 3.109238  (–ø—Ä–∏—Ä–æ—Å—Ç +0.007 TON - —Ñ–∞—Ä–º–∏–Ω–≥)
```

**–ù–ï–¢ –°–ö–ê–ß–ö–û–í –Ω–∞ +25 TON** - –∫—Ä—É–ø–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è!

### **2. –ò–∑–º–µ–Ω–µ–Ω–∏—è, –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ –°–ï–ì–û–î–ù–Ø:**
- ‚úÖ **23 –∏—é–ª—è**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –≤ `core/TransactionService.ts`
- ‚ùå **24 –∏—é–ª—è**: LSP –æ—à–∏–±–∫–∏ –≤ `modules/wallet/service.ts` –ù–ï –ò–°–ü–†–ê–í–õ–ï–ù–´

### **3. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –î–û/–ü–û–°–õ–ï:**
- **–î–û 23 –∏—é–ª—è**: –î–µ–ø–æ–∑–∏—Ç—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–ü–û–°–õ–ï 23 –∏—é–ª—è**: –î–µ–ø–æ–∑–∏—Ç—ã –∏—Å—á–µ–∑–∞—é—Ç –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è

## üéØ –ì–õ–ê–í–ù–´–ô –ü–û–î–û–ó–†–ï–í–ê–ï–ú–´–ô

**`tx_hash_unique` UNIQUE INDEX CONSTRAINT**

**–ü—Ä–æ–±–ª–µ–º–∞**: Blockchain –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ webhook'–∏ –¥–ª—è –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
1. –ü–µ—Ä–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí –¥–µ–ø–æ–∑–∏—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è, –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
2. –í—Ç–æ—Ä–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí UNIQUE VIOLATION –Ω–∞ tx_hash_unique
3. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ü–ï–†–í–£–Æ –£–°–ü–ï–®–ù–£–Æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
4. –ë–∞–ª–∞–Ω—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é

## üî¨ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

### **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—à–∏–±–æ–∫:**
```bash
grep -i "unique.*tx_hash" server.log
grep -i "duplicate.*tx_hash" server.log  
grep -i "UNIQUE VIOLATION" server.log
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è webhook'–∏:**
```sql
SELECT tx_hash_unique, COUNT(*) 
FROM transactions 
WHERE tx_hash_unique IS NOT NULL 
AND created_at > '2025-07-24 00:00:00'
GROUP BY tx_hash_unique 
HAVING COUNT(*) > 1;
```

### **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rollback —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
```sql
SELECT * FROM transactions 
WHERE user_id IN (SELECT id FROM users WHERE first_name = 'Dima Osadchuk')
AND created_at > '2025-07-24 06:00:00'
ORDER BY created_at DESC;
```

## ‚ö° –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–û–°–ù–û–í–ù–ê–Ø –ì–ò–ü–û–¢–ï–ó–ê**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `tx_hash_unique` —Å UNIQUE –∏–Ω–¥–µ–∫—Å–æ–º —Å–æ–∑–¥–∞–ª–æ –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –Ω–æ –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ê–ì–†–ï–°–°–ò–í–ù–û - –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç —É–∂–µ —É—Å–ø–µ—à–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö webhook'–æ–≤ –æ—Ç –±–ª–æ–∫—á–µ–π–Ω–∞.

**–°–¢–ê–¢–£–°**: –°–∏—Å—Ç–µ–º–∞ –¢–†–ï–ë–£–ï–¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è `tx_hash_unique` –ø—Ä–æ–≤–µ—Ä–∫–∏.

---
**–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê** - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏.