# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–†–´–¢–ò–ï: –ò—Å—Ç–æ—á–Ω–∏–∫ –æ—à–∏–±–∫–∏ "–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É" –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞—Å–∫—Ä—ã—Ç

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤, —Ö–æ—Ç—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## –ì–õ–ê–í–ù–´–ô –í–ò–ù–û–í–ù–ò–ö –ù–ê–ô–î–ï–ù
**–§–∞–π–ª**: `client/src/services/withdrawalService.ts` —Å—Ç—Ä–æ–∫–∏ 115-121
```typescript
} catch (networkError) {
  return {
    message: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É', // ‚ùå –í–û–¢ –ò–°–¢–û–ß–ù–ò–ö!
  };
}
```

## –¢–æ—á–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –æ—à–∏–±–∫–∏ (—Å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏)

### 1. API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```bash
curl tests –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ 401 –æ—Ç–≤–µ—Ç—ã –∑–∞ 6-8ms
```

### 2. correctApiRequest –ø—ã—Ç–∞–µ—Ç—Å—è token refresh  
–ü—Ä–∏ 401 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç JWT —Ç–æ–∫–µ–Ω

### 3. Refresh fails
–°–æ–∑–¥–∞–µ—Ç—Å—è auth error —Å `status: 401, needAuth: true`

### 4. withdrawalService catch
–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç auth error –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ "network error"

### 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ—Ç
"–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É" –≤–º–µ—Å—Ç–æ "–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"

## –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã

### ‚úÖ Backend API
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ 401 errors (`curl` tests –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã)
- Endpoint `/api/v2/wallet/withdraw` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Router configuration –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è (—Å—Ç—Ä–æ–∫–∞ 78 –≤ routes.ts)

### ‚úÖ correctApiRequest  
- –£–ñ–ï –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É auth errors (—Å—Ç—Ä–æ–∫–∏ 221-233)
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ—Ç auth errors —Å `status: 401, needAuth: true`
- Token refresh logic —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- WebSocket updates —Ä–∞–±–æ—Ç–∞—é—Ç
- Balance management —Ä–∞–±–æ—Ç–∞–µ—Ç  
- Rollback protection —Ä–∞–±–æ—Ç–∞–µ—Ç

### ‚ùå withdrawalService
- –û–±—â–∏–π catch –±–ª–æ–∫ –∑–∞–≥–ª—É—à–∞–µ—Ç auth errors –∫–∞–∫ network errors
- –°—Ç—Ä–æ–∫–∞ 119: `} catch (networkError) {` - –Ω–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –æ—à–∏–±–∫–∏ "network errors"
- –°—Ç—Ä–æ–∫–∞ 121: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É" –¥–ª—è auth failures

## Root Cause
**Auth failures –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ network failures –≤ `withdrawalService.ts:119`**

## –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–∑ console logs (Real-time)

### –£—Å–ø–µ—à–Ω—ã–π API –æ—Ç–≤–µ—Ç:
```
[correctApiRequest] –û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞: {"success":false,"error":"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: 0.01 TON"}
```

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è frontend:
```  
[submitWithdrawal] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ —Å–µ—Ç–µ–≤–æ–º —Å–ª–æ–µ: {"success":false,"error":"–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –î–æ—Å—Ç—É–ø–Ω–æ: 0.01 TON"}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É"
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞** –≤ `withdrawalService.ts`:
```typescript
} catch (networkError) {  // ‚ùå –í–°–ï –æ—à–∏–±–∫–∏ = "network errors"
  return {
    message: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞...',  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
  };
}
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```typescript  
} catch (error) {
  // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º –æ—à–∏–±–æ–∫
  if ((error as any).status === 401) {
    return { message: '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', error_type: 'auth' };
  }
  if ((error as any).success === false && (error as any).error) {
    return { message: (error as any).error, error_type: 'business_logic' };
  }
  // –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ network errors
  return { message: '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏...', error_type: 'network' };
}
```

## –°—Ç–∞—Ç—É—Å
‚úÖ **ROOT CAUSE CONFIRMED** - —Ç–æ—á–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞ –Ω–∞–π–¥–µ–Ω–∞ —Å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏.

**–§–∞–π–ª –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: `client/src/services/withdrawalService.ts` —Å—Ç—Ä–æ–∫–∏ 115-121
**–î–µ–π—Å—Ç–≤–∏–µ**: –ó–∞–º–µ–Ω–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π catch –±–ª–æ–∫ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –æ—à–∏–±–æ–∫ –ø–æ —Ç–∏–ø–∞–º