# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢: –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø TON –î–ï–ü–û–ó–ò–¢–û–í

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 3 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –¢–†–ï–ë–£–ï–¢–°–Ø  

## –ú–ê–°–®–¢–ê–ë –ü–†–û–ë–õ–ï–ú–´

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç—ã:
- **41 –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–∞—Ä–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- **100% —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** –∏–º–µ—é—Ç `tx_hash = NULL` –∏ `boc = NULL`
- **–°–∏—Å—Ç–µ–º–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
- **–ü–æ—Ç–µ—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –¥–≤–æ–π–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ —Å –∫–æ—à–µ–ª—å–∫–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
- ID 1805783 –∏ 1805780: 1.5 TON (—Ä–∞–∑–Ω–∏—Ü–∞ 8.6 —Å–µ–∫)
- ID 1805783 –∏ 1805776: 1.5 TON (—Ä–∞–∑–Ω–∏—Ü–∞ 17.6 —Å–µ–∫) 
- ID 1805780 –∏ 1805776: 1.5 TON (—Ä–∞–∑–Ω–∏—Ü–∞ 9.0 —Å–µ–∫)
- **+ 38 –¥—Ä—É–≥–∏—Ö –ø–∞—Ä –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**

## –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –í URL –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–ò

**Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
```typescript
// client/src/services/tonConnectService.ts:452
const backendResponse = await correctApiRequest('/api/v2/wallet/ton-deposit', 'POST', {
  ton_tx_hash: cleanBocHash,
  amount: tonAmount,
  wallet_address: tonConnectUI.account?.address || 'unknown'
});
```

**Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
```typescript
// modules/wallet/routes.ts:85
router.post('/ton-deposit', ..., walletController.tonDeposit.bind(walletController));
// –†–ï–ê–õ–¨–ù–´–ô URL: /api/wallet/ton-deposit (–ë–ï–ó /v2)
```

**–†–ï–ó–£–õ–¨–¢–ê–¢:**
- ‚úÖ Frontend —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TON –≤ –±–ª–æ–∫—á–µ–π–Ω
- ‚ùå Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 (–º–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω)
- ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ù–ï –ó–ê–ü–ò–°–´–í–ê–ï–¢–°–Ø —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API
- ‚ùå Frontend –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É (—Å—Ç—Ä–æ–∫–∞ 468: "–ù–ï –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É")

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –ù–ï–ò–ó–í–ï–°–¢–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –°–û–ó–î–ê–ù–ò–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô

**–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å:** –ï—Å–ª–∏ API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ö–¢–û —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –ë–î?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:**
1. **Webhook –∏–∑ –±–ª–æ–∫—á–µ–π–Ω —Å–∫–∞–Ω–µ—Ä–∞** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤)
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ frontend** (retry logic)
3. **Race condition** –≤ –¥—Ä—É–≥–æ–π —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
4. **–ê–¥–º–∏–Ω—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã** –∏–ª–∏ —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
5. **–î—Ä—É–≥–∏–µ API endpoints** (–≤–æ–∑–º–æ–∂–Ω–æ `/api/wallet/ton-deposit` —Ä–∞–±–æ—Ç–∞–µ—Ç?)

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ3: –û–¢–°–£–¢–°–¢–í–ò–ï BLOCKCHAIN DATA

**–í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç:**
- `tx_hash: NULL` 
- `boc: NULL`
- `description: "Test deposit" / "DUPLICATION_TEST"`

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ blockchain hash **–ù–ï–í–û–ó–ú–û–ñ–ù–ê**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ —Å–≤—è–∑–∏ —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É "–¥–æ–≤–µ—Ä–∏—è frontend"

## –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ê–Ω–∞–ª–∏–∑ backend –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
```typescript
// modules/wallet/controller.ts - tonDeposit()
const { ton_tx_hash, amount, wallet_address } = req.body;

// –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
if (!ton_tx_hash || !amount || !wallet_address) {
  return this.sendError(res, '–ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã', 400);
}
```

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–∂–∏–¥–∞–µ—Ç `ton_tx_hash`, –Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î –∏–º–µ—é—Ç `tx_hash = NULL`.

### –°—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```typescript
// modules/wallet/routes.ts:62-66
const tonDepositSchema = z.object({
  ton_tx_hash: z.string().min(1, 'Transaction hash is required'),
  amount: z.number().positive('Amount must be positive'),
  wallet_address: z.string().min(1, 'Wallet address is required')
});
```

## –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

### 1. –ò–°–ü–†–ê–í–ò–¢–¨ URL –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Æ
**Frontend:** –ò–∑–º–µ–Ω–∏—Ç—å URL —Å `/api/v2/wallet/ton-deposit` –Ω–∞ `/api/wallet/ton-deposit`

### 2. –ù–ê–ô–¢–ò –†–ï–ê–õ–¨–ù–´–ô –ò–°–¢–û–ß–ù–ò–ö –î–£–ë–õ–ò–ö–ê–¢–û–í
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ webhook endpoints
- –ù–∞–π—Ç–∏ –∫—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å `tx_hash = NULL`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–ª–æ–∫—á–µ–π–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

### 3. –£–°–ò–õ–ò–¢–¨ –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–Æ
- –î–æ–±–∞–≤–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –ø–æ (user_id, amount, timestamp)
- –î–æ–±–∞–≤–∏—Ç—å unique constraint –≤ –ë–î
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### 4. –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ BOC hash —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –í–´–í–û–î–´

1. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ª–æ–º–∞–Ω–∞** - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–î—É–±–ª–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫**
3. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –¥–≤–æ–π–Ω—ã–µ —Å–ø–∏—Å–∞–Ω–∏—è
4. **–°—Ä–æ—á–Ω—ã–π deploy –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ç—Ä–µ–±—É–µ—Ç—Å—è**

## –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–ù–ï–ú–ï–î–õ–ï–ù–ù–û)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å URL –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é frontend ‚Üí backend
- [ ] –ù–∞–π—Ç–∏ –∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å—Ç—Ä–µ–Ω–Ω—É—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é

### –§–∞–∑–∞ 2: –ü–æ–ª–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å blockchain hash –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö  
- [ ] –î–æ–±–∞–≤–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤ –ë–î
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤

### –§–∞–∑–∞ 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
- [ ] –í–æ–∑–º–µ—Å—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–≤–æ–π–Ω—ã–µ —Å–ø–∏—Å–∞–Ω–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è

---
**–í–ù–ò–ú–ê–ù–ò–ï:** –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ù–ï –ò–ó–ú–ï–ù–Ø–¢–¨ –ù–ò–ö–ê–ö–û–ô –ö–û–î –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏!
–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –æ—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã.