# üéØ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø TON –î–ï–ü–û–ó–ò–¢–û–í
**–î–∞—Ç–∞:** 21 –∏—é–ª—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** Username collision –º–µ–∂–¥—É User 25 –∏ User 227  
**–¶–µ–ª—å:** –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ telegram_id  

---

## üìã **–ü–õ–ê–ù –°–û–ì–õ–ê–°–û–í–ê–ù–ù–´–• –ò–ó–ú–ï–ù–ï–ù–ò–ô**

### **PHASE 1: –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô –ê–ù–ê–õ–ò–ó (15 –º–∏–Ω—É—Ç)**
- [x] –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- [x] –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã TON Connect
- [x] –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è username –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- [x] –ù–ê–ô–î–ï–ù–ê –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê: tonDeposit –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

### **PHASE 2: –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø (20 –º–∏–Ω—É—Ç)**
- [ ] –ù–∞–π—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤  
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É —Å username –Ω–∞ telegram_id + fallback
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- [ ] –£–±—Ä–∞—Ç—å fallback –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **PHASE 3: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–ê–†–°–ò–ù–ì–ê (10 –º–∏–Ω—É—Ç)**
- [ ] –ù–∞–π—Ç–∏ –∫–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—É–º–º –∏–∑ BOC —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å amount=0 –ø—Ä–æ–±–ª–µ–º—É –¥–ª—è –Ω–æ–≤—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—É–º–º

### **PHASE 4: –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• (15 –º–∏–Ω—É—Ç)**
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ User 25
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å User 227 –Ω–∞ User 25
- [ ] –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã –æ–±–æ–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### **PHASE 5: –í–ê–õ–ò–î–ê–¶–ò–Ø (10 –º–∏–Ω—É—Ç)**
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ TON –¥–µ–ø–æ–∑–∏—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å User 25 –∏ User 227 –æ—Ç–¥–µ–ª—å–Ω–æ
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô**

### **–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **TON Connect API Handler**
   ```javascript
   // –ë–´–õ–û:
   const user = await getUserByUsername(username);
   
   // –°–¢–ê–ù–ï–¢:
   const user = await getUserByTelegramId(telegram_id);
   ```

2. **User Lookup Logic**
   ```javascript
   // –ë–ï–ó–û–ü–ê–°–ù–´–ô –ü–ï–†–ï–•–û–î:
   const user = await getUserByTelegramId(telegram_id) 
     || await getUserByUsername(username); // –≤—Ä–µ–º–µ–Ω–Ω—ã–π fallback
   ```

3. **BOC Parser –¥–ª—è —Å—É–º–º**
   ```javascript
   // –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ amount –∏–∑ TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   const amount = parseAmountFromBOC(bocData);
   ```

### **–§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä–Ω–æ):**
- `modules/wallet/service.ts` (TON deposit handler)
- `services/tonConnectService.ts` (frontend integration)
- `utils/tonTransaction.ts` (BOC parsing)

---

## üõ°Ô∏è **–ú–ï–†–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò**

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. ‚úÖ **–ù–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º UNI —Ñ–∞—Ä–º–∏–Ω–≥** - —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
2. ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã** - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. ‚úÖ **–î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. ‚úÖ **–ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ** - —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º

### **–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:**
- [ ] User 25 –≤–∏–¥–∏—Ç —Å–≤–æ–∏ TON –¥–µ–ø–æ–∑–∏—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏
- [ ] User 227 –Ω–µ —Ç–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–º
- [ ] –ù–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å—É–º–º–∞–º–∏
- [ ] –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø—Ä–æ–±–ª–µ–º

---

## üìä **ROLLBACK –ü–õ–ê–ù**

### **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–∫–∞—Ç–∞:**
```javascript
// –¢–ï–ö–£–©–ê–Ø –†–ê–ë–û–ß–ê–Ø –õ–û–ì–ò–ö–ê (–¥–ª—è –æ—Ç–∫–∞—Ç–∞):
const user = await supabase
  .from('users')  
  .select('*')
  .eq('username', username)
  .single();

// –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê:
const user = await supabase
  .from('users')
  .select('*') 
  .eq('telegram_id', telegram_id)
  .single();
```

### **–®–∞–≥–∏ –æ—Ç–∫–∞—Ç–∞:**
1. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ –ø–æ username
2. –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ BOC –ø–∞—Ä—Å–µ—Ä–µ (–µ—Å–ª–∏ –±—ã–ª–∏)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã –∏–∑ –ª–æ–≥–æ–≤

---

## üéØ **–°–û–ì–õ–ê–°–û–í–ê–ù–ò–ï –ü–õ–ê–ù–ê**

### **–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:**
1. ‚úÖ –°–æ–≥–ª–∞—Å–Ω—ã —Å –ø–æ—ç—Ç–∞–ø–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º?
2. ‚ùì –ù–∞—á–∏–Ω–∞—Ç—å —Å –∞–Ω–∞–ª–∏–∑–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã?
3. ‚ùì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ?
4. ‚ùì –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç—ã User 25 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?

### **–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 60-70 –º–∏–Ω—É—Ç
### **–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:** –°—Ä–µ–¥–Ω–∏–π (—É–ø—Ä–∞–≤–ª—è–µ–º—ã–π)

---

**–°–¢–ê–¢–£–°:** –ì–û–¢–û–í –ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò –ü–û–°–õ–ï –°–û–ì–õ–ê–°–û–í–ê–ù–ò–Ø