<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniFarm JWT Token Updater</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f7;
            color: #1d1d1f;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #1d1d1f;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
        }
        .success {
            background: #d1f4d1;
            color: #0a5d0a;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef5350;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #42a5f5;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: background 0.2s;
        }
        button:hover {
            background: #0051d5;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .token-info {
            background: #f5f5f7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
        }
        .user-info {
            margin: 20px 0;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 1px solid #b0d4ff;
        }
        .user-info h3 {
            margin-top: 0;
            color: #1565c0;
        }
        .user-info p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê UniFarm JWT Token Updater</h1>
        
        <div class="info status">
            <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
        </div>

        <div id="currentStatus" class="status"></div>

        <div class="user-info">
            <h3>–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–æ–∫–µ–Ω–µ:</h3>
            <p><strong>User ID:</strong> 62</p>
            <p><strong>Telegram ID:</strong> 88888848</p>
            <p><strong>Username:</strong> preview_test</p>
            <p><strong>–ò–º—è:</strong> Preview</p>
            <p><strong>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:</strong> REF_1751780521918_e1v62d</p>
        </div>

        <button onclick="updateToken()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å JWT —Ç–æ–∫–µ–Ω</button>
        <button onclick="checkCurrentToken()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω</button>
        <button onclick="clearToken()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        <button onclick="openApp()">üöÄ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>

        <div id="tokenInfo" class="token-info" style="display: none;"></div>
    </div>

    <script>
        // –ù–æ–≤—ã–π JWT —Ç–æ–∫–µ–Ω
        const NEW_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYyLCJ0ZWxlZ3JhbV9pZCI6ODg4ODg4NDgsInVzZXJuYW1lIjoicHJldmlld190ZXN0IiwiZmlyc3RfbmFtZSI6IlByZXZpZXciLCJyZWZfY29kZSI6IlJFRl8xNzUxNzgwNTIxOTE4X2UxdjYyZCIsImlhdCI6MTc1MTg3MTA2MywiZXhwIjoxNzUyNDc1ODYzfQ.NKbyJiXtLnGzyr0w-C1oR658X5TzDO6EkKU8Ie5zgE0';

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('currentStatus');
            statusEl.className = `status ${type}`;
            statusEl.innerHTML = message;
        }

        function parseJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                return null;
            }
        }

        function checkCurrentToken() {
            const currentToken = localStorage.getItem('unifarm_jwt_token');
            const tokenInfoEl = document.getElementById('tokenInfo');
            
            if (!currentToken) {
                updateStatus('‚ùå JWT —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage', 'error');
                tokenInfoEl.style.display = 'none';
                return;
            }

            const decoded = parseJWT(currentToken);
            if (!decoded) {
                updateStatus('‚ö†Ô∏è –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω –≤ localStorage', 'error');
                tokenInfoEl.style.display = 'none';
                return;
            }

            const expiryDate = new Date(decoded.exp * 1000);
            const now = new Date();
            const isExpired = expiryDate < now;

            tokenInfoEl.style.display = 'block';
            tokenInfoEl.innerHTML = `
                <strong>–¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω:</strong><br>
                User ID: ${decoded.userId || '–Ω–µ —É–∫–∞–∑–∞–Ω'}<br>
                Username: ${decoded.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}<br>
                –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ: ${expiryDate.toLocaleString('ru-RU')}<br>
                –°—Ç–∞—Ç—É—Å: ${isExpired ? '‚ùå –ò—Å—Ç–µ–∫' : '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω'}
            `;

            if (isExpired) {
                updateStatus('‚ö†Ô∏è –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å', 'error');
            } else {
                updateStatus(`‚úÖ –¢–æ–∫–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${decoded.username} (ID: ${decoded.userId})`, 'success');
            }
        }

        function updateToken() {
            try {
                localStorage.setItem('unifarm_jwt_token', NEW_TOKEN);
                updateStatus('‚úÖ JWT —Ç–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º —Ç–æ–∫–µ–Ω–µ
                const decoded = parseJWT(NEW_TOKEN);
                const tokenInfoEl = document.getElementById('tokenInfo');
                tokenInfoEl.style.display = 'block';
                tokenInfoEl.innerHTML = `
                    <strong>–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω:</strong><br>
                    User ID: ${decoded.userId}<br>
                    Username: ${decoded.username}<br>
                    Telegram ID: ${decoded.telegram_id}<br>
                    Ref Code: ${decoded.ref_code}<br>
                    –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ: ${new Date(decoded.exp * 1000).toLocaleString('ru-RU')}
                `;
                
                setTimeout(() => {
                    if (confirm('–¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                        window.location.reload();
                    }
                }, 1000);
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ${error.message}`, 'error');
            }
        }

        function clearToken() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å JWT —Ç–æ–∫–µ–Ω?')) {
                localStorage.removeItem('unifarm_jwt_token');
                updateStatus('‚úÖ JWT —Ç–æ–∫–µ–Ω —É–¥–∞–ª–µ–Ω –∏–∑ localStorage', 'success');
                document.getElementById('tokenInfo').style.display = 'none';
            }
        }

        function openApp() {
            window.open(window.location.origin, '_blank');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            checkCurrentToken();
        };
    </script>
</body>
</html>