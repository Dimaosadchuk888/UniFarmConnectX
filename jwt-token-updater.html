<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Token Update - UniFarm</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .success {
            color: #28a745;
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            color: #17a2b8;
            background: #d1ecf1;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß JWT Token Update Tool</h1>
        <p><strong>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</strong> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 62 –≤ —Å–∏—Å—Ç–µ–º–µ UniFarm</p>
        
        <div id="status"></div>
        
        <h3>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h3>
        <div id="current-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
        
        <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
        <button class="btn" onclick="updateJWTToken()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å JWT —Ç–æ–∫–µ–Ω</button>
        <button class="btn" onclick="checkTokenStatus()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ç–æ–∫–µ–Ω–∞</button>
        <button class="btn" onclick="testAPIEndpoint()">üß™ –¢–µ—Å—Ç API</button>
        
        <h3>–õ–æ–≥–∏</h3>
        <pre id="logs"></pre>
    </div>

    <script>
        const log = (message) => {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        };

        const showStatus = (message, type = 'info') => {
            const status = document.getElementById('status');
            status.innerHTML = `<div class="${type}">${message}</div>`;
        };

        const updateCurrentStatus = (message) => {
            document.getElementById('current-status').innerHTML = message;
        };

        // –ù–æ–≤—ã–π JWT —Ç–æ–∫–µ–Ω –¥–ª—è user_id=62 (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 7 –¥–Ω–µ–π)
        const newJWTToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjYyLCJ0ZWxlZ3JhbV9pZCI6ODg4ODg4NDgsInVzZXJuYW1lIjoicHJldmlld190ZXN0IiwiZmlyc3RfbmFtZSI6IlByZXZpZXciLCJyZWZfY29kZSI6IlJFRl8xNzUxNzgwNTIxOTE4X2UxdjYyZCIsImlhdCI6MTc1MTk5MzUzNiwiZXhwIjoxNzUyNTk4MzM2fQ.LNbvVJRm8-xrqVgVN6J8QbNGhXGKcQiGIVQ6YqnLhqE';

        function updateJWTToken() {
            log('–ù–∞—á–∏–Ω–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞...');
            
            try {
                // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
                localStorage.removeItem('unifarm_jwt_token');
                localStorage.removeItem('telegramJWT');
                log('–°—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª–µ–Ω—ã');
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
                localStorage.setItem('unifarm_jwt_token', newJWTToken);
                log('–ù–æ–≤—ã–π JWT —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                
                showStatus('‚úÖ JWT —Ç–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
                const savedToken = localStorage.getItem('unifarm_jwt_token');
                if (savedToken && savedToken === newJWTToken) {
                    log('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage');
                    updateCurrentStatus('<span style="color: green;">‚úÖ –¢–æ–∫–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω</span>');
                } else {
                    log('–û–®–ò–ë–ö–ê: —Ç–æ–∫–µ–Ω –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è');
                    showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞', 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞: ${error.message}`);
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function checkTokenStatus() {
            log('–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç–∞—Ç—É—Å —Ç–æ–∫–µ–Ω–∞...');
            
            const token = localStorage.getItem('unifarm_jwt_token');
            if (!token) {
                log('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage');
                updateCurrentStatus('<span style="color: red;">‚ùå –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>');
                showStatus('‚ùå JWT —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            try {
                // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
                const payload = JSON.parse(atob(token.split('.')[1]));
                log(`–¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${payload.userId}`);
                log(`Telegram ID: ${payload.telegram_id}`);
                log(`Username: ${payload.username}`);
                log(`–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: ${new Date(payload.exp * 1000).toLocaleString()}`);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
                const now = Date.now() / 1000;
                if (payload.exp > now) {
                    updateCurrentStatus('<span style="color: green;">‚úÖ –¢–æ–∫–µ–Ω –∞–∫—Ç–∏–≤–µ–Ω</span>');
                    showStatus('‚úÖ JWT —Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω', 'success');
                } else {
                    updateCurrentStatus('<span style="color: red;">‚ùå –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫</span>');
                    showStatus('‚ùå JWT —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫', 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞: ${error.message}`);
                updateCurrentStatus('<span style="color: red;">‚ùå –¢–æ–∫–µ–Ω –ø–æ–≤—Ä–µ–∂–¥–µ–Ω</span>');
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        async function testAPIEndpoint() {
            log('–¢–µ—Å—Ç–∏—Ä—É—é API endpoint...');
            
            const token = localStorage.getItem('unifarm_jwt_token');
            if (!token) {
                log('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                showStatus('‚ùå –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/v2/wallet/balance?user_id=62', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                log(`API –æ—Ç–≤–µ—Ç: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${JSON.stringify(data.data, null, 2)}`);
                    showStatus('‚úÖ API —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ', 'success');
                } else {
                    const errorData = await response.json();
                    log(`–û—à–∏–±–∫–∞ API: ${JSON.stringify(errorData, null, 2)}`);
                    showStatus(`‚ùå API –æ—à–∏–±–∫–∞: ${response.status}`, 'error');
                }
                
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ API: ${error.message}`);
                showStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', () => {
            log('–°–∏—Å—Ç–µ–º–∞ JWT Token Updater –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            checkTokenStatus();
        });
    </script>
</body>
</html>