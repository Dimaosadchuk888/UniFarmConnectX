# TON Wallet Integration Audit Report
**Date:** July 6, 2025  
**Status:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞

## üß© –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
‚úÖ **TON Connect –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:**
- @tonconnect/sdk v3.1.0
- @tonconnect/ui v2.1.0  
- @tonconnect/ui-react v2.1.0
- @tonconnect/protocol v2.2.7

‚úÖ **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `client/src/components/ton-boost/BoostPackagesCard.tsx` - –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏
- `client/src/components/ton-boost/PaymentMethodDialog.tsx` - –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
- `client/src/components/ton-boost/ExternalPaymentStatus.tsx` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- `client/src/services/tonConnectService.ts` - —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π –¥–ª—è TON Connect

### Backend endpoints:
‚úÖ **modules/boost/controller.ts:**
- `purchaseBoost` (—Å—Ç—Ä–æ–∫–∞ 206) - –º–µ—Ç–æ–¥ –ø–æ–∫—É–ø–∫–∏ –±—É—Å—Ç–∞
- `verifyTonPayment` (—Å—Ç—Ä–æ–∫–∞ 254) - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

‚úÖ **modules/boost/service.ts:**
- `purchaseBoost` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
- `verifyTonPayment` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
- `purchaseWithInternalWallet` - –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å
- `purchaseWithExternalWallet` - –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π –∫–æ—à–µ–ª–µ–∫

## üìç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ª–æ–≥–∏ –≤ tonConnectService.ts:
```javascript
console.log("===============================================================");
console.log("üî¥ –í–´–ó–û–í sendTonTransaction –ü–û –ù–û–í–û–ú–£ –¢–ó");
console.log("üî¥ –°–£–ú–ú–ê:", amount, "TON");
console.log("üî¥ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô:", comment);
// ... –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –Ω–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è production

### 2. –§–æ—Ä–º–∞—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
```javascript
const transactionComment = `UniFarmBoost:${userId}:${boostId}`;
```
**–°—Ç–∞—Ç—É—Å:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞:
```javascript
if (!isTonWalletConnected(tonConnectUI)) {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º toast —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
}
```
**–°—Ç–∞—Ç—É—Å:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ BoostModal:
‚ùå **–ù–µ –Ω–∞–π–¥–µ–Ω** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `BoostModal.tsx` —É–ø–æ–º—è–Ω—É—Ç—ã–π –≤ –¢–ó
- –í–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `PaymentMethodDialog.tsx`
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –æ–ø–∏—Å–∞–Ω–Ω–æ–º—É –≤ –¢–ó

## üîÑ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫

### –£—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
1. **–í—ã–±–æ—Ä –ø–∞–∫–µ—Ç–∞** ‚Üí BoostPackagesCard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
2. **–û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞** ‚Üí PaymentMethodDialog –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã  
3. **–í–Ω–µ—à–Ω–∏–π –∫–æ—à–µ–ª–µ–∫** ‚Üí sendTonTransaction —á–µ—Ä–µ–∑ TonConnect UI
4. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ö—ç—à–∞** ‚Üí POST /api/v2/boost/verify-ton-payment
5. **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** ‚Üí checkTonTransaction –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–ª–æ–∫—á–µ–π–Ω
6. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è** ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ boost_purchases –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
‚úÖ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º –∫–æ—à–µ–ª—å–∫–µ
‚úÖ –ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω –¥–ª—è –≤–Ω–µ—à–Ω–µ–π –æ–ø–ª–∞—Ç—ã
‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ waiting
‚úÖ –û—à–∏–±–∫–∏ —Å–µ—Ç–∏ –ø—Ä–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üõ° –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. Hardcoded –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
```javascript
// –í tonConnectService.ts –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ:
const TON_BOOST_RECEIVER_ADDRESS = process.env.VITE_TON_BOOST_RECEIVER_ADDRESS
```
**–†–∏—Å–∫:** –ï—Å–ª–∏ –∞–¥—Ä–µ—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–≥—É—Ç –∏–¥—Ç–∏ –Ω–µ —Ç—É–¥–∞

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ ton-proof:
–í –∫–æ–¥–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ton-proof –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
**–†–∏—Å–∫:** –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é

### 3. –¢–∞–±–ª–∏—Ü–∞ boost_purchases:
–ö–æ–¥ –æ–∂–∏–¥–∞–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã boost_purchases –≤ Supabase
**–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É –∏–∑ –¢–ó

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|---------|------------|
| TON Connect –≤ –ø—Ä–æ–µ–∫—Ç–µ | ‚úÖ | –í—Å–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã |
| ton-proof | ‚ùå | –ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
| BoostModal | ‚ö†Ô∏è | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PaymentMethodDialog |
| Payload —Å –∞–¥—Ä–µ—Å–æ–º –∏ —Å—É–º–º–æ–π | ‚úÖ | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ sendTonTransaction |
| QR-–∫–æ–¥ –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã | ‚úÖ | TonConnect UI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç |
| onTransactionSuccess | ‚úÖ | –í—ã–∑—ã–≤–∞–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é |

## üîç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - VITE_TON_BOOST_RECEIVER_ADDRESS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - JWT —Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase —Ç–∞–±–ª–∏—Ü—ã:**
   - boost_purchases
   - transactions
   - users (–ø–æ–ª—è balance_ton, ton_boost_package)

3. **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
   - –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å
   - –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Tonkeeper
   - –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Wallet app
   - –û—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

1. **–î–≤–æ–π–Ω–∞—è –ø–æ–∫—É–ø–∫–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å —Ç–µ–º –∂–µ tx_hash
2. **–¢–∞–π–º–∞—É—Ç—ã:** –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –¥–æ 30 —Å–µ–∫—É–Ω–¥
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ë–î

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ TON Connect –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ **—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º:
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±—É—Å—Ç–æ–≤

–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
- ‚ùì –ù–∞–ª–∏—á–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –≤ Supabase
- ‚ùì –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å TON_BOOST_RECEIVER_ADDRESS
- ‚ùì –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–æ—à–µ–ª—å–∫–∞–º–∏ (Tonkeeper, Wallet)