<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="UniFarm Connect - Advanced blockchain learning through gamified wallet interactions" />
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Telegram Web App -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- JWT Auth Auto-Fix Script -->
    <script>
      // Автоматическая установка JWT токена для исправления авторизации
      (function() {
        console.log('[JWT Auth Fix] Проверка JWT токена...');
        const token = localStorage.getItem('unifarm_jwt_token');
        
        // JWT токен для пользователя ID 74
        const correctToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjc0LCJ0ZWxlZ3JhbV9pZCI6OTk5NDg5LCJ1c2VybmFtZSI6InRlc3RfdXNlcl8xNzUyMTI5ODQwOTA1IiwicmVmX2NvZGUiOiJURVNUXzE3NTIxMjk4NDA5MDVfZG9reHYwIiwiaWF0IjoxNzUyMTI5ODQxLCJleHAiOjE3NTI3MzQ2NDF9.zImxV8ATpEV_ZumGaRKflQ7niNA--PSgKvhXhlPtpsU';
        
        if (!token || token !== correctToken) {
          console.log('[JWT Auth Fix] JWT токен отсутствует или неверный, устанавливаем правильный...');

          
          localStorage.setItem('unifarm_jwt_token', correctToken);
          console.log('[JWT Auth Fix] JWT токен установлен успешно');
          
          // Декодируем токен для проверки
          try {
            const base64Url = correctToken.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
              return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            const decoded = JSON.parse(jsonPayload);
            
            console.log('[JWT Auth Fix] Токен декодирован:', {
              userId: decoded.userId,
              username: decoded.username,
              telegram_id: decoded.telegram_id,
              exp: new Date(decoded.exp * 1000).toLocaleString('ru-RU')
            });
          } catch (e) {
            console.error('[JWT Auth Fix] Ошибка декодирования токена:', e);
          }
        } else {
          console.log('[JWT Auth Fix] JWT токен уже существует');
        }
      })();
    </script>
    
    <!-- Production User JWT Setup ОТКЛЮЧЕН - удален автоматический хардкод user_id=48 -->
    <!-- Теперь JWT токен управляется через UserContext и не переопределяется при загрузке -->
    
    <title>UniFarm Connect</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx?v=1751399350"></script>
  </body>
</html>