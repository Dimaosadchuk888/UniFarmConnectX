<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- –ú–µ—Ç–∫–∞ –¥–ª—è Telegram Mini App -->
    <meta name="telegram-web-app-ready" content="true" />
    <title>UniFarm - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        h1 {
            margin-bottom: 10px;
        }
        p {
            margin-bottom: 20px;
            color: #666;
        }
    </style>
    <script>
        // –≠–º—É–ª—è—Ü–∏—è Telegram WebApp –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
        if (!window.Telegram && window.localStorage.getItem('dev_mode') === 'true') {
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç Telegram —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            window.Telegram = {
                WebApp: {
                    ready: function() { console.log('[DEV] Telegram.WebApp.ready() called'); },
                    expand: function() { console.log('[DEV] Telegram.WebApp.expand() called'); },
                    initData: 'dev_mode=true&user=%7B%22id%22%3A1%2C%22first_name%22%3A%22Test%22%7D&auth_date=1619631535',
                    initDataUnsafe: {
                        user: {
                            id: 1,
                            username: 'dev_user',
                            first_name: 'Test',
                            last_name: 'User'
                        },
                        auth_date: '1619631535',
                        hash: 'dev_hash'
                    },
                    platform: 'web',
                    version: '6.0'
                }
            };
            console.log('[DEV] üõ†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: —ç–º—É–ª—è—Ü–∏—è Telegram WebApp API');
        }

        // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –ª–æ–≥–æ 5 —Ä–∞–∑
        let tapCount = 0;
        function enableDevMode() {
            tapCount++;
            if (tapCount >= 5) {
                window.localStorage.setItem('dev_mode', 'true');
                alert('üõ†Ô∏è –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–∫–ª—é—á–µ–Ω! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                tapCount = 0;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ —Ü–∏–∫–ª–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
        function checkRedirectLoop() {
            // –ü–æ–ª—É—á–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
            let redirectCount = parseInt(localStorage.getItem('redirect_count') || '0');
            
            // –ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ –±–æ–ª—å—à–µ 3, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
            if (redirectCount > 3) {
                console.log('[Telegram Redirect] ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ü–∏–∫–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞');
                localStorage.removeItem('redirect_count');
                
                // –ï—Å–ª–∏ –º—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –Ω–µ –¥–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç
                if (window.location.pathname === '/') {
                    return false;
                }
                
                // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞, –¥–µ–ª–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                if (window.location.pathname.includes('telegram-redirect.html')) {
                    window.location.href = window.location.origin;
                    return false;
                }
                
                return false;
            }
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
            localStorage.setItem('redirect_count', (redirectCount + 1).toString());
            return true;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
        function redirectToMain() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–∏–∫–ª —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
            if (!checkRedirectLoop()) {
                console.log('[Telegram Redirect] –†–µ–¥–∏—Ä–µ–∫—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑-–∑–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ü–∏–∫–ª–∞');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π URL
            const currentUrl = window.location.href;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ Telegram
            const isTelegramWebApp = !!window.Telegram && !!window.Telegram.WebApp;
            
            // –í—ã–≤–æ–¥–∏–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å
            console.log('[Telegram Redirect] Current URL:', currentUrl);
            console.log('[Telegram Redirect] Launched from Telegram WebApp:', isTelegramWebApp);
            
            if (isTelegramWebApp) {
                console.log('[Telegram Redirect] Telegram WebApp environment detected!');
                console.log('[Telegram Redirect] Telegram WebApp data:', {
                    initDataAvailable: !!window.Telegram.WebApp.initData,
                    initDataLength: window.Telegram.WebApp.initData?.length || 0,
                    initDataUnsafeAvailable: !!window.Telegram.WebApp.initDataUnsafe,
                    userAvailable: !!window.Telegram.WebApp.initDataUnsafe?.user,
                    userId: window.Telegram.WebApp.initDataUnsafe?.user?.id || 'not available'
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –ø—Ä–∏–∑–Ω–∞–∫ –∑–∞–ø—É—Å–∫–∞ –∏–∑ Telegram
                localStorage.setItem('telegram_launch', 'true');
                // –ï—Å–ª–∏ Mini App –ø–µ—Ä–µ–¥–∞–ª–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫—ç—à–∏—Ä—É–µ–º –∏—Ö
                if (window.Telegram.WebApp.initDataUnsafe?.user) {
                    localStorage.setItem('telegram_user_data', JSON.stringify(window.Telegram.WebApp.initDataUnsafe.user));
                }
            }
            
            // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
            if (window.location.pathname.includes('telegram-redirect.html')) {
                localStorage.removeItem('redirect_count'); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                window.location.href = window.location.origin;
                return;
            }
            
            // –ï—Å–ª–∏ URL –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ—à, —É–±–∏—Ä–∞–µ–º –µ–≥–æ
            if (currentUrl.endsWith('/') && currentUrl.length > window.location.origin.length + 1) {
                const newUrl = currentUrl.slice(0, -1);
                console.log('[Telegram Redirect] Removing trailing slash:', newUrl);
                window.location.href = newUrl;
                return;
            }
            
            // –ï—Å–ª–∏ –Ω–∏–∫–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
            localStorage.removeItem('redirect_count');
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            // –ù–µ–º–Ω–æ–≥–æ –∑–∞–¥–µ—Ä–∂–∏–≤–∞–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(redirectToMain, 1000);
        };
    </script>
</head>
<body>
    <div class="loader" onclick="enableDevMode()"></div>
    <h1>UniFarm</h1>
    <p>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...</p>
</body>
</html>