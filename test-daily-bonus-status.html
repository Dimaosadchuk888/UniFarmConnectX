<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ Daily Bonus</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        .log {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .error {
            color: #ff5252;
        }
        .success {
            color: #4CAF50;
        }
        .warning {
            color: #FFA726;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background: #45a049;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .stat-item {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
        }
        .stat-label {
            color: #888;
            font-size: 12px;
        }
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Daily Bonus –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 74</h1>
    
    <div class="section">
        <h2>–î–µ–π—Å—Ç–≤–∏—è</h2>
        <button onclick="checkDailyBonus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Daily Bonus</button>
        <button onclick="checkTransactions()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</button>
        <button onclick="tryClaimBonus()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å</button>
    </div>

    <div class="section">
        <h2>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h2>
        <div id="status" class="stats"></div>
    </div>

    <div class="section">
        <h2>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Daily Bonus</h2>
        <div id="transactions" class="log"></div>
    </div>

    <div class="section">
        <h2>–õ–æ–≥–∏</h2>
        <div id="logs" class="log"></div>
    </div>

    <script>
        const API_BASE = '/api/v2';
        
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logsDiv.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        async function makeRequest(url, options = {}) {
            const token = localStorage.getItem('unifarm_jwt_token');
            if (!token) {
                log('‚ùå JWT —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage', 'error');
                return null;
            }

            try {
                const response = await fetch(API_BASE + url, {
                    ...options,
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                const data = await response.json();
                
                if (!response.ok) {
                    log(`‚ùå –û—à–∏–±–∫–∞ ${url}: ${response.status} ${response.statusText}`, 'error');
                    log(`–û—Ç–≤–µ—Ç: ${JSON.stringify(data)}`, 'error');
                    return null;
                }

                return data;
            } catch (error) {
                log(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ ${url}: ${error.message}`, 'error');
                return null;
            }
        }

        async function checkDailyBonus() {
            log('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Daily Bonus...');
            
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ can claim
            const canClaimData = await makeRequest('/daily-bonus/check');
            if (canClaimData && canClaimData.success) {
                log(`‚úÖ Can claim: ${canClaimData.data.canClaim}`, 'success');
                log(`–°–µ—Ä–∏—è: ${canClaimData.data.streak} –¥–Ω–µ–π`, 'info');
                log(`–°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å: ${canClaimData.data.bonusAmount} UNI`, 'info');
                
                updateStatus({
                    '–ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å': canClaimData.data.canClaim ? '–î–∞' : '–ù–µ—Ç',
                    '–°–µ—Ä–∏—è –¥–Ω–µ–π': canClaimData.data.streak,
                    '–†–∞–∑–º–µ—Ä –±–æ–Ω—É—Å–∞': `${canClaimData.data.bonusAmount} UNI`
                });
            }

            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            const statsData = await makeRequest('/daily-bonus/74/stats');
            if (statsData && statsData.success) {
                log(`‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞`, 'success');
                log(`–í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ: ${statsData.data.totalClaimed} UNI`, 'info');
                log(`–í—Å–µ–≥–æ –¥–Ω–µ–π: ${statsData.data.totalDays}`, 'info');
                log(`–ü–æ—Å–ª–µ–¥–Ω–∏–π –±–æ–Ω—É—Å: ${statsData.data.lastClaimDate || '–ù–∏–∫–æ–≥–¥–∞'}`, 'info');
                
                updateStatus({
                    '–í—Å–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–æ': `${statsData.data.totalClaimed} UNI`,
                    '–í—Å–µ–≥–æ –¥–Ω–µ–π': statsData.data.totalDays,
                    '–ü–æ—Å–ª–µ–¥–Ω–∏–π –±–æ–Ω—É—Å': statsData.data.lastClaimDate || '–ù–∏–∫–æ–≥–¥–∞'
                });
            }

            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
            const balanceData = await makeRequest('/wallet/balance');
            if (balanceData && balanceData.success) {
                log(`‚úÖ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${balanceData.data.uniBalance} UNI`, 'success');
                updateStatus({
                    '–ë–∞–ª–∞–Ω—Å UNI': `${balanceData.data.uniBalance} UNI`,
                    '–ë–∞–ª–∞–Ω—Å TON': `${balanceData.data.tonBalance} TON`
                });
            }
        }

        async function checkTransactions() {
            log('üí∞ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Daily Bonus...');
            
            const txData = await makeRequest('/wallet/transactions?limit=100');
            if (txData && txData.success && txData.data) {
                const allTx = txData.data;
                const dailyBonusTx = allTx.filter(tx => 
                    tx.type === 'daily_bonus' || tx.type === 'DAILY_BONUS'
                );
                
                log(`‚úÖ –í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${allTx.length}`, 'success');
                log(`‚úÖ Daily Bonus —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${dailyBonusTx.length}`, 'success');
                
                const txDiv = document.getElementById('transactions');
                txDiv.innerHTML = '';
                
                if (dailyBonusTx.length === 0) {
                    txDiv.innerHTML = '<div class="error">‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ Daily Bonus –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!</div>';
                } else {
                    dailyBonusTx.forEach(tx => {
                        txDiv.innerHTML += `
                            <div style="margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                                <div><strong>–î–∞—Ç–∞:</strong> ${new Date(tx.created_at).toLocaleString('ru-RU')}</div>
                                <div><strong>–°—É–º–º–∞:</strong> +${tx.amount_uni || tx.amount} UNI</div>
                                <div><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${tx.description}</div>
                                <div><strong>ID:</strong> ${tx.id}</div>
                            </div>
                        `;
                    });
                }
            }
        }

        async function tryClaimBonus() {
            log('üéÅ –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å Daily Bonus...');
            
            const claimData = await makeRequest('/daily-bonus/claim', {
                method: 'POST'
            });
            
            if (claimData) {
                if (claimData.success) {
                    log(`‚úÖ –ë–æ–Ω—É—Å —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω!`, 'success');
                    log(`–ù–∞—á–∏—Å–ª–µ–Ω–æ: ${claimData.data.amount} UNI`, 'success');
                    log(`–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${claimData.data.newBalance} UNI`, 'success');
                    log(`–°–µ—Ä–∏—è: ${claimData.data.streak} –¥–Ω–µ–π`, 'success');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    setTimeout(() => {
                        checkTransactions();
                        checkDailyBonus();
                    }, 1000);
                } else {
                    log(`‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å: ${claimData.error || claimData.message}`, 'warning');
                }
            }
        }

        function updateStatus(data) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = Object.entries(data).map(([label, value]) => `
                <div class="stat-item">
                    <div class="stat-label">${label}</div>
                    <div class="stat-value">${value}</div>
                </div>
            `).join('');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            checkDailyBonus();
            checkTransactions();
        };
    </script>
</body>
</html>