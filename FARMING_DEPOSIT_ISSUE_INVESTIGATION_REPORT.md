# üîç –û–¢–ß–ï–¢ –ü–û –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Æ –ü–†–û–ë–õ–ï–ú–´ –î–ï–ü–û–ó–ò–¢–û–í –§–ê–†–ú–ò–ù–ì–ê

**–î–∞—Ç–∞:** 8 –∏—é–ª—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** UNI –±–∞–ª–∞–Ω—Å—ã –Ω–µ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Ñ–∞—Ä–º–∏–Ω–≥–∞  
**–°—Ç–∞—Ç—É—Å:** üéØ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –ù–ê–ô–î–ï–ù–ê

## üìã –ö–†–ê–¢–ö–û–ï –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç—ã —Ñ–∞—Ä–º–∏–Ω–≥–∞ - —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–µ —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –±–∞–ª–∞–Ω—Å–∞, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å 200 OK.

## üîç –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø

### **API –ü–æ–≤–µ–¥–µ–Ω–∏–µ:**
```javascript
// –ó–∞–ø—Ä–æ—Å: POST /api/v2/uni-farming/deposit
// –¢–µ–ª–æ: { "amount": "5.5" }
// –û—Ç–≤–µ—Ç:
{
  "success": true,
  "data": {
    "success": false,
    "message": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ø–æ–∑–∏—Ç–∞"
  }
}
```

### **–°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã transactions:**
```javascript
// –ü–æ–ª—è –¥–ª—è —Å—É–º–º:
'amount_uni',    // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è UNI
'amount_ton',    // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è TON  
'amount'         // ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (legacy)
```

### **–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** ID 62 (preview_test)
- **–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:** 549 UNI
- **–¢–µ—Å—Ç—ã:** 1, 5.5, 10, 0.1 UNI - –≤—Å–µ FAILED
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 UNI —Å–ø–∏—Å–∞–Ω–æ, –±–∞–ª–∞–Ω—Å –æ—Å—Ç–∞–ª—Å—è 549

## üéØ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

**–ù–∞–π–¥–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ:** `modules/farming/service.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ `depositUniForFarming()` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ catch –±–ª–æ–∫–µ –Ω–∞ —Å—Ç—Ä–æ–∫–µ 315:

```javascript
} catch (error) {
  logger.error('[FarmingService] –û—à–∏–±–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–∞ UNI:', error);
  return { success: false, message: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ø–æ–∑–∏—Ç–∞' };  // ‚Üê –≠–¢–û –í–û–ó–í–†–ê–©–ê–ï–¢–°–Ø
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π return:** (—Å—Ç—Ä–æ–∫–∞ 312)
```javascript
return { success: true, message: '–î–µ–ø–æ–∑–∏—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ñ–∞—Ä–º–∏–Ω–≥' };
```

## üîß –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ú–ï–¢–û–î–ê

### **–õ–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞ depositUniForFarming():**

1. ‚úÖ **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã** - —Ä–∞–±–æ—Ç–∞–µ—Ç  
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚ùì **BalanceManager.subtractBalance()** - –ù–ï–ò–ó–í–ï–°–¢–ù–û
5. ‚ùì **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ uni_deposit_amount** - –ù–ï–ò–ó–í–ï–°–¢–ù–û
6. ‚ùì **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –ù–ï–ò–ó–í–ï–°–¢–ù–û
7. ‚ùå **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≥–¥–µ-—Ç–æ –≤ –ø—É–Ω–∫—Ç–∞—Ö 4-6**

### **–í–µ—Ä–æ—è—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**

1. **BalanceManager.subtractBalance()** - –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. **Supabase update –æ–ø–µ—Ä–∞—Ü–∏—è** - –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–ª—è–º–∏
3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å ENUM —Ç–∏–ø–∞–º–∏

## üìä –ì–û–¢–û–í–ù–û–°–¢–¨ –°–ò–°–¢–ï–ú–´

**–¢–µ–∫—É—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 85% ‚Üí 60% (–∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–±–ª–µ–º—ã –¥–µ–ø–æ–∑–∏—Ç–æ–≤)

### **–†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ API endpoints (–ø—Ä–∏–Ω–∏–º–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã)
- ‚úÖ Frontend –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è JWT
- ‚úÖ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚ùå **FarmingService.depositUniForFarming()** - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- ‚ùå **–°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞** - –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- ‚ùå **–°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–æ–≤** - –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥–∞** - –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è

## üõ†Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### **–®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```javascript
// –í FarmingService.depositUniForFarming()
try {
  // ... existing code ...
} catch (error) {
  logger.error('[FarmingService] –î–ï–¢–ê–õ–¨–ù–ê–Ø –û–®–ò–ë–ö–ê:', {
    error: error.message,
    stack: error.stack,
    telegramId,
    amount,
    step: '–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–¥–µ –ø–∞–¥–∞–µ—Ç'
  });
  return { success: false, message: '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–ø–æ–∑–∏—Ç–∞' };
}
```

### **–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å BalanceManager**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `core/BalanceManager.subtractBalance()` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `result.success`

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase –æ–ø–µ—Ä–∞—Ü–∏–∏**
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ –ø–æ–ª—è `uni_deposit_amount`, `uni_farming_rate` —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ ENUM —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### **–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É transactions**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª—è `amount_uni`, `amount_ton` –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∏–ø `FARMING_REWARD` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ ENUM

## üìã –ë–ï–ó–û–ü–ê–°–ù–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. **–ù–ï –¢–†–û–ì–ê–¢–¨** —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É
2. **–î–û–ë–ê–í–ò–¢–¨** –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. **–ù–ê–ô–¢–ò** —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
4. **–ò–°–ü–†–ê–í–ò–¢–¨** –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É
5. **–ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–¢–¨** –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
6. **–û–¢–ö–ê–¢–ò–¢–¨** –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è

## üéØ –í–´–í–û–î

–ü—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –º–µ—Ç–æ–¥–µ `FarmingService.depositUniForFarming()` –≥–¥–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –æ—à–∏–±–∫–∏ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–æ–±–∞–≤–∏—Ç—å try-catch –±–ª–æ–∫–∏ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –º–µ—Ç–æ–¥–∞.