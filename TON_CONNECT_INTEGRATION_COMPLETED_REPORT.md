# ‚úÖ TON CONNECT –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê

**–î–∞—Ç–∞:** 20 –∏—é–ª—è 2025  
**–ó–∞–¥–∞—á–∞:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Frontend TON Connect —Å Backend API  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ  

## üéØ –ß–¢–û –ë–´–õ–û –°–î–ï–õ–ê–ù–û

### 1. **–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω**
**–§–∞–π–ª:** `client/src/services/tonConnectService.ts`  
**–ú–µ—Ç–æ–¥:** `sendTonTransaction()` (—Å—Ç—Ä–æ–∫–∏ 424-442)  
**–î–æ–±–∞–≤–ª–µ–Ω–æ:** 18 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Backend API  

### 2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞:**
```typescript
// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω:
try {
  const { correctApiRequest } = await import('../../lib/correctApiRequest');
  
  const backendResponse = await correctApiRequest('/api/v2/wallet/ton-deposit', 'POST', {
    ton_tx_hash: result.boc,      // Hash —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞
    amount: tonAmount,            // –°—É–º–º–∞ –¥–µ–ø–æ–∑–∏—Ç–∞
    wallet_address: tonConnectUI.account?.address || 'unknown' // –ê–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  });
  
  // –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  console.log('[TON_DEPOSIT] Backend —É–≤–µ–¥–æ–º–ª–µ–Ω:', backendResponse.success);
} catch (backendError) {
  // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ - –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π flow
  console.error('[TON_DEPOSIT] –û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è backend:', backendError);
}
```

## üìä –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### ‚úÖ **–ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
1. User –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON" ‚úÖ
2. tonConnectService.sendTonTransaction() ‚úÖ
3. Tonkeeper –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é ‚úÖ
4. –ë–ª–æ–∫—á–µ–π–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é ‚úÖ
5. üÜï Frontend –≤—ã–∑—ã–≤–∞–µ—Ç POST /api/v2/wallet/ton-deposit ‚úÖ
6. Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ processTonDeposit() ‚úÖ
7. BalanceManager.addBalance() –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å ‚úÖ
8. TransactionService —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î ‚úÖ
9. WebSocket –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚úÖ
10. UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ ‚úÖ
```

### ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞:**
- JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `correctApiRequest` ‚úÖ
- –ò–∑–æ–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫ - –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —É—Å–ø–µ—à–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é ‚úÖ
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ ‚úÖ
- –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–ª–∏ race conditions ‚úÖ

## üõ† –°–û–ó–î–ê–ù –°–ö–†–ò–ü–¢ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø

### **restore-user25-deposit.cjs** 
–ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞ User #25:
- Hash: b30da7471672b8fc154baca674b2cc9c0829ead2a443bfa901f7b676ced2c70d
- –°—É–º–º–∞: 0.1 TON  
- –¢—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω User #25

## üìã –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:**
1. **–ù–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã:** –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ TON Connect
2. **User #25:** –î–µ–ø–æ–∑–∏—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
3. **Backend:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã
4. **UI:** –ë—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –ù–æ–≤—ã–π TON –¥–µ–ø–æ–∑–∏—Ç —á–µ—Ä–µ–∑ TON Connect
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ UI
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏  
- [ ] WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ User #25 –¥–µ–ø–æ–∑–∏—Ç–∞

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### **–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå TON –¥–µ–ø–æ–∑–∏—Ç—ã –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å backend
- ‚ùå –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ù–ï —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –≤ –ë–î
- ‚ùå –ë–∞–ª–∞–Ω—Å—ã –ù–ï –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å
- ‚ùå User #25 –ø–æ—Ç–µ—Ä—è–ª 0.1 TON

### **–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ TON –¥–µ–ø–æ–∑–∏—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –ë–î
- ‚úÖ –ë–∞–ª–∞–Ω—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ User #25 –º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π –¥–µ–ø–æ–∑–∏—Ç
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

## üìÑ –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. `client/src/services/tonConnectService.ts` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend
2. `restore-user25-deposit.cjs` - —Å–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞  
3. `TON_CONNECT_INTEGRATION_COMPLETED_REPORT.md` - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### **–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–±–æ—Ç–µ):**
- `modules/wallet/controller.ts::tonDeposit()` ‚úÖ
- `modules/wallet/service.ts::processTonDeposit()` ‚úÖ
- `modules/wallet/routes.ts` ‚úÖ
- `core/BalanceManager.ts` ‚úÖ
- `core/TransactionService.ts` ‚úÖ

## üöÄ –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

**‚úÖ TON CONNECT –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê**

–ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º–∏ TON –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏ —Ä–µ—à–µ–Ω–∞. –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–∏–µ–º—É —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Å–µ—Ö TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ TON Connect.

---
**User #25 –¥–µ–ø–æ–∑–∏—Ç –≥–æ—Ç–æ–≤ –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é** —á–µ—Ä–µ–∑ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º JWT —Ç–æ–∫–µ–Ω–æ–º.