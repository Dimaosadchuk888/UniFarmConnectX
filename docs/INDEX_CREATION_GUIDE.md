# üìù –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –°–û–ó–î–ê–ù–ò–Æ –ò–ù–î–ï–ö–°–û–í

## ‚ö†Ô∏è –û—à–∏–±–∫–∞ "CREATE INDEX CONCURRENTLY cannot run inside a transaction block"

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—ã –ø—ã—Ç–∞–ª–∏—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (BEGIN/COMMIT).

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

### –°–ø–æ—Å–æ–± 1: –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç —Å—Ä–∞–∑—É
1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `scripts/generated_index_script_fixed.sql`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –í–°–Å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å Supabase SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ "Run"
5. PostgreSQL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É –æ—Ç–¥–µ–ª—å–Ω–æ

### –°–ø–æ—Å–æ–± 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ
–ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Å–ø–æ—Å–æ–± –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É –æ—Ç–¥–µ–ª—å–Ω–æ:

```sql
-- –ö–æ–º–∞–Ω–¥–∞ 1
CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_telegram_id
ON users (telegram_id);

-- –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, –∑–∞—Ç–µ–º –∫–æ–º–∞–Ω–¥–∞ 2
CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_transactions_user_id__created_at_desc
ON transactions (user_id, created_at DESC);

-- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö 8 –∏–Ω–¥–µ–∫—Å–æ–≤...
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
```sql
SELECT tablename, indexname 
FROM pg_indexes 
WHERE schemaname = 'public' 
  AND indexname LIKE 'idx_%'
ORDER BY indexname;
```

## ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- –ú–∞–ª–µ–Ω—å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã (< 1000 —Å—Ç—Ä–æ–∫): –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
- –°—Ä–µ–¥–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã (1000-100k —Å—Ç—Ä–æ–∫): 1-5 –º–∏–Ω—É—Ç
- –ë–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã (> 100k —Å—Ç—Ä–æ–∫): 5-20 –º–∏–Ω—É—Ç

## ‚úÖ –ü—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—Ö–∞:
1. –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. –ö–æ–º–∞–Ω–¥–∞ SELECT –≤—ã—à–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 8 –Ω–æ–≤—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
3. –ó–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ

## ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï:
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ BEGIN/COMMIT
- –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞
- –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –ø–∏–∫–æ–≤—ã–µ —á–∞—Å—ã –Ω–∞–≥—Ä—É–∑–∫–∏

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:
–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö 8 –∏–Ω–¥–µ–∫—Å–æ–≤ –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ 5-10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!