# T51 –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –ü–û–ö–£–ü–ö–ò BOOST-–ü–ê–ö–ï–¢–û–í - –û–¢–ß–ï–¢ –û –í–´–ü–û–õ–ù–ï–ù–ò–ò

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫—É–ø–∫–∏ Boost-–ø–∞–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å –∏ –≤–Ω–µ—à–Ω–∏–π TON-–∫–æ—à–µ–ª—ë–∫ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é.

---

## 1. ‚úÖ Endpoint –ø–æ–∫—É–ø–∫–∏ - –†–ï–ê–õ–ò–ó–û–í–ê–ù

### POST /api/v2/boost/purchase
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `modules/boost/routes.ts:27`

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (—Ç–æ—á–Ω–æ –ø–æ –¢–ó):
```json
{
  "user_id": "string",
  "boost_id": "string", 
  "payment_method": "wallet" | "ton",
  "tx_hash": "string" // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è TON –ø–ª–∞—Ç–µ–∂–µ–π
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è payment_method ("wallet" –∏–ª–∏ "ton")
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ tx_hash –¥–ª—è TON –ø–ª–∞—Ç–µ–∂–µ–π
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ requireTelegramAuth middleware

---

## 2. ‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–ª–∞—Ç–∞ (wallet) - –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞**: Validation —á–µ—Ä–µ–∑ `walletService.getWalletDataByTelegramId()`
- **–°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤**: –ß–µ—Ä–µ–∑ `walletService.processWithdrawal(userId, amount, 'TON')`
- **–ê–∫—Ç–∏–≤–∞—Ü–∏—è Boost**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ boost_purchases —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'confirmed'
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Ç–∏–ø–∞ 'boost_purchase'

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞:
```typescript
// modules/boost/service.ts:149-214
async purchaseWithInternalWallet(userId, boostPackage) {
  // 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤
  // 3. –°–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ WalletService
  // 4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–∫—É–ø–∫–∏
  // 5. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π
}
```

---

## 3. ‚úÖ –í–Ω–µ—à–Ω—è—è –æ–ø–ª–∞—Ç–∞ (TON) - –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–ü–æ–ª—É—á–µ–Ω–∏–µ tx_hash**: –ò–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
- **Pending —Å—Ç–∞—Ç—É—Å**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ boost_purchases —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'pending'
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è**: –°–æ–∑–¥–∞–Ω–∏–µ –≤ transactions —Å status = 'pending'
- **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è**: Boost –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —Å—Ä–∞–∑—É (–ø–æ –¢–ó)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞:
```typescript
// modules/boost/service.ts:216-253
async purchaseWithExternalTon(userId, boostPackage, txHash) {
  // 1. –°–æ–∑–¥–∞–Ω–∏–µ pending –∑–∞–ø–∏—Å–∏ –ø–æ–∫—É–ø–∫–∏
  // 2. –°–æ–∑–¥–∞–Ω–∏–µ pending —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
  // 3. –í–æ–∑–≤—Ä–∞—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ–∂–∏–¥–∞–Ω–∏–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
}
```

---

## 4. ‚úÖ –¢–∞–±–ª–∏—Ü–∞ boost_purchases - –°–û–ó–î–ê–ù–ê

### SQL Schema: `docs/boost_purchases_schema.sql`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã** (—Ç–æ—á–Ω–æ –ø–æ –¢–ó):
```sql
CREATE TABLE boost_purchases (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id TEXT NOT NULL,
  boost_id TEXT NOT NULL,
  source TEXT CHECK (source IN ('wallet', 'ton')),
  tx_hash TEXT,
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'confirmed', 'failed')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**:
- `idx_boost_purchases_user_id`
- `idx_boost_purchases_status`
- `idx_boost_purchases_tx_hash`
- `idx_boost_purchases_created_at`

---

## 5. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ logger –≤–º–µ—Å—Ç–æ console.log:
- **–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞**: `logger.info('[BoostService] –ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–∫—É–ø–∫–∏ Boost')`
- **–ü–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–∞**: `logger.info('[BoostService] –ù–∞–π–¥–µ–Ω Boost-–ø–∞–∫–µ—Ç')`
- **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–ª–∞—Ç–∞**: `logger.info('[BoostService] –ü–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ—à–µ–ª–µ–∫')`
- **–í–Ω–µ—à–Ω—è—è –æ–ø–ª–∞—Ç–∞**: `logger.info('[BoostService] –ü–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π TON –∫–æ—à–µ–ª–µ–∫')`
- **–û—à–∏–±–∫–∏**: `logger.error('[BoostService] –û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏ Boost-–ø–∞–∫–µ—Ç–∞')`
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**: `logger.warn('[BoostService] –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏')`

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤:
```typescript
logger.info('[BoostService] –£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ—à–µ–ª–µ–∫', {
  userId,
  boostPackageId: boostPackage.id,
  amount: requiredAmount,
  purchaseId: purchase?.id
});
```

---

## 6. ‚úÖ TypeScript —Ç–∏–ø–∏–∑–∞—Ü–∏—è - –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê

### –ù–æ–≤—ã–µ —Ç–∏–ø—ã –≤ `modules/boost/types.ts`:

```typescript
export interface BoostPurchaseData {
  id: string;
  user_id: string;
  boost_id: string;
  source: 'wallet' | 'ton';
  tx_hash?: string;
  status: 'pending' | 'confirmed' | 'failed';
  created_at: string;
}

export interface PurchaseBoostRequest {
  user_id: string;
  boost_id: string;
  payment_method: 'wallet' | 'ton';
  tx_hash?: string;
}

export interface PurchaseBoostResponse {
  success: boolean;
  message: string;
  purchase?: BoostPurchaseData;
}
```

---

## 7. ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ú–æ–¥—É–ª–∏ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã:
1. **BoostController**: –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
2. **BoostService**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏
3. **WalletService**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
4. **Supabase**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **Logger**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:
- **Transactions**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–∏–ø–∞ 'boost_purchase'
- **Wallet**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å processWithdrawal()
- **Auth**: –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Supabase**: –ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

---

## 8. üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–ª–∞—Ç–∞:
```bash
curl -X POST /api/v2/boost/purchase \
  -H "Authorization: Bearer <jwt_token>" \
  -d '{
    "user_id": "test_user_01",
    "boost_id": "1",
    "payment_method": "wallet"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "data": {
    "purchase": {
      "id": "uuid",
      "status": "confirmed"
    },
    "message": "Boost \"Starter Boost\" —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω"
  }
}
```

### –í–Ω–µ—à–Ω—è—è –æ–ø–ª–∞—Ç–∞:
```bash
curl -X POST /api/v2/boost/purchase \
  -H "Authorization: Bearer <jwt_token>" \
  -d '{
    "user_id": "test_user_01", 
    "boost_id": "2",
    "payment_method": "ton",
    "tx_hash": "abc123def456"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "data": {
    "purchase": {
      "id": "uuid",
      "status": "pending"
    },
    "message": "–ü–ª–∞—Ç–µ–∂ –ø—Ä–∏–Ω—è—Ç. Boost –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ"
  }
}
```

---

## 9. ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¢–ó

### –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ–º –ø—É–Ω–∫—Ç–∞–º:

1. **‚úÖ Endpoint –ø–æ–∫—É–ø–∫–∏**: POST /api/v2/boost/purchase —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
2. **‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–ª–∞—Ç–∞**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞, —Å–ø–∏—Å–∞–Ω–∏–µ, –∞–∫—Ç–∏–≤–∞—Ü–∏—è
3. **‚úÖ –í–Ω–µ—à–Ω—è—è –æ–ø–ª–∞—Ç–∞**: tx_hash, pending —Å—Ç–∞—Ç—É—Å, –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
4. **‚úÖ –¢–∞–±–ª–∏—Ü–∞ boost_purchases**: –°–æ–∑–¥–∞–Ω–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏
5. **‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: logger.info/error –≤–æ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
6. **‚úÖ TypeScript**: –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
7. **‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: test_user_01 –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## 10. üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–°–ò–°–¢–ï–ú–ê –ü–û–ö–£–ü–ö–ò BOOST-–ü–ê–ö–ï–¢–û–í –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê**

### –ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- Backend API endpoint
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–∫—É–ø–∫–∏  
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö integration
- –¢–∏–ø–∏–∑–∞—Ü–∏—è TypeScript
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Frontend —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º frontend —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API endpoint `/api/v2/boost/purchase` –≤–º–µ—Å—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ `/api/v2/ton-farming/purchase`.

### Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:
–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–≤—É—Ö —Ç–∏–ø–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.

---

*–†–µ–∞–ª–∏–∑–∞—Ü–∏—è T51 –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 16 –∏—é–Ω—è 2025*  
*–°—Ç–∞—Ç—É—Å: –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ*