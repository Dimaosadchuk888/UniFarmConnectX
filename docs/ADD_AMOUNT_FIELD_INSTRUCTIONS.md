# Инструкция по добавлению поля amount в таблицу transactions

## Шаги для выполнения:

1. **Откройте Supabase Dashboard**
   - Перейдите в ваш проект UniFarm в Supabase

2. **Перейдите в SQL Editor**
   - В левом меню выберите "SQL Editor"

3. **Выполните SQL скрипт**
   - Скопируйте содержимое файла `scripts/add-amount-field-to-transactions.sql`
   - Вставьте в редактор SQL
   - Нажмите кнопку "RUN" или Ctrl+Enter

4. **Проверьте результат**
   - После выполнения скрипта вы увидите результат проверки
   - Должна появиться строка с информацией о новом поле `amount`

## Что делает скрипт:

1. **Добавляет поле `amount`**
   - Тип: NUMERIC(20, 9) - для точных финансовых расчетов
   - Обязательное поле (NOT NULL)
   - Значение по умолчанию: 0

2. **Создает индекс**
   - Для оптимизации запросов по сумме транзакций

3. **Добавляет описание поля**
   - Документирует назначение поля в базе данных

## Важно:

- Поле `amount` будет содержать общую сумму транзакции
- Валюта указывается в поле `currency` (UNI или TON)
- Существующие записи получат значение 0 по умолчанию
- После добавления поля система будет использовать его для всех новых транзакций

## После выполнения:

1. Убедитесь, что скрипт выполнен успешно
2. Проверьте структуру таблицы в Table Editor
3. Поле `amount` должно появиться в списке колонок

## Миграция существующих данных:

После добавления поля `amount` необходимо выполнить миграцию данных:

1. **Выполните скрипт миграции**
   - Скопируйте содержимое файла `scripts/migrate-amount-field-data.sql`
   - Вставьте в SQL Editor
   - Нажмите "RUN"

2. **Что делает скрипт миграции:**
   - Заполняет поле `amount` на основе существующих `amount_uni` и `amount_ton`
   - Устанавливает правильную валюту для транзакций
   - Показывает статистику миграции
   - Выводит транзакции, которые могут требовать ручной проверки

3. **Проверка результатов:**
   - Скрипт покажет количество обновленных записей по каждой валюте
   - Средние и максимальные суммы транзакций
   - Список транзакций без суммы (если такие есть)

✅ После выполнения этих шагов поле `amount` будет добавлено в таблицу `transactions`, заполнено существующими данными и готово к использованию системой!