# T53 –ê–£–î–ò–¢ –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ô UNI/TON –í–ê–õ–Æ–¢ - –û–¢–ß–ï–¢

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú

–ü—Ä–æ–≤–µ–¥–µ–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è UNI –∏ TON —Ç–æ–∫–µ–Ω–æ–≤. –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–æ–±–ª—é–¥–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞ –ø–æ –ø—É–Ω–∫—Ç–∞–º –¢–ó:

### 1. üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ Boost –∑–∞ UNI: ‚úÖ –°–û–ë–õ–Æ–î–ï–ù–û

**–§–∞–π–ª**: `modules/boost/controller.ts:199`
```typescript
if (!['wallet', 'ton'].includes(payment_method)) {
  return this.sendError(res, '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π payment_method. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "wallet" –∏–ª–∏ "ton"', 400);
}
```

**–§–∞–π–ª**: `modules/boost/types.ts:66`
```typescript
export interface PurchaseBoostRequest {
  payment_method: 'wallet' | 'ton'; // UNI –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ TypeScript —Ç–∏–ø–æ–≤
}
```

**‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞**: API –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è payment_method: 'uni' —Å –æ—à–∏–±–∫–æ–π 400.

### 2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UNI —Ç–æ–ª—å–∫–æ –≤ UNI Farming: ‚úÖ –°–û–ë–õ–Æ–î–ï–ù–û

**UNI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤**:
- **API**: `/api/v2/uni-farming/deposit` —á–µ—Ä–µ–∑ `modules/farming/controller.ts:depositUni`
- **–ú–µ—Ç–æ–¥**: `FarmingService.depositUniForFarming()` –≤ `modules/farming/service.ts:132`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ UNI**:
```typescript
const currentBalance = parseFloat(user.balance_uni || '0');
if (currentBalance < depositAmount) {
  return { success: false, message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' };
}
```

**‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**: UNI —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ wallet.balance_uni

### 3. üö´ –ó–∞–ø—Ä–µ—Ç TON Connect –¥–ª—è UNI: ‚úÖ –°–û–ë–õ–Æ–î–ï–ù–û

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ UNI farming**:
- –ù–∏–∫–∞–∫–∏—Ö –≤—ã–∑–æ–≤–æ–≤ TON Connect API
- –ù–∏–∫–∞–∫–∏—Ö tx_hash –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è UNI –æ–ø–µ—Ä–∞—Ü–∏–π  
- –ù–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è UNI

**UNI —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ**:
```typescript
await supabase.from(FARMING_TABLES.TRANSACTIONS).insert({
  user_id: user.id,
  type: 'UNI_DEPOSIT',
  amount_uni: depositAmount,
  description: `UNI farming deposit: ${amount}`
});
```

### 4. üíæ –¢–∞–±–ª–∏—Ü—ã Supabase: ‚úÖ –°–û–û–¢–í–ï–¢–°–¢–í–£–Æ–¢

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
- `'UNI_DEPOSIT'` - –¥–µ–ø–æ–∑–∏—Ç UNI –≤ —Ñ–∞—Ä–º–∏–Ω–≥
- `'UNI_HARVEST'` - —Å–±–æ—Ä —É—Ä–æ–∂–∞—è UNI  
- `'UNI_REWARD'` - –Ω–∞–≥—Ä–∞–¥—ã UNI

**–ü–æ–ª—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**:
- `balance_uni` - –±–∞–ª–∞–Ω—Å UNI —Ç–æ–∫–µ–Ω–æ–≤
- `balance_ton` - –±–∞–ª–∞–Ω—Å TON —Ç–æ–∫–µ–Ω–æ–≤
- `uni_deposit_amount` - —Å—É–º–º–∞ UNI –≤ —Ñ–∞—Ä–º–∏–Ω–≥–µ

### 5. üîÑ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ API —É—Ä–æ–≤–Ω–µ: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê

**API `/api/v2/boost/purchase` –±–ª–æ–∫–∏—Ä—É–µ—Ç UNI**:
- TypeScript —Ç–∏–ø—ã –∏—Å–∫–ª—é—á–∞—é—Ç 'uni' –∏–∑ payment_method
- Controller –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –ª—é–±—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫—Ä–æ–º–µ 'wallet'/'ton'
- Service –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ TON –±–∞–ª–∞–Ω—Å –¥–ª—è –ø–æ–∫—É–ø–æ–∫

**–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ UNI**:
```json
{
  "success": false,
  "error": "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π payment_method. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ \"wallet\" –∏–ª–∏ \"ton\""
}
```

---

## üìÅ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏:

### ‚úÖ boost/ - –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫—É–ø–∫–∏ Boost
- **controller.ts**: –í–∞–ª–∏–¥–∞—Ü–∏—è payment_method –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ 'wallet'/'ton'
- **service.ts**: purchaseWithInternalWallet –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ ton_balance
- **types.ts**: TypeScript —Ç–∏–ø—ã –∏—Å–∫–ª—é—á–∞—é—Ç 'uni' –∏–∑ payment_method

### ‚úÖ farming/ - UNI Farming —Å–∏—Å—Ç–µ–º–∞  
- **controller.ts**: depositUni –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ UNI —Ç–æ–∫–µ–Ω—ã
- **service.ts**: depositUniForFarming —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å balance_uni
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –ù–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å

### ‚úÖ wallet/ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏
- **service.ts**: processWithdrawal –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ 'UNI'/'TON' —Ç–∏–ø—ã
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: balance_uni –∏ balance_ton —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: currency –ø–æ–ª–µ —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç UNI/TON –æ–ø–µ—Ä–∞—Ü–∏–∏

---

## üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### 1. **TypeScript —É—Ä–æ–≤–µ–Ω—å**
```typescript
payment_method: 'wallet' | 'ton' // UNI –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ union —Ç–∏–ø–∞
```

### 2. **Runtime –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```typescript
if (!['wallet', 'ton'].includes(payment_method)) {
  return this.sendError(res, '–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π payment_method...', 400);
}
```

### 3. **–õ–æ–≥–∏–∫–∞ Boost —Å–µ—Ä–≤–∏—Å–∞**
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ TON –±–∞–ª–∞–Ω—Å
if (walletData.ton_balance < requiredAmount) {
  return { success: false, message: `–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤...` };
}
```

### 4. **UNI Farming –∏–∑–æ–ª—è—Ü–∏—è**  
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ UNI –±–∞–ª–∞–Ω—Å
const currentBalance = parseFloat(user.balance_uni || '0');
if (currentBalance < depositAmount) {
  return { success: false, message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤' };
}
```

---

## üî¨ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

### ‚ùå –ü–æ–ø—ã—Ç–∫–∞ –∫—É–ø–∏—Ç—å Boost –∑–∞ UNI:
```bash
curl -X POST /api/v2/boost/purchase \
  -H "Authorization: Bearer <jwt>" \
  -d '{
    "user_id": "test_user",
    "boost_id": "1", 
    "payment_method": "uni"
  }'
```
**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –û—à–∏–±–∫–∞ 400 "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π payment_method"

### ‚úÖ UNI Farming –¥–µ–ø–æ–∑–∏—Ç:
```bash
curl -X POST /api/v2/uni-farming/deposit \
  -H "Authorization: Bearer <jwt>" \
  -d '{
    "amount": "10"
  }'
```
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –°–ø–∏—Å–∞–Ω–∏–µ —Å balance_uni, —Å–æ–∑–¥–∞–Ω–∏–µ UNI_DEPOSIT —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### ‚úÖ Boost –ø–æ–∫—É–ø–∫–∞ –∑–∞ TON:
```bash
curl -X POST /api/v2/boost/purchase \
  -H "Authorization: Bearer <jwt>" \
  -d '{
    "user_id": "test_user",
    "boost_id": "1",
    "payment_method": "wallet"
  }'
```
**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –°–ø–∏—Å–∞–Ω–∏–µ —Å balance_ton —á–µ—Ä–µ–∑ WalletService

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç:

```
UNI –¢–û–ö–ï–ù–´:
‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫: balance_uni (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å)
‚îú‚îÄ‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –¢–û–õ–¨–ö–û UNI Farming
‚îú‚îÄ‚îÄ API: /api/v2/uni-farming/deposit
‚îú‚îÄ‚îÄ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: UNI_DEPOSIT, UNI_HARVEST, UNI_REWARD  
‚îî‚îÄ‚îÄ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –ù–ï–¢ –≤–Ω–µ—à–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π, –ù–ï–¢ TON Connect

TON –¢–û–ö–ï–ù–´:  
‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫: balance_ton (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π) + –≤–Ω–µ—à–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∏
‚îú‚îÄ‚îÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: Boost –ø–æ–∫—É–ø–∫–∏, TON —Ñ–∞—Ä–º–∏–Ω–≥
‚îú‚îÄ‚îÄ API: /api/v2/boost/purchase, /api/v2/ton-farming/*
‚îú‚îÄ‚îÄ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: boost_purchase, ton_farming_*
‚îî‚îÄ‚îÄ –ü–æ–¥–¥–µ—Ä–∂–∫–∞: TON Connect –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π
```

---

## üéØ –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### ‚úÖ –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó —Å–æ–±–ª—é–¥–µ–Ω—ã:
1. **‚ùå Boost –∑–∞ UNI**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
2. **‚úÖ UNI —Ç–æ–ª—å–∫–æ –≤ —Ñ–∞—Ä–º–∏–Ω–≥–µ**: –°—Ç—Ä–æ–≥–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –≤ farming –º–æ–¥—É–ª–µ  
3. **üö´ TON Connect –¥–ª—è UNI**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
4. **üíæ Supabase —Å—Ö–µ–º–∞**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–µ–±—É–µ–º—ã–µ —Ç–∏–ø—ã –∏ –ø–æ–ª—è
5. **üîÑ API –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üîß –¢–æ—á–µ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

#### 1. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ middleware (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è):
```typescript
// modules/boost/routes.ts
const validateBoostPayment = (req, res, next) => {
  if (req.body.payment_method === 'uni') {
    return res.status(400).json({
      success: false, 
      error: 'INVALID_PAYMENT_METHOD: UNI –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è Boost'
    });
  }
  next();
};

router.post('/purchase', requireTelegramAuth, validateBoostPayment, ...);
```

#### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è):
```typescript
// modules/boost/model.ts  
export const BOOST_PAYMENT_METHODS = {
  ALLOWED: ['wallet', 'ton'] as const,
  BLOCKED: ['uni'] as const
} as const;
```

### üöÄ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: PRODUCTION READY

–°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UNI –∏ TON —Ç–æ–∫–µ–Ω–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ. –í—Å–µ –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç –Ω–∞ TypeScript, runtime –∏ business-logic —É—Ä–æ–≤–Ω—è—Ö.

---

*–ê—É–¥–∏—Ç T53 –∑–∞–≤–µ—Ä—à–µ–Ω: 16 –∏—é–Ω—è 2025*  
*–°—Ç–∞—Ç—É—Å: –í–°–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –°–û–ë–õ–Æ–î–ï–ù–´ –ö–û–†–†–ï–ö–¢–ù–û*