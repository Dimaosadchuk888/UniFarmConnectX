# üìã –ü–û–≠–¢–ê–ü–ù–´–ô –ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ë–î - 100% –¢–û–ß–ù–û–°–¢–¨

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-08-01  
**–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤:** 112,935,565.07  
**–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:** 845,228 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, 103 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

**–í–°–ï –î–ê–ù–ù–´–ï –î–û–õ–ñ–ù–´ –ë–´–¢–¨ –°–û–•–†–ê–ù–ï–ù–´!**
- –ü–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π —Ñ–∞–∑–æ–π - –ø—Ä–æ–≤–µ—Ä–∫–∞
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã - –≤–∞–ª–∏–¥–∞—Ü–∏—è  
- –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ - –æ—Ç–∫–∞—Ç

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï (–ø–æ—Å–ª–µ –∞—É–¥–∏—Ç–∞)

| –¢–∞–±–ª–∏—Ü–∞ | –ó–∞–ø–∏—Å–µ–π | –°—Ç–∞—Ç—É—Å | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |
|---------|---------|--------|-------------------|
| users | 103 | ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è | –ë–∞–ª–∞–Ω—Å—ã, farming –¥–∞–Ω–Ω—ã–µ |
| transactions | 845,228 | ‚ö†Ô∏è –ì–∏–±—Ä–∏–¥–Ω–∞—è | 2 —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö |
| withdraw_requests | 159 | ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | telegram_id, username |
| uni_farming_data | 98 | ‚ùå –î—É–±–ª–∏—Ä—É–µ—Ç users | Farming –±–∞–ª–∞–Ω—Å—ã |
| ton_farming_data | 44 | ‚ùå –î—É–±–ª–∏—Ä—É–µ—Ç users | TON boost –¥–∞–Ω–Ω—ã–µ |
| referrals | 52 | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ–µ –¥—É–±–ª. | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ |
| missions | 5 | ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–∞—è | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏—Å—Å–∏–π |

**–ü—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:**
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 0
- ‚úÖ –í—ã–≤–æ–¥—ã –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 0  
- ‚úÖ Farming –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 0

---

## üîÑ –§–ê–ó–ê 0: –ü–û–î–ì–û–¢–û–í–ö–ê (30 –º–∏–Ω—É—Ç) [CRITICAL]

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
SELECT current_user, current_database();

-- 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
SELECT pg_database_size(current_database());

-- 3. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ—á–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏
SELECT 
  (SELECT COUNT(*) FROM users) as users_count,
  (SELECT COUNT(*) FROM transactions) as tx_count,
  (SELECT SUM(balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) FROM users) as total_balance;
```

### –î–µ–π—Å—Ç–≤–∏—è
1. **–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π backup –ë–î**
   ```bash
   pg_dump -U postgres -d unifarm_production > backup_20250801_$(date +%H%M%S).sql
   ```

2. **–≠–∫—Å–ø–æ—Ä—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ CSV**
   ```sql
   -- –ë–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   COPY (
     SELECT id, telegram_id, username, balance_uni, balance_ton, 
            uni_farming_balance, ton_farming_balance,
            (balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) as total
     FROM users
     ORDER BY total DESC
   ) TO '/tmp/user_balances_backup.csv' CSV HEADER;
   
   -- Farming —Å—Ç–∞—Ç—É—Å—ã
   COPY (
     SELECT id, user_id, deposit_amount, farming_balance, is_active
     FROM uni_farming_data
   ) TO '/tmp/uni_farming_backup.csv' CSV HEADER;
   ```

3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ø-20 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   ```sql
   SELECT 
     id, telegram_id, username,
     balance_uni, balance_ton,
     uni_farming_balance, ton_farming_balance,
     (balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) as total
   FROM users
   ORDER BY total DESC
   LIMIT 20;
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ
- [ ] Backup —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –∏ –Ω–µ –ø—É—Å—Ç–æ–π (—Ä–∞–∑–º–µ—Ä > 100MB)
- [ ] CSV —Ñ–∞–π–ª—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ —Å–¥–µ–ª–∞–Ω—ã
- [ ] –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∞: **112,935,565.07**

---

## üîÑ –§–ê–ó–ê 1: –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø FARMING (15 –º–∏–Ω—É—Ç) [CRITICAL]

### –¶–µ–ª—å
–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –í–°–ï farming –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É users –±–µ–∑ –ø–æ—Ç–µ—Ä—å

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```sql
-- 1. –ù–∞–π—Ç–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ UNI farming
SELECT 
  u.id,
  u.telegram_id,
  u.uni_deposit_amount as user_deposit,
  ufd.deposit_amount as farming_deposit,
  u.uni_farming_balance as user_balance,
  ufd.farming_balance as farming_balance,
  CASE 
    WHEN u.uni_deposit_amount != COALESCE(ufd.deposit_amount, 0) THEN 'DEPOSIT_DIFF'
    WHEN u.uni_farming_balance != COALESCE(ufd.farming_balance, 0) THEN 'BALANCE_DIFF'
    ELSE 'OK'
  END as status
FROM users u
LEFT JOIN uni_farming_data ufd ON u.id = ufd.user_id
WHERE ufd.user_id IS NOT NULL
  AND (u.uni_deposit_amount != ufd.deposit_amount 
       OR u.uni_farming_balance != ufd.farming_balance);

-- 2. –ù–∞–π—Ç–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –≤ TON boost
SELECT 
  u.id,
  u.ton_boost_active,
  tfd.boost_active,
  u.ton_farming_balance,
  tfd.farming_balance
FROM users u
LEFT JOIN ton_farming_data tfd ON u.id = CAST(tfd.user_id AS INTEGER)
WHERE tfd.user_id IS NOT NULL
  AND (u.ton_boost_active != tfd.boost_active
       OR u.ton_farming_balance != tfd.farming_balance);

-- 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É –î–û
SELECT 
  SUM(balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) as checksum_before
FROM users;
```

### –î–µ–π—Å—Ç–≤–∏—è
```sql
-- –ù–ê–ß–ê–¢–¨ –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
BEGIN;

-- 1. –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE archive_uni_farming_data AS 
SELECT *, NOW() as archived_at FROM uni_farming_data;

CREATE TABLE archive_ton_farming_data AS 
SELECT *, NOW() as archived_at FROM ton_farming_data;

-- 2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å UNI farming (—Ç–æ–ª—å–∫–æ –≥–¥–µ –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è)
UPDATE users u
SET 
  uni_deposit_amount = GREATEST(u.uni_deposit_amount, COALESCE(ufd.deposit_amount, 0)),
  uni_farming_balance = GREATEST(u.uni_farming_balance, COALESCE(ufd.farming_balance, 0)),
  uni_farming_rate = CASE 
    WHEN ufd.farming_rate > 0 THEN ufd.farming_rate 
    ELSE COALESCE(u.uni_farming_rate, 0.01)
  END,
  uni_farming_active = u.uni_farming_active OR COALESCE(ufd.is_active, false),
  uni_farming_start_timestamp = COALESCE(u.uni_farming_start_timestamp, ufd.farming_start_timestamp),
  uni_farming_last_update = GREATEST(u.uni_farming_last_update, ufd.farming_last_update)
FROM uni_farming_data ufd
WHERE u.id = ufd.user_id;

-- 3. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å TON boost
UPDATE users u
SET 
  ton_boost_active = u.ton_boost_active OR COALESCE(tfd.boost_active, false),
  ton_boost_package_id = COALESCE(u.ton_boost_package_id, tfd.boost_package_id),
  ton_boost_rate = GREATEST(u.ton_boost_rate, COALESCE(tfd.farming_rate, 0)),
  ton_farming_balance = GREATEST(u.ton_farming_balance, COALESCE(tfd.farming_balance, 0)),
  ton_farming_start_timestamp = COALESCE(u.ton_farming_start_timestamp, tfd.farming_start_timestamp),
  ton_farming_last_update = GREATEST(u.ton_farming_last_update, tfd.farming_last_update)
FROM ton_farming_data tfd
WHERE u.id = CAST(tfd.user_id AS INTEGER);

-- –ü–†–û–í–ï–†–ò–¢–¨ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT 
  SUM(balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) as checksum_after
FROM users;

-- –ï—Å–ª–∏ –≤—Å—ë –û–ö - –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å
COMMIT;
-- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã - –æ—Ç–∫–∞—Ç–∏—Ç—å
-- ROLLBACK;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ
```sql
-- 1. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å
SELECT 
  SUM(balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) as checksum
FROM users;
-- –î–û–õ–ñ–ù–û –ë–´–¢–¨: 112,935,565.07

-- 2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–µ—Ä–º–µ—Ä–æ–≤
SELECT 
  COUNT(*) FILTER (WHERE uni_farming_active) as uni_farmers,
  COUNT(*) FILTER (WHERE ton_boost_active) as ton_boosters
FROM users;

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ API
-- GET /api/v2/uni-farming/status?user_id=1
-- GET /api/v2/ton-boost/status?user_id=1
```

---

## üîÑ –§–ê–ó–ê 2: –û–ß–ò–°–¢–ö–ê WITHDRAW_REQUESTS (10 –º–∏–Ω—É—Ç) [HIGH]

### –¶–µ–ª—å
–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø–æ–ª—è telegram_id –∏ username

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```sql
-- 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
SELECT 
  wr.id,
  wr.telegram_id = u.telegram_id as telegram_match,
  wr.username = u.username as username_match
FROM withdraw_requests wr
JOIN users u ON wr.user_id = u.id
WHERE wr.telegram_id != u.telegram_id 
   OR wr.username != u.username;

-- 2. –ù–∞–π—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏
SELECT COUNT(*) as pending_count
FROM withdraw_requests
WHERE status = 'pending';
```

### –î–µ–π—Å—Ç–≤–∏—è
```sql
BEGIN;

-- 1. –°–æ–∑–¥–∞—Ç—å VIEW –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
CREATE OR REPLACE VIEW withdraw_requests_full AS
SELECT 
  wr.id,
  wr.user_id,
  wr.amount_ton,
  wr.ton_wallet,
  wr.status,
  wr.created_at,
  wr.processed_at,
  wr.processed_by,
  u.telegram_id,
  u.username,
  u.first_name,
  u.balance_ton as current_balance
FROM withdraw_requests wr
JOIN users u ON wr.user_id = u.id;

-- 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ VIEW —Ä–∞–±–æ—Ç–∞–µ—Ç
SELECT * FROM withdraw_requests_full LIMIT 5;

-- 3. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø–æ–ª—è
ALTER TABLE withdraw_requests 
DROP COLUMN telegram_id CASCADE,
DROP COLUMN username CASCADE;

COMMIT;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ
- [ ] VIEW –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—ã–≤–æ–¥–æ–≤
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã–≤–æ–¥

---

## üîÑ –§–ê–ó–ê 3: –£–ù–ò–§–ò–ö–ê–¶–ò–Ø TRANSACTIONS (20 –º–∏–Ω—É—Ç) [HIGH]

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```sql
-- –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º–∞—Ç–æ–≤
SELECT 
  COUNT(*) FILTER (WHERE currency IS NOT NULL) as new_format,
  COUNT(*) FILTER (WHERE currency IS NULL AND (amount_uni > 0 OR amount_ton > 0)) as old_format,
  COUNT(*) FILTER (WHERE currency IS NOT NULL AND (amount_uni > 0 OR amount_ton > 0)) as hybrid
FROM transactions;
```

### –î–µ–π—Å—Ç–≤–∏—è
```sql
BEGIN;

-- 1. –î–æ–±–∞–≤–∏—Ç—å –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è
ALTER TABLE transactions
ADD COLUMN IF NOT EXISTS unified_amount DECIMAL(20,6) 
GENERATED ALWAYS AS (COALESCE(amount, amount_uni + amount_ton)) STORED;

ALTER TABLE transactions
ADD COLUMN IF NOT EXISTS unified_currency VARCHAR(10)
GENERATED ALWAYS AS (
  COALESCE(
    currency,
    CASE 
      WHEN amount_ton > 0 THEN 'TON'
      WHEN amount_uni > 0 THEN 'UNI'
      ELSE 'UNKNOWN'
    END
  )
) STORED;

-- 2. –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_transactions_unified 
ON transactions(user_id, unified_currency, created_at DESC);

-- 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
SELECT 
  id, type, 
  amount_uni, amount_ton, amount, currency,
  unified_amount, unified_currency
FROM transactions 
LIMIT 20;

COMMIT;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ
- [ ] –°—É–º–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–æ–≤–ø–∞–¥–∞—é—Ç –≤ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üîÑ –§–ê–ó–ê 4: –ò–ù–î–ï–ö–°–´ (10 –º–∏–Ω—É—Ç) [MEDIUM]

### –î–µ–π—Å—Ç–≤–∏—è
```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è users
CREATE INDEX IF NOT EXISTS idx_users_telegram_id ON users(telegram_id);
CREATE INDEX IF NOT EXISTS idx_users_balance_uni ON users(balance_uni) WHERE balance_uni > 0;
CREATE INDEX IF NOT EXISTS idx_users_balance_ton ON users(balance_ton) WHERE balance_ton > 0;
CREATE INDEX IF NOT EXISTS idx_users_farming_active ON users(uni_farming_active) WHERE uni_farming_active = true;
CREATE INDEX IF NOT EXISTS idx_users_referred_by ON users(referred_by) WHERE referred_by IS NOT NULL;

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è transactions
CREATE INDEX IF NOT EXISTS idx_transactions_user_created ON transactions(user_id, created_at DESC);
CREATE INDEX IF NOT EXISTS idx_transactions_type ON transactions(type, created_at DESC);

-- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
ANALYZE users;
ANALYZE transactions;
```

---

## üîÑ –§–ê–ó–ê 5: –£–î–ê–õ–ï–ù–ò–ï –¢–ê–ë–õ–ò–¶ (5 –º–∏–Ω—É—Ç) [LOW]

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç 24+ —á–∞—Å–∞ –±–µ–∑ farming —Ç–∞–±–ª–∏—Ü
- [ ] –ê—Ä—Ö–∏–≤—ã —Å–æ–∑–¥–∞–Ω—ã (archive_uni_farming_data, archive_ton_farming_data)
- [ ] –ö–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### –î–µ–π—Å—Ç–≤–∏—è
```sql
-- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
DROP TABLE IF EXISTS uni_farming_data CASCADE;
DROP TABLE IF EXISTS ton_farming_data CASCADE;
DROP TABLE IF EXISTS user_sessions CASCADE;
```

---

## üîÑ –§–ê–ó–ê 6: –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–û–î–ê [CRITICAL]

### –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. **server/repositories/UniFarmingRepository.ts**
   - –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `uni_farming_data`
   - –ß–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ `users`

2. **server/repositories/TonFarmingRepository.ts**
   - –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ `ton_farming_data`
   - –ß–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ `users`

3. **server/controllers/WithdrawController.ts**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `withdraw_requests_full` VIEW

4. **shared/schema.ts**
   - –£–¥–∞–ª–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü
   - –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è VIEW

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

### SQL —Ç–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```sql
-- 1. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤
SELECT SUM(balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) as total
FROM users;
-- –î–û–õ–ñ–ù–û –ë–´–¢–¨: 112,935,565.07

-- 2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT 
  (SELECT COUNT(*) FROM users) as users,
  (SELECT COUNT(*) FROM transactions) as transactions,
  (SELECT COUNT(*) FROM withdraw_requests) as withdrawals;

-- 3. –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
SELECT 
  COUNT(*) FILTER (WHERE uni_farming_active) as uni_farmers,
  COUNT(*) FILTER (WHERE ton_boost_active) as ton_boosters,
  COUNT(*) FILTER (WHERE referred_by IS NOT NULL) as referrals
FROM users;
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- [ ] Claim UNI farming
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è TON boost
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## üö® –ü–õ–ê–ù –û–¢–ö–ê–¢–ê

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup:**
   ```bash
   psql -U postgres -d unifarm_production < backup_20250801_HHMMSS.sql
   ```
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   ```sql
   SELECT SUM(balance_uni + balance_ton + uni_farming_balance + ton_farming_balance) FROM users;
   ```
4. **–£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É**

---

## üìù –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –õ–ò–°–¢

- [ ] –§–∞–∑–∞ 0: Backup —Å–æ–∑–¥–∞–Ω
- [ ] –§–∞–∑–∞ 1: Farming —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω
- [ ] –§–∞–∑–∞ 2: withdraw_requests –æ—á–∏—â–µ–Ω
- [ ] –§–∞–∑–∞ 3: transactions —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- [ ] –§–∞–∑–∞ 4: –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –§–∞–∑–∞ 5: –°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã
- [ ] –§–∞–∑–∞ 6: –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω
- [ ] –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~3 —á–∞—Å–∞ —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ü–û–ú–ù–ò–¢–ï: –õ—É—á—à–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á–µ–º –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ!**