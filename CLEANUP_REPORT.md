# üìÑ –û–¢–ß–Å–¢: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫ –∏–∑ server/index.ts

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ

### 1. –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ `/api/user/current`
**–£–¥–∞–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```typescript
app.get('/api/user/current', async (req: any, res: any) => {
  try {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤–æ–≥–æ –≥–æ—Å—Ç–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userData = {
      id: 1,
      guest_id: 'guest_' + Date.now(),
      balance_uni: '0',
      balance_ton: '0',
      uni_farming_balance: '0',
      uni_farming_rate: '0',
      uni_deposit_amount: '0'
    };

    res.json({
      success: true,
      data: userData
    });
  } catch (error: any) {
    res.status(500).json({
      success: false,
      error: error.message || 'Internal server error'
    });
  }
});
```

### 2. –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ `/api/missions`
**–£–¥–∞–ª–µ–Ω–Ω—ã–π –∫–æ–¥:**
```typescript
app.get('/api/missions', async (req: any, res: any) => {
  try {
    const missionsList = await db.select().from(missions).orderBy(missions.id);
    
    res.json({
      success: true,
      data: missionsList
    });
  } catch (error: any) {
    res.status(500).json({
      success: false,
      error: error.message || 'Internal server error'
    });
  }
});
```

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º

### 1. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –§–∞–π–ª `modules/user/controller.ts` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ú–µ—Ç–æ–¥ `getCurrentUser()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç `/api/v2/users/profile` –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `modules/user/routes.ts`
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –±–∞–ª–∞–Ω—Å–∞–º–∏

### 2. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –º–∏—Å—Å–∏–π
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –§–∞–π–ª `modules/missions/controller.ts` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –ú–µ—Ç–æ–¥ `getActiveMissions()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç `/api/v2/missions/` –ø–æ–¥–∫–ª—é—á–µ–Ω –≤ `modules/missions/routes.ts`
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
```
üöÄ Starting UniFarm Unified Server...
üìã Using server/index.ts as the single entry point
[2025-06-12T17:02:47.190Z] [INFO] [WebSocket] –°–µ—Ä–≤–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ø—É—Ç–∏ /ws
[2025-06-12T17:02:47.194Z] [INFO] ‚úÖ UniFarm —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω
[2025-06-12T17:02:47.197Z] [INFO] üöÄ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://0.0.0.0:3000
[2025-06-12T17:02:47.197Z] [INFO] üì° API –¥–æ—Å—Ç—É–ø–µ–Ω: http://0.0.0.0:3000/api/v2/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–≥–ª—É—à–µ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ WebSocket —Å–µ—Ä–≤–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- ‚úÖ API –º–∞—Ä—à—Ä—É—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ `server/routes.ts`
- ‚úÖ –ú–æ–¥—É–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö connection pool –∞–∫—Ç–∏–≤–µ–Ω

## ‚ö†Ô∏è –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º

### 1. –î—Ä—É–≥–∏–µ v2 endpoints –≤ server/index.ts
**–û—Å—Ç–∞–≤–ª–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- `/api/v2/users/profile` - –¥—É–±–ª–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –Ω–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è backward compatibility
- `/api/v2/daily-bonus/status` - –Ω–µ –∏–º–µ–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –º–æ–¥—É–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
- –î—Ä—É–≥–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ endpoints –≤ —Ä–∞–∑–¥–µ–ª–µ "Add missing v2 endpoints"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –±—ã–ª–æ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è —É–¥–∞–ª—è—Ç—å —ç—Ç–∏ –º–∞—Ä—à—Ä—É—Ç—ã, –∏ –æ–Ω–∏ –º–æ–≥—É—Ç —Å–ª—É–∂–∏—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints
**–û—Å—Ç–∞–≤–ª–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- `/api/v2/farming/data` - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `/api/v2/transactions` - –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

‚úÖ **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ `/api/user/current` –∏ `/api/missions` —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω—ã**
‚úÖ **–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∫–∞–∫ —Ä–∞–±–æ—á–∏–µ**
‚úÖ **–°–µ—Ä–≤–µ—Ä —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏**
‚úÖ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ**

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫.