# Отчет: Проблема с созданием транзакций при депозитах фарминга
Дата: 11 января 2025

## Проблема
Реальные депозиты UNI фарминга НЕ создают транзакции в базе данных, хотя баланс списывается корректно.

## Результаты исследования

### 1. Прямое создание транзакций - ✅ РАБОТАЕТ
```
ID 599235 | 999.999 UNI | FARMING_DEPOSIT - создана через прямой SQL
ID 599234 | 100 UNI | FARMING_DEPOSIT - тестовая транзакция
```

### 2. Структура БД - ✅ КОРРЕКТНАЯ
- Тип FARMING_DEPOSIT существует в enum
- Поля amount и currency добавлены и работают
- Транзакции создаются без ошибок

### 3. Код создания транзакций - ✅ ОБНОВЛЕН
В modules/farming/service.ts добавлено:
- Детальное логирование на всех этапах
- Поля amount и currency в payload
- console.log для отладки

### 4. Проблема - ❌ КОД НЕ ВЫПОЛНЯЕТСЯ
При реальных депозитах через UI:
- Баланс уменьшается (422,236 → 362,237 UNI)
- Депозит увеличивается корректно
- НО транзакции НЕ создаются

## Вероятные причины

1. **Код создания транзакций не достигается**
   - Возможно, есть ранний return или throw
   - Условная логика пропускает блок создания

2. **Другой путь выполнения**
   - Может быть альтернативный метод депозита
   - Обход основного метода depositUniForFarming

3. **Ошибка без логирования**
   - Silent failure в try/catch блоке
   - Подавление ошибок где-то выше по стеку

## Следующие шаги

1. Проверить workflow logs при реальном депозите
2. Добавить логирование в самое начало метода depositUniForFarming
3. Проверить альтернативные пути депозита (directDeposit и т.д.)
4. Убедиться что сервер перезапущен с новым кодом

## Критическое замечание
Система фарминга РАБОТАЕТ (балансы обновляются), но история транзакций НЕ ведется, что критично для прозрачности и аудита.