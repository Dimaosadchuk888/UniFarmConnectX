# üîç –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –û–¢–ß–ï–¢ –ü–û –£–ù–ò–§–ò–ö–ê–¶–ò–ò –ê–ö–ö–ê–£–ù–¢–û–í

**–î–∞—Ç–∞**: 31.07.2025  
**–≠—Ç–∞–ª–æ–Ω**: User ID 25 (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –∞–∫–∫–∞—É–Ω—Ç)  
**–¶–µ–ª—å**: –í—ã—è–≤–∏—Ç—å –≤—Å–µ –ø—Ä–∏—á–∏–Ω—ã —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É

## üìä –ê–ù–ê–õ–ò–ó –≠–¢–ê–õ–û–ù–ù–û–ì–û –ê–ö–ö–ê–£–ù–¢–ê (User ID 25)

### –ò–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ replit.md –≤—ã—è–≤–ª–µ–Ω–æ:
- **–í—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: 583 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å 12:00 –æ–¥–Ω–æ–≥–æ –¥–Ω—è (–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ REFERRAL_REWARD)
- **–ü—Ä–æ–±–ª–µ–º—ã —Å –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏**: 3 TON –¥–µ–ø–æ–∑–∏—Ç –∏—Å—á–µ–∑ –ø–æ—Å–ª–µ blockchain –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è  
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∞–Ω–æ–º–∞–ª–∏—è**: 5.564 TON user balance vs 54 TON farming balance (872% —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ)
- **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏**: –ü–æ–ª—É—á–∏–ª –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é 3 TON –∑–∞ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç
- **–°–∏—Å—Ç–µ–º–Ω–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ User ID 25 (–∏–¥–µ–∞–ª—å–Ω–∞—è):
```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ users
users {
  id: 25,
  telegram_id: [–£–ù–ò–ö–ê–õ–¨–ù–´–ô],
  username: "DimaOsadchuk",
  first_name: [–ó–ê–ü–û–õ–ù–ï–ù–û],
  balance_uni: [>0],
  balance_ton: [>0],
  ref_code: [–£–ù–ò–ö–ê–õ–¨–ù–´–ô_–ö–û–î],
  parent_ref_code: [–ú–û–ñ–ï–¢_–ë–´–¢–¨_NULL],
  referred_by: [–ú–û–ñ–ï–¢_–ë–´–¢–¨_NULL],
  uni_farming_active: true/false,
  ton_boost_active: true/false,
  ton_boost_package: [–ú–û–ñ–ï–¢_–ë–´–¢–¨_NULL],
  ton_boost_rate: [–ú–û–ñ–ï–¢_–ë–´–¢–¨_NULL],
  ton_wallet_address: [–ú–û–ñ–ï–¢_–ë–´–¢–¨_NULL],
  created_at: [–î–ê–¢–ê_–°–û–ó–î–ê–ù–ò–Ø]
}

-- –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞)
transactions: –ú–ù–û–ñ–ï–°–¢–í–û –∑–∞–ø–∏—Å–µ–π
ton_farming_data: –ï–°–¢–¨ –ø—Ä–∏ ton_boost_active=true  
user_sessions: –ê–ö–¢–ò–í–ù–´–ï —Å–µ—Å—Å–∏–∏
daily_bonus_claims: –ò–°–¢–û–†–ò–Ø –±–æ–Ω—É—Å–æ–≤
referrals: –ú–û–ñ–ï–¢ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
```

## üö® –í–´–Ø–í–õ–ï–ù–ù–´–ï –†–ê–ó–õ–ò–ß–ò–Ø –ú–ï–ñ–î–£ –ê–ö–ö–ê–£–ù–¢–ê–ú–ò

### 1. **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã**

| –ü–æ–ª–µ | –ü—Ä–æ–±–ª–µ–º–∞ | –í–ª–∏—è–Ω–∏–µ |
|------|----------|---------|
| `telegram_id` | NULL –∏–ª–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã | –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `ref_code` | NULL –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ | –ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã |
| `balance_uni` | NULL –∏–ª–∏ "0" | –ù—É–ª–µ–≤—ã–µ –±–∞–ª–∞–Ω—Å—ã |  
| `balance_ton` | NULL –∏–ª–∏ "0" | –ù–µ—Ç TON —Å—Ä–µ–¥—Å—Ç–≤ |
| `username` | NULL | –ü—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º |
| `first_name` | NULL | –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü**

| –¢–∞–±–ª–∏—Ü–∞ | –ü—Ä–æ–±–ª–µ–º–∞ | –°–∏–º–ø—Ç–æ–º—ã |
|---------|----------|----------|
| `transactions` | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–ø–∏—Å–∏ | –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π |
| `ton_farming_data` | –ù–µ—Ç –ø—Ä–∏ `ton_boost_active=true` | TON Boost –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| `user_sessions` | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç | –ü—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| `daily_bonus_claims` | –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π | –ù–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ |

### 3. **–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è**

| –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–∏—Å–∫ |
|----------------|----------|------|
| TON Boost –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö | `ton_boost_active=true` –Ω–æ –Ω–µ—Ç `ton_farming_data` | –í–∏—Å—è—â–∏–µ —Ñ–ª–∞–≥–∏ |
| –ë–∞–ª–∞–Ω—Å –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –ï—Å—Ç—å –±–∞–ª–∞–Ω—Å, –Ω–æ –Ω–µ—Ç –∑–∞–ø–∏—Å–∏ –æ –µ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–∏ | –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ |
| Farming –±–µ–∑ –¥–µ–ø–æ–∑–∏—Ç–∞ | –ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∞—Ä–º–∏–Ω–≥ –±–µ–∑ –¥–µ–ø–æ–∑–∏—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ | –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ |

## üîß SQL –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–ü–†–û–°–´

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–ø—É—Å–∫–∞–º–∏
SELECT u.id, u.username, u.telegram_id, u.ref_code, u.balance_uni, u.balance_ton,
       CASE 
         WHEN telegram_id IS NULL THEN 'NO_TELEGRAM_ID'
         WHEN ref_code IS NULL OR ref_code = '' THEN 'NO_REF_CODE'
         WHEN balance_uni IS NULL OR balance_uni::numeric = 0 THEN 'ZERO_UNI'
         WHEN balance_ton IS NULL OR balance_ton::numeric = 0 THEN 'ZERO_TON'
         WHEN username IS NULL THEN 'NO_USERNAME'
         WHEN first_name IS NULL THEN 'NO_FIRSTNAME'
         ELSE 'OK'
       END as critical_issue
FROM users u 
WHERE telegram_id IS NULL 
   OR ref_code IS NULL OR ref_code = ''
   OR balance_uni IS NULL OR balance_uni::numeric = 0
   OR balance_ton IS NULL OR balance_ton::numeric = 0
   OR username IS NULL 
   OR first_name IS NULL
ORDER BY u.id;
```

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```sql
-- –ê–∫–∫–∞—É–Ω—Ç—ã –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
SELECT u.id, u.username, u.balance_uni, u.balance_ton, u.created_at,
       'NO_TRANSACTIONS' as issue_type
FROM users u 
LEFT JOIN transactions t ON u.id = t.user_id 
WHERE t.user_id IS NULL 
ORDER BY u.created_at DESC;
```

### 3. –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è TON Boost
```sql
-- TON Boost –∞–∫—Ç–∏–≤–µ–Ω –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞—Ä–º–∏–Ω–≥–∞
SELECT u.id, u.username, u.ton_boost_active, u.ton_boost_package, u.ton_boost_rate,
       'BOOST_WITHOUT_DATA' as issue_type
FROM users u 
LEFT JOIN ton_farming_data tfd ON u.id = tfd.user_id 
WHERE u.ton_boost_active = true AND tfd.user_id IS NULL 
ORDER BY u.id;
```

### 4. –î—É–±–ª–∏–∫–∞—Ç—ã –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
```sql
-- –î—É–±–ª–∏–∫–∞—Ç—ã telegram_id
SELECT telegram_id, COUNT(*) as duplicate_count, 
       STRING_AGG(id::text, ', ') as user_ids
FROM users 
WHERE telegram_id IS NOT NULL
GROUP BY telegram_id 
HAVING COUNT(*) > 1;

-- –î—É–±–ª–∏–∫–∞—Ç—ã ref_code
SELECT ref_code, COUNT(*) as duplicate_count,
       STRING_AGG(id::text, ', ') as user_ids  
FROM users
WHERE ref_code IS NOT NULL AND ref_code != ''
GROUP BY ref_code
HAVING COUNT(*) > 1;
```

## üõ†Ô∏è –ü–õ–ê–ù –ë–ï–ó–û–ü–ê–°–ù–û–ô –£–ù–ò–§–ò–ö–ê–¶–ò–ò

### –≠–¢–ê–ü 1: –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
```sql
-- 1.1 –°–æ–∑–¥–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
CREATE OR REPLACE VIEW account_health_check AS
SELECT 
    u.id,
    u.username,
    u.telegram_id,
    -- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    CASE WHEN telegram_id IS NULL THEN 'CRITICAL' ELSE 'OK' END as telegram_id_status,
    CASE WHEN ref_code IS NULL OR ref_code = '' THEN 'CRITICAL' ELSE 'OK' END as ref_code_status,
    CASE WHEN balance_uni IS NULL OR balance_uni::numeric = 0 THEN 'WARNING' ELSE 'OK' END as uni_balance_status,
    CASE WHEN balance_ton IS NULL OR balance_ton::numeric = 0 THEN 'WARNING' ELSE 'OK' END as ton_balance_status,
    
    -- –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    CASE WHEN t.user_id IS NULL THEN 'MISSING' ELSE 'OK' END as transactions_status,
    CASE WHEN u.ton_boost_active = true AND tfd.user_id IS NULL THEN 'INCONSISTENT' ELSE 'OK' END as ton_farming_status,
    
    -- –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
    CASE 
        WHEN telegram_id IS NULL THEN 'BROKEN'
        WHEN ref_code IS NULL OR ref_code = '' THEN 'BROKEN'
        WHEN t.user_id IS NULL THEN 'ISSUES'
        WHEN u.ton_boost_active = true AND tfd.user_id IS NULL THEN 'ISSUES'
        WHEN balance_uni IS NULL OR balance_uni::numeric = 0 THEN 'WARNINGS'
        ELSE 'GOOD'
    END as overall_status,
    
    u.created_at
FROM users u
LEFT JOIN (SELECT DISTINCT user_id FROM transactions) t ON u.id = t.user_id
LEFT JOIN ton_farming_data tfd ON u.id = tfd.user_id;

-- 1.2 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –∞–∫–∫–∞—É–Ω—Ç–æ–≤
SELECT overall_status, COUNT(*) as count, 
       ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2) as percentage
FROM account_health_check 
GROUP BY overall_status 
ORDER BY count DESC;
```

### –≠–¢–ê–ü 2: –°–û–ó–î–ê–ù–ò–ï BACKUP
```sql
-- 2.1 –ü–æ–ª–Ω—ã–π backup –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
CREATE TABLE users_backup_unification_2025_07_31 AS SELECT * FROM users;
CREATE TABLE transactions_backup_unification_2025_07_31 AS SELECT * FROM transactions;
CREATE TABLE ton_farming_data_backup_unification_2025_07_31 AS SELECT * FROM ton_farming_data;
CREATE TABLE user_sessions_backup_unification_2025_07_31 AS SELECT * FROM user_sessions;

-- 2.2 Backup –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
CREATE TABLE problematic_accounts_before_fix AS
SELECT * FROM account_health_check 
WHERE overall_status IN ('BROKEN', 'ISSUES');
```

### –≠–¢–ê–ü 3: –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø
```sql
BEGIN;

-- 3.1 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π (–ù–ï –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è User ID 25)

-- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ ref_code –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –Ω–µ–≥–æ
UPDATE users 
SET ref_code = 'REF' || LPAD(id::text, 6, '0')
WHERE (ref_code IS NULL OR ref_code = '') 
AND id != 25; -- –ù–ï –¢–†–û–ì–ê–ï–ú –≠–¢–ê–õ–û–ù

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è NULL)
UPDATE users 
SET balance_uni = COALESCE(balance_uni, '0.01'),
    balance_ton = COALESCE(balance_ton, '0.01')
WHERE (balance_uni IS NULL OR balance_ton IS NULL)
AND id != 25; -- –ù–ï –¢–†–û–ì–ê–ï–ú –≠–¢–ê–õ–û–ù

-- 3.2 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π

-- –°–æ–∑–¥–∞–Ω–∏–µ ton_farming_data –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö TON Boost
INSERT INTO ton_farming_data (
    user_id, farming_balance, farming_rate, boost_active, 
    last_update, created_at
)
SELECT 
    u.id, 0.0, 0.0, false, NOW(), NOW()
FROM users u
LEFT JOIN ton_farming_data tfd ON u.id = tfd.user_id
WHERE u.ton_boost_active = true 
AND tfd.user_id IS NULL
AND u.id != 25; -- –ù–ï –¢–†–û–ì–ê–ï–ú –≠–¢–ê–õ–û–ù

-- –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏
INSERT INTO transactions (
    user_id, transaction_type, currency, amount, status, 
    description, created_at, data
)
SELECT 
    u.id, 'SYSTEM_INITIALIZATION', 'UNI', 0.01, 'confirmed',
    'Account unification - system initialization',
    NOW(),
    jsonb_build_object(
        'migration', 'unification_2025_07_31',
        'reason', 'missing_transactions',
        'reference_user', 25
    )
FROM users u
LEFT JOIN transactions t ON u.id = t.user_id
WHERE t.user_id IS NULL
AND u.id != 25; -- –ù–ï –¢–†–û–ì–ê–ï–ú –≠–¢–ê–õ–û–ù

-- 3.3 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
UPDATE users 
SET ton_boost_active = false,
    ton_boost_package = NULL,
    ton_boost_rate = NULL
WHERE id IN (
    SELECT u.id 
    FROM users u 
    LEFT JOIN ton_farming_data tfd ON u.id = tfd.user_id 
    WHERE u.ton_boost_active = true 
    AND (tfd.user_id IS NULL OR tfd.boost_active = false)
)
AND id != 25; -- –ù–ï –¢–†–û–ì–ê–ï–ú –≠–¢–ê–õ–û–ù

-- –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
SELECT '–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã:' as check_result;
SELECT COUNT(*) FROM account_health_check WHERE overall_status = 'BROKEN';

SELECT '–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ - –∞–∫–∫–∞—É–Ω—Ç—ã –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:' as check_result;
SELECT COUNT(*) FROM users u LEFT JOIN transactions t ON u.id = t.user_id WHERE t.user_id IS NULL;

-- COMMIT —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
-- COMMIT;
```

## üéØ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–õ–Ø –ù–û–í–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô

### –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
```typescript
// modules/auth/service.ts - –¥–æ–±–∞–≤–∏—Ç—å –≤ createUser()
async function createUserWithFullInitialization(userData: any) {
    const transaction = await db.transaction();
    
    try {
        // 1. –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = await transaction.insert(users).values({
            telegram_id: userData.telegram_id,
            username: userData.username,
            first_name: userData.first_name,
            ref_code: generateUniqueRefCode(),
            balance_uni: "0.01", // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
            balance_ton: "0.01", // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
            parent_ref_code: userData.parent_ref_code || null,
            created_at: new Date()
        }).returning();
        
        // 2. –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        await transaction.insert(transactions).values({
            user_id: user.id,
            transaction_type: 'SYSTEM_INITIALIZATION',
            currency: 'UNI',
            amount: "0.01",
            status: 'confirmed',
            description: 'Welcome bonus - account initialization',
            created_at: new Date()
        });
        
        // 3. –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è —Ñ–∞—Ä–º–∏–Ω–≥–∞ (–ø–∞—Å—Å–∏–≤–Ω—É—é)
        await transaction.insert(ton_farming_data).values({
            user_id: user.id,
            farming_balance: "0",
            farming_rate: "0",
            boost_active: false,
            created_at: new Date()
        });
        
        await transaction.commit();
        return user;
        
    } catch (error) {
        await transaction.rollback();
        throw error;
    }
}
```

## ‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–ò–ß–ò–ù–´ –†–ê–ó–õ–ò–ß–ò–ô

### 1. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã**
- **–°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**: –°–æ–∑–¥–∞–Ω—ã –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **–í–µ—Ä—Å–∏–∏ —Å–∏—Å—Ç–µ–º—ã**: –†–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–º–µ–ª–∏ —Ä–∞–∑–Ω—É—é –ª–æ–≥–∏–∫—É
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –Ω–µ –≤—Å–µ–≥–¥–∞ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏**
- **–ü—Ä–µ—Ä–≤–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**: –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
- **Race conditions**: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
- **Rollback –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–∫–∞—Ç—ã (—á–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ)

### 3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
- **Frontend –∫–µ—à**: –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–¥–∞
- **JWT —Ç–æ–∫–µ–Ω—ã**: –†–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- **WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: –†–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### 4. **–ü—Ä–æ–±–ª–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
- **TON Connect**: –†–∞–∑–ª–∏—á–∏—è –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–æ–≤
- **Telegram WebApp**: –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ API
- **API endpoints**: –≠–≤–æ–ª—é—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤

## üîç –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ú–û–ù–ò–¢–û–†–ò–ù–ì–£

### 1. **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
```sql
-- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
SELECT * FROM account_health_check 
WHERE overall_status IN ('BROKEN', 'ISSUES')
AND created_at >= CURRENT_DATE - INTERVAL '1 day';
```

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã**
- –ù–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã –±–µ–∑ ref_code
- TON Boost –∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ–∑ ton_farming_data  
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤

### 3. **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö**
- –ü—Ä–æ—Ü–µ–Ω—Ç "–∑–¥–æ—Ä–æ–≤—ã—Ö" –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–π

## üìã –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü—Ä–æ–±–ª–µ–º–∞**: –ê–∫–∫–∞—É–Ω—Ç—ã –∏–º–µ—é—Ç —Ä–∞–∑–ª–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –∏–∑-–∑–∞ —ç–≤–æ–ª—é—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤ –∏ –Ω–µ–ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ—ç—Ç–∞–ø–Ω–∞—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ User ID 25 —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–∞—Ç–∞.

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã –±—É–¥—É—Ç –∏–º–µ—Ç—å –µ–¥–∏–Ω—É—é, –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: User ID 25 –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω, –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏–º—ã —á–µ—Ä–µ–∑ backup —Ç–∞–±–ª–∏—Ü—ã.