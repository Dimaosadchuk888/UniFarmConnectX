# –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –°–ò–°–¢–ï–ú–´

## üîç **–û–ë–ù–ê–†–£–ñ–ï–ù–ê –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê:**

### 1. **–î–≤–∞ –ø—É—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:**

#### **–ü—É—Ç—å –ê: `authenticateFromTelegram()`** (—Å HMAC –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π)
- –í—ã–∑—ã–≤–∞–µ—Ç `findOrCreateFromTelegram()` 
- –ü–µ—Ä–µ–¥–∞–µ—Ç `ref_by: options.ref_by` ‚úÖ
- –í—ã–∑—ã–≤–∞–µ—Ç `processReferralInline()` ‚úÖ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å —Å–æ–∑–¥–∞–µ—Ç—Å—è

#### **–ü—É—Ç—å –ë: `registerDirectFromTelegramUser()`** (fallback –±–µ–∑ HMAC)
- –í—ã–∑—ã–≤–∞–µ—Ç `createUser()` —Å `ref_by: null` ‚ùå
- –ü—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å—Ç—Ñ–∞–∫—Ç—É–º (—Å—Ç—Ä–æ–∫–∏ 357-430)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

### 2. **–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å—Ç—Ä–æ–∫–µ 340 `modules/auth/service.ts`:**
```typescript
userInfo = await this.createUser({
  telegram_id: userData.telegram_id,
  username: userData.username || userData.first_name,
  first_name: userData.first_name,
  ref_by: null  // ‚ùå –£–ë–ò–†–ê–ï–ú ref_by –∏–∑ createUser
});
```

### 3. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

```typescript
// –í AuthController.ts —Å—Ç—Ä–æ–∫–∞ 28:
if (direct_registration && telegram_id) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç registerDirectFromTelegramUser()
  // ref_by —Ç–µ—Ä—è–µ—Ç—Å—è!
}
```

## üìä **–ê–ù–ê–õ–ò–ó –†–ï–ó–£–õ–¨–¢–ê–¢–û–í:**

### **User 224 (—É—Å–ø–µ—à–Ω—ã–π –∫–µ–π—Å):**
- **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω**: —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (`registerDirectFromTelegramUser()`)
- **ref_by —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**: –≤ `null` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (—Å—Ç—Ä–æ–∫–∞ 340)
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å**: —Å–æ–∑–¥–∞–Ω–∞ –ü–û–ó–ñ–ï –Ω–∞—à–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏ (29 –º–∏–Ω—É—Ç —Å–ø—É—Å—Ç—è)

### **Users 225, 223, 222, 221, 220 (–Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏):**
- **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã**: —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- **ref_by**: `null` (–ø–æ—Ç–µ—Ä—è–Ω–æ)
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å**: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

## üéØ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:**

1. **–°–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—É—Ç—å –ê –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
2. **–ü—É—Ç—å –ë (–ø—Ä—è–º–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è) —Å–ª–æ–º–∞–Ω** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "–£–±–∏—Ä–∞–µ–º ref_by –∏–∑ createUser"** - –∫—Ç–æ-—Ç–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ —Å–ª–æ–º–∞–ª —Å–∏—Å—Ç–µ–º—É
4. **–ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –≤ —Å—Ç—Ä–æ–∫–∞—Ö 357-430 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ–ª–∂–Ω—ã–º –æ–±—Ä–∞–∑–æ–º

## üîß **–ü–†–û–°–¢–û–ï –†–ï–®–ï–ù–ò–ï:**

–ó–∞–º–µ–Ω–∏—Ç—å –≤ —Å—Ç—Ä–æ–∫–µ 340:
```typescript
ref_by: null  // –£–±–∏—Ä–∞–µ–º ref_by –∏–∑ createUser
```

–ù–∞:
```typescript
ref_by: userData.ref_by  // –ü–µ—Ä–µ–¥–∞–µ–º ref_by –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

–≠—Ç–æ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç `processReferralInline()` –≤ `findOrCreateFromTelegram()` –¥–ª—è –ø—Ä—è–º–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

## üìù **–°–¢–ê–¢–£–° –ü–†–û–ë–õ–ï–ú–´:**
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (–ø—É—Ç—å –ê —Ä–∞–±–æ—Ç–∞–µ—Ç)
- **–ü—É—Ç—å –ë**: ‚ùå –°–ª–æ–º–∞–Ω (—Å—Ç—Ä–æ–∫–∞ 340)
- **–†–µ—à–µ–Ω–∏–µ**: –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è