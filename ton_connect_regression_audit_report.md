# –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π –∞—É–¥–∏—Ç TON Connect –∏ —Å–∏—Å—Ç–µ–º—ã UniFarm

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 12 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –í—ã–ø–æ–ª–Ω–µ–Ω

## üìä –ó–ê–î–ê–ß–ê 1. –†–ï–ì–†–ï–°–°–ò–û–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –°–ò–°–¢–ï–ú–´

| –ú–æ–¥—É–ª—å | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ | –†–µ–∑—É–ª—å—Ç–∞—Ç | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |
|--------|---------------|-----------|-------------|
| üîó **ConnectWallet** | –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** | ‚Ä¢ `client/src/services/tonConnectService.ts:connectTonWallet()` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞<br>‚Ä¢ API `/api/v2/wallet/connect-ton` –∏ `/api/v2/wallet/save-ton-address` —Å—É—â–µ—Å—Ç–≤—É—é—Ç<br>‚Ä¢ `modules/wallet/controller.ts:connectTonWallet()` –∏ `saveTonAddress()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã<br>‚Ä¢ –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (–ø–æ–ª—è: ton_wallet_address, ton_wallet_verified, ton_wallet_linked_at) |
| üíº **–ë–∞–ª–∞–Ω—Å** | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ UNI/TON, —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –ë–î | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** | ‚Ä¢ –ö–æ–Ω—Å–æ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `balance_uni: 1009900.122573` –¥–ª—è user 74<br>‚Ä¢ WebSocket —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)<br>‚Ä¢ API `/api/v2/uni-farming/status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| üí∏ **–î–µ–ø–æ–∑–∏—Ç** | TON-–¥–µ–ø–æ–∑–∏—Ç –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –∫–æ—à–µ–ª—å–∫–∞ | ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù** | ‚Ä¢ API `/api/v2/wallet/ton-deposit` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (`server/index.ts:1258`)<br>‚Ä¢ `TonDepositCard.tsx` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è UI –¥–µ–ø–æ–∑–∏—Ç–æ–≤<br>‚Ä¢ `modules/wallet/service.ts:processTonDeposit()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç—ã<br>‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ `ton_tx_hash`<br>‚Ä¢ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `BalanceManager` |
| üßæ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** | ‚Ä¢ `UnifiedTransactionService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π<br>‚Ä¢ –¢–∏–ø—ã: DEPOSIT, WITHDRAWAL, FARMING_REWARD –∏ –¥—Ä.<br>‚Ä¢ –ü–æ–ª—è: amount, currency (UNI/TON), type, status |
| ü§ù **–†–µ—Ñ–µ—Ä–∞–ª—ã** | start_param —á–µ—Ä–µ–∑ initData, –∑–∞–ø–∏—Å—å –≤ referrals | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** | ‚Ä¢ `client/src/App.tsx:109` - —á–∏—Ç–∞–µ—Ç `window.Telegram?.WebApp?.startParam`<br>‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 1) Telegram start_param, 2) URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, 3) sessionStorage<br>‚Ä¢ –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ backend —á–µ—Ä–µ–∑ `ref_by` –ø–∞—Ä–∞–º–µ—Ç—Ä<br>‚Ä¢ `modules/auth/service.ts:160` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| üîÑ **–ê–≤—Ç–æ–≤—ã–≤–æ–¥ / –ó–∞—è–≤–∫–∞** | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ withdraw_requests | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** | ‚Ä¢ –¢–∞–±–ª–∏—Ü–∞ `withdraw_requests` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏<br>‚Ä¢ API `/api/v2/wallet/withdraw` —Å–æ–∑–¥–∞–µ—Ç –∑–∞—è–≤–∫–∏<br>‚Ä¢ –°—Ç–∞—Ç—É—Å—ã: pending/approved/rejected/completed<br>‚Ä¢ Telegram Bot –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (@unifarm_admin_bot) |

---

## üîç –ó–ê–î–ê–ß–ê 2. –ê–£–î–ò–¢ CONNECTWALLET (TON CONNECT)

| –ü—É–Ω–∫—Ç | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç | –î–µ—Ç–∞–ª–∏ |
|-------|----------|-----------|---------|
| **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞** | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ @tonconnect/sdk, TonConnectUI | ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** | ‚Ä¢ `@tonconnect/ui-react` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö<br>‚Ä¢ `TonConnectUIProvider` –≤ `App.tsx`<br>‚Ä¢ `useTonConnectUI()` —Ö—É–∫ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö |
| **–°–µ—Å—Å–∏—è** | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, localStorage | ‚ö†Ô∏è **–ß–ê–°–¢–ò–ß–ù–û** | ‚Ä¢ TON Connect –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–µ—Å—Å–∏—é<br>‚Ä¢ –ù–µ—Ç —è–≤–Ω–æ–≥–æ –∫–æ–¥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage<br>‚Ä¢ –ê–¥—Ä–µ—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ |
| **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞** | wallet.account.address –¥–æ—Å—Ç—É–ø–µ–Ω | ‚úÖ **–î–û–°–¢–£–ü–ï–ù** | ‚Ä¢ `tonConnectUI.account?.address` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `TonDepositCard.tsx:29`<br>‚Ä¢ –ê–¥—Ä–µ—Å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –Ω–∞ backend –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è |
| **–û—Ç–ø—Ä–∞–≤–∫–∞ TON** | UI –¥–ª—è transfer —á–µ—Ä–µ–∑ sendTransaction() | ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù** | ‚Ä¢ `TonDepositCard.tsx` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤<br>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `wallet.sendTransaction()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏<br>‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ BOC –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞** | TON Connect v2 | ‚úÖ **V2** | ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ @tonconnect/ui v2<br>‚Ä¢ Manifest URL: `/tonconnect-manifest.json`<br>‚Ä¢ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –ù–µ—Ç hardcoded –∫–ª—é—á–µ–π | ‚úÖ **–ë–ï–ó–û–ü–ê–°–ù–û** | ‚Ä¢ –í—Å–µ –∫–ª—é—á–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>‚Ä¢ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏<br>‚Ä¢ HMAC –≤–∞–ª–∏–¥–∞—Ü–∏—è Telegram –¥–∞–Ω–Ω—ã—Ö |

---

## üìÑ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### TON Connect Manifest
**–§–∞–π–ª:** `client/public/tonconnect-manifest.json`
```json
{
  "url": "https://uni-farm-connect-x-ab245275.replit.app",
  "name": "UniFarm",
  "iconUrl": "https://uni-farm-connect-x-ab245275.replit.app/assets/favicon.ico",
  "termsOfUseUrl": "https://uni-farm-connect-x-ab245275.replit.app/terms",
  "privacyPolicyUrl": "https://uni-farm-connect-x-ab245275.replit.app/privacy"
}
```
‚úÖ –ú–∞–Ω–∏—Ñ–µ—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è production

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ changelog
1. **CORS –¥–ª—è manifest** - —Ä–µ—à–µ–Ω–æ 11 —è–Ω–≤–∞—Ä—è 2025 (—Å–º. `replit.md:138`)
2. **JWT —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - —Ä–µ—à–µ–Ω–æ 11 —è–Ω–≤–∞—Ä—è 2025

### API Endpoints –¥–ª—è TON
- `POST /api/v2/wallet/connect-ton` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
- `POST /api/v2/wallet/save-ton-address` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
- `POST /api/v2/wallet/ton-deposit` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- `POST /api/v2/wallet/withdraw` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥

---

## üéØ –§–ò–ù–ê–õ–¨–ù–´–ô –í–´–í–û–î

### –°—Ç–∞—Ç—É—Å: **‚úÖ –ì–û–¢–û–í –ö –ü–†–ò–Å–ú–£ TON –í –õ–ò–ß–ù–´–ô –ö–ê–ë–ò–ù–ï–¢**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. ‚úÖ TON Connect v2 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
2. ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ API endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
3. ‚úÖ –î–µ–ø–æ–∑–∏—Ç—ã TON –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ –ë–∞–ª–∞–Ω—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket
5. ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ –ë–î
6. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
7. ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç start_param

**–ú–∏–Ω–æ—Ä–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
- ‚ö†Ô∏è –°–µ—Å—Å–∏—è TON Connect —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —è–≤–Ω–æ–≥–æ –∫–æ–¥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage –Ω–µ—Ç
- ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:** 98%