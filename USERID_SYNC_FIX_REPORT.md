# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–Å–¢: Preview –ö–∞–±–∏–Ω–µ—Ç –∏ –ë–∞–ª–∞–Ω—Å—ã
**–î–∞—Ç–∞:** 8 –∏—é–ª—è 2025, 13:15 UTC  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê  
**–¶–µ–ª—å:** –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ –≤ Preview

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –ù–ê–•–û–î–ö–ò

### ‚úÖ 1. –ü–û–î–ö–õ–Æ–ß–ï–ù–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ –û–ü–†–ï–î–ï–õ–Å–ù:
```bash
# JWT Token Payload:
userId: 62
telegram_id: 88888848
username: "preview_test"
first_name: "Preview"
Issued: 2025-07-08T13:08:13.000Z
Expires: 2025-07-15T13:08:13.000Z
```

### ‚úÖ 2. –î–ê–ù–ù–´–ï –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–• (SUPABASE):
```bash
=== USER_ID=62 –§–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï ===
ID: 62
Telegram ID: 88888848
Username: preview_test
First Name: Preview
UNI Balance: 550           ‚Üê –†–ï–ê–õ–¨–ù–´–ô –ë–ê–õ–ê–ù–°
TON Balance: 0
UNI Deposit Amount: 0
UNI Farming Balance: 0
TON Farming Balance: 0
Created: 2025-07-06T05:42:01.919
Last Active: 2025-07-08T06:18:53.286
```

### ‚ùå 3. –î–ê–ù–ù–´–ï –ù–ê UI (–ò–ó –õ–û–ì–û–í –ë–†–ê–£–ó–ï–†–ê):
```bash
=== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –í BALANCECARD ===
userId: null               ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
uniBalance: 0              ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
tonBalance: 0              ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
uniFarmingActive: false
```

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–ò–ß–ò–ù

### ‚úÖ API –£–°–ü–ï–®–ù–û –ü–û–õ–£–ß–ê–ï–¢ –î–ê–ù–ù–´–ï:
–ò–∑ –ª–æ–≥–æ–≤ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏–¥–Ω–æ:
```javascript
"[UserContext] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç API:",{
  "success":true,
  "data":{
    "user":{
      "id":62,
      "telegram_id":88888848,
      "username":"preview_test",
      "first_name":"Preview",
      "ref_code":"REF_1751780521918_e1v62d",
      "balance_uni":550,    ‚Üê API –í–û–ó–í–†–ê–©–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û!
      "balance_ton":"0"
    }
  }
}
```

### ‚ùå USERCONTEXT –ù–ï –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢ USERID:
```javascript
"[UserContext] –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ API:",{
  "user":{
    "id":62,
    "balance_uni":550
  }
}
"[UserContext] –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ, userId:",null  ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï: –ë–ê–ó–ê vs UI

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | API Response | UI Display | –°—Ç–∞—Ç—É—Å |
|----------|-------------|--------------|------------|---------|
| User ID | ‚úÖ 62 | ‚úÖ 62 | ‚ùå null | üî¥ –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω |
| UNI Balance | ‚úÖ 550 | ‚úÖ 550 | ‚ùå 0 | üî¥ –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è |
| TON Balance | ‚úÖ 0 | ‚úÖ 0 | ‚ùå 0 | üü° –°–ª—É—á–∞–π–Ω–æ —Å–æ–≤–ø–∞–ª |
| Username | ‚úÖ preview_test | ‚úÖ preview_test | ‚ùì N/A | - |

---

## üéØ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### üîç –ü—Ä–æ–±–ª–µ–º–∞ –≤ UserContext.tsx:

**API —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ** ‚Üí UserContext –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API  
**–î–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ state** ‚Üí userId –æ—Å—Ç–∞–µ—Ç—Å—è null –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö  
**BalanceCard –ø–æ–ª—É—á–∞–µ—Ç null** ‚Üí –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç 0 –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

### üìç –ù–ê–ô–î–ï–ù–ê –¢–û–ß–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê –ü–†–û–ë–õ–ï–ú–´:
```typescript
// UserContext –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
response.data = { user: { id: 62, balance_uni: 550 } }
userData = response.data = { user: {...} }

// –û–®–ò–ë–ö–ê –≤ —Å—Ç—Ä–æ–∫–µ 274:
userId: userData.id || null,          // userData.id = undefined!

// –ü–†–ê–í–ò–õ–¨–ù–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
userId: userData.user.id || null,     // userData.user.id = 62

// –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–µ–π—á–∞—Å:
"[UserContext] –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ, userId": null    // userData.id = undefined
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### ‚úÖ –†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ **Supabase Database**: –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã (user_id=62, balance_uni=550)
- ‚úÖ **API Endpoints**: –í–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ **Network Layer**: –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **JWT Authentication**: –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω –¥–ª—è user_id=62

### ‚ùå –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
- ‚ùå **UserContext State Management**: –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤ state
- ‚ùå **State Update Logic**: dispatch –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è userId
- ‚ùå **Component Data Flow**: BalanceCard –ø–æ–ª—É—á–∞–µ—Ç null –∑–Ω–∞—á–µ–Ω–∏—è

### üîç Race Condition Issue:
```
UserContext.refreshUserData() —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç API response
      ‚Üì
–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ  
      ‚Üì
–ù–û: state.userId –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
      ‚Üì
BalanceCard –ø–æ–ª—É—á–∞–µ—Ç userId=null ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –±–∞–ª–∞–Ω—Å—ã
```

---

## üìã –ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. **UserContext.tsx –ö–û–ù–ö–†–ï–¢–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:**
```typescript
// –°–¢–†–û–ö–ê 274 - –ó–ê–ú–ï–ù–ò–¢–¨:
userId: userData.id || null,

// –ù–ê:
userId: userData.user.id || null,

// –ò –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –ü–û–õ–Ø –ê–ù–ê–õ–û–ì–ò–ß–ù–û:
username: userData.user.username || null,
telegramId: userData.user.telegram_id || null,
refCode: userData.user.ref_code || null
```

### 2. **State Management:**
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å userReducer –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ userId
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å initialState –∏ —É—Å–ª–æ–≤–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è state

### 3. **Component Communication:**
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ BalanceCard –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ context
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å useContext hook –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å UserContext
- –ù–∞–π—Ç–∏ —Ç–æ—á–∫—É, –≥–¥–µ —Ç–µ—Ä—è–µ—Ç—Å—è userId –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ state
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å dispatch –ª–æ–≥–∏–∫—É –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å State Flow
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å userReducer actions
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ user_id=62
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ balance_uni=550 –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìà –í–õ–ò–Ø–ù–ò–ï –ù–ê PRODUCTION

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** 92% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏  
**–î–∞–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç deployment  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (UX —É–ª—É—á—à–µ–Ω–∏–µ)

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ API —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ UI.

---

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –†–ï–ó–Æ–ú–ï

**Preview –∫–∞–±–∏–Ω–µ—Ç:** user_id=62 (telegram_id=88888848, username=preview_test)  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –±–∞–ª–∞–Ω—Å:** 550 UNI, 0 TON  
**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** userData.id –≤–º–µ—Å—Ç–æ userData.user.id –≤ —Å—Ç—Ä–æ–∫–µ 274 UserContext.tsx  
**–ö–û–ù–ö–†–ï–¢–ù–û–ï –†–ï–®–ï–ù–ò–ï:** –ó–∞–º–µ–Ω–∏—Ç—å userData.id –Ω–∞ userData.user.id –≤ dispatch payload

---

*–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 8 –∏—é–ª—è 2025, 13:18 UTC*  
*Preview –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É, –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã*