# üî¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç: –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ UniFarming

**–î–∞—Ç–∞:** 13 –∏—é–ª—è 2025  
**–ê–≤—Ç–æ—Ä:** Technical Agent  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞

---

## ‚ùó –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –í —Ñ–∞–π–ª–µ `core/scheduler/farmingScheduler.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `farmer.id` (UUID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `uni_farming_data`)
- –î–æ–ª–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `farmer.user_id` (—á–∏—Å–ª–æ–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –í—Å–µ 36 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤ –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –¥–æ—Ö–æ–¥–∞
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ `FARMING_REWARD` –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –±–æ–ª–µ–µ 32 —á–∞—Å–æ–≤
- –ë–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç—Å—è

---

## üîÑ –¶–µ–ø–æ—á–∫–∞ –≤—ã–∑–æ–≤–æ–≤

### 1. **–ù–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ - FarmingScheduler**
```
farmingScheduler.start()
  ‚Üì
processUniFarmingIncome() [—Å—Ç—Ä–æ–∫–∞ 55]
  ‚Üì
```

### 2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤**
```
UniFarmingRepository.getActiveFarmers() [—Å—Ç—Ä–æ–∫–∞ 63]
  ‚Üì
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ uni_farming_data:
{
  id: "b5cc17fc-a461-4b54-8d88-c2ffdfff943a" (UUID),
  user_id: 74 (number),
  deposit_amount: 513589,
  ...
}
```

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞—Ä–º–µ—Ä–∞**
```
for (const farmer of activeFarmers) [—Å—Ç—Ä–æ–∫–∞ 88]
  ‚Üì
farmerIncomes.push({
  userId: farmer.id, // ‚ùå –û–®–ò–ë–ö–ê! –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UUID –≤–º–µ—Å—Ç–æ user_id
  income: parseFloat(income),
  currency: 'UNI'
}) [—Å—Ç—Ä–æ–∫–∞ 93-97]
```

### 4. **Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤**
```
batchBalanceProcessor.processFarmingIncome(farmerIncomes) [—Å—Ç—Ä–æ–∫–∞ 108]
  ‚Üì
BatchBalanceProcessor –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å –¥–ª—è userId = UUID
  ‚Üì
–û–®–ò–ë–ö–ê: Supabase –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å id = UUID
```

### 5. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**
```
await supabase.from('transactions').insert({
  user_id: farmer.id, // ‚ùå –û–®–ò–ë–ö–ê! UUID –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–∞
  type: 'FARMING_REWARD',
  ...
}) [—Å—Ç—Ä–æ–∫–∏ 143-156]
```

---

## üß© –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ –∫–æ–¥–∞ —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º —Ç–∏–ø–∞

### –§–∞–π–ª: `core/scheduler/farmingScheduler.ts`

**–°—Ç—Ä–æ–∫–∞ 94:**
```typescript
userId: farmer.id, // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: farmer.user_id
```

**–°—Ç—Ä–æ–∫–∏ 131, 146, 167:**
```typescript
user_id: farmer.id, // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: farmer.user_id
```

**–°—Ç—Ä–æ–∫–∏ 100, 158, 159:**
```typescript
–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${farmer.id} // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: farmer.user_id
```

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)**

–í —Ñ–∞–π–ª–µ `core/scheduler/farmingScheduler.ts` –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `farmer.id` –Ω–∞ `farmer.user_id`:

- –°—Ç—Ä–æ–∫–∞ 94: `userId: farmer.user_id,`
- –°—Ç—Ä–æ–∫–∞ 100: `–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${farmer.user_id}:`
- –°—Ç—Ä–æ–∫–∞ 121: `f.userId === farmer.user_id`
- –°—Ç—Ä–æ–∫–∞ 131: `user_id: farmer.user_id,`
- –°—Ç—Ä–æ–∫–∞ 146: `user_id: farmer.user_id,`
- –°—Ç—Ä–æ–∫–∞ 154: `source_user_id: farmer.user_id,`
- –°—Ç—Ä–æ–∫–∞ 158-159: `user ${farmer.user_id}`
- –°—Ç—Ä–æ–∫–∞ 167: `userId: farmer.user_id,`

### 2. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**

1. **–¢–∏–ø–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `UniFarmingData` –≤ `modules/farming/types.ts`
   - –ß–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤:**
   - –î–æ–±–∞–≤–∏—Ç—å runtime –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ `UnifiedTransactionService`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é

3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ UniFarmingRepository:**
   - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è, –∏—Å–∫–ª—é—á–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π `id`
   - –ò–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª—è –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏: `record_id` –∏ `user_id`

---

## üß™ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤—Ä—É—á–Ω—É—é
npx tsx run-farming-scheduler.ts

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
npx tsx check-uni-farming-rewards.ts

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 74
npx tsx check-user-74-balance.ts
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–ª—è –≤—Å–µ—Ö 36 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- –°–ª–µ–¥–∏—Ç—å –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è 1% –≤ –¥–µ–Ω—å
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

## üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤:**
   - `BatchBalanceProcessor` –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å
   - `UnifiedTransactionService` —Ç–∞–∫–∂–µ –ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

2. **–ù–µ–≤–µ—Ä–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
   - 30 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π TON boost –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ `FARMING_REWARD`
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –±—É–¥—É—â–µ–º

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**
   - –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –∑–∞–º–µ–Ω–æ–π `farmer.id` –Ω–∞ `farmer.user_id` –≤ 8 –º–µ—Å—Ç–∞—Ö —Ñ–∞–π–ª–∞ `farmingScheduler.ts`. –≠—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤.

**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** ~5 –º–∏–Ω—É—Ç  
**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π  
**–í–ª–∏—è–Ω–∏–µ:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –¥–ª—è 36 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π