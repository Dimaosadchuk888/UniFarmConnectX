# üîç –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó: BatchBalanceProcessor vs BalanceManager

## üìä –ü–æ–ª–Ω–∞—è —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | BalanceManager | BatchBalanceProcessor |
|----------|----------------|----------------------|
| **–ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω** | `core/BalanceManager.ts` | `core/BatchBalanceProcessor.ts` |
| **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (—Ñ–∞–π–ª—ã)** | - `modules/farming/service.ts`<br>- `modules/wallet/*`<br>- `modules/dailyBonus/service.ts`<br>- `modules/missions/service.ts`<br>- `core/TransactionService.ts` | - `core/scheduler/farmingScheduler.ts`<br>- `modules/scheduler/tonBoostIncomeScheduler.ts` |
| **–ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç** | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (–¥–µ–ø–æ–∑–∏—Ç—ã, –≤—ã–≤–æ–¥—ã, –ø–æ–∫—É–ø–∫–∏) | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç) |
| **–û–±–Ω–æ–≤–ª—è–µ—Ç –ª–∏ –±–∞–ª–∞–Ω—Å –≤ –ë–î** | ‚úÖ –î–∞, —á–µ—Ä–µ–∑ Supabase `.update()` | ‚úÖ –î–∞, —á–µ—Ä–µ–∑ Supabase RPC `increment_user_balance` |
| **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WebSocket** | ‚úÖ –î–∞, —á–µ—Ä–µ–∑ callback `onBalanceUpdate` | ‚úÖ –î–∞, –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `BalanceNotificationService` |
| **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ payload** | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `websocket-balance-integration.ts` | `{userId, balanceUni, balanceTon, changeAmount, currency, source, timestamp}` |
| **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ TON Boost** | ‚ùì –í–µ—Ä–æ—è—Ç–Ω–æ –¥–∞ (—á–µ—Ä–µ–∑ boost/service.ts) | ‚úÖ –î–∞, –≤ `tonBoostIncomeScheduler.ts` |
| **–°–≤—è–∑–∞–Ω —Å farmingScheduler** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞, –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç |
| **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å BalanceCache | ‚úÖ –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–µ—à –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π |
| **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ single update | ‚úÖ Batch processing —Å retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–º |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | –î–ª—è –µ–¥–∏–Ω–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö (100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) |

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (–ü–†–û–ë–õ–ï–ú–ê):

```
–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ï –î–ï–ô–°–¢–í–ò–Ø:
User ‚Üí API ‚Üí Service ‚Üí BalanceManager ‚Üí Supabase ‚úÖ
                            ‚Üì
                    WebSocket callback ‚Üí BalanceNotificationService ‚ùå
                    (callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è)

–ü–õ–ê–ù–ò–†–û–í–©–ò–ö–ò:
Scheduler ‚Üí BatchBalanceProcessor ‚Üí Supabase RPC ‚ùå (–Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ increment_user_balance)
                    ‚Üì
            BalanceNotificationService ‚Üí WebSocket ‚úÖ
            (–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç changeAmount=0)
```

## üõë –¢–æ—á–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞

### 1. **–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è RPC —Ñ—É–Ω–∫—Ü–∏—è (—Å fallback)**
BatchBalanceProcessor –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å `increment_user_balance` –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ Supabase:
```typescript
// core/BatchBalanceProcessor.ts, —Å—Ç—Ä–æ–∫–∞ 179-184
const { data, error } = await supabase.rpc('increment_user_balance', {
  p_user_id: update.user_id,
  p_uni_amount: update.uni_increment,
  p_ton_amount: update.ton_increment
});
```
**–ù–û**: –µ—Å—Ç—å fallback –º–µ—Ö–∞–Ω–∏–∑–º (—Å—Ç—Ä–æ–∫–∏ 187-215) –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –æ–±—ã—á–Ω—ã–π update –µ—Å–ª–∏ RPC –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 2. **–î–≤–æ–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- BalanceManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç callback –º–µ—Ö–∞–Ω–∏–∑–º —á–µ—Ä–µ–∑ `websocket-balance-integration.ts`
- BatchBalanceProcessor –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞–µ—Ç `BalanceNotificationService`

### 3. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ WebSocket**
- BatchBalanceProcessor –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã (—Å—Ç—Ä–æ–∫–∏ 228-234) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π payload
- BalanceManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç callback, –Ω–æ `websocket-balance-integration.ts` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç changeAmount=0
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞: —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ñ–∞–π–ª `balanceNotificationService.ts` (—Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞)

## ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### BalanceManager.updateBalance()
- **–ü—Ä–∏–Ω–∏–º–∞–µ—Ç**: `{user_id, amount_uni, amount_ton, operation: 'add'|'subtract'|'set', source}`
- **–û–±–Ω–æ–≤–ª—è–µ—Ç**: –î–∞, –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Supabase `.update()`
- **–£–≤–µ–¥–æ–º–ª—è–µ—Ç**: –ß–µ—Ä–µ–∑ callback `onBalanceUpdate` (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: –°–æ–∑–¥–∞–µ—Ç —á–µ—Ä–µ–∑ `transactionEnforcer`

### BatchBalanceProcessor.processFarmingIncome()
- **–ü—Ä–∏–Ω–∏–º–∞–µ—Ç**: –ú–∞—Å—Å–∏–≤ `{userId, income}` 
- **–û–±–Ω–æ–≤–ª—è–µ—Ç**: –ü—ã—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ RPC (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
- **–£–≤–µ–¥–æ–º–ª—è–µ—Ç**: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `BalanceNotificationService`
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –ë–∞—Ç—á–∏ –ø–æ 100 –∑–∞–ø–∏—Å–µ–π

## üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### **–í–´–í–û–î: BalanceManager –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
1. ‚úÖ –£–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. ‚úÖ –ò–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å callback –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ Supabase –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ (–Ω–µ RPC)
4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å–∏—Å—Ç–µ–º–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
5. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ç–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π (add/subtract/set)

### **–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏:**

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ë–´–°–¢–†–´–ô –§–ò–ö–°)
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å BatchBalanceProcessor - –∑–∞–º–µ–Ω–∏—Ç—å RPC –Ω–∞ –æ–±—ã—á–Ω—ã–µ update –æ–ø–µ—Ä–∞—Ü–∏–∏
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
3. ~20 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, 1 —á–∞—Å —Ä–∞–±–æ—Ç—ã

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
1. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BalanceManager
2. –î–æ–±–∞–≤–∏—Ç—å –≤ BalanceManager –º–µ—Ç–æ–¥ `batchUpdate()` –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. –£–¥–∞–ª–∏—Ç—å BatchBalanceProcessor –ø–æ–ª–Ω–æ—Å—Ç—å—é
4. ~200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, 3-4 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

## üîê –†–∏—Å–∫–∏ –∏ –≤—ã–≥–æ–¥—ã

### –†–∏—Å–∫–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å:
- ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- ‚ùå –î–≤–æ–π–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–¥–∞
- ‚ùå –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –í—ã–≥–æ–¥—ã –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ BalanceManager:
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞–º–∏
- ‚úÖ –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –¥–µ–±–∞–∂–∏—Ç—å
- ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è 70% –æ–ø–µ—Ä–∞—Ü–∏–π

## üìã –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### –†–∞–∑–ª–∏—á–∏—è –ø–æ –≤–∞–ª—é—Ç–∞–º
- –û–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç UNI –∏ TON –æ–¥–∏–Ω–∞–∫–æ–≤–æ
- –ù–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø–æ –≤–∞–ª—é—Ç–∞–º

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
- –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–µ–ø–æ–∑–∏—Ç–µ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã
- BalanceManager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, BatchBalanceProcessor - –Ω–µ—Ç

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
- **TON Boost**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BatchBalanceProcessor (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
- **Withdrawals**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BalanceManager (—á–µ—Ä–µ–∑ TransactionService)
- **Missions**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BalanceManager
- **Daily Bonus**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç BalanceManager

## üéØ –§–ò–ù–ê–õ–¨–ù–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ BalanceManager:**

1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `batchUpdateBalances()` –≤ BalanceManager
2. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ –Ω–∞ –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
3. –£–¥–∞–ª–∏—Ç—å BatchBalanceProcessor
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é WebSocket —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π callback

–≠—Ç–æ —Ä–µ—à–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–∞–¥–µ–∂–Ω—É—é, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ü—Ä–æ–±–ª–µ–º–∞ websocket-balance-integration.ts
- –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `changeAmount: 0` (—Å—Ç—Ä–æ–∫–∞ 25) –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π —Å—É–º–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–µ –∑–Ω–∞–µ—Ç –≤–∞–ª—é—Ç—É, –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏—Ç `currency: 'UNI'` (—Å—Ç—Ä–æ–∫–∞ 26)
- –≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –ø–æ—á–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç BalanceManager –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –ü–æ—á–µ–º—É BatchBalanceProcessor —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ
- –ó–Ω–∞–µ—Ç —Ç–æ—á–Ω—ã–µ —Å—É–º–º—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ú–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞–ª—é—Ç—É –∏–∑ –¥–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π payload —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### Quickfix –¥–ª—è websocket-balance-integration.ts
Callback –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
```typescript
balanceManager.onBalanceUpdate = async (userId: number, changeData?: {amount: number, currency: 'UNI'|'TON', source: string}) => {
  // –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª–Ω—ã–π payload
}
```