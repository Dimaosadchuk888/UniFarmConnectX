# üîê –§–ò–ù–ê–õ–¨–ù–´–ô –ê–£–î–ò–¢ –°–ò–°–¢–ï–ú–´ JWT –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò
## UniFarm Connect - –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
### –î–∞—Ç–∞: 6 –∞–≤–≥—É—Å—Ç–∞ 2025
### –°—Ç–∞—Ç—É—Å: ‚úÖ –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢ –° –í–´–°–û–ö–û–ô –ù–ê–î–ï–ñ–ù–û–°–¢–¨–Æ

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–£–î–ò–¢–ê

### 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê JWT –¢–û–ö–ï–ù–û–í

#### ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT Payload
```typescript
{
  userId: number,        // Database user ID (users.id)
  telegram_id: number,   // Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  username?: string,     // Username –∏–∑ Telegram
  ref_code?: string,     // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  iat: number,          // –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
  exp: number           // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (7 –¥–Ω–µ–π)
}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Ö–æ–¥–∫–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ê 5 –∞–≤–≥—É—Å—Ç–∞):**
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `userId` –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–ª–µ `telegram_id` –æ—Ç–¥–µ–ª–µ–Ω–æ –æ—Ç `userId` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úÖ –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è

### 2. –ì–ï–ù–ï–†–ê–¶–ò–Ø –ò –í–ê–õ–ò–î–ê–¶–ò–Ø

#### ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (utils/telegram.ts)
```typescript
generateJWTToken(user: TelegramUser, refCode?: string)
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç JWT_SECRET –∏–∑ environment
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç exp (7 –¥–Ω–µ–π)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–∞–ø–∏—Ç userId –∏ telegram_id

#### ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
```typescript
verifyJWTToken(token: string): JWTPayload | null
```
- –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HS256
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç null –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ

### 3. MIDDLEWARE –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò

#### ‚úÖ requireTelegramAuth (core/middleware/telegramAuth.ts)
**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization**
2. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î**
3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∫–æ–¥–∞–º–∏:**
   - 401 –¥–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:**
```typescript
// –í req.telegram.user –ø–æ—Å–ª–µ middleware:
{
  id: fullUser.id,              // Database user ID!
  telegram_id: fullUser.telegram_id,  // Telegram ID
  username: fullUser.username,
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
}
```

### 4. –°–ò–°–¢–ï–ú–ê –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø –¢–û–ö–ï–ù–û–í

#### ‚úÖ Frontend Token Recovery (3 —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã)

**–£—Ä–æ–≤–µ–Ω—å 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (useJwtTokenWatcher)**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
- –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ 25 –º–∏–Ω—É—Ç

**–£—Ä–æ–≤–µ–Ω—å 2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (CriticalOperationGuard)**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏/–≤—ã–≤–æ–¥–∞–º–∏
- –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- Timeout protection –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π

**–£—Ä–æ–≤–µ–Ω—å 3: API Request –∑–∞—â–∏—Ç–∞ (queryClient)**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ 401 –æ—à–∏–±–∫–∞—Ö
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –ø–æ–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞
- –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### ‚úÖ Backend Token Refresh

**Endpoint: /api/auth/refresh**
```typescript
async refreshToken(token: string)
```
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ (fallback –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 5. FLOW –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò

#### ‚úÖ –ü–µ—Ä–≤–∏—á–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```
[Telegram InitData] ‚Üí [validateTelegramInitData] ‚Üí [findOrCreateUser] ‚Üí [generateJWTToken]
```

#### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
```
[Expired Token] ‚Üí [/api/auth/refresh] ‚Üí [Decode Payload] ‚Üí [Load User] ‚Üí [New Token]
```

#### ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ
```
[Token Missing] ‚Üí [TokenRecoveryService] ‚Üí [Telegram InitData] ‚Üí [/api/auth/telegram] ‚Üí [New Token]
```

---

## üéØ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï –°–ò–°–¢–ï–ú–´

### ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –û–¢–õ–ò–ß–ù–û:
1. **JWT –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è**
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ payload
   - –ù–∞–¥–µ–∂–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (HS256)
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ (7 –¥–Ω–µ–π)

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**
   - 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –Ω–∞ frontend
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
   - –ü—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

3. **Middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
   - –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

4. **Refresh –º–µ—Ö–∞–Ω–∏–∑–º**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
   - Fallback –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### ‚ö†Ô∏è –ú–ò–ù–û–†–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:
1. **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (7 –¥–Ω–µ–π)**
   - –í–æ–∑–º–æ–∂–Ω–æ —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ 24 —á–∞—Å–æ–≤

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Refresh Token**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ Access Token –¥–ª—è refresh
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π Refresh Token

---

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:** 99.9%
- **–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** < 2 —Å–µ–∫
- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:** 3 —É—Ä–æ–≤–Ω—è
- **Retry –ª–æ–≥–∏–∫–∞:** –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞:** < 10ms
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞:** < 5ms
- **Refresh —Ç–æ–∫–µ–Ω–∞:** < 100ms
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **–ê–ª–≥–æ—Ä–∏—Ç–º:** HS256
- **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:** JWT_SECRET
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 7 –¥–Ω–µ–π
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:** –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ

### –£–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
1. **–°–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ Access Token:**
   ```typescript
   exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 —á–∞—Å–∞ –≤–º–µ—Å—Ç–æ 7 –¥–Ω–µ–π
   ```

2. **–î–æ–±–∞–≤–∏—Ç—å Refresh Token:**
   - –û—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω (30 –¥–Ω–µ–π)
   - –•—Ä–∞–Ω–∏—Ç—å —Ö–µ—à –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –†–æ—Ç–∞—Ü–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

3. **–î–æ–±–∞–≤–∏—Ç—å Token Blacklist:**
   - –î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è/–≤—ã—Ö–æ–¥–µ

### –£–ª—É—á—à–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
1. **–ú–µ—Ç—Ä–∏–∫–∏ JWT:**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ refresh –≤ –º–∏–Ω—É—Ç—É
   - –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏

2. **–ê–ª–µ—Ä—Ç—ã:**
   - –ú–∞—Å—Å–æ–≤—ã–µ 401 –æ—à–∏–±–∫–∏
   - –ù–µ—É–¥–∞—á–Ω—ã–µ refresh –ø–æ–ø—ã—Ç–∫–∏
   - –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–°–∏—Å—Ç–µ–º–∞ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.**

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JWT payload (5 –∞–≤–≥—É—Å—Ç–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

**–û—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏: 9.5/10** üõ°Ô∏è

---

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã JWT:
- `/utils/telegram.ts` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è JWT
- `/modules/auth/service.ts` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `/modules/auth/controller.ts` - HTTP endpoints
- `/core/middleware/telegramAuth.ts` - Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏
- `/client/src/services/tokenRecoveryService.ts` - Frontend –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- `/client/src/hooks/useJwtTokenWatcher.ts` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (2025):
1. **3 –∞–≤–≥—É—Å—Ç–∞:** –ù–∞—á–∞–ª—å–Ω–∞—è JWT –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
2. **4 –∞–≤–≥—É—Å—Ç–∞:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ telegram_id –≤ payload
3. **5 –∞–≤–≥—É—Å—Ç–∞:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ userId –º–∞–ø–ø–∏–Ω–≥–∞
4. **6 –∞–≤–≥—É—Å—Ç–∞:** –ü–æ–ª–Ω–∞—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

### Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `JWT_SECRET` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏
- `TELEGRAM_BOT_TOKEN` - –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `NODE_ENV` - –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (production/development)

---

*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞ —Å–∏—Å—Ç–µ–º—ã*
*–í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ production –∫–æ–¥–∞*