# ‚úÖ TON CONNECT –î–ï–ü–û–ó–ò–¢–´ - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞**: 24 –∏—é–ª—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–´–ü–û–õ–ù–ï–ù–û**  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 5 –º–∏–Ω—É—Ç  
**–ú–µ—Ç–æ–¥**: –í–∞—Ä–∏–∞–Ω—Ç A - —Ç–æ—á–µ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  

---

## üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **1. ‚úÖ Frontend-Backend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞**
**–§–∞–π–ª**: `client/src/services/tonConnectService.ts`  
**–°—Ç—Ä–æ–∫–∏**: 427-441 (–¥–æ–±–∞–≤–ª–µ–Ω–æ 15 —Å—Ç—Ä–æ–∫)  

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```typescript
// –ù–û–í–û–ï: –£–≤–µ–¥–æ–º–ª—è–µ–º backend –æ —É—Å–ø–µ—à–Ω–æ–º TON –¥–µ–ø–æ–∑–∏—Ç–µ
try {
  const { correctApiRequest } = await import('../lib/correctApiRequest');
  
  const backendResponse = await correctApiRequest('/api/v2/wallet/ton-deposit', 'POST', {
    ton_tx_hash: result.boc,
    amount: tonAmount,
    wallet_address: tonConnectUI.account?.address || 'unknown'
  });
  
  console.log('‚úÖ Backend –¥–µ–ø–æ–∑–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω:', backendResponse);
} catch (backendError) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–∞ –Ω–∞ backend:', backendError);
  // –ù–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É - blockchain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ –ø—Ä–æ—à–ª–∞
}
```

### **2. ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞**
**–§–∞–π–ª**: `core/TransactionService.ts`  
**–°—Ç—Ä–æ–∫–∞**: 118  

**–î–æ**: `tx_hash_unique: null`  
**–ü–æ—Å–ª–µ**: `tx_hash_unique: metadata?.tx_hash || null`

### **3. ‚úÖ Type Mapping –∏—Å–ø—Ä–∞–≤–ª–µ–Ω**
**–§–∞–π–ª**: `core/TransactionService.ts`  
**–°—Ç—Ä–æ–∫–∞**: 25  

**–î–æ**: `'TON_DEPOSIT': 'FARMING_REWARD'`  
**–ü–æ—Å–ª–µ**: `'TON_DEPOSIT': 'DEPOSIT'`

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### ‚ùå **–ü–û–í–ï–î–ï–ù–ò–ï –î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç TON –¥–µ–ø–æ–∑–∏—Ç —á–µ—Ä–µ–∑ TON Connect
2. Blockchain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ  
3. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
4. **Backend –ù–ï –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**
5. –ë–∞–ª–∞–Ω—Å "–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è" –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
6. –î–µ–ø–æ–∑–∏—Ç "–ø—Ä–æ–ø–∞–¥–∞–µ—Ç" –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ **–ü–û–í–ï–î–ï–ù–ò–ï –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç TON –¥–µ–ø–æ–∑–∏—Ç —á–µ—Ä–µ–∑ TON Connect
2. Blockchain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
3. **Frontend –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –≤—ã–∑—ã–≤–∞–µ—Ç Backend API**
4. **Backend —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –ë–î —á–µ—Ä–µ–∑ UnifiedTransactionService**
5. **–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
6. **WebSocket –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
7. **UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –±–∞–ª–∞–Ω—Å –ù–ê–í–°–ï–ì–î–ê**

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞)**:
```
TON Connect ‚Üí sendTonTransaction() ‚Üí correctApiRequest() ‚Üí 
POST /api/v2/wallet/ton-deposit ‚Üí tonDeposit() ‚Üí processTonDeposit() ‚Üí 
UnifiedTransactionService ‚Üí Database ‚Üí WebSocket ‚Üí UI Update
```

### **–°–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**:
- ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Å –æ–¥–Ω–∏–º tx_hash
- ‚úÖ **Error Handling**: Backend –æ—à–∏–±–∫–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç blockchain —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ **Type Safety**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ `TON_DEPOSIT` ‚Üí `DEPOSIT`
- ‚úÖ **Logging**: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**:
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–ø–æ–∑–∏—Ç—ã –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- ‚úÖ WebSocket –∏ balance updates –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- ‚úÖ UNI –¥–µ–ø–æ–∑–∏—Ç—ã –æ—Å—Ç–∞–ª–∏—Å—å –Ω–∞ `FARMING_REWARD` (–∫–∞–∫ –±—ã–ª–æ)

---

## üöÄ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

### **–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**:

#### **1. –ù–æ–≤—ã–π TON –¥–µ–ø–æ–∑–∏—Ç**:
```
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ö–æ—à–µ–ª–µ–∫"
3. –ù–∞–∂–∞—Ç—å "–ü–æ–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ TON"
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON –∫–æ—à–µ–ª–µ–∫
5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª—é–±—É—é —Å—É–º–º—É
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏–ª—Å—è –ù–ê–í–°–ï–ì–î–ê
7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∫–∞–∫ "üíé TON –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ"
```

#### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**:
```
–í browser console –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
‚úÖ "Backend –¥–µ–ø–æ–∑–∏—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω: {success: true, transaction_id: XXX}"
```

#### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø –µ—Å—Ç—å):
```
SELECT * FROM transactions 
WHERE type = 'DEPOSIT' 
AND description LIKE 'TON deposit from blockchain:%'
ORDER BY created_at DESC;
```

---

## üéä –°–¢–ê–¢–£–° –ì–û–¢–û–í–ù–û–°–¢–ò

**‚úÖ –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ê**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –í—Å–µ –Ω–æ–≤—ã–µ TON –¥–µ–ø–æ–∑–∏—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã –±–µ–∑ "–æ—Ç–∫–∞—Ç–æ–≤"

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ—á–µ—á–Ω—ã–µ –∏ –æ–±—Ä–∞—Ç–∏–º—ã–µ
- –ù–∏–∫–∞–∫–∏—Ö breaking changes
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã
- Production ready

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
- Error handling –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
- Console –ª–æ–≥–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

**üéØ –†–ï–ó–£–õ–¨–¢–ê–¢**: TON Connect –¥–µ–ø–æ–∑–∏—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç —Ç–µ—Ä—è—Ç—å –¥–µ–ø–æ–∑–∏—Ç—ã!