# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢ –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò API UniFarm
**–î–∞—Ç–∞:** 12 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò –û–ë–ù–ê–†–£–ñ–ï–ù–´

---

## üìä –°–í–û–î–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

- **52 –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- **3+ –ø—Ä—è–º—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞** –º–∏–Ω—É—é—Ç —Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å** - –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è** - –æ–±—Ö–æ–¥ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨ #1: –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –§–∞–π–ª: `modules/wallet/directBalanceHandler.ts`

```typescript
export const getDirectBalance = async (req: Request, res: Response) => {
  const userId = req.query.user_id as string; // –ë–ï–ó –ü–†–û–í–ï–†–ö–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò!
  
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –±–∞–∑—ã
  const user = await userRepository.getUserById(parseInt(userId));
```

**–†–∏—Å–∫:** –õ—é–±–æ–π –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–Ω–∞—è –µ–≥–æ ID:
```bash
curl "https://unifarm.com/api/v2/wallet/direct-balance?user_id=74"
```

---

## üü° –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–û–ï –ù–ê–†–£–®–ï–ù–ò–ï #2: –û–±—Ö–æ–¥ BaseController

### –§–∞–π–ª: `modules/farming/directDeposit.ts`
```typescript
/**
 * –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä—è–º–æ–π –¥–µ–ø–æ–∑–∏—Ç –º–∏–Ω—É—è BaseController
 * –¶–µ–ª—å: –û–±–æ–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É —Å BaseController.handleRequest –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
 */
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–æ–∑–¥–∞–Ω –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å –≤–º–µ—Å—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å BaseController

---

## üìã –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–• –≠–ù–î–ü–û–ò–ù–¢–û–í (52)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–≤–ª–∏—è—é—Ç –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å):
1. `/api/v2/auth/refresh` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–æ–≤
2. `/api/v2/auth/telegram` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
3. `/api/v2/wallet/balance` - –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
4. `/api/v2/wallet/withdraw` - –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
5. `/api/v2/wallet/ton-deposit` - –¥–µ–ø–æ–∑–∏—Ç TON
6. `/api/v2/uni-farming/status` - —Å—Ç–∞—Ç—É—Å —Ñ–∞—Ä–º–∏–Ω–≥–∞
7. `/api/v2/uni-farming/harvest` - —Å–±–æ—Ä —É—Ä–æ–∂–∞—è
8. `/api/v2/uni-farming/direct-deposit` - –ø—Ä—è–º–æ–π –¥–µ–ø–æ–∑–∏—Ç
9. `/api/v2/boost/purchase` - –ø–æ–∫—É–ø–∫–∞ –±—É—Å—Ç–æ–≤
10. `/api/v2/boost/verify-ton-payment` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
11. `/api/v2/daily-bonus/claim` - –ø–æ–ª—É—á–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞
12. `/api/v2/missions/active` - –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∏—Å—Å–∏–∏
13. `/api/v2/referral/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
14. `/api/v2/users/profile` - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–º. –≤ `/tmp/missing_endpoints.txt`

---

## üîß –ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–Ø–ú–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò

1. **directDepositHandler** (`modules/farming/directDeposit.ts`)
   - –û–±—Ö–æ–¥–∏—Ç BaseController
   - –í—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å –Ω–∞–ø—Ä—è–º—É—é
   - –†–∏—Å–∫: –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å middleware –ø—Ä–æ–≤–µ—Ä–∫–∏

2. **directFarmingStatusHandler** (`modules/farming/directFarmingStatus.ts`)
   - –û–±—Ö–æ–¥–∏—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
   - –°—Ç–∞—Ç—É—Å –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω

3. **getDirectBalance** (`modules/wallet/directBalanceHandler.ts`)
   - **–ö–†–ò–¢–ò–ß–ù–û**: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ù–∞–ø—Ä—è–º—É—é —á–∏—Ç–∞–µ—Ç –∏–∑ –ë–î —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   - –û–±—Ö–æ–¥–∏—Ç BalanceManager

---

## üü° –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ù–ê–†–£–®–ï–ù–ò–Ø

### 4. –ü—Ä—è–º—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö

**–§–∞–π–ª—ã:** 
- `modules/boost/TonFarmingRepository.ts`
- `modules/farming/UniFarmingRepository.ts`

```typescript
// TonFarmingRepository.ts —Å—Ç—Ä–æ–∫–∞ 179
if (data.farming_balance !== undefined) updates.ton_farming_balance = data.farming_balance;

// UniFarmingRepository.ts —Å—Ç—Ä–æ–∫–∞ 124
if (data.farming_balance !== undefined) updates.uni_farming_balance = data.farming_balance;
```

**–†–∏—Å–∫:** –û–±—Ö–æ–¥ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ BalanceManager –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ–ø—É—Å–∫—É –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### 5. –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

**–§–∞–π–ª—ã:**
- `modules/wallet/service.ts` - –ø—Ä—è–º—ã–µ INSERT –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 837, 847, 916, 1006)
- `modules/monitor/service.ts` - –ø—Ä—è–º—ã–µ SELECT –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å—Ç—Ä–æ–∫–∏ 37-40)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–æ–±–ª—é–¥–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Repository

---

## ‚úÖ –ü–†–û–í–ï–†–ï–ù–ù–´–ï –ù–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ú–ï–°–¢–ê

1. **SQL Injection** - –ù–ï –û–ë–ù–ê–†–£–ñ–ï–ù–û
   - Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
   - –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞:
     - `modules/user/controller.ts:514` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `.ilike.%${query}%`
     - `modules/referral/service.ts:533` - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–µ –∑–∞–ø—Ä–æ—Å

---

## üö® –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –°–†–û–ß–ù–û: –ó–∞–∫—Ä—ã—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ getDirectBalance
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
export const getDirectBalance = async (req: Request, res: Response) => {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
  if (!req.user?.id) {
    return res.status(401).json({ error: 'Unauthorized' });
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–º—É userId
  const requestedUserId = req.query.user_id;
  if (requestedUserId !== req.user.id.toString()) {
    return res.status(403).json({ error: 'Forbidden' });
  }
  // ...
}
```

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É —Å BaseController
–í–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ö–æ–¥–Ω—ã—Ö –ø—É—Ç–µ–π, –Ω—É–∂–Ω–æ –≤—ã—è—Å–Ω–∏—Ç—å –ø–æ—á–µ–º—É BaseController –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
–ù–∞—á–∞—Ç—å —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 4. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö direct handlers
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏:
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –í—ã–∑—ã–≤–∞—é—Ç —Å–µ—Ä–≤–∏—Å—ã (–Ω–µ –æ–±—Ö–æ–¥—è—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É)
- –õ–æ–≥–∏—Ä—É—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏

---

## üìà –°–¢–ê–¢–£–° –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô** - –°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç —Å–µ—Ä—å–µ–∑–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** ‚ùå –ù–ï –ì–û–¢–û–í–ê

**–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ!**