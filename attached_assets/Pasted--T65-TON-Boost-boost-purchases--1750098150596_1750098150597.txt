‚úÖ T65: –ü–æ—á–∏–Ω–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π TON Boost –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ boost_purchases

‚∏ª

üéØ –¶–µ–ª—å –∑–∞–¥–∞—á–∏

–û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –æ—Ç TON Boost –ø–∞–∫–µ—Ç–æ–≤ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—é —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã Boost-–º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–ª –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–∞–∫ –∑–∞–¥—É–º—ã–≤–∞–ª–æ—Å—å.

‚∏ª

üìå –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

1. Row‚ÄëLevel Security (RLS) ‚Äî boost_purchases
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ RLS –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ boost_purchases –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å:
 ‚Ä¢ –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é –≤ Supabase SQL Editor:

INSERT INTO public.boost_purchases (user_id, boost_id, source, tx_hash, status, created_at)
VALUES ( <—Ç–µ—Å—Ç–æ–≤—ã–π user>, <—Ç–µ—Å—Ç–æ–≤—ã–π boost>, 'ton', '<—Ç–µ—Å—Ç-—Ö–µ—à>', 'pending', now() );


 ‚Ä¢ –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É, –¥–æ–±–∞–≤–∏–≤ auth.uid() = user_id –∏–ª–∏ –∞–Ω–∞–ª–æ–≥.

 ‚Ä¢ –ü–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å—å –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.

2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ tonBoostIncomeScheduler.ts
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ cron-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç)
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ BOOST —Å status = confirmed
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å DEBUG/INFO-—Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø–æ–ø—ã—Ç–∫–∞—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è.
 ‚Ä¢ –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
 ‚Ä¢ –°–æ–∑–¥–∞—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ton_boost_income –≤ —Ç–∞–±–ª–∏—Ü–µ transactions
 ‚Ä¢ –°–æ–∑–¥–∞—é—Ç—Å—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ boost_purchases —Å status = confirmed –∏–ª–∏ completed
 ‚Ä¢ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (user_balances.balance_ton) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—É–º–º—É –¥–æ—Ö–æ–¥–∞

3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
 ‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ logger.info/logger.error:
 ‚Ä¢ –ö–æ–≥–¥–∞ scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
 ‚Ä¢ –ö–∞–∫–∏–µ –ø–∞–∫–µ—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
 ‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
 ‚Ä¢ –≠—Ç–æ –æ–±–ª–µ–≥—á–∏—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –Ω–∞ –ø—Ä–æ–¥–µ

4. –°—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
 ‚Ä¢ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—Ä—É—á–Ω—É—é –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ Boost:
 ‚Ä¢ –ß–µ—Ä–µ–∑ API POST /api/v2/boost/purchase —Å test-–¥–∞–Ω–Ω—ã–º–∏, –≤–∫–ª—é—á–∞—è tx_hash
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∞ boost_purchases –ø–æ—è–≤–∏–ª–∞—Å—å —Å—Ç—Ä–æ–∫–∞ pending
 ‚Ä¢ –ó–∞–ø—É—Å—Ç–∏—Ç—å scheduler –≤—Ä—É—á–Ω—É—é (await tonBoostIncomeScheduler.run())
 ‚Ä¢ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
 ‚Ä¢ –í transactions –ø–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ ton_boost_income
 ‚Ä¢ –ó–∞–ø–∏—Å—å –≤ boost_purchases –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (status = confirmed)
 ‚Ä¢ –ë–∞–ª–∞–Ω—Å –¢–û–ù (user_balances.balance_ton) —É–≤–µ–ª–∏—á–µ–Ω

‚∏ª

‚úçÔ∏è –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∞–≥–µ–Ω—Ç–∞

T65: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ –æ—Ç TON Boost
 1. –ü—Ä–æ–≤–µ—Ä—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫–ª—é—á–∏/–∏–∑–º–µ–Ω–∏ RLS –¥–ª—è boost_purchases, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–µ—à–∏—Ç—å insert.
 2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ tonBoostIncomeScheduler.ts –≤–∫–ª—é—á–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É confirmed Boost:
 ‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ transactions —Ç–∏–ø ton_boost_income
 ‚Ä¢ –û–±–Ω–æ–≤–ª—è–µ—Ç boost_purchases.status –Ω–∞ confirmed
 ‚Ä¢ –î–æ–±–∞–≤–ª—è–µ—Ç –∫ user_balances.balance_ton
 3. –î–æ–±–∞–≤—å –ª–æ–≥–∏ –≤ scheduler (start, –ø–∞–∫–µ—Ç ID, —Ä–µ–∑—É–ª—å—Ç–∞—Ç).
 4. –ü—Ä–æ–≤–µ–¥–∏ —Ç–µ—Å—Ç:
 ‚Ä¢ –°–æ–∑–¥–∞–π Boost —á–µ—Ä–µ–∑ API
 ‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –ø–æ—è–≤–∏–ª–∏—Å—å pending, –ø–æ—Å–ª–µ scheduler ‚Äî confirmed, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å.

‚∏ª