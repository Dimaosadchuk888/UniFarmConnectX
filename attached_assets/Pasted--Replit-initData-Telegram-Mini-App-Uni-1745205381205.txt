Техническое Задание для Replit

Тема: Аудит передачи и обработки initData от Telegram в Mini App UniFarm

Цель задачи:

Понять, почему при открытии Mini App через Telegram появляется ошибка:

«Не удалось подтвердить ваш аккаунт Telegram»

Требования:
 1. Проверить на клиенте (frontend):
 • Вывести в консоль браузера значение window.Telegram?.WebApp?.initData и initDataUnsafe.
 • Проверить, действительно ли получаются данные от Telegram при запуске Mini App через Telegram.
 • Добавить временное логирование: console.log("initData from Telegram:", window.Telegram?.WebApp?.initData);
console.log("initDataUnsafe from Telegram:", window.Telegram?.WebApp?.initDataUnsafe); 


 2. Проверить на сервере (backend):
 • Логировать заголовки всех запросов /api/me и /api/referral/register-start-param, чтобы проверить наличие Telegram-данных.
 • Добавить временные логи в userController.ts и authController.ts: console.log("Received headers:", req.headers);
console.log("Parsed Telegram data:", parsedData); 


 3. Провести аудит валидации initData:
 • Проверить, не отклоняется ли валидатором initData, даже если оно передано.
 • Убедиться, что:
 • Проверка подписи Telegram initData проходит корректно.
 • Время жизни initData (auth_date) не истекло.
 4. Проверить код, связанный с ошибкой отображения в UI:
 • Убедиться, что блок с ошибкой (isTelegramError) отображается только при реальном отсутствии initData, а не из-за других сбоев валидации.
 5. Ничего не исправлять, только провести аудит и дать отчёт:
 • Какие данные реально передаются от клиента на сервер.
 • Где именно происходит сбой: на фронте, в заголовках, при валидации или в логике отображения UI.

Ограничения:
 • Нельзя переписывать основную бизнес-логику без согласования.
 • Нельзя хардкодить initData для теста — работать только с реальными данными из Telegram.
 • Все изменения — в отдельной тестовой ветке или в комментариях в коде.

⸻

Цель: Нам нужен чёткий отчёт, где именно происходит обрыв авторизации между Telegram и приложением.