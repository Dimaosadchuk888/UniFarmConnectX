üßæ –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: T42

üìå –†–æ–ª—å:

–í—ã ‚Äî AI-–∏–Ω–∂–µ–Ω–µ—Ä –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ UniFarm. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ø–æ—á–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram Mini App, –≤–∫–ª—é—á–∞—è initData, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Supabase DB. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –¥–æ–¥—É–º—ã–≤–∞—Ç—å, –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –∏–ª–∏ —á–∏–Ω–∏—Ç—å –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

‚∏ª

üß© –ö–æ–Ω—Ç–µ–∫—Å—Ç:

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Mini App –≤ Telegram –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä–µ:
 ‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
 ‚Ä¢ Telegram.initData –ª–∏–±–æ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è, –ª–∏–±–æ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
 ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Supabase DB
 ‚Ä¢ JWT –∏–ª–∏ ref_code –Ω–µ –≤—ã–¥–∞—é—Ç—Å—è

‚∏ª

üîç –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–ø–æ —à–∞–≥–∞–º):

üîπ 1. Frontend (initData)
 ‚Ä¢ –ì–¥–µ –∏ –∫–∞–∫ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è window.Telegram.WebApp.initData –∏–ª–∏ initDataUnsafe
 ‚Ä¢ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ Telegram WebApp SDK
 ‚Ä¢ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ª–∏ Telegram WebApp (Telegram.WebApp.ready() / expand() / sendData())

üîπ 2. –ü–µ—Ä–µ–¥–∞—á–∞ initData ‚Üí backend
 ‚Ä¢ –ì–¥–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è initData –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Mini App
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–∑–æ–≤ /auth/telegram –∏–ª–∏ /api/v2/auth/telegram
 ‚Ä¢ –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä initData –≤ —Ç–µ–ª–µ –∏–ª–∏ –≤ query

üîπ 3. Backend –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç–æ–¥ validateTelegramInitData() –≤ authService.ts
 ‚Ä¢ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è initData: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ Telegram Bot Token (–∏–∑ .env)
 ‚Ä¢ –ö–∞–∫–∏–µ –ø–æ–ª—è –±–µ—Ä—É—Ç—Å—è –∏–∑ initData (id, username, hash –∏ —Ç.–¥.)
 ‚Ä¢ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ: –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è 401/500/redirect?

üîπ 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ createUserFromTelegram() –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 ‚Ä¢ –°–æ–∑–¥–∞—ë—Ç—Å—è –ª–∏ ref_code, telegram_id, username
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É users –≤ Supabase: –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?
 ‚Ä¢ –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è?

üîπ 5. –í—ã–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ / ref_code
 ‚Ä¢ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ª–∏ JWT –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏?
 ‚Ä¢ –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ref_code?
 ‚Ä¢ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–∏ –æ–Ω –≤ Supabase?

‚∏ª

‚ö†Ô∏è –û—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å:
 ‚Ä¢ initData = undefined/null
 ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É
 ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –±–∞–∑–µ
 ‚Ä¢ Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ç–æ–∫–µ–Ω
 ‚Ä¢ Telegram WebApp –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –≤ –æ–∫–Ω–µ

‚∏ª

üö´ –ó–∞–ø—Ä–µ—â–µ–Ω–æ:
 ‚Ä¢ –ú–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–¥–∞
 ‚Ä¢ –£–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ø–∞–ø–∫–∏
 ‚Ä¢ –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å WebApp –∏–ª–∏ authService
 ‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–≥–ª—É—à–∫–∏, mock –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ—Å—Ç—ã–ª–∏

‚∏ª

üì§ –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞:

üßæ –û–¢–ß–ï–¢ –ü–û T42: –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram initData

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp: ‚úÖ/‚ùå
2. –ó–Ω–∞—á–µ–Ω–∏–µ initData (–≤ –∫–æ–Ω—Å–æ–ª–∏/–ø–µ—Ä–µ–¥–∞—á–µ): ...
3. –í—ã–∑–æ–≤ /auth/telegram: ‚úÖ/‚ùå (—á—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è)
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ validateTelegramInitData(): ...
5. –°—Ç–∞—Ç—É—Å createUserFromTelegram(): ‚úÖ/‚ùå
6. –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ Supabase (–ø–æ telegram_id): ...
7. –í—ã–¥–∞—ë—Ç—Å—è –ª–∏ JWT/ref_code: ...
8. –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã: ...
9. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: ...


‚∏ª

üéØ –¶–µ–ª—å –∑–∞–¥–∞—á–∏:

–í—ã—è–≤–∏—Ç—å, –ø–æ—á–µ–º—É Telegram WebApp –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –∏–ª–∏ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç initData, –∏ –ø–æ—á–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ Supabase. –†–µ—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç–æ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≤–∞—à–µ–≥–æ –æ—Ç—á–µ—Ç–∞.

‚∏ª