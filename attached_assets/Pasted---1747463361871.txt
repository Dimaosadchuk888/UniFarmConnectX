–í–æ—Ç –∫–∞–∫ –º–æ–∂–Ω–æ —ç—Ç–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –≤ –≤–∏–¥–µ —á—ë—Ç–∫–æ–≥–æ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¢–ó –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

---

üìã **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î**

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ `storage-adapter.ts`

* –í –º–µ—Ç–æ–¥–µ `checkDatabaseConnection` **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `queryWithRetry`, –∞ –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω—É—é.
* –ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```ts
import { queryWithRetry } from "./db-selector-new";

private async checkDatabaseConnection(): Promise<boolean> {
  try {
    await queryWithRetry('SELECT 1', [], 1); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–º–ø–æ—Ä—Ç
    console.log('[StorageAdapter] –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
    this.useMemory = false;
    return true;
  } catch (error) {
    console.error('[StorageAdapter] –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –ø–∞–º—è—Ç–∏:', error);
    this.useMemory = true;
    return false;
  }
}
```

---

### 2. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –ë–î

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```
db.ts              // –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
db-selector.ts     // –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ë–î
storage-adapter.ts // –†–∞–±–æ—Ç–∞ —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –¥–∞–Ω–Ω—ã—Ö
```

* –ò—Å–∫–ª—é—á–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ `db-selector-new.ts`, –ª–∏–±–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –µ–≥–æ –≤ `db-selector.ts` –∏ —É–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ñ–∞–π–ª.
* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ **–≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã** –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è.

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π URL —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Ö–æ—Å—Ç–æ–º –∏ –ø–æ—Ä—Ç–æ–º Neon DB.
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

  * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSL-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ).
  * –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
  * –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–¥—ë—Ç –∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º—É —Ä–µ–≥–∏–æ–Ω—É Neon DB.

---

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫

* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:

  * –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫.
  * –í –ª–æ–≥–∞—Ö –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–æ–∫ `TypeError: queryWithRetry is not a function`.
  * –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –ë–î –∏ –ø–∞–º—è—Ç—å—é –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î.

üìå –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç –æ –≤–Ω–µ—Å—ë–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫.

---

–ï—Å–ª–∏ –≤—Å—ë —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç, —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–π! üòä
