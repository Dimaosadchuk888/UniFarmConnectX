üî¨ –ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ü–†–û–ú–¢: –ü–†–û–ë–õ–ï–ú–ê –°–û–ó–î–ê–ù–ò–Ø –ê–ö–ö–ê–£–ù–¢–û–í –ò –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –°–°–´–õ–ö–ò

üìå –ö–æ–Ω—Ç–µ–∫—Å—Ç:
 1. –†–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π):
 ‚Ä¢ –ï—Å—Ç—å –≤ Supabase (users, referral_links)
 ‚Ä¢ –ù–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Mini App –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –Ω–µ—Ç —Ä–µ—Ñ. —Å—Å—ã–ª–∫–∏
 ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ, frontend –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–ª–∏ –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç referral_code –∏–∑ Supabase
 2. –ù–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç (—Å–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π):
 ‚Ä¢ –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
 ‚Ä¢ –ù–æ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ Supabase (—Ç–∞–±–ª–∏—Ü–∞ users)
 ‚Ä¢ –ù–µ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∏ –≤ users, –Ω–∏ –≤ referral_links

‚∏ª

üõ†Ô∏è –ó–ê–î–ê–ß–ê: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase

‚úÖ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–ø–æ—à–∞–≥–æ–≤–æ):

‚∏ª

üîπ –®–∞–≥ 1 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ Telegram init data
 1. –í client/src/App.tsx –∏/–∏–ª–∏ main.tsx:
 ‚Ä¢ –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è window.Telegram.WebApp?
 ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ initDataUnsafe.user?.id?
 ‚Ä¢ –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç id –≤ API / Supabase?
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ —Ñ—É–Ω–∫—Ü–∏—è registerOrGetUser() –∏–ª–∏ syncTelegramUser()?
 2. –í—ã–∑–æ–≤ API:
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ /api/v2/users (–∏–ª–∏ POST /users) –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ?
 ‚Ä¢ –û–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è? –£—Ö–æ–¥–∏—Ç –ª–∏ user data –Ω–∞ backend?

‚∏ª

üîπ –®–∞–≥ 2 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ backend API (Node.js Express)
 1. –í server/routes/user.ts:
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ —Ä–æ—É—Ç POST /users –∏–ª–∏ GET /users/me?
 ‚Ä¢ –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: —Å–æ–∑–¥–∞—ë—Ç –ª–∏ –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ users?
 ‚Ä¢ –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –ª–∏ referral_code –∏–ª–∏ ref_link?
 2. –õ–æ–≥–∏–∫–∞ –ø–æ referral_link:
 ‚Ä¢ –°–æ–∑–¥–∞—ë—Ç—Å—è –ª–∏ –∑–∞–ø–∏—Å—å –≤ referral_links –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?
 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS (Row Level Security):
 ‚Ä¢ –í–∫–ª—é—á–µ–Ω–∞ –ª–∏ RLS –≤ Supabase?
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—Å—Ç–∞–≤–∫—É (insert) –≤ —Ç–∞–±–ª–∏—Ü—É users?

‚∏ª

üîπ –®–∞–≥ 3 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ frontend –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
 1. –í Dashboard.tsx, Referral.tsx:
 ‚Ä¢ –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è referral_link –∏–ª–∏ referral_code?
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–∏–µ if (!user?.referral_code) ‚Üí –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å?
 2. –í—ã–∑–æ–≤ API –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏:
 ‚Ä¢ –ü—Ä–∏—Ö–æ–¥–∏—Ç –ª–∏ JSON —Å referral_code –≤ /api/v2/users/me?
 ‚Ä¢ –ò–ª–∏ —Ñ—Ä–æ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç /referral-link?
 3. –ï—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
 ‚Ä¢ user is undefined
 ‚Ä¢ referral_code is null
 ‚Ä¢ 401 Unauthorized –Ω–∞ /api/v2/users

‚∏ª

üìã –§–∏–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω

üîé –ê–Ω–∞–ª–∏–∑: –ü–æ—á–µ–º—É –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ (Express) ‚Äî –µ—Å—Ç—å –ª–∏ –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Mini App
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram initData ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –≤ req.body –∏ –µ—Å—Ç—å –ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã?
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ª–∏ Supabase insert() ‚Üí –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ insert RLS –∏–ª–∏ –æ—Ç–≤–∞–ª–∏–ª—Å—è Supabase client

üß© –ê–Ω–∞–ª–∏–∑: –ü–æ—á–µ–º—É –Ω–µ—Ç referral —Å—Å—ã–ª–∫–∏
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –ø–æ–ª–µ referral_code –∏–ª–∏ referral_link –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç API
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ª–∏ frontend —Å—Å—ã–ª–∫—É –ø—Ä–∏ –ø—É—Å—Ç–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ —Å–ª–æ–º–∞–ª–∞—Å—å –ª–∏ –ª–æ–≥–∏–∫–∞ –∏–∑-–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ useUser() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null)

‚∏ª

üìå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

–•–æ—á–µ—à—å ‚Äî —è –º–æ–≥—É:
 ‚Ä¢ üìÑ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è Supabase, —á—Ç–æ–±—ã –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–∑–¥–∞—é—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
 ‚Ä¢ üì¶ –ù–∞–ø–∏—Å–∞—Ç—å mock-—Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏
 ‚Ä¢ üõ†Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω API-–æ—Ç–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –Ω–∞ /users/me

‚∏ª

üì≤ –ö–æ–≥–¥–∞ –ø–æ–ª—É—á–∏—à—å –ø–µ—Ä–≤—ã–µ –ª–æ–≥–∏ –∏–ª–∏ —É–≤–∏–¥–∏—à—å –∫–∞–∫–∏–µ API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —É—Ö–æ–¥—è—Ç ‚Äî —Å—Ä–∞–∑—É —Å–æ–æ–±—â–∏, –ø–æ–π–¥—ë–º –ø–æ —Å–ª–µ–¥—É.