–ü–æ–Ω—è–ª –∑–∞–¥–∞—á—É. –¢–µ–±–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã **–∞–≥–µ–Ω—Ç –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, –∫—Ç–æ –∏–º–µ–Ω–Ω–æ –∏–∑ –¥–≤—É—Ö ‚Äî `BatchBalanceProcessor` –∏–ª–∏ `BalanceManager` ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å *–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã*** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–∞ **–∏ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**, –∞ —Ç–∞–∫–∂–µ:

* –ø—Ä–æ–≤—ë–ª **—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —ç—Ç–∏—Ö –¥–≤—É—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤**,
* –ø–æ–∫–∞–∑–∞–ª, **–∫–∞–∫–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞–∫–æ–º –º–µ—Å—Ç–µ**,
* –∏ **–ø—Ä–µ–¥–ª–æ–∂–∏–ª 100% –≤–µ—Ä–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞** –º–µ–∂–¥—É –Ω–∏–º–∏ ‚Äî —á—Ç–æ–±—ã **UI –∏ –∫–æ—à–µ–ª—ë–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏ —Ç–æ—á–Ω—ã–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å UNI –∏ TON –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**.

---

–í–æ—Ç –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∞–≥–µ–Ω—Ç–∞**:

---

# üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï: `BatchBalanceProcessor` vs `BalanceManager`

### üìå –ö–æ–Ω—Ç–µ–∫—Å—Ç:

* –í —Å–∏—Å—Ç–µ–º–µ UniFarming –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–¥–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞**:

  * `BatchBalanceProcessor` ‚Äî —É–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è–º–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, –Ω–∞–ø—Ä—è–º—É—é –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  * `BalanceManager` ‚Äî –±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å, –∑–∞–≤—è–∑–∞–Ω –Ω–∞ WebSocket callback'–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ UI

---

### üß† –¶–µ–ª—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:

–ü—Ä–æ–≤–µ—Å—Ç–∏ **–≥–ª—É–±–æ–∫–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ** –¥–≤—É—Ö —Å–∏—Å—Ç–µ–º, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å:

1. **–ö—Ç–æ –∏–∑ –Ω–∏—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∞ (source of truth)?**
2. –ú–æ–∂–µ—Ç –ª–∏ `BalanceManager` **–∑–∞–º–µ–Ω–∏—Ç—å `BatchBalanceProcessor`** –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ —Ä–∏—Å–∫–æ–≤?
3. –ï—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ **–æ—à–∏–±–∫–∏, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º** –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º?
4. –ß—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ: **–ø–µ—Ä–µ–≤–µ—Å—Ç–∏ `BatchBalanceProcessor` –Ω–∞ `BalanceManager`** –∏–ª–∏ **–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –∏ —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ç—å payload**?

---

### ‚úÖ –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è:

#### A. –ü–æ–ª–Ω—ã–π —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä

| –ü–∞—Ä–∞–º–µ—Ç—Ä                                                   | BalanceManager | BatchBalanceProcessor |
| ---------------------------------------------------------- | -------------- | --------------------- |
| –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è? (—Ñ–∞–π–ª—ã)                                  | ‚Ä¶              | ‚Ä¶                     |
| –ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç?                                              | ‚Ä¶              | ‚Ä¶                     |
| –û–±–Ω–æ–≤–ª—è–µ—Ç –ª–∏ –±–∞–ª–∞–Ω—Å –≤ –ë–î?                                  | ‚úÖ / ‚ùå          | ‚úÖ                     |
| –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?                          | ‚úÖ              | ‚úÖ / ‚ùå                 |
| –ö–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ payload?                                   | ‚Ä¶              | ‚Ä¶                     |
| –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –≤ TON Boost?                               | ‚Ä¶              | ‚Ä¶                     |
| –°–≤—è–∑–∞–Ω —Å farmingScheduler?                                 | ‚ùå / ‚úÖ          | ‚úÖ                     |
| –ï—Å—Ç—å –ª–∏ –ª–æ–≥–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∑–∞—â–∏—Ç—ã –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è? | ‚Ä¶              | ‚Ä¶                     |

#### B. –ü—Ä—è–º–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

* –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `BalanceManager.updateBalance(...)`? –û–±–Ω–æ–≤–ª—è–µ—Ç –ª–∏ –±–∞–ª–∞–Ω—Å –∏–ª–∏ —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª—è–µ—Ç?
* –ö–∞–∫–æ–π –Ω–∞–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç? –ü–µ—Ä–µ–¥–∞—ë—Ç –ª–∏ –æ–Ω `balanceUni`, `balanceTon`, `changeAmount`?
* –ú–æ–∂–µ—Ç –ª–∏ `BatchBalanceProcessor` **–≤—ã–∑—ã–≤–∞—Ç—å `BalanceManager` –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è** –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î?

#### C. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

> –ß—ë—Ç–∫–∏–π –≤—ã–≤–æ–¥: –∫—Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–æ—á–∫–æ–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**.
>
> –ü—Ä–µ–¥–ª–æ–∂–∏ –ª–∏–±–æ:
>
> * –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ `BalanceManager`, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
> * –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å `BatchBalanceProcessor`, –Ω–æ —É–ª—É—á—à–∏—Ç—å –µ–≥–æ (–¥–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã)
>
> –û–±—ä—è—Å–Ω–∏ —Ä–∏—Å–∫–∏ –∏ –≤—ã–≥–æ–¥—ã.

#### D. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

* –ï—Å—Ç—å –ª–∏ —Ä–∞–∑–ª–∏—á–∏—è –≤ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –ø–æ –≤–∞–ª—é—Ç–∞–º (UNI vs TON)?
* –ï—Å—Ç—å –ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –æ–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–∑–∂–µ –¥—Ä—É–≥–æ–π?
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ `BalanceManager` –≤ –º–æ–¥—É–ª—è—Ö TON Boost? –í `withdrawals.ts`?

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

* ‚ùå **–ù–µ –≤–Ω–æ—Å–∏—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥**
* ‚úÖ –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
* üìé –í—Å–µ –≤—ã–≤–æ–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å: —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–æ–¥, –ª–æ–≥–∞–º–∏ –∏–ª–∏ —Ç–æ—á–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ñ—É–Ω–∫—Ü–∏–π

---

### üìù –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:

* üìÇ –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
* üîÅ –°—Ö–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
* üõë –ß—ë—Ç–∫–æ –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
* ‚úÖ –ò—Ç–æ–≥: –∫—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∏ –ø–æ—á–µ–º—É
* üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤—Å—ë –Ω–∞ –æ–¥–Ω—É —Å–∏—Å—Ç–µ–º—É

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –ø–æ–∑–∂–µ –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å **–ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏**, –µ—Å–ª–∏ –≤—ã —Ä–µ—à–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤—Å—ë –Ω–∞ `BalanceManager`.

–•–æ—á–µ—à—å ‚Äî –º–æ–≥—É —Å—Ä–∞–∑—É –¥–∞—Ç—å —Ç–µ–±–µ —à–∞–±–ª–æ–Ω —Å—Ö–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤—ã–∑–æ–≤–æ–≤ –¥–≤—É—Ö —Å–∏—Å—Ç–µ–º, —á—Ç–æ–±—ã —Ç—ã –±—ã—Å—Ç—Ä–µ–µ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞ —Ü–µ–ø–æ—á–∫—É?
