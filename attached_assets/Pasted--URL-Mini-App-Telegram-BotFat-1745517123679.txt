Техническая задача для устранения проблемы лишнего слэша в URL Mini App

Цель:
Telegram через BotFather автоматически добавляет / в конце URL Mini App. Это ломает передачу window.Telegram.WebApp.initData, и приложение считает, что оно запущено вне Telegram.

Требования:
 1. Не изменять текущую структуру проекта
 2. Не трогать работающие модули авторизации, кабинета, фарминга и т.п.
 3. Внести только необходимую логику для устранения последствий / в конце URL

⸻

Что нужно сделать:

✅ Вариант 1: Редирект на сервере (основной способ)

Добавить на сервер (в server.ts, routes.ts или аналогичном файле) следующий обработчик: 

app.get('*/', (req, res) => {
  if (req.path.endsWith('/') && req.path !== '/') {
    res.redirect(301, req.path.slice(0, -1) + req.url.slice(req.path.length));
  } else {
    next();
  }
}); 

Зачем:
Telegram может открывать Mini App как / или /?startapp=.../, или /#/, и в этих случаях window.Telegram может быть пустым.
Редирект гарантирует попадание на “чистый” URL без слеша. 

✅ Вариант 5 (опционально): Защита на клиенте

Добавить в index.html или главный React-файл: 

<script>
  if (window.location.pathname.endsWith('/') && window.location.pathname !== '/') {
    window.history.replaceState({}, document.title,
      window.location.pathname.slice(0, -1) + window.location.search + window.location.hash
    );
  }
</script> 

Зачем:
Иногда Telegram открывает Mini App с / в hash-режиме — это поможет исправить клиентский маршрут до инициализации React.

⸻

Что не нужно:
 • Не менять ссылки в BotFather — они уже настроены правильно
 • Не внедрять альтернативные параметры типа ?tma=true
 • Не модифицировать TelegramInitDataWarning или компонент кабинета

⸻

После реализации:
 1. Проверить, что Mini App открывается без Not Found
 2. Проверить, что window.Telegram.WebApp.initData присутствует
 3. Проверить, что не появляется жёлтое предупреждение «Приложение не открыто из Telegram»

⸻

Если агенту нужно — я готов помочь протестировать эти изменения после внедрения.