# Технический запрос: «ПОЧЕМУ НЕ РАБОТАЕТ CONNECT WALLET?»

## Контекст
- Прод-домен: https://uni-farm-connect-x-elizabethstone1.replit.app
- При нажатии «Connect Wallet» все кошельки показывают “Ошибка манифеста”.
- Мы уверены, что актуальный файл `/.well-known/tonconnect-manifest.json` создан.
- Подозрение: в коде или конфиге остался альтернативный (старый) манифест либо путь формируется неверно.

## Что нужно проверить (короткий чек-лист)

| № | Проверить | Как именно |
|---|-----------|-----------|
| 1 | Файл манифеста на проде | curl -I https://uni-farm-connect-x-elizabethstone1.replit.app/.well-known/tonconnect-manifest.json → должен вернуть 200 и Content-Type: application/json. |
| 2 | Есть ли дубли манифеста | grep -R "tonconnect-manifest" . — найти все пути и убедиться, что в проекте только один актуальный файл. |
| 3 | Как формируется `manifestUrl` в коде | В компоненте ConnectWallet (обычно TonConnectButton.tsx или wallet-connect.ts`) посмотреть, откуда берётся `manifestUrl. Должно быть:
const manifestUrl = `${window.location.origin}/.well-known/tonconnect-manifest.json`; |
| 4 | Старые/альтернативные ссылки | grep -R "github.*tonconnect" . и grep -R "http" .well-known — убедиться, что никакой GitHub-URL или прежний домен не жёстко прописан. |
| 5 | Включён ли манифест в билд Replit | После npm run build или автодеплоя проверить, что папка .well-known присутствует в каталоге, который Replit отдаёт (обычно build/ или `dist/`). |
| 6 | Правила роутинга Replit | В файле replit.nix`/`Replfile`/`nginx.conf (если есть) убедиться, что нет rewrite, который перенаправляет всё на index.html и пропускает .well-known/*. |
| 7 | Кэш Cloudflare (если подключён) | Сделать HEAD-запрос с заголовком Cache-Control: no-cache; если 200 появляется только так — очистить кэш. |

## Выходные данные
После проверки пришлите таблицу:

| Пункт | Статус | Что нашли / строка файла |
|-------|--------|--------------------------|
| 1. HTTP-статус манифеста | 200 / 404 / … | — |
| 2. Дубли файлов | да / нет | пути |
| 3. manifestUrl в коде | корректен / ошибочен | файл:строка |
| 4. Старые ссылки | найдены / нет | примеры |
| 5. В билде | есть / нет | путь |
| 6. Rewrite | ок / править | файл:строка |
| 7. Кэш | влияет / нет | — |

Ничего не правим, только собираем факты и присылаем отчёт.