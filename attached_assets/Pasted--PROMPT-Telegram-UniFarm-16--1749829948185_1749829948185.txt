üü® PROMPT: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ UniFarm (–¢16)

–ö–æ–Ω—Ç–µ–∫—Å—Ç:
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è UniFarm, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 Unauthorized, –∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. Telegram Mini App –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ initData –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

‚∏ª

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
–ü—Ä–æ–≤–µ—Å—Ç–∏ –≥–ª—É–±–æ–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram Mini App –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏.

‚∏ª

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏:
 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É initData
‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ window.Telegram.WebApp.initData –∏–ª–∏ initDataUnsafe –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ AuthService.
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç useTelegram() ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω –∏–∑–≤–ª–µ–∫–∞—Ç—å telegram_id, username, ref –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ö –≤ API.
‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ –∫–∞–∂–¥–æ–º fetch() –∑–∞–ø—Ä–æ—Å–µ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ x-telegram-init-data.
 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram Middleware –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å middleware validateTelegramUser() –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π.
‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ–Ω –ø–∞—Ä—Å–∏—Ç initData, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç hash, –∏–∑–≤–ª–µ–∫–∞–µ—Ç telegram_id –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–∞–ª—å—à–µ.
 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç /api/v2/register/telegram
‚Ä¢ –û–Ω –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
‚Ä¢ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â—ë –Ω–µ—Ç –≤ –ë–î ‚Äî –æ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è.
‚Ä¢ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –µ—Å—Ç—å ‚Äî –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –µ–≥–æ user_id, ref_code, username.
 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –ë–î
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—É users ‚Äî –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å telegram_id.
‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç fallback –Ω–∞ guest_id.
 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å client-side –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
‚Ä¢ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã Telegram auth.
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É initData –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ.

‚∏ª

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
üîí –ù–µ–ª—å–∑—è —Ç—Ä–æ–≥–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –¢–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
üîí –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–±—Ö–æ–¥—ã.

‚∏ª

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ initData –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ë–î
‚úÖ –í—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ API —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ 401
‚úÖ –í –ª–æ–≥–µ –≤–∏–¥–Ω–æ [TelegramMiddleware] Valid Telegram user
‚úÖ –ù–∞ —ç–∫—Ä–∞–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –∏ –±–∞–ª–∞–Ω—Å

‚∏ª

–ï—Å–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞ —Å initData, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å –ª–æ–≥ console.warn('No initData provided') –≤ middleware –∏ client –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.