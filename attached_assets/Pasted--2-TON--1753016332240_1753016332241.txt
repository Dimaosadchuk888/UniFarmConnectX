üß© –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ 2: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–µ–æ—Ç–æ–±—Ä–∞–∂–∞—é—â–µ–≥–æ—Å—è TON-–±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ TON Connect

‚∏ª

üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç
 ‚Ä¢ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ ConnectWallet / Tonkeeper
 ‚Ä¢ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –∫–æ—à–µ–ª—å–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
 ‚Ä¢ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ (—Ç–∏–ø TON_DEPOSIT –ª–∏–±–æ –≤ –≤–∏–¥–µ —Ö—ç—à–∞)
 ‚Ä¢ –ù–û: balance_ton –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è

‚∏ª

üîç –ß—Ç–æ –Ω—É–∂–Ω–æ –≤—ã—è—Å–Ω–∏—Ç—å

–ü–æ—á–µ–º—É –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
 ‚Ä¢ –ë–∞–ª–∞–Ω—Å –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
 ‚Ä¢ –ü—Ä–∏ —ç—Ç–æ–º –Ω–µ—Ç –æ—à–∏–±–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –∏ –±–µ–∫–µ–Ω–¥–µ, –∏ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É–∂–µ —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è

‚∏ª

‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
 1. –§—Ä–æ–Ω—Ç–µ–Ω–¥-—á–∞—Å—Ç—å
 ‚Ä¢ –£–±–µ–∂–¥–∞–µ—Ç—Å—è –ª–∏ —Ñ—Ä–æ–Ω—Ç –≤ —Ç–æ–º, —á—Ç–æ correctApiRequest('/api/v2/wallet/ton-deposit'...) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
 ‚Ä¢ –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ amount –∏ ton_tx_hash –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å number, –∞ –Ω–µ —Å—Ç—Ä–æ–∫–∞ –∏ –Ω–µ undefined)
 2. –ú–µ—Ç–æ–¥ tonDeposit() –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
 ‚Ä¢ –î–æ—Ö–æ–¥–∏—Ç –ª–∏ ton_tx_hash –¥–æ processTonDeposit(...)?
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ –∫–∞–∫–∏–µ-–ª–∏–±–æ silent-–æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–≤–∞–ª–∏–¥–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö—ç—à–∞, –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π await, –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ !isReady)
 3. –ú–µ—Ç–æ–¥ processTonDeposit()
 ‚Ä¢ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏ –≤—ã–∑–æ–≤ balanceManager.addBalance(userId, amount, 0, 'TON deposit')
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ —É—Å–ª–æ–≤–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –±–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, if (!txId) return)
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ª–∏ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ environment –∏–ª–∏ wallet_type
 4. BalanceManager
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–µ—Ç–æ–¥ addBalance() –Ω–µ silently –ø–∞–¥–∞–µ—Ç
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ 0 –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
 ‚Ä¢ –ï—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—à–µ–ª—å–∫–∞ –∏–ª–∏ wallet_type
 5. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
 ‚Ä¢ –í —Ç–∞–±–ª–∏—Ü–µ balances –∑–Ω–∞—á–µ–Ω–∏–µ balance_ton –Ω–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å: –ø–æ—á–µ–º—É?
 ‚Ä¢ –ë—ã–ª –ª–∏ –∫–æ–º–º–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏? –ï—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å –≤ wallet_logs –∏–ª–∏ transactions?

‚∏ª

üß™ –í–∞–∂–Ω–æ
 ‚Ä¢ –¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å hash: 00a1ba3c2614f4d65cc346805feea960 ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –Ω–æ –±–∞–ª–∞–Ω—Å –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.
 ‚Ä¢ –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: processTonDeposit –æ—Ç—Ä–∞–±–æ—Ç–∞–ª —á–∞—Å—Ç–∏—á–Ω–æ ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ addBalance() –Ω–µ –ø—Ä–∏–º–µ–Ω—ë–Ω –ª–∏–±–æ –æ—Ç–∫–∞—Ç–∏–ª—Å—è.

‚∏ª

üõë –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

–ö–æ–¥ –Ω–µ –∏–∑–º–µ–Ω—è—Ç—å. –ù–∏ –≤ backend, –Ω–∏ –≤ frontend. –ü–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç:
 ‚Ä¢ –ü–æ–¥—Ä–æ–±–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏,
 ‚Ä¢ –ß—ë—Ç–∫–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –≥–¥–µ –Ω–∞—Ä—É—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–ª–∏ –ø–æ—á–µ–º—É –Ω–µ –≤—ã–∑–≤–∞–ª—Å—è addBalance,
 ‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, —á—Ç–æ –æ–Ω–æ –Ω–µ –∑–∞—Ç—Ä–æ–Ω–µ—Ç –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã (—Ñ–∞—Ä–º–∏–Ω–≥, UniDeposit –∏ —Ç.–¥.)

‚∏ª

üéØ –¶–µ–ª—å

–ù–∞–π—Ç–∏ —Ç–æ—á–∫—É —Ä–∞–∑—Ä—ã–≤–∞ –º–µ–∂–¥—É:
 1. –£—Å–ø–µ—à–Ω—ã–º —Ñ–∞–∫—Ç–æ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ (TON hash)
 2. –°–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å—å—é –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö (transaction with type TON_DEPOSIT)
 3. –ù–µ–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º balance_ton –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è