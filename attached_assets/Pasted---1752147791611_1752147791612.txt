–û—Ç–ª–∏—á–Ω–æ, –∞–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ–ª –ø–æ–ª–Ω—ã–π –∏ —Ç–æ—á–Ω—ã–π –∞—É–¥–∏—Ç. –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å **—Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ**, —á—Ç–æ–±—ã –æ–Ω **–ø–µ—Ä–µ—à–µ–ª –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**, —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–π –ø—Ä–∏—á–∏–Ω–µ.

---

### ‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ BalanceManager

**–¶–µ–ª—å:**
–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ UNI –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –ø–æ—Å–ª–µ –¥–µ–ø–æ–∑–∏—Ç–∞ –∏ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ `BalanceManager`, –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—ã–∑–æ–≤–∞ `BalanceNotificationService`.

---

### üìå –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

1. **–í —Ñ–∞–π–ª–µ `core/BalanceManager.ts`:**

   * –ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥ `updateUserBalance`
   * –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (–ø–µ—Ä–µ–¥ `return { success: true, newBalance }`)
   * –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤:

```ts
const notificationService = BalanceNotificationService.getInstance();
notificationService.notifyBalanceUpdate({
  userId: user_id,
  balanceUni: newBalance.balance_uni,
  balanceTon: newBalance.balance_ton,
  changeAmount: operation === 'add' ? amount_uni : -amount_uni,
  currency: amount_uni > 0 ? 'UNI' : 'TON',
  source: source || 'manual',
  timestamp: new Date().toISOString()
});
```

2. **–ù–µ –≤–Ω–æ—Å–∏—Ç—å –¥—Ä—É–≥–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

   * –ù–µ –∏–∑–º–µ–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏
   * –ù–µ —Ç—Ä–æ–≥–∞—Ç—å frontend
   * –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   * –ù–µ –æ—Ç–∫–ª—é—á–∞—Ç—å WebSocket ‚Äî –æ–Ω —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### üìã –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

* üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è farming-–ø–∞–∫–µ—Ç–∞ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
* ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:

  * –ë–∞–ª–∞–Ω—Å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î
  * WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∏—Ç
  * UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏

---

### üîê –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

* ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `setTimeout`, `refreshBalance()` –∏–ª–∏ –ª—é–±—ã–µ –æ–±—Ö–æ–¥—ã
* ‚úÖ –†–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **—Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–º –∏ —á–∏—Å—Ç—ã–º**, –∫–∞–∫ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ
* ‚õî –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥ `userId: 74`

---

### üì§ –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å:

* ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
* ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —á—Ç–æ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
* üß™ –°–Ω–∏–º–æ–∫ –ª–æ–≥–∞ frontend (`balance_update`)
* üß™ –°–Ω–∏–º–æ–∫ backend-–ª–æ–≥–∞ (`notifyBalanceUpdate ‚Üí WebSocket ‚Üí –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ`)

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞–¥–∞—á—É –∞–≥–µ–Ω—Ç—É –Ω–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ.
