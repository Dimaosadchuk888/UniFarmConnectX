Техническое задание для Replit: устранение ошибки с Telegram API и реферальной ссылкой

Ограничения
 • Нельзя создавать новые компоненты, если не указано в задаче
 • Нельзя изменять или ломать уже работающие механики
 • Нельзя переписывать структуру App.tsx или Referral.tsx без согласования
 • Все логи должны быть с префиксом, чтобы легко отследить ([TG AUDIT], [REF LINK], и т.д.)

⸻

Задачи (по шагам)

✅ 1. Проверка инициализации Telegram WebApp API

Файл: App.tsx
 • Добавить лог в useEffect, который выводит:
=== [Telegram WebApp Init Check] === и Telegram.WebApp (или null)
 • Если Telegram.WebApp не определён — вывести: [TG AUDIT] Telegram WebApp не загружен

✅ 2. Проверка initDataUnsafe

Файл: telegramService.ts
 • Добавить лог === [InitData Check] ===
 • Проверить поля: user, auth_date, query_id
 • Выводить user.id, если он есть. Если нет — [TG AUDIT] Telegram ID недоступен

✅ 3. Проверка заголовков запроса на бэкенде

Файл: UserController
 • Добавить лог === [Telegram User ID Check] === из X-Telegram-User-Id
 • Убедиться, что ID используется для генерации ref_code

⬜️ 4. Проверка генерации ref_code

Файл: ReferralService.ts
 • Проверить, что если user.id передан, то:
 • создается пользователь
 • создается ref_code
 • возвращается в ответе API

⬜️ 5. Проверка отображения ссылки

Файл: Referral.tsx
 • Проверить, что ссылка https://t.me/UniFarming_Bot/app?startapp=ref_<код>
генерируется из ref_code, возвращенного с бэка
 • Если нет кода — отображать [TG AUDIT] Не удалось получить ссылку

⸻

Дополнительные задачи по аудиту

⬜️ 6. Проверка поведения с новым аккаунтом
 • Подключить чистый Telegram-аккаунт
 • Убедиться, что ID корректно передан и ref_code сгенерирован

⬜️ 7. Проверка поведения на dev и prod-доменах
 • Убедиться, что в BotFather указан только prod-домен
https://uni-farm-connect-2-misterxuniverse.replit.app
 • Проверить, что dev-домен не используется для загрузки манифеста

⸻

Если задача выполнена — отмечай её галочкой ✅
Если задача не может быть выполнена — логируй причину и не внедряй ничего нового