Понял задачу, вот как можно оформить точное техническое задание для агента по исследованию вывода средств в UniFarm, с учётом всей цепочки и взаимодействий. Это позволит получить полный и структурированный отчёт без вмешательства в код:

---

# Техническое задание: Глубокое исследование функционала вывода средств (Июнь 2025)

## Цель

Детально проверить и описать работу функционала вывода средств в проекте UniFarm, включая:

* Механизм запроса вывода пользователем через интерфейс
* Проверку корректности расчёта комиссии
* Механизм списания средств с баланса пользователя
* Обработку и хранение заявок на вывод в базе данных
* Взаимодействие с админ Telegram-ботом, получение и обработку заявок
* Корректность учёта транзакций и логирования
* Все точки контроля, исключения и безопасности

---

## Объекты исследования и проверки

### 1. Фронтенд (Кошелек → Раздел Вывод средств)

* Где именно отображается форма вывода средств
* Как пользователь создаёт заявку на вывод (ввод суммы, подтверждение)
* Какая комиссия учитывается (фиксированная или процентная)
* Валидация данных, ограничения минимальных и максимальных сумм

### 2. API / Бэкенд

* Какие эндпоинты отвечают за создание заявки на вывод, проверку баланса и расчёт комиссии
* Логика бизнес-процесса создания заявки на вывод (контроллер, сервис)
* Валидация и защита (JWT, проверка баланса, предотвращение повторных заявок)
* Обновление баланса пользователя (списание суммы с учётом комиссии)
* Создание записи транзакции вывода с правильным статусом
* Возможные ошибки и обработка исключений

### 3. База данных

* Таблицы, связанные с выводом средств:

  * Таблица заявок на вывод (`withdraw_requests` или аналог)
  * Таблица транзакций (`transactions`) с типом `WITHDRAWAL` или аналог
  * Поля для хранения статуса, суммы, комиссии, даты создания и исполнения
* Проверка правильности связей между таблицами и целостности данных

### 4. Telegram Admin Bot

* Как бот получает уведомления о новых заявках (webhook, polling)
* Какие команды и функции админов используются для обработки заявок (`/withdrawals`, `/approve`, `/reject`)
* Логика изменения статуса заявки и взаимодействия с базой данных
* Отслеживание логов действий админов (безопасность и аудит)
* Фиксация операций списания средств с баланса при одобрении заявки
* Обработка отказов и возврат баланса при отклонении заявки

### 5. Взаимодействие и синхронизация

* Как происходит синхронизация данных между фронтендом, сервером и ботом
* Использование WebSocket для обновления балансов и статусов в реальном времени
* Как обеспечивается атомарность транзакций (чтобы не было двойного списания)
* Взаимодействие с внешними платежными системами (если есть)

---

## Формат отчёта от агента

Агент должен предоставить:

* Полный текстовый отчёт с описанием каждого пункта из раздела "Объекты исследования"
* Указание ключевых файлов, классов, методов и таблиц, которые участвуют в процессе
* Анализ текущей готовности к выводу средств — что работает, что требует доработок (без внесения изменений)
* Описание потенциальных рисков или проблемных мест, которые могут повлиять на корректность списаний и безопасности
* Рекомендации для последующих действий, если они необходимы

---

## Важные условия

* Код не менять, только анализировать и документировать
* Использовать существующие системные файлы UniFarm для навигации
* Подчёркивать, что задание — это **исследование и документирование**, а не исправление или добавление функционала

---

Если хочешь, могу помочь сформировать этот запрос в виде промпта для агента — скажи.
