# ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ UniFarm –∫ Production

## üéØ –¶–µ–ª—å:
–£–¥–∞–ª–∏—Ç—å –≤—Å–µ fallback'–∏ (`user_id=43`, `user_id=48`) –∏–∑ backend –∏ frontend, –æ—Å—Ç–∞–≤–∏—Ç—å fallback –¢–û–õ–¨–ö–û –≤ Preview-—Ä–µ–∂–∏–º–µ.  
–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ **–≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Telegram / JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é**.

---

## üîß Backend

### 1. –£–¥–∞–ª–∏—Ç—å fallback'–∏ –Ω–∞uction

## üéØ 
#### üîç –§–∞–π–ª:–π —á–µ–∫-–ª–∏—Å—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫
- [ ] –°—Ç—Ä–æ–∫–∞ 64:
```ts
const userId = req.query.user_id as string || "1"; // ‚ùå –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ª–æ–≥–∏–∫—É

 ‚Ä¢ –°—Ç—Ä–æ–∫–∞ 296:

const userId = (req as any).user?.id–¢–û–õ–¨–ö–û –≤ Preview-—Ä–µ–∂–∏–º–µ.  
–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤req.query.user_id || "43";

 ‚Ä¢ –°—Ç—Ä–æ–∫–∞ 335:

const userId = (req as any).user?.id–µ fallback'–∏ (`user_id=43`, `user_id="43";

‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:

if (!req.user?.id) {
  return res.status(401).json({ error: 'Unauthorized' });
}


‚∏ª

üîç –§–∞–π–ª: server/index.ts
 ‚Ä¢ –°—Ç—Ä–æ–∫–∞ 465:

const userId = req.query.user_id || "43"; // ‚ùå —É–¥–∞–ª–∏—Ç—å

‚úÖ –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:

if (!req.query.user_id) return res.status(400).send('Missing user_id');


‚∏ª

üîç –§–∞–π–ª: modules/dailyBonus/routes.ts
 ‚Ä¢ –°—Ç—Ä–æ–∫–∞ 13:

const userId = req.query.user_id || "43"; // ‚ùå —É–¥–∞–ª–∏—Ç—å

‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π JWT-–ø–∞—Ä—Å–∏–Ω–≥ –∏–ª–∏ middleware-–∑–∞—â–∏—Ç—É.

‚∏ª

üñ•Ô∏è Frontend

2. –û—Å—Ç–∞–≤–∏—Ç—å fallback user_id=48 —Ç–æ–ª—å–∫–æ –¥–ª—è DEV/Preview

üîç –§–∞–π–ª: client/src/contexts/UserContext.tsx
 ‚Ä¢ –°—Ç—Ä–æ–∫–∞ 220:

apiUrl = /api/v2/users/profile?user_id=48; // ‚ùå –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ—Å—Ç—ã–ª—å

‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:

if (window.location.hostname.includes('replit')) {
  apiUrl = '/api/v2/users/profile?user_id=48'; // ‚úÖ –¢–æ–ª—å–∫–æ –≤ Preview
} else {
  apiUrl = '/api/v2/users/profile'; // ‚úÖ –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
}


‚∏ª

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
 ‚Ä¢ BalanceCard, TransactionHistory, TonFarmingStatusCard
 ‚Ä¢ –ü–æ–ª—É—á–∞—é—Ç userId —Ç–æ–ª—å–∫–æ –∏–∑ UserContext
 ‚Ä¢ –ù–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ä—É—á–Ω—ã—Ö –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ–∫

‚∏ª

üõ° Telegram Auth
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: telegramAuth.ts –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç JWT
 ‚Ä¢ –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ‚Üí 401

‚∏ª

üß™ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
 ‚Ä¢ 1. –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram Mini App
 ‚Ä¢ 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ URL –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç ?user_id=...
 ‚Ä¢ 3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ /api/v2/users/profile –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
 ‚Ä¢ 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Wallet, Transactions, Farming, Referrals
 ‚Ä¢ 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ JWT ‚Äî –¥–æ—Å—Ç—É–ø –∑–∞–∫—Ä—ã—Ç (401)

‚∏ª

üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ –í—Å–µ fallback‚Äô–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ production
‚úÖ Preview –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç user_id=48 –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è 100% —á–µ—Ä–µ–∑ Telegram initData + JWT
‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚úÖ Production –æ–∫—Ä—É–∂–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —á–∏—Å—Ç–æ