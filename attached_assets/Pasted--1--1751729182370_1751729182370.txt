–û—Ç–ª–∏—á–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ–º.

‚∏ª

‚úÖ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

‚∏ª

üéØ –¶–µ–ª—å:

–û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram Mini App. –°–µ–π—á–∞—Å —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É Missing user_id, —á—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.

‚∏ª

üìå –ü—Ä–æ–±–ª–µ–º–∞:
 ‚Ä¢ –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ Mini App –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ–π:

[UserContext] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
[correctApiRequest] –û—Ç–≤–µ—Ç: {"error":"Missing user_id"}


 ‚Ä¢ JWT —Ç–æ–∫–µ–Ω –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è.
 ‚Ä¢ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞.

‚∏ª

üß© –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å:
 1. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å telegramAuth.ts, jwt.ts, UserContext.tsx, auth.service.ts
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
 ‚Ä¢ initData –∏–∑ Telegram –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç—Å—è
 ‚Ä¢ user_id –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ JWT
 ‚Ä¢ JWT —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ Authorization –∑–∞–≥–æ–ª–æ–≤–æ–∫
 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Mini App –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
 ‚Ä¢ initData –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —Å —Ñ—Ä–æ–Ω—Ç–∞ (tg.initData)
 ‚Ä¢ –í—ã–∑–æ–≤ /api/v2/auth/telegram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω
 ‚Ä¢ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage –∏–ª–∏ context
 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ middleware
 ‚Ä¢ jwtMiddleware –¥–æ–ª–∂–Ω–∞:
 ‚Ä¢ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
 ‚Ä¢ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 401 Unauthorized –ø—Ä–∏ –æ—à–∏–±–∫–µ
 ‚Ä¢ –ù–ï –¥–æ–ø—É—Å–∫–∞—Ç—å –æ—à–∏–±–∫—É undefined user_id –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ
 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
 ‚Ä¢ –ß–µ—Ä–µ–∑ Telegram ‚Üí –æ—Ç–∫—Ä—ã—Ç—å Mini App ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
 ‚Ä¢ –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ JWT
 ‚Ä¢ –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞:
 ‚Ä¢ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ endpoints (–Ω–∞–ø—Ä–∏–º–µ—Ä, /api/v2/user/me)

‚∏ª

üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
 ‚Ä¢ –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ Mini App:
 ‚Ä¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏–Ω–∏—Ç—Å—è
 ‚Ä¢ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è JWT
 ‚Ä¢ –¥–∞–Ω–Ω—ã–µ user_id, username, wallet_address –¥–æ—Å—Ç—É–ø–Ω—ã
 ‚Ä¢ –ö–æ–Ω—Å–æ–ª—å –ù–ï –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
 ‚Ä¢ Missing user_id
 ‚Ä¢ undefined –≤ UserContext
 ‚Ä¢ jwt malformed

‚∏ª

üìÅ –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã:
 ‚Ä¢ client/src/context/UserContext.tsx
 ‚Ä¢ client/src/services/auth.service.ts
 ‚Ä¢ server/middleware/jwt.ts
 ‚Ä¢ server/modules/auth/controller.ts
 ‚Ä¢ server/modules/auth/service.ts
 ‚Ä¢ core/telegram/verifyInitData.ts
 ‚Ä¢ .env ‚Üí JWT_SECRET (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑ fallback)

‚∏ª

üö´ –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å:
 ‚Ä¢ –ù–µ –º–µ–Ω—è—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
 ‚Ä¢ –ù–µ –º–µ–Ω—è—Ç—å UI
 ‚Ä¢ –ù–µ –º–µ–Ω—è—Ç—å Telegram Bot
 ‚Ä¢ –ù–µ —Ç—Ä–æ–≥–∞—Ç—å –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ –∫—Ä–æ–º–µ auth, user, middleware

‚∏ª

üì¶ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
 ‚Ä¢ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç
 ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Mini App –±–µ–∑ –æ—à–∏–±–æ–∫
 ‚Ä¢ –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ JWT
 ‚Ä¢ –û—Ç—á—ë—Ç: –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–±–ª–µ–º—ã –±—ã–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏ —á—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

‚∏ª