Техническое задание: Оплата Boost-пакетов через TON Connect SDK

Цель:

Настроить корректную оплату Boost-пакетов через внешний TON-кошелёк Tonkeeper с подтверждением транзакции и автоматической активацией буста при успешной оплате.

⸻

1. Создание заявки на оплату

При нажатии на кнопку «Оплатить с TON кошелька»:
 • Создать заявку в базе данных со статусом pending:
 • userId
 • boostId
 • amountTON
 • bonusUNI
 • comment = UniFarmBoost:{userId}:{boostId}
 • status: "pending"
 • timestamp

⸻

2. Интеграция с TON Connect SDK

Интегрировать TON Connect SDK (@tonconnect/sdk) в клиентскую часть.
 • После создания заявки отправить запрос на транзакцию через tonconnect: tonConnectUI.sendTransaction({
  validUntil: <timestamp>,
  messages: [{
    address: "UQBlrUfJMIlAcyYzttyxV2xrrvaHHIKEKeetGZbDoitTRWT8",
    amount: "1000000000", // сумма в nanotons (1 TON = 1e9)
    payload: comment: UniFarmBoost:{userId}:{boostId}
  }]
}) 

 • Важно: TON Connect SDK должен быть подключён к Tonkeeper.
 • Обработать ответ с результатом:
 • txHash
 • status: confirmed | rejected

⸻

3. Подтверждение оплаты и активация буста

После успешной транзакции:
 • Найти заявку по userId и boostId
 • Проверить сумму и комментарий
 • Обновить статус заявки в БД на success
 • Активировать Boost-пакет:
 • Начислить доходность в TON (в зависимости от типа буста)
 • Начислить бонус в UNI на баланс
 • Добавить транзакцию в историю с метаданными:
 • category: "purchase"
 • source: "TON Boost"
 • type: "income" для бонуса и "expense" для TON

⸻

4. UI: Отображение процесса оплаты

Добавить/обновить следующие компоненты:
 • PaymentMethodDialog: выбор между внутренним балансом и TON Connect
 • ExternalPaymentStatus:
 • показывает статус оплаты
 • в случае ошибки предлагает повторить или сменить способ оплаты

⸻

5. Ограничения для Replit

ВАЖНО:
 • Не изменять внутреннюю логику UNI фарминга
 • Не изменять текущий UI компонентов, кроме блока оплаты буста
 • Не переписывать кошелёк или историю транзакций
 • Все изменения — только в рамках логики оплаты через TON Connect SDK
 • Визуально оставить дизайн прежним, только добавить кнопку «Открыть Tonkeeper»

⸻

6. Проверка

Тест-кейс:
 1. Пользователь выбирает Boost 1 (1 TON)
 2. Система генерирует UniFarmBoost:1234:1
 3. Пользователь подтверждает платёж в Tonkeeper
 4. Boost активируется, в историю добавляется транзакция
 5. Баланс UNI +10 000, доходность TON +0.5%/день