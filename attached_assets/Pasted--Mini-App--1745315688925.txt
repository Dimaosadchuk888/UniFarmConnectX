Техническое задание: Полный аудит отображения реферальной ссылки в Mini App

Цель: Найти и устранить причину, по которой реферальная ссылка не отображается внутри Mini App Telegram, несмотря на корректную генерацию ref_code в API.

⸻

Что необходимо проверить:

1. Telegram WebApp инициализация
 • Проверь, работает ли Telegram WebApp внутри Mini App, а не в обычном браузере.
 • Логика window.Telegram.WebApp должна корректно инициализироваться.
 • Проверь, используется ли объект Telegram правильно, и нет ли конфликтов с условиями if (isTelegramAvailable).

2. Формирование ссылки
 • Проверь, что ref_code подставляется в ссылку в формате: https://t.me/UniFarmingBot/app?startapp=ref_КОД 


 • Проверь, не блокируется ли рендеринг ссылки из-за условий, связанных с ошибками Telegram.

3. Telegram ID
 • Убедись, что telegram_id корректно считывается через Telegram WebApp.
 • Проверь TelegramService, который отвечает за telegram_id, и его передачу в компонент ReferralLinkCard.

4. Component: ReferralLinkCard
 • Проверь, что компонент не рендерит заглушку/ошибку, если Telegram WebApp временно недоступен.
 • Проверь, чтобы в любом случае, при наличии ref_code, отображалась ссылка, даже если telegram_id не получен.

5. API
 • Проверь, что при открытии Mini App:
 • /api/me корректно возвращает ref_code
 • Нет CORS-ошибок или сбоев авторизации
 • Проверь, что фронт не блокирует отрисовку ссылки при ref_code !== null.

6. Консольные ошибки
 • Устранить: Telegram object not available
Telegram WebApp не обнаружен (попытка 3/3)
Все попытки инициализации Telegram WebApp исчерпаны 


 • Проверь, на каком этапе приложение решает, что Telegram WebApp недоступен, и почему это влияет на вывод ссылки.

⸻

Что должно быть в итоге:
 • Реферальная ссылка отображается у всех пользователей, кто заходит через Telegram Mini App.
 • Оранжевое предупреждение исчезает, если ref_code получен.
 • Лоадер “Получение ссылки…” корректно работает 1–2 секунды и исчезает.
 • При ошибке Telegram WebApp — но наличии ref_code — ссылка всё равно должна отображаться.