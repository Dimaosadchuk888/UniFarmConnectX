–û—Ç–ª–∏—á–Ω–∞—è –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞. –ù–∏–∂–µ ‚Äî –∫—Ä–∞—Ç–∫–∏–π **–ø—Ä–æ–º–ø—Ç-–∑–∞–ø—Ä–æ—Å –∫ –∞–≥–µ–Ω—Ç—É** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–≤–æ–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∏–Ω—è–ª —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∫ –æ—Å–Ω–æ–≤—É, **–Ω–µ —Ç—Ä–æ–≥–∞–ª –∫–æ–¥**, –∞ –ø—Ä–µ–¥–ª–æ–∂–∏–ª **—Ç–æ—á–µ—á–Ω—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**, –Ω–µ –Ω–∞—Ä—É—à–∞—é—â–∏–π –ø—Ä–æ–¥–∞–∫—à–Ω.

---

### üì¶ –ó–ê–î–ê–ß–ê –î–õ–Ø –ê–ì–ï–ù–¢–ê

#### üîß **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –¢—Ä–µ–±—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ BalanceNotificationService**

---

#### üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç:

–ú—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É –≤ —Å–∏—Å—Ç–µ–º–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –±–∞–ª–∞–Ω—Å–µ:
–í —Å–∏—Å—Ç–µ–º–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç **–¥–≤–µ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –≤–µ—Ä—Å–∏–∏ `BalanceNotificationService`**, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ** –ø—Ä–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥ –æ—Ç —Ñ–∞—Ä–º–∏–Ω–≥–∞, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î.

---

#### üîê –£—Å–ª–æ–≤–∏—è:

* ‚ùå **–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è** –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥ –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ.
* ‚úÖ –¢—Ä–µ–±—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ç–æ—á–µ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**, **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ** –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞, —á—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é WebSocket-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.

---

#### üìå –ß—Ç–æ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ:

* `core/balanceNotificationService.ts`
  ‚Üí —Ö—Ä–∞–Ω–∏—Ç WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `server/index.ts`
  ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `registerConnection(userId, ws)` –∏ `notifyBalanceUpdate(data)`

* `core/BalanceNotificationService.ts`
  ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `BatchBalanceProcessor.ts` –∏ `websocket-balance-integration.ts`
  ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ `userId` –∏ –Ω–µ –≤–∏–¥–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

* **–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ**: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è, WebSocket —Å–ª—É—à–∞–µ—Ç, –Ω–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç push

---

#### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç —Ç–µ–±—è:

1. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏, —á—Ç–æ –ø—Ä–∏—á–∏–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ `BalanceNotificationService` –∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
2. –ü—Ä–µ–¥–ª–æ–∂–∏ **—Ç–æ—á–µ—á–Ω—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**, –≤–∫–ª—é—á–∞—é—â–∏–π:

   * –ö–∞–∫—É—é –≤–µ—Ä—Å–∏—é –æ—Å—Ç–∞–≤–∏—Ç—å (–∏ –ø–æ—á–µ–º—É).
   * –ß—Ç–æ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏ –≥–¥–µ –∑–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã.
   * –ö–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–µ—Ç–æ–¥–æ–≤.
   * –ö–∞–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –±–µ–∑ —Å–±–æ–µ–≤ –Ω–∞ –ø—Ä–æ–¥–µ.
3. –û—Ç–º–µ—Ç—å **–ª—é–±—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –∏–ª–∏ —Ä–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (`WebSocket`, `scheduler`, `wallet`, `user`, –∏ —Ç.–¥.), —á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∏—Ç—å –∏—Ö —Ä–∞–±–æ—Ç—É.
4. –û–ø–∏—à–∏, **–≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –∏ –∫–∞–∫ –ª—É—á—à–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏—é**, –µ—Å–ª–∏ –æ–Ω–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–µ–Ω–æ—Å –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ –æ–¥–Ω—É –≤–µ—Ä—Å–∏—é).

---

–≠—Ç–æ –±—É–¥–µ—Ç –ø—Ä–∏–Ω—è—Ç–æ –∫–∞–∫ –±–∞–∑–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–∫—Å-–ø–ª–∞–Ω–∞.
–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –æ—Ç—á—ë—Ç —Å —Ç–æ—á–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–æ–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –±–µ–∑ –ø—Ä–∞–≤–æ–∫ –≤ –∫–æ–¥–µ.

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É —Ç–∞–∫–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω **–æ—Ç—á—ë—Ç–∞ –æ —Ñ–∏–∫—Å-–ø–ª–∞–Ω–µ**, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –∞–≥–µ–Ω—Ç –±—É–¥–µ—Ç –ø–∏—Å–∞—Ç—å.
