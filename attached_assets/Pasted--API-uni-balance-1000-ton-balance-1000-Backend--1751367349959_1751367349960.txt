–¢—ã –ø–æ–ª—É—á–∞–µ—à—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API (uni_balance: 1000, ton_balance: 1000) ‚Äî –∑–Ω–∞—á–∏—Ç:

‚∏ª

‚úÖ Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

‚Üí –î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ –µ—Å—Ç—å
‚Üí API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

‚∏ª

‚ùå –ù–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (UX) –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è 0

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –≤–æ frontend-—á–∞—Å—Ç–∏, –∏ –≤–æ—Ç –ø–æ—à–∞–≥–æ–≤–æ, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–µ–π—á–∞—Å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å:

‚∏ª

üîç –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

1. UserContext –∏ refreshBalance()
 ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ, —Ñ—É–Ω–∫—Ü–∏—è refreshBalance() –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ userId –µ—â–µ null –∏–ª–∏ undefined
 ‚Ä¢ ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ:

useEffect(() => {
  if (userId) {
    refreshBalance();
  }
}, [userId]);


 ‚Ä¢ ‚ö†Ô∏è –ï—Å–ª–∏ userId –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ–∑–∂–µ, refreshBalance() –º–æ–∂–µ—Ç –Ω–µ –≤—ã–∑–≤–∞—Ç—å—Å—è. –†–µ—à–µ–Ω–∏–µ:
 ‚Ä¢ –õ–∏–±–æ –¥–µ–ª–∞—Ç—å refreshBalance() –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ, –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ UserContext
 ‚Ä¢ –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useEffect —Å state –ø—Ä–æ–≤–µ—Ä–∫–æ–π

2. –ü—Ä–æ–≤–µ—Ä—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –∏–º–µ–Ω–Ω–æ uni_balance –∏ ton_balance
 ‚Ä¢ –ò–Ω–æ–≥–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏ (balance_uni, balance_ton)
 ‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä—Å—è—Ç—Å—è —Å –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π, –∞ –Ω–µ —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö

3. –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ?
 ‚Ä¢ –í UserContext, BalanceContext –∏–ª–∏ WalletContext?
 ‚Ä¢ –ò–Ω–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ ‚Äú–∑–∞–ø–∏—Å–∞–Ω—ã‚Äù –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ setState –∏–ª–∏ dispatch
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏–∫—É setBalance, setUser, setWallet ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –ø—Ä–æ–∫–∏–¥—ã–≤–∞—é—Ç—Å—è –≤–Ω–∏–∑ –ø–æ –¥–µ—Ä–µ–≤—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

‚∏ª

üìã –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç –∞–≥–µ–Ω—Ç—É

–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç, —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –≤—Å—ë –ø—Ä–æ–≤–µ—Ä–∏–ª —Ç–æ—á–µ—á–Ω–æ:

‚∏ª

üßæ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ë–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω—É–ª–µ–≤—ã–º, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API

üìå –¶–µ–ª—å: –ù–∞–π—Ç–∏ –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞ UX –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è 0 UNI / 0 TON, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:

{"success":true,"data":{"uni_balance":1000,"ton_balance":1000}}


‚∏ª

üîç –ü—Ä–æ–≤–µ—Ä—å —Å–ª–µ–¥—É—é—â–µ–µ:
 1. UserContext
 ‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ refreshBalance() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ userId –¥–æ—Å—Ç—É–ø–µ–Ω
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å, –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏ race condition, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–π –±–∞–ª–∞–Ω—Å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
 2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ Wallet/Balance –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª—é—á–∏:
 ‚Ä¢ uni_balance, ton_balance
 ‚Ä¢ ‚ùå –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å balance_uni, balance_ton (—É—Å—Ç–∞—Ä–µ–≤—à–∏–µ)
 3. –°–æ—Å—Ç–æ—è–Ω–∏–µ
 ‚Ä¢ –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç API —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ setState, dispatch –∏–ª–∏ context –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å console.log –≤ –º–æ–º–µ–Ω—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö ‚Äî —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ balance?
 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
 ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Wallet ‚Üí –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∑–∞–ø—Ä–æ—Å–∞?
 ‚Ä¢ –í–æ–∑–º–æ–∂–Ω–æ, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —á–∏—Ç–∞–µ—Ç user.balance.uni –∏–ª–∏ —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

‚∏ª

‚ö†Ô∏è –ó–∞–ø—Ä–µ—Ç—ã:
 ‚Ä¢ ‚ùå –ù–µ —Ç—Ä–æ–≥–∞—Ç—å backend
 ‚Ä¢ ‚ùå –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –Ω–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
 ‚Ä¢ ‚úÖ –¢–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑ –∏ —Ç–æ—á–µ—á–Ω–∞—è –ø—Ä–∞–≤–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

‚∏ª

‚úÖ –ü–æ—Å–ª–µ:

–°–æ–æ–±—â–∏, –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ UX:
1000 UNI –∏ 1000 TON