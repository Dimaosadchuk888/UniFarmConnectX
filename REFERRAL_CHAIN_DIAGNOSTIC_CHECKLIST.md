# –ß–ï–ö-–õ–ò–°–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –†–ï–§–ï–†–ê–õ–¨–ù–û–ô –¶–ï–ü–û–ß–ö–ò

## üéØ –¶–ï–õ–¨
–ù–∞–π—Ç–∏ —Ç–æ—á–∫—É —Ä–∞–∑—Ä—ã–≤–∞ –≤ —Ü–µ–ø–æ—á–∫–µ: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É Referrals

## üìã –ü–õ–ê–ù –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### 1. –¢–û–ß–ö–ò –í–•–û–î–ê
- [ ] **Client-side –æ–±—Ä–∞–±–æ—Ç–∫–∞**: `client/src/App.tsx` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ ref_code –∏–∑ URL/Telegram
- [ ] **Auth endpoint**: `/api/auth/telegram` - –ø–æ–ª—É—á–µ–Ω–∏–µ initData —Å ref_by
- [ ] **Routing**: `server/index.ts` - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è auth –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] **Controller**: `modules/auth/controller.ts` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–ª–µ–≥—Ä–∞–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 2. –°–ï–†–í–ò–°–´ –û–ë–†–ê–ë–û–¢–ö–ò –†–ï–§–ï–†–ê–õ–¨–ù–û–ì–û –ö–û–î–ê
- [ ] **AuthService**: `modules/auth/service.ts`
  - [ ] `authenticateFromTelegram()` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - [ ] `registerDirectFromTelegramUser()` - –ø—Ä—è–º–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  - [ ] `findOrCreateFromTelegram()` - –ø–æ–∏—Å–∫/—Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - [ ] `processReferralInline()` - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π
- [ ] **ReferralService**: `modules/referral/service.ts`
  - [ ] `processReferral()` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - [ ] `generateRefCode()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–æ–≤
- [ ] **UserService**: `modules/user/service.ts`
  - [ ] `createUser()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - [ ] `getOrCreateUserFromTelegram()` - –ø–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ Telegram –¥–∞–Ω–Ω—ã—Ö

### 3. –ë–ê–ó–ê –î–ê–ù–ù–´–• - –û–ü–ï–†–ê–¶–ò–ò –ó–ê–ü–ò–°–ò
- [ ] **Users table**: –ü–æ–ª–µ `referred_by` –¥–æ–ª–∂–Ω–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è
- [ ] **Referrals table**: –î–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å–≤—è–∑—å inviter ‚Üî referred_user
- [ ] **Supabase RLS**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏
- [ ] **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å INTEGER/STRING –¥–ª—è user_id

### 4. –¶–ï–ü–û–ß–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò –î–ê–ù–ù–´–•
- [ ] **URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**: `ref_code`, `refCode`, `ref_by`, `start_param`
- [ ] **Telegram initData**: –ü–µ—Ä–µ–¥–∞—á–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ initData
- [ ] **JWT payload**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ç–æ–∫–µ–Ω–µ
- [ ] **Middleware**: `telegramAuth.ts` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 5. –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –û–®–ò–ë–ö–ò
- [ ] **Auth logs**: –õ–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] **Referral logs**: –õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å–≤—è–∑–µ–π
- [ ] **Database errors**: –û—à–∏–±–∫–∏ Supabase –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] **API response**: –°—Ç–∞—Ç—É—Å—ã —É—Å–ø–µ—Ö–∞/–Ω–µ—É–¥–∞—á–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

### 6. –¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò
- [ ] **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ
- [ ] **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ (–Ω–µ –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–ª—è—Ç—å referred_by)
- [ ] **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –∫–æ–¥**: –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º ref_code
- [ ] **–°–∞–º–æ—Ä–µ—Ñ–µ—Ä–∞–ª**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

## üîç –ú–ï–¢–û–î–´ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò
1. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞** - –∏–∑—É—á–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤** - –ø–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ª–æ–≥–∞—Ö
3. **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è ref_code
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã –ë–î** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü
5. **API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ endpoints –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø
- –ù–ï –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥
- –ù–ï –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö  
- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –¢–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ö–æ–¥–æ–∫