<!DOCTYPE html>
<html>
<head>
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Frontend –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        .error { color: red; }
        .success { color: green; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Frontend –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h1>
    
    <div class="section">
        <h2>üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ Local Storage</h2>
        <div id="localStorage-result" class="result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="section">
        <h2>üóÇÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ Session Storage</h2>
        <div id="sessionStorage-result" class="result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="section">
        <h2>üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ React Query Cache</h2>
        <div id="reactQuery-result" class="result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="section">
        <h2>üåê –ü—Ä—è–º–æ–π API –∑–∞–ø—Ä–æ—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>
        <div id="api-result" class="result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <div class="section">
        <h2>üéØ –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ UI</h2>
        <div id="ui-analysis" class="result">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Local Storage
        function checkLocalStorage() {
            const result = document.getElementById('localStorage-result');
            const keys = Object.keys(localStorage);
            let output = `<strong>–ù–∞–π–¥–µ–Ω–æ ${keys.length} –∫–ª—é—á–µ–π:</strong><br>`;
            
            keys.forEach(key => {
                try {
                    const value = localStorage.getItem(key);
                    if (value && (key.includes('transaction') || key.includes('balance') || key.includes('ton'))) {
                        output += `<div class="warning">üîç ${key}: ${value.substring(0, 200)}${value.length > 200 ? '...' : ''}</div>`;
                    } else {
                        output += `<div>${key}: ${value ? value.substring(0, 50) : 'null'}${value && value.length > 50 ? '...' : ''}</div>`;
                    }
                } catch (e) {
                    output += `<div class="error">‚ùå ${key}: –æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è</div>`;
                }
            });
            
            result.innerHTML = output;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ Session Storage
        function checkSessionStorage() {
            const result = document.getElementById('sessionStorage-result');
            const keys = Object.keys(sessionStorage);
            let output = `<strong>–ù–∞–π–¥–µ–Ω–æ ${keys.length} –∫–ª—é—á–µ–π:</strong><br>`;
            
            keys.forEach(key => {
                try {
                    const value = sessionStorage.getItem(key);
                    if (value && (key.includes('transaction') || key.includes('balance') || key.includes('ton'))) {
                        output += `<div class="warning">üîç ${key}: ${value.substring(0, 200)}${value.length > 200 ? '...' : ''}</div>`;
                    } else {
                        output += `<div>${key}: ${value ? value.substring(0, 50) : 'null'}${value && value.length > 50 ? '...' : ''}</div>`;
                    }
                } catch (e) {
                    output += `<div class="error">‚ùå ${key}: –æ—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è</div>`;
                }
            });
            
            result.innerHTML = output;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ React Query Cache
        function checkReactQueryCache() {
            const result = document.getElementById('reactQuery-result');
            
            // –ü–æ–ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ React Query cache –≤ window –æ–±—ä–µ–∫—Ç–µ
            if (window.__REACT_QUERY_STATE__) {
                result.innerHTML = '<div class="success">‚úÖ React Query state –Ω–∞–π–¥–µ–Ω</div>';
            } else if (window.queryClient) {
                result.innerHTML = '<div class="success">‚úÖ Query Client –Ω–∞–π–¥–µ–Ω</div>';
            } else {
                result.innerHTML = '<div class="warning">‚ö†Ô∏è React Query cache –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ window –æ–±—ä–µ–∫—Ç–µ</div>';
            }
        }
        
        // –ü—Ä—è–º–æ–π API –∑–∞–ø—Ä–æ—Å
        async function checkAPIDirectly() {
            const result = document.getElementById('api-result');
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º JWT —Ç–æ–∫–µ–Ω –∏–∑ localStorage
                const authData = localStorage.getItem('auth');
                let token = null;
                
                if (authData) {
                    try {
                        const parsed = JSON.parse(authData);
                        token = parsed.token;
                    } catch (e) {
                        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–∞—Ä—Å–∏—Ç—å auth –∏–∑ localStorage');
                    }
                }
                
                if (!token) {
                    result.innerHTML = '<div class="error">‚ùå JWT —Ç–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage</div>';
                    return;
                }
                
                // –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                const response = await fetch('/api/v2/wallet/transactions?user_id=184&limit=20', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    result.innerHTML = `<div class="error">‚ùå API –∑–∞–ø—Ä–æ—Å –Ω–µ—É—Å–ø–µ—à–µ–Ω: ${response.status} ${response.statusText}</div>`;
                    return;
                }
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.transactions) {
                    const transactions = data.data.transactions;
                    
                    // –ò—â–µ–º TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    const tonTransactions = transactions.filter(tx => tx.currency === 'TON');
                    const recentTonDeposits = tonTransactions.filter(tx => tx.type === 'DEPOSIT');
                    
                    let output = `<div class="success">‚úÖ API –æ—Ç–≤–µ—Ç–∏–ª —É—Å–ø–µ—à–Ω–æ</div>`;
                    output += `<div><strong>–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:</strong> ${transactions.length}</div>`;
                    output += `<div><strong>TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:</strong> ${tonTransactions.length}</div>`;
                    output += `<div><strong>TON –¥–µ–ø–æ–∑–∏—Ç–æ–≤:</strong> ${recentTonDeposits.length}</div>`;
                    
                    if (recentTonDeposits.length > 0) {
                        output += '<div class="warning">üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ TON –¥–µ–ø–æ–∑–∏—Ç—ã:</div>';
                        recentTonDeposits.forEach((tx, i) => {
                            const time = new Date(tx.created_at).toLocaleString();
                            output += `<div>  ${i + 1}. ${tx.amount} TON –≤ ${time} - ${tx.description}</div>`;
                        });
                    } else {
                        output += '<div class="error">‚ùå TON –¥–µ–ø–æ–∑–∏—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ API –æ—Ç–≤–µ—Ç–µ</div>';
                    }
                    
                    result.innerHTML = output;
                } else {
                    result.innerHTML = `<div class="error">‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API: ${JSON.stringify(data)}</div>`;
                }
                
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞: ${error.message}</div>`;
            }
        }
        
        // –ê–Ω–∞–ª–∏–∑ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function analyzeUI() {
            const result = document.getElementById('ui-analysis');
            let output = '';
            
            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            const transactionElements = document.querySelectorAll('[data-testid*="transaction"], .transaction-item, [class*="transaction"]');
            
            if (transactionElements.length > 0) {
                output += `<div class="success">‚úÖ –ù–∞–π–¥–µ–Ω–æ ${transactionElements.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ DOM</div>`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ TON –¥–∞–Ω–Ω—ã—Ö
                transactionElements.forEach((el, i) => {
                    const text = el.textContent || el.innerText || '';
                    if (text.includes('TON') || text.includes('0.1') || text.includes('0,1')) {
                        output += `<div class="warning">üîç –≠–ª–µ–º–µ–Ω—Ç ${i + 1} —Å–æ–¥–µ—Ä–∂–∏—Ç TON/0.1: ${text.substring(0, 100)}...</div>`;
                    }
                });
            } else {
                output += '<div class="warning">‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ DOM</div>';
            }
            
            // –ò—â–µ–º –ª—é–±—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è 0.1 –∏–ª–∏ TON
            const allElements = document.querySelectorAll('*');
            let tonMentions = 0;
            
            allElements.forEach(el => {
                const text = el.textContent || el.innerText || '';
                if (text.includes('0.1 TON') || text.includes('0,1 TON')) {
                    tonMentions++;
                    if (tonMentions <= 5) { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5
                        output += `<div class="warning">üéØ –ù–∞–π–¥–µ–Ω–æ "0.1 TON" –≤: ${el.tagName} - ${text.substring(0, 100)}...</div>`;
                    }
                }
            });
            
            if (tonMentions > 5) {
                output += `<div>... –∏ –µ—â–µ ${tonMentions - 5} —É–ø–æ–º–∏–Ω–∞–Ω–∏–π 0.1 TON</div>`;
            }
            
            result.innerHTML = output;
        }
        
        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
        window.onload = function() {
            checkLocalStorage();
            checkSessionStorage();
            checkReactQueryCache();
            checkAPIDirectly();
            
            // –ê–Ω–∞–ª–∏–∑ UI —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã React —É—Å–ø–µ–ª –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è
            setTimeout(analyzeUI, 1000);
        };
    </script>
</body>
</html>