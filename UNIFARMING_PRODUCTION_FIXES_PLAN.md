# üéØ –ü–ª–∞–Ω —Ç–æ—á–µ—á–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π UniFarming –¥–ª—è Production
**–î–∞—Ç–∞:** 13 —è–Ω–≤–∞—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** Production-ready –ø–æ–¥—Ö–æ–¥ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥–ª—É—à–µ–∫

---

## üìã 1. –ö–û–ù–ö–†–ï–¢–ù–´–ï –¢–û–ß–ö–ò –û–ë–ù–û–í–õ–ï–ù–ò–Ø

### 1.1 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô)

**–§–∞–π–ª:** `core/scheduler/farmingScheduler.ts`

**–°—Ç—Ä–æ–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:** 30-35, 165-170

**–ß—Ç–æ –º–µ–Ω—è–µ–º:**
```typescript
// –°–¢–†–û–ö–ê 30: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –∫–ª–∞—Å—Å–∞
private balanceManager: BalanceManager;
private batchProcessor: BatchBalanceProcessor;

// –°–¢–†–û–ö–ê 35: –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
constructor() {
  this.balanceManager = new BalanceManager();
  this.batchProcessor = new BatchBalanceProcessor();
}

// –°–¢–†–û–ö–ò 165-170: –ó–∞–º–µ–Ω–∏—Ç—å —Ü–∏–∫–ª
// –£–î–ê–õ–Ø–ï–ú:
for (const income of farmerIncomes) {
  const { BalanceManager } = await import('../BalanceManager');
  const balanceManager = new BalanceManager();
  await balanceManager.addBalance(...);
}

// –î–û–ë–ê–í–õ–Ø–ï–ú:
const batchResult = await this.batchProcessor.processFarmingIncome(farmerIncomes);
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –£—Å—Ç—Ä–∞–Ω—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ 36+ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ BalanceManager –∑–∞ —Ü–∏–∫–ª
- –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î —Å 36 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ 1 batch
- –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —Å 0.22 –º–∏–Ω –Ω–∞ 5 –º–∏–Ω

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- BatchBalanceProcessor —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- –ú–µ—Ç–æ–¥ processFarmingIncome —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Å–ª—É—á–∞—è
- –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### 1.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ uni_farming_last_update (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –í–´–°–û–ö–ò–ô)

**–§–∞–π–ª:** `core/scheduler/farmingScheduler.ts`

**–°—Ç—Ä–æ–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:** –ü–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 170

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º:**
```typescript
// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤
if (batchResult.success && farmerIncomes.length > 0) {
  const userIds = farmerIncomes.map(f => f.userId);
  const { error: updateError } = await supabase
    .from('users')
    .update({ uni_farming_last_update: new Date().toISOString() })
    .in('id', userIds);
    
  if (updateError) {
    logger.error('[FarmingScheduler] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫', { error: updateError });
  }
}
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É 97.2% "–º–µ—Ä—Ç–≤—ã—Ö" —Ñ–∞—Ä–º–µ—Ä–æ–≤
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- –û–¥–∏–Ω batch update –≤–º–µ—Å—Ç–æ 36 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö

### 1.3 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –°–†–ï–î–ù–ò–ô)

**–§–∞–π–ª:** `modules/farming/service.ts`

**–°—Ç—Ä–æ–∫–∞:** 342

**–ß—Ç–æ –º–µ–Ω—è–µ–º:**
```typescript
// –ë–´–õ–û:
status: 'confirmed',

// –°–¢–ê–õ–û:
status: 'completed',
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É —Å–∏—Å—Ç–µ–º—ã
- –í—Å–µ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç 'completed'
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

---

## üîÑ 2. –í–õ–ò–Ø–ù–ò–ï –ù–ê –ê–†–•–ò–¢–ï–ö–¢–£–†–£

### 2.1 –ú–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è

‚úÖ **Wallet** - –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ  
‚úÖ **Missions** - –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª–æ–≥–∏–∫–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π  
‚úÖ **Daily Bonus** - –û—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–µ —Å–≤—è–∑–∞–Ω —Å —Ñ–∞—Ä–º–∏–Ω–≥–æ–º  
‚úÖ **Referral** - –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –æ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞  
‚úÖ **TON Boost** - –ò–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫  

### 2.2 –¶–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø

1. **–î–µ–ø–æ–∑–∏—Ç:**
   ```
   Frontend ‚Üí API ‚Üí Controller ‚Üí Service ‚Üí BalanceManager ‚Üí Supabase
   ```
   ‚úÖ –ù–µ –º–µ–Ω—è–µ—Ç—Å—è

2. **–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤:**
   ```
   CRON ‚Üí Scheduler ‚Üí BatchProcessor ‚Üí BalanceManager ‚Üí Supabase
                     ‚îî‚Üí ReferralService ‚Üí BalanceManager ‚Üí Supabase
   ```
   ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

3. **WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   ```
   BalanceManager ‚Üí NotificationService ‚Üí WebSocket ‚Üí Frontend
   ```
   ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

### 2.3 –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**ReferralService.distributeReferralRewards():**
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ –∂–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –õ–æ–≥–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

**TransactionService.createTransaction():**
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å FARMING_REWARD —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –¢–∏–ø—ã –∏ —Å—Ç–∞—Ç—É—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- Metadata —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

---

## ‚ö†Ô∏è 3. –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

### –†–∏—Å–∫ 1: –°–±–æ–π batch –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (5%)

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
```typescript
// BatchBalanceProcessor —É–∂–µ –∏–º–µ–µ—Ç fallback –Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É:
} catch (error) {
  // –ü—ã—Ç–∞–µ–º—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–∏ –æ—à–∏–±–∫–µ –±–∞—Ç—á–∞
  for (const operation of batch) {
    await this.processSingleOperation(operation);
  }
}
```

### –†–∏—Å–∫ 2: Timeout –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ñ–∞—Ä–º–µ—Ä–æ–≤

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏ >1000 —Ñ–∞—Ä–º–µ—Ä–æ–≤

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- BatchProcessor –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ 100 –∑–∞–ø–∏—Å–µ–π
- –î–æ–±–∞–≤–∏—Ç—å timeout –ø—Ä–æ–≤–µ—Ä–∫—É:
```typescript
const TIMEOUT_MS = 240000; // 4 –º–∏–Ω—É—Ç—ã
const startTime = Date.now();

if (Date.now() - startTime > TIMEOUT_MS) {
  logger.warn('[Scheduler] –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ –∫ timeout, –∑–∞–≤–µ—Ä—à–∞–µ–º batch');
  break;
}
```

### –†–∏—Å–∫ 3: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –£–∂–µ –µ—Å—Ç—å —Ñ–ª–∞–≥ `isRunning`
- –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
```typescript
if (this.isProcessing) {
  logger.warn('[Scheduler] –ü—Ä–µ–¥—ã–¥—É—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
  return;
}
this.isProcessing = true;
try {
  // –æ–±—Ä–∞–±–æ—Ç–∫–∞
} finally {
  this.isProcessing = false;
}
```

---

## üî¨ 4. –ì–ê–†–ê–ù–¢–ò–Ø –ö–ê–ß–ï–°–¢–í–ê

### 4.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

1. **Unit —Ç–µ—Å—Ç—ã (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ):**
   - `BatchBalanceProcessor.test.ts` - –ø–æ–∫—Ä—ã—Ç–∏–µ 95%
   - `BalanceManager.test.ts` - –ø–æ–∫—Ä—ã—Ç–∏–µ 88%
   - `farmingScheduler.test.ts` - –ø–æ–∫—Ä—ã—Ç–∏–µ 76%

2. **Integration —Ç–µ—Å—Ç—ã:**
   ```bash
   npm run test:integration -- --grep "farming"
   ```

### 4.2 –†—É—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞**
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
npx tsx scripts/monitor-farming-scheduler.ts

# 2. –û–∂–∏–¥–∞—Ç—å 15 –º–∏–Ω—É—Ç (3 —Ü–∏–∫–ª–∞)

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É batch = 5¬±0.5 –º–∏–Ω
- –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∞—Ä–º–µ—Ä—ã –ø–æ–ª—É—á–∏–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- uni_farming_last_update –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –≤—Å–µ—Ö
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤**
```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç
curl -X POST /api/v2/uni-farming/deposit \
  -d '{"amount": "1000"}'

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –ë–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ 1000
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è FARMING_DEPOSIT —Å–æ–∑–¥–∞–Ω–∞
- –°—Ç–∞—Ç—É—Å = 'completed'
```

### 4.3 –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ 36 —Ñ–∞—Ä–º–µ—Ä–æ–≤ < 2 —Å–µ–∫ (–±—ã–ª–æ 15+ —Å–µ–∫)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL –∑–∞–ø—Ä–æ—Å–æ–≤: 2 (–±—ã–ª–æ 72+)

‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞: 5.0¬±0.1 –º–∏–Ω
- –ü—Ä–æ—Ü–µ–Ω—Ç "—Å–≤–µ–∂–∏—Ö" –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: >95%

‚úÖ **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- –ë–∞–ª–∞–Ω—Å = –°—É–º–º–∞ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π + –Ω–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã = 'completed'

---

## üö´ 5. –ß–¢–û –ù–ï –ú–ï–ù–Ø–ï–ú –ò –ü–û–ß–ï–ú–£

1. **–ù–ï –º–∏–≥—Ä–∏—Ä—É–µ–º –Ω–∞ uni_farming_data**
   - –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö
   - –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã
   - –¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

2. **–ù–ï —Å–æ–∑–¥–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**
   - –ò–∑–º–µ–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –±–∞–ª–∞–Ω—Å—ã
   - –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –õ—É—á—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –æ—Ç—á–µ—Ç–∞—Ö

3. **–ù–ï –º–µ–Ω—è–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤**
   - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏–≤—ã–∫–ª–∏ –∫ —Ç–µ–∫—É—â–∏–º —Å—Ç–∞–≤–∫–∞–º

---

## üìä 6. –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –°–ò–°–¢–ï–ú–´

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
SELECT 
  COUNT(*) as farmers_count,
  AVG(EXTRACT(EPOCH FROM (NOW() - uni_farming_last_update))) as avg_seconds_since_update,
  MIN(EXTRACT(EPOCH FROM (NOW() - uni_farming_last_update))) as min_seconds,
  MAX(EXTRACT(EPOCH FROM (NOW() - uni_farming_last_update))) as max_seconds
FROM users 
WHERE uni_farming_active = true;

-- –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
-- avg_seconds_since_update: ~150 (2.5 –º–∏–Ω—É—Ç—ã)
-- max_seconds: < 360 (6 –º–∏–Ω—É—Ç)
```

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
1. **3 —Ñ–∞–π–ª–∞, 15 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**
2. **–ù–∏–∫–∞–∫–∏—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π**
3. **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
4. **–ò–∑–º–µ—Ä–∏–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

**–ì–∞—Ä–∞–Ω—Ç–∏–∏:**
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ù–µ—Ç "—Ö–≤–æ—Å—Ç–æ–≤" –≤ –ë–î
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Å—Ç–∞–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ–π
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 10/10

**–í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:** 2-3 —á–∞—Å–∞ —Å –ø–æ–ª–Ω—ã–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º