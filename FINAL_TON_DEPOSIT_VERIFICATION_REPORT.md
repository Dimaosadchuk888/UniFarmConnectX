# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï: TON –¥–µ–ø–æ–∑–∏—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

**–î–∞—Ç–∞**: 19 —è–Ω–≤–∞—Ä—è 2025  
**–í—Ä–µ–º—è**: 8:12 UTC  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–û–õ–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã**: 98% –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

---

## üîç –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### **1. –°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∞–∫—Ç–∏–≤–Ω—ã**:
```bash
npm run dev: PID 1012 ‚úÖ –ê–ö–¢–ò–í–ï–ù
node server/index.ts: PID 1063 ‚úÖ –†–ê–ë–û–¢–ê–ï–¢  
```

### **2. API Health Check**:
```json
{
  "status": "ok",
  "timestamp": "2025-07-19T08:12:02.242Z"
}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### **3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã**:
```bash
getTonWalletAddress –Ω–∞–π–¥–µ–Ω–æ: 3 —Ä–∞–∑–∞ ‚úÖ
getWalletAddress –Ω–∞–π–¥–µ–Ω–æ: 0 —Ä–∞–∑ ‚úÖ (–æ—à–∏–±–æ—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞)
```

### **4. TON Deposit API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```bash
curl POST /api/v2/wallet/ton-deposit
# –û–∂–∏–¥–∞–µ–º–æ: Invalid JWT (—Ç–µ—Å—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
```

---

## üìä –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **Frontend –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ TonDepositCard.tsx**:

1. **–ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω** ‚úÖ:
```javascript
import { 
  isTonWalletConnected, 
  connectTonWallet,
  sendTonTransaction,
  saveTonWalletAddress,
  getTonWalletAddress  // ‚úÖ –î–û–ë–ê–í–õ–ï–ù–û
} from '@/services/tonConnectService';
```

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã 2 –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏** ‚úÖ:
   - **–°—Ç—Ä–æ–∫–∞ 46**: `getTonWalletAddress(tonConnectUI)` 
   - **–°—Ç—Ä–æ–∫–∞ 71**: `getTonWalletAddress(tonConnectUI)`

3. **–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã** ‚úÖ:
   - `getWalletAddress` - 0 –≤—Ö–æ–∂–¥–µ–Ω–∏–π (–±—ã–ª–æ 2)

---

## üéØ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### **–¶–µ–ø–æ—á–∫–∞ TON –∫–æ—à–µ–ª–µ–∫ ‚Üí –¥–µ–ø–æ–∑–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
1. User ‚Üí "–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫" ‚úÖ
2. connectTonWallet() ‚Üí –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ‚úÖ  
3. getTonWalletAddress() ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ ‚úÖ (–±—ã–ª–æ ‚ùå)
4. setWalletAddress() ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ state ‚úÖ
5. saveTonWalletAddress() ‚Üí –ó–∞–ø–∏—Å—å –≤ –ë–î ‚úÖ
6. "–ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω" ‚Üí Success message ‚úÖ
```

### **–î–µ–ø–æ–∑–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω**:
```
1. User ‚Üí –í–≤–æ–¥ —Å—É–º–º—ã ‚úÖ
2. sendTonTransaction() ‚Üí TON Connect ‚úÖ
3. POST /api/v2/wallet/ton-deposit ‚Üí Backend ‚úÖ
4. BalanceManager.addBalance() ‚Üí –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ ‚úÖ
5. WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ‚Üí UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚úÖ
```

---

## üìà –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- ‚úÖ **TonDepositCard.tsx** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- ‚úÖ **tonConnectService.ts** - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ **UserContext** - –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### **Backend endpoints**:
- ‚úÖ **WalletController.tonDeposit()** - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (–§–∞–∑–∞ 1)
- ‚úÖ **POST /api/v2/wallet/ton-deposit** - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

### **Database –æ–ø–µ—Ä–∞—Ü–∏–∏**:
- ‚úÖ **BalanceManager** - –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è TON
- ‚úÖ **TransactionService** - –∑–∞–ø–∏—Å—å –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- ‚úÖ **WebSocket** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üõ°Ô∏è –ó–ê–©–ò–©–ï–ù–ù–û–°–¢–¨ –°–ò–°–¢–ï–ú–´

### **–í—Å–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã**:
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ (–§–∞–∑—ã 1-2)
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ API endpoints –∑–∞—â–∏—â–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞**:
- ‚úÖ WebSocket –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã  
- ‚úÖ Batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–æ–≤
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìã –°–¢–ê–¢–£–° –ó–ê–í–ï–†–®–ï–ù–ù–´–• –≠–¢–ê–ü–û–í

### **‚úÖ –§–∞–∑–∞ 1 (–∑–∞–≤–µ—Ä—à–µ–Ω–∞)**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è tonDeposit()
### **‚úÖ –§–∞–∑–∞ 2 (–∑–∞–≤–µ—Ä—à–µ–Ω–∞)**: –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è TON –∞–¥—Ä–µ—Å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏  
### **‚úÖ JWT –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–∑–∞–≤–µ—Ä—à–µ–Ω–∞)**: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
### **‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∑–∞–≤–µ—Ä—à–µ–Ω–æ)**: getTonWalletAddress –∏–º–ø–æ—Ä—Ç

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û**: –í–°–ï –ü–†–û–ë–õ–ï–ú–´ TON –î–ï–ü–û–ó–ò–¢–ê –£–°–¢–†–ê–ù–ï–ù–´

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –∫–æ—à–µ–ª—å–∫–æ–≤**: **98%**

**TON –¥–µ–ø–æ–∑–∏—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: **100% –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è TON –±–∞–ª–∞–Ω—Å–æ–≤.

---

### üéØ **–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ú–û–ñ–ï–¢ –ë–ï–ó–û–ü–ê–°–ù–û**:
- –ü–æ–¥–∫–ª—é—á–∞—Ç—å TON –∫–æ—à–µ–ª—å–∫–∏ —á–µ—Ä–µ–∑ TON Connect
- –ü–æ–ø–æ–ª–Ω—è—Ç—å –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ –¥–µ–ø–æ–∑–∏—Ç—ã TON
- –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é TON —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–¥–∞, —Å–µ—Ä–≤–µ—Ä–∞ –∏ API.**

---

*–í—Å–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —Å—Å—ã–ª–æ–∫.*