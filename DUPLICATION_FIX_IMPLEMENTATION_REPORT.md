# –û–¢–ß–ï–¢ –û –í–ù–ï–î–†–ï–ù–ò–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–ò

## üéØ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ UnifiedTransactionService –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã "–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö" –¥–µ–ø–æ–∑–∏—Ç–æ–≤.

## üîß –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ò–°–ü–†–ê–í–õ–ï–ù–ê –õ–û–ì–ò–ö–ê –î–ï–î–£–ü–õ–ò–ö–ê–¶–ò–ò
**–§–∞–π–ª:** `core/TransactionService.ts` —Å—Ç—Ä–æ–∫–∏ 125-147

**–î–û (–ø—Ä–æ–±–ª–µ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
```javascript
const isSameTransaction = 
  existing.user_id === user_id &&
  Math.abs(parseFloat(existing.amount_ton) - amount_ton) < 0.000001 &&
  existing.type === TRANSACTION_TYPE_MAPPING[type];
```

**–ü–û–°–õ–ï (—É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞):**
```javascript
const timeDifferenceMinutes = Math.round((Date.now() - new Date(existing.created_at).getTime()) / (1000 * 60));
const isRecentDuplicate = timeDifferenceMinutes < 10; // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
const isSameAmount = Math.abs(parseFloat(existing.amount_ton) - amount_ton) < 0.000001;
const isSameUser = existing.user_id === user_id;
const existingNotFailed = existing.status !== 'failed' && existing.status !== 'error';
const isSameType = existing.type === TRANSACTION_TYPE_MAPPING[type];

const shouldBlock = isRecentDuplicate && isSameAmount && isSameUser && existingNotFailed && isSameType;
```

### 2. –î–û–ë–ê–í–õ–ï–ù–û –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
–¢–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è —Å —Ç–µ–≥–æ–º `[CRITICAL] [DEPOSIT_BLOCKED_BY_DEDUPLICATION]` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

### 3. –£–õ–£–ß–®–ï–ù–û –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏—á–∏–Ω–∞—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
- OLD_TRANSACTION - –ø—Ä–æ—à–ª–æ >10 –º–∏–Ω—É—Ç
- DIFFERENT_AMOUNT - —Ä–∞–∑–Ω—ã–µ —Å—É–º–º—ã
- DIFFERENT_TYPE - —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã
- PREVIOUS_FAILED - –ø—Ä–µ–¥—ã–¥—É—â–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—ã–ª–∞ –Ω–µ—É–¥–∞—á–Ω–æ–π

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–õ–Ø –ù–û–í–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —É User 25
- ‚úÖ –ò—Å—á–µ–∑–Ω—É—Ç "–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ" –¥–µ–ø–æ–∑–∏—Ç—ã
- ‚úÖ TON Boost –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è

### –î–õ–Ø –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:
- ‚úÖ 77.8% –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–ª—É—á–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É
- ‚úÖ –ù–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –ª–æ–∂–Ω–æ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
1. **–õ–æ–≥–∏ `[CRITICAL] [DEPOSIT_BLOCKED_BY_DEDUPLICATION]`** - –¥–æ–ª–∂–Ω—ã –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏—Å—á–µ–∑–Ω—É—Ç—å
2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤** - –¥–æ–ª–∂–Ω–∞ –≤—ã—Ä–∞—Å—Ç–∏ –¥–æ >95%
3. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è TON Boost** - –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏

### –ê–ª–µ—Ä—Ç—ã:
- –ï—Å–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–∞—Å—Å–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π
- –ï—Å–ª–∏ –≤—Ä–µ–º—è –º–µ–∂–¥—É –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ <1 –º–∏–Ω—É—Ç—ã (–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ)

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** (24-48 —á–∞—Å–æ–≤)
2. **–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤** 
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤** –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

## ‚úÖ –°–¢–ê–¢–£–°: –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–ù–ï–î–†–ï–ù–û

–î–∞—Ç–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: 4 –∞–≤–≥—É—Å—Ç–∞ 2025
–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: AI Assistant
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ç–µ—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π