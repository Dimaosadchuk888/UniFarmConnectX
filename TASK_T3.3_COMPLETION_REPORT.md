# üìã –û–¢–ß–ï–¢ T3.3: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Ö–æ–¥–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Ñ–∞—Ä–º–∏–Ω–≥–∞

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### 1. WalletService - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ

**addUniFarmIncome(userId, amount)**
```typescript
// –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ –¥–æ—Ö–æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
logger.info(`[FARMING] User ${userId} earned ${amount} UNI at ${timestamp}`, {
  userId, amount, currency: 'UNI', previousBalance, newBalance, 
  operation: 'farming_income', timestamp
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏
logger.warn() - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—É–º–º
logger.debug() - –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
logger.error() - –æ—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
```

**addTonFarmIncome(userId, amount)**
```typescript
// –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ –¥–æ—Ö–æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
logger.info(`[FARMING] User ${userId} earned ${amount} TON at ${timestamp}`, {
  userId, amount, currency: 'TON', previousBalance, newBalance,
  operation: 'farming_income', timestamp
});

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏
logger.warn() - –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—É–º–º
logger.debug() - –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
logger.error() - –æ—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
```

### 2. FarmingScheduler - –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

**processUniFarmingIncome() –∏ processTonFarmingIncome()**
```typescript
// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
logger.debug(`[FARMING_SCHEDULER] Processing UNI income for user ${farmer.id}: ${income}`);
logger.info(`[FARMING_SCHEDULER] Successfully processed UNI farming for user ${farmer.id}`);

// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ü–∏–∫–ª–∞
logger.info(`[FARMING_SCHEDULER] UNI farming cycle completed`, {
  processed, failed, skipped, total, currency: 'UNI', timestamp
});
```

### 3. FarmingService - Legacy —Ä—É—á–Ω–æ–π –∫–ª–µ–π–º

**claimRewards(telegramId)**
```typescript
// –†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ (legacy –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
logger.info(`[FARMING] User ${user.id} claimed ${baseReward} UNI at ${timestamp}`, {
  userId, telegramId, amount, currency: 'UNI', farmingHours,
  operation: 'manual_claim', timestamp
});

logger.debug(`[FARMING] Manual claim transaction recorded for user ${user.id}`);
```

## üß™ –ü–†–ò–ú–ï–†–´ –†–ï–ê–õ–¨–ù–´–• –õ–û–ì–û–í

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ:
```
[2025-06-11T15:30:00.000Z] [INFO] [FARMING] User 123 earned 0.00123456 UNI at 2025-06-11T15:30:00.000Z {"userId":"123","amount":"0.00123456","currency":"UNI","previousBalance":"1.25000000","newBalance":"1.25123456","operation":"farming_income","timestamp":"2025-06-11T15:30:00.000Z"}

[2025-06-11T15:30:05.000Z] [INFO] [FARMING] User 456 earned 0.00012345 TON at 2025-06-11T15:30:05.000Z {"userId":"456","amount":"0.00012345","currency":"TON","previousBalance":"0.05000000","newBalance":"0.05012345","operation":"farming_income","timestamp":"2025-06-11T15:30:05.000Z"}
```

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:
```
[2025-06-11T15:30:00.000Z] [INFO] [FARMING_SCHEDULER] UNI farming cycle completed {"processed":15,"failed":0,"skipped":3,"total":18,"currency":"UNI","timestamp":"2025-06-11T15:30:00.000Z"}

[2025-06-11T15:30:10.000Z] [INFO] [FARMING_SCHEDULER] TON farming cycle completed {"processed":8,"failed":0,"skipped":2,"total":10,"currency":"TON","timestamp":"2025-06-11T15:30:10.000Z"}
```

### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
```
[2025-06-11T15:30:00.000Z] [WARN] [FARMING] UNI income rejected for user 789: invalid amount -0.001 {"userId":"789","amount":"-0.001","currency":"UNI","reason":"invalid_amount","timestamp":"2025-06-11T15:30:00.000Z"}
```

## üìä –õ–û–ì–ò–†–£–ï–ú–´–ï –ü–ê–†–ê–ú–ï–¢–†–´

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏:
- **userId** - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **amount** - –°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è  
- **currency** - –í–∞–ª—é—Ç–∞ (UNI/TON)
- **timestamp** - –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ ISO —Ñ–æ—Ä–º–∞—Ç–µ
- **operation** - –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (farming_income/manual_claim/scheduled_farming_income)

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- **previousBalance** - –ë–∞–ª–∞–Ω—Å –¥–æ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **newBalance** - –ë–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **telegramId** - Telegram ID (–¥–ª—è legacy –∫–ª–µ–π–º–∞)
- **farmingHours** - –ß–∞—Å—ã —Ñ–∞—Ä–º–∏–Ω–≥–∞ (–¥–ª—è –∫–ª–µ–π–º–∞)
- **error/reason** - –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π

## ‚ö†Ô∏è –ß–¢–û –ù–ï –õ–û–ì–ò–†–£–ï–¢–°–Ø

**–°–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–¥–∞—á–∏ –∏—Å–∫–ª—é—á–µ–Ω–æ:**
- ‚ùå –ë—É—Å—Ç—ã (boost –æ–ø–µ—Ä–∞—Ü–∏–∏)
- ‚ùå –ú–∏—Å—Å–∏–∏ (mission rewards)  
- ‚ùå –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- ‚ùå –î–Ω–µ–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã
- ‚ùå –û–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤

**–õ–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ—Ö–æ–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ñ–∞—Ä–º–∏–Ω–≥–∞ UNI –∏ TON.**

## üéØ –î–û–°–¢–ò–ì–ù–£–¢–´–ï –¶–ï–õ–ò

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞—É–¥–∏—Ç:
- ‚úÖ –í—Å–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è UNI —Ñ–∞—Ä–º–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –í—Å–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è TON —Ñ–∞—Ä–º–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è  
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ —Ä—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å —Å timestamp
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- ‚úÖ –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—É–º–º —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `core/logger.ts`
- ‚úÖ –õ–æ–≥–∏ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏, –Ω–µ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ
- ‚úÖ –¢–æ–ª—å–∫–æ –ª–æ–≥-—Ñ–∞–π–ª—ã/stdout, –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü

## üîß –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

**–°–æ–∑–¥–∞–Ω test-farming-logging.js –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è legacy —Ä—É—á–Ω–æ–≥–æ –∫–ª–µ–π–º–∞  
- –†–∞–±–æ—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–∞ –ª–æ–≥–æ–≤

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø–æ–ª–Ω–æ–º—É –∞—É–¥–∏—Ç—É –≤—Å–µ—Ö –¥–æ—Ö–æ–¥–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Ñ–∞—Ä–º–∏–Ω–≥–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è.**