run = "sh ./start-with-neon.sh"
modules = ["nodejs-20"]

[nix]
channel = "stable-23_05"

[env]
DATABASE_PROVIDER = "neon"
FORCE_NEON_DB = "true"
NODE_ENV = "production"
PORT = "3000"

[deployment]
run = ["sh", "-c", "DATABASE_PROVIDER=neon FORCE_NEON_DB=true NODE_ENV=production PORT=3000 sh ./start-with-neon.sh"]
deploymentTarget = "cloudrun"
ignorePorts = false

[[ports]]
localPort = 3000
externalPort = 80