# üìä –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã telegramAuth.ts

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–†–µ–∑—é–º–µ](#—Ä–µ–∑—é–º–µ)
2. [–ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è telegram.user](#–ø–æ–ª–Ω–∞—è-–∫–∞—Ä—Ç–∞-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è-telegramuser)
3. [–†–µ–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏](#—Ä–µ–∞–ª—å–Ω—ã–µ-—Ç–æ—á–∫–∏-—É—è–∑–≤–∏–º–æ—Å—Ç–∏)
4. [–û—Ü–µ–Ω–∫–∞ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏](#–æ—Ü–µ–Ω–∫–∞-–∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
5. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–±–µ–∑-–∏–∑–º–µ–Ω–µ–Ω–∏—è-–∫–æ–¥–∞)
6. [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](#–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–¥–ª—è-–±–µ–∑–æ–ø–∞—Å–Ω–æ–π-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

---

## üìå –†–µ–∑—é–º–µ

### ‚úÖ –í–µ—Ä–¥–∏–∫—Ç: –°–∏—Å—Ç–µ–º–∞ –ú–û–ñ–ï–¢ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –≤ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ

**–û—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–±—Ö–æ–¥–Ω—ã–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞ –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª
- –¢–µ–∫—É—â–∏–µ —Ä–∏—Å–∫–∏ –ù–ï —è–≤–ª—è—é—Ç—Å—è –≤—ã—Å–æ–∫–æ—Ä–∏—Å–∫–æ–≤—ã–º–∏ –ø—Ä–∏ –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã

---

## üìÅ –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è telegram.user

### üî¥ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å –ü–†–û–ë–õ–ï–ú–û–ô (–∏—Å–ø–æ–ª—å–∑—É—é—Ç telegram.user.id –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

#### 1. **modules/farming/controller.ts**
```typescript
// –°—Ç—Ä–æ–∫–∏ 18-23: –û–®–ò–ë–ö–ê - –ø–µ—Ä–µ–¥–∞—é—Ç database ID –≤–º–µ—Å—Ç–æ telegram_id
const user = await userRepository.getOrCreateUserFromTelegram({
  telegram_id: telegram.user.id,  // ‚ùå –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è database ID (74)
  username: telegram.user.username,
  first_name: telegram.user.first_name
});
```

#### 2. **modules/missions/controller.ts**
```typescript
// –°—Ç—Ä–æ–∫–∏ 18-23: –û–®–ò–ë–ö–ê - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
const user = await userRepository.getOrCreateUserFromTelegram({
  telegram_id: telegram.user.id,  // ‚ùå –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è database ID (74)
  username: telegram.user.username,
  first_name: telegram.user.first_name
});
```

#### 3. **modules/airdrop/controller.ts** (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ)
- –í–µ—Ä–æ—è—Ç–Ω–æ, –∏–º–µ–µ—Ç —Ç—É –∂–µ –ø—Ä–æ–±–ª–µ–º—É –≤ –º–µ—Ç–æ–¥–∞—Ö —Ç—Ä–µ–±—É—é—â–∏—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### üü¢ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:

#### 1. **modules/transactions/controller.ts**
```typescript
// –°—Ç—Ä–æ–∫–∞ 22: ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø–æ–ª—å–∑—É—é—Ç getUserById
const user = await userRepository.getUserById(telegram.user.id);
```

#### 2. **modules/wallet/controller.ts**
```typescript
// –°—Ç—Ä–æ–∫–∞ 123: ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø–æ–ª—å–∑—É—é—Ç telegram_id
const user = await userRepository.getOrCreateUserFromTelegram({
  telegram_id: telegram.user.telegram_id,  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
  username: telegram.user.username,
  first_name: telegram.user.first_name
});
```

#### 3. **modules/dailyBonus/controller.ts**
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø–µ—Ä–µ–¥–∞—é—Ç –≤–µ—Å—å –æ–±—ä–µ–∫—Ç telegram.user
const result = await dailyBonusService.checkAndClaimBonus(telegram.user);
```

### üü° –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –±–µ–∑ –ø—Ä—è–º–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç telegram:

- **modules/boost/controller.ts** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç userId –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **modules/referral/controller.ts** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç userId –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **modules/user/controller.ts** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç telegram_id –∏–∑ JWT payload

---

## ‚ö†Ô∏è –†–µ–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. **getOrCreateUserFromTelegram –≤ farming –∏ missions**
- **–†–∏—Å–∫**: –ü–µ—Ä–µ–¥–∞—á–∞ database ID –≤–º–µ—Å—Ç–æ telegram_id –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–π—Ç–∏/—Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å telegram_id = 74 (database ID)
- **–ö–æ–Ω—Ç—Ä–æ–ª—å**: ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û - —Ñ—É–Ω–∫—Ü–∏—è –∏–º–µ–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
  ```typescript
  async getOrCreateUserFromTelegram(userData: CreateUserData): Promise<User | null> {
    let user = await this.getUserByTelegramId(userData.telegram_id); // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç
    if (!user) {
      user = await this.createUser(userData); // –°–æ–∑–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
    }
    return user;
  }
  ```
- **–†–µ–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç**: –§—É–Ω–∫—Ü–∏—è –ù–ï –Ω–∞–π–¥–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç.–∫. –∏—â–µ—Ç –ø–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É ID) –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ, –Ω–æ –ë–î –≤–µ—Ä–æ—è—Ç–Ω–æ –∏–º–µ–µ—Ç UNIQUE constraint –Ω–∞ telegram_id

### 2. **–ü–µ—Ä–µ–¥–∞—á–∞ telegram_id –≤ —Å–µ—Ä–≤–∏—Å—ã**
- **farming/controller.ts**: —Å—Ç—Ä–æ–∫–∏ 26, 61 - –ø–µ—Ä–µ–¥–∞—é—Ç database ID –≤ –º–µ—Ç–æ–¥—ã –æ–∂–∏–¥–∞—é—â–∏–µ telegram_id
- **missions/controller.ts**: —Å—Ç—Ä–æ–∫–∏ 26, 60, 88 - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### 3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏**
- –í–µ–∑–¥–µ –≥–¥–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è `telegram_id: telegram.user.id` - —ç—Ç–æ database ID
- –£—Å–ª–æ–∂–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

---

## ‚úÖ –û—Ü–µ–Ω–∫–∞ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ú–æ–∂–µ—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ?

**–î–ê, –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏:**

1. **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚úÖ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
   - –ö–æ—à–µ–ª–µ–∫ ‚úÖ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ)
   - Daily Bonus ‚úÖ (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

2. **–ù–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**
   - Farming/Missions –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
   - getOrCreateUserFromTelegram –≤–µ—Ä–æ—è—Ç–Ω–æ –∏–º–µ–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥–æ–ª–≥ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º**
   - –ü—Ä–æ–±–ª–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ middleware
   - –û–±—Ö–æ–¥–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏–∑–≤–µ—Å—Ç–Ω—ã –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

### –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Ç–µ–∫—É—â–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π?

**–î–ê, –µ—Å–ª–∏:**
- –í—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω—ã –æ –ø—Ä–æ–±–ª–µ–º–µ
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞
- Code review –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

### –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –∑–∞–±—É–¥—É—Ç –ø—Ä–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
1. –ü–æ–∫–∞–∑ —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∫ –±—ã–ª–æ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏)
2. –°–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
4. –û—à–∏–±–∫–∏ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∏ –æ—Ç—á–µ—Ç–∞—Ö

**–ù–û**: –≠—Ç–∏ –æ—à–∏–±–∫–∏ –±—ã—Å—Ç—Ä–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

### 1. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö

**–í —Ñ–∞–π–ª–µ core/middleware/telegramAuth.ts –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:**
```typescript
// ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –û–°–û–ë–ï–ù–ù–û–°–¢–¨
// telegram.user.id —Å–æ–¥–µ—Ä–∂–∏—Ç database user ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 74)
// telegram.user.telegram_id —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π Telegram ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 999489)
// 
// –ü–†–ê–í–ò–õ–¨–ù–û–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
// - –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ database ID: getUserById(telegram.user.id)
// - –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ Telegram ID: getUserByTelegramId(telegram.user.telegram_id)
// - –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: { telegram_id: telegram.user.telegram_id }
```

### 2. Helper —Ñ—É–Ω–∫—Ü–∏–∏ –≤ BaseController

**–î–æ–±–∞–≤–∏—Ç—å –≤ core/BaseController.ts:**
```typescript
/**
 * ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å telegram auth
 */
protected getTelegramId(telegram: any): number {
  // –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π Telegram ID
  return telegram.user.telegram_id;
}

protected getDatabaseUserId(telegram: any): number {
  // –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç database user ID
  return telegram.user.id;
}

// –í validateTelegramAuth –¥–æ–±–∞–≤–∏—Ç—å warning:
console.warn(`[${this.constructor.name}] –í–ù–ò–ú–ê–ù–ò–ï: telegram.user.id = database ID, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ telegram.user.telegram_id –¥–ª—è Telegram ID`);
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –≤ README.md —Å–µ–∫—Ü–∏—é

```markdown
## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–í —Å–∏—Å—Ç–µ–º–µ UniFarm –æ–±—ä–µ–∫—Ç `telegram.user` –∏–º–µ–µ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- `telegram.user.id` - —Å–æ–¥–µ—Ä–∂–∏—Ç **database user ID** (–ù–ï telegram_id!)
- `telegram.user.telegram_id` - —Å–æ–¥–µ—Ä–∂–∏—Ç **—Ä–µ–∞–ª—å–Ω—ã–π Telegram ID**

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ database ID
const user = await userRepository.getUserById(telegram.user.id);

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–∏—Å–∫ –ø–æ Telegram ID
const user = await userRepository.getOrCreateUserFromTelegram({
  telegram_id: telegram.user.telegram_id,  // –ù–ï .id!
  username: telegram.user.username
});

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–µ!
const user = await userRepository.getUserByTelegramId(telegram.user.id);
```
```

### 4. –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è Code Review

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `docs/CODE_REVIEW_CHECKLIST.md`:
```markdown
## –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–ü—Ä–∏ review –∫–æ–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º telegram auth –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è Telegram ID (`.telegram_id`, –ù–ï `.id`)
- [ ] –ü—Ä–∏ –≤—ã–∑–æ–≤–µ getUserByTelegramId –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `telegram.user.telegram_id`
- [ ] –ü—Ä–∏ –≤—ã–∑–æ–≤–µ getUserById –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `telegram.user.id`
- [ ] –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `telegram_id: telegram.user.telegram_id`
- [ ] –í –ª–æ–≥–∞—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
```

---

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ TransactionsController:**
```typescript
const telegram = this.validateTelegramAuth(req, res);
if (!telegram) return;

// –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –ø–æ database ID:
const user = await userRepository.getUserById(telegram.user.id);

// –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–∏—Å–∫–∞ –ø–æ Telegram ID:
const user = await userRepository.getOrCreateUserFromTelegram({
  telegram_id: telegram.user.telegram_id,  // ‚ö†Ô∏è –ù–ï .id!
  username: telegram.user.username,
  first_name: telegram.user.first_name
});
```

2. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞–∫–æ–π ID –Ω—É–∂–µ–Ω –º–µ—Ç–æ–¥—É:**
- `getUserById()` - —Ç—Ä–µ–±—É–µ—Ç database ID ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `telegram.user.id`
- `getUserByTelegramId()` - —Ç—Ä–µ–±—É–µ—Ç Telegram ID ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `telegram.user.telegram_id`
- `getOrCreateUserFromTelegram()` - —Ç—Ä–µ–±—É–µ—Ç Telegram ID ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `telegram.user.telegram_id`

3. **–ü—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Ç–∏–ø ID:**
```typescript
logger.info('[Controller] –û–ø–µ—Ä–∞—Ü–∏—è', {
  database_user_id: telegram.user.id,
  telegram_id: telegram.user.telegram_id,
  username: telegram.user.username
});
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ **–∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–∞ –∏ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å** –±–µ–∑ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏:

1. ‚úÖ –í—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å–≤–µ–¥–æ–º–ª–µ–Ω—ã –æ–± –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
2. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Å—Ç–∞
3. ‚úÖ Code review –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π
4. ‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ –∫–æ–ø–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

–†–∏—Å–∫–∏ **–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã** –∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Å—Ä–æ—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

---

## üìä –°–≤–æ–¥–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º telegram.user.id:
1. **farming/controller.ts** - –ø–µ—Ä–µ–¥–∞–µ—Ç database ID –≤–º–µ—Å—Ç–æ telegram_id
2. **missions/controller.ts** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞  
3. **user/controller.ts** (—Å—Ç—Ä–æ–∫–∞ 143) - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç telegramUser.user.id –≤–º–µ—Å—Ç–æ telegram_id

### –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
1. **transactions/controller.ts** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç getUserById() ‚úÖ
2. **wallet/controller.ts** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç telegram.user.telegram_id ‚úÖ
3. **dailyBonus/controller.ts** - –ø–µ—Ä–µ–¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚úÖ

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∏—Å–∫–∏:
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–µ–∑–¥–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è database ID –∫–∞–∫ telegram_id)
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∏—Å–∫–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ farming –∏ missions
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤ –ª–æ–≥–∞—Ö

### –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:
- getOrCreateUserFromTelegram –∏–º–µ–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ‚úÖ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ –∏–º–µ–µ—Ç UNIQUE constraint –Ω–∞ telegram_id ‚úÖ
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∫–æ—à–µ–ª–µ–∫) —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã ‚úÖ