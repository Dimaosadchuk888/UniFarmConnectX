<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Connect Test - Domain Check</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .test-results {
            margin-top: 20px;
        }
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç TON Connect Domain Test</h1>
        
        <div class="info">
            <strong>–¢–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω:</strong> <span id="current-domain"></span>
        </div>
        
        <div class="test-results">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h2>
            <div id="results"></div>
        </div>
        
        <div style="margin-top: 20px;">
            <button onclick="runTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
            <button onclick="clearCache()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
        
        <h3>–†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ URL:</h3>
        <div id="manual-links"></div>
    </div>

    <script>
        const currentDomain = window.location.origin;
        document.getElementById('current-domain').textContent = currentDomain;
        
        const results = document.getElementById('results');
        const manualLinks = document.getElementById('manual-links');
        
        // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
        manualLinks.innerHTML = `
            <p>–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–∏ —Å—Å—ã–ª–∫–∏ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ:</p>
            <ul>
                <li><a href="${currentDomain}/tonconnect-manifest.json" target="_blank">${currentDomain}/tonconnect-manifest.json</a></li>
                <li><a href="${currentDomain}/.well-known/tonconnect-manifest.json" target="_blank">${currentDomain}/.well-known/tonconnect-manifest.json</a></li>
                <li><a href="${currentDomain}/assets/unifarm-icon.svg" target="_blank">${currentDomain}/assets/unifarm-icon.svg</a></li>
            </ul>
        `;
        
        async function runTests() {
            results.innerHTML = '<div class="info">üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞...</div>';
            const testResults = [];
            
            // Test 1: Manifest availability
            try {
                const response = await fetch('/tonconnect-manifest.json');
                const manifest = await response.json();
                
                if (response.ok) {
                    testResults.push({
                        test: '–ú–∞–Ω–∏—Ñ–µ—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω',
                        status: 'success',
                        details: `‚úÖ HTTP ${response.status} - –ú–∞–Ω–∏—Ñ–µ—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ`
                    });
                    
                    // Check domain match
                    if (manifest.url === currentDomain) {
                        testResults.push({
                            test: '–î–æ–º–µ–Ω –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ',
                            status: 'success',
                            details: `‚úÖ –î–æ–º–µ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç: ${manifest.url}`
                        });
                    } else {
                        testResults.push({
                            test: '–î–æ–º–µ–Ω –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ',
                            status: 'error',
                            details: `‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–æ–º–µ–Ω–æ–≤!<br>
                                     –í –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ: ${manifest.url}<br>
                                     –¢–µ–∫—É—â–∏–π: ${currentDomain}`
                        });
                    }
                    
                    // Show manifest content
                    testResults.push({
                        test: '–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞',
                        status: 'info',
                        details: `<pre>${JSON.stringify(manifest, null, 2)}</pre>`
                    });
                } else {
                    testResults.push({
                        test: '–ú–∞–Ω–∏—Ñ–µ—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω',
                        status: 'error',
                        details: `‚ùå HTTP ${response.status} - –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞`
                    });
                }
            } catch (error) {
                testResults.push({
                    test: '–ú–∞–Ω–∏—Ñ–µ—Å—Ç –¥–æ—Å—Ç—É–ø–µ–Ω',
                    status: 'error',
                    details: `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`
                });
            }
            
            // Test 2: Icon availability
            try {
                const iconResponse = await fetch('/assets/unifarm-icon.svg');
                if (iconResponse.ok) {
                    testResults.push({
                        test: '–ò–∫–æ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞',
                        status: 'success',
                        details: `‚úÖ /assets/unifarm-icon.svg - HTTP ${iconResponse.status}`
                    });
                } else {
                    testResults.push({
                        test: '–ò–∫–æ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞',
                        status: 'error',
                        details: `‚ùå /assets/unifarm-icon.svg - HTTP ${iconResponse.status}`
                    });
                }
            } catch (error) {
                testResults.push({
                    test: '–ò–∫–æ–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞',
                    status: 'error',
                    details: `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∫–æ–Ω–∫–∏: ${error.message}`
                });
            }
            
            // Test 3: Alternative manifest path
            try {
                const altResponse = await fetch('/.well-known/tonconnect-manifest.json');
                if (altResponse.ok) {
                    testResults.push({
                        test: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å',
                        status: 'success',
                        details: `‚úÖ /.well-known/tonconnect-manifest.json - HTTP ${altResponse.status}`
                    });
                } else {
                    testResults.push({
                        test: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å',
                        status: 'warning',
                        details: `‚ö†Ô∏è /.well-known/tonconnect-manifest.json - HTTP ${altResponse.status}`
                    });
                }
            } catch (error) {
                testResults.push({
                    test: '–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å',
                    status: 'warning',
                    details: `‚ö†Ô∏è –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`
                });
            }
            
            // Display results
            results.innerHTML = testResults.map(result => {
                const className = result.status === 'success' ? 'success' : 
                                result.status === 'error' ? 'error' : 'info';
                return `
                    <div class="${className}">
                        <strong>${result.test}:</strong><br>
                        ${result.details}
                    </div>
                `;
            }).join('');
        }
        
        function clearCache() {
            // Clear cache and reload
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            
            // Force reload without cache
            window.location.reload(true);
        }
        
        // Run tests on load
        runTests();
    </script>
</body>
</html>