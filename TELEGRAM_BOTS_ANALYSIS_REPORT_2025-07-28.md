# üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú –° TELEGRAM –ë–û–¢–ê–ú–ò

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 28 –∏—é–ª—è 2025, 13:40 UTC  
**–°—Ç–∞—Ç—É—Å**: üìã **–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê**

---

## üö® –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå @UniFarming_Bot –ù–ï –û–¢–í–ï–ß–ê–ï–¢ –ù–ê /START

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**:
- ‚úÖ **–õ–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: `modules/telegram/service.ts:296-298`
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ /start —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**: `handleStartCommand()` –º–µ—Ç–æ–¥ (—Å—Ç—Ä–æ–∫–∏ 314-363)
- ‚úÖ **Webhook controller –≥–æ—Ç–æ–≤**: `modules/telegram/controller.ts:92-118`
- ‚úÖ **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ**: –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å WebApp –∫–Ω–æ–ø–∫–æ–π

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. **Webhook –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**: Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç updates –Ω–∞ –Ω–∞—à webhook
2. **–û—à–∏–±–∫–∏ –≤ processUpdate()**: –ú–µ—Ç–æ–¥ –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–µ
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å sendMessage()**: –û—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç—å –¥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **Bot token –ø—Ä–æ–±–ª–µ–º—ã**: –í–æ–∑–º–æ–∂–Ω–æ –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω

**–ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**: –õ–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

---

### 2. ‚ùå @unifarm_admin_bot –ù–ï –ü–†–ò–ù–ò–ú–ê–ï–¢ –ó–ê–Ø–í–ö–ò

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**:
- ‚úÖ **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**: `isAuthorizedAdmin()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –≥–æ—Ç–æ–≤–∞**: `/admin`, `/start`, `/withdrawals` –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ **Callback buttons —Ä–∞–±–æ—Ç–∞—é—Ç**: Inline keyboard —Å approve/reject
- ‚ö†Ô∏è **LSP –æ—à–∏–±–∫–∞**: `Type 'boolean | null' is not assignable to type 'boolean'` –≤ —Å—Ç—Ä–æ–∫–µ 41

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. **Webhook delivery –ø—Ä–æ–±–ª–µ–º—ã**: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≥–ª–∞–≤–Ω–æ–º—É –±–æ—Ç—É
2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `isAuthorizedAdmin()`
3. **LSP –æ—à–∏–±–∫–∞**: Type error –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å runtime –ø—Ä–æ–±–ª–µ–º—ã
4. **Bot token –ø—Ä–æ–±–ª–µ–º—ã**: Admin bot token –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–º

**AdminBot –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã**: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä handlers —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

---

### 3. ‚ùå –ù–ï–¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–ô –î–õ–Ø –ó–ê–Ø–í–û–ö –ù–ê –í–´–í–û–î

**–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞**:
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è**: `modules/wallet/service.ts:618-630`
- ‚úÖ **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è**: Type 'withdrawal', status 'pending'
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∫–æ–º–∏—Å—Å–∏–∏**: Type 'withdrawal_fee' –¥–ª—è UNI –≤—ã–≤–æ–¥–æ–≤
- ‚úÖ **Admin notification**: –í—ã–∑–æ–≤ `AdminBotService.notifyWithdrawal()`

**–ù–∞–π–¥–µ–Ω–Ω—ã–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**:
```typescript
// –°—Ç—Ä–æ–∫–∏ 619-630
const { error: transactionError } = await supabase
  .from(WALLET_TABLES.TRANSACTIONS)
  .insert({
    user_id: parseInt(userId),
    type: 'withdrawal',
    amount_uni: type === 'UNI' ? withdrawAmount.toString() : '0',
    amount_ton: type === 'TON' ? withdrawAmount.toString() : '0',
    currency: type,
    status: 'pending',
    description: `–í—ã–≤–æ–¥ ${withdrawAmount} ${type}`,
    created_at: new Date().toISOString()
  });
```

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. **–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**: `transactionError` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—à–∏–±–∫—É –ë–î
2. **Silent fail**: –ö–æ–¥ –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
3. **Database constraints**: –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å foreign keys –∏–ª–∏ constraints
4. **Insufficient logging**: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –≤–∏–¥–Ω–∞ –∏–∑-–∑–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### Webhook Status Check:
```
Main Bot: https://uni-farm-connect-unifarm01010101.replit.app/api/v2/telegram/webhook
Admin Bot: https://uni-farm-connect-unifarm01010101.replit.app/api/v2/admin-bot/webhook
```

### LSP Errors Found:
1. **modules/adminBot/service.ts:41**: Type 'boolean | null' ‚Üí 'boolean'
2. **modules/adminBot/controller.ts**: Additional type error

### Critical Code Flows:
1. **Main Bot**: Telegram ‚Üí Webhook ‚Üí TelegramController ‚Üí TelegramService.processUpdate() ‚Üí handleStartCommand()
2. **Admin Bot**: Telegram ‚Üí Webhook ‚Üí AdminBotController.handleUpdate() ‚Üí handleMessage()
3. **Withdrawal**: WalletService.processWithdrawal() ‚Üí supabase.insert(transaction) ‚Üí AdminBotService.notifyWithdrawal()

---

## üéØ –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´ –ü–†–û–ë–õ–ï–ú

### –ì–ª–∞–≤–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ - TELEGRAM DELIVERY ISSUES:
1. **Webhook timeout**: Telegram –º–æ–∂–µ—Ç –Ω–µ –¥–æ–∂–¥–∞—Ç—å—Å—è –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
2. **Rate limiting**: –ë–æ—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã Telegram
3. **Network issues**: –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –º–µ–∂–¥—É Telegram –∏ –Ω–∞—à–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º

### –í—Ç–æ—Ä–∏—á–Ω–∞—è –≥–∏–ø–æ—Ç–µ–∑–∞ - RUNTIME ERRORS:
1. **LSP –æ—à–∏–±–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç exceptions**: Type errors –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
2. **Database connection issues**: Supabase queries –º–æ–≥—É—Ç –ø–∞–¥–∞—Ç—å
3. **Logging –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω**: –û—à–∏–±–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥:
1. **–ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω**: –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **Silent failures**: –û—à–∏–±–∫–∏ –ë–î –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ warnings, –Ω–µ –∫–∞–∫ errors
3. **Transaction isolation**: –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–∑–æ–ª—è—Ü–∏–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –ë–î

---

## üìä –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 - –ò—Å–ø—Ä–∞–≤–∏—Ç—å LSP –æ—à–∏–±–∫–∏:
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å type error –≤ `adminBot/service.ts:41`
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å type issues –≤ `adminBot/controller.ts`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 - –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ webhook handlers
- –£—Å–∏–ª–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –î–æ–±–∞–≤–∏—Ç—å error tracking –¥–ª—è Telegram API calls

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram integration:
- –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å bot tokens –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook URLs –≤ Telegram Bot API
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å direct API calls –∫ Telegram

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4 - Database debugging:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å constraints –≤ —Ç–∞–±–ª–∏—Ü–µ transactions
- –î–æ–±–∞–≤–∏—Ç—å explicit error handling –¥–ª—è DB operations
- –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å foreign key relationships

---

## üöÄ –°–¢–ê–¢–£–° –ì–û–¢–û–í–ù–û–°–¢–ò

### ‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ:
- –õ–æ–≥–∏–∫–∞ –±–æ—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- Webhook endpoints –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É
- –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–µ—Ç–æ–¥—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç

### üîÑ –¢–†–ï–ë–£–ï–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
- LSP type errors (2 —Ñ–∞–π–ª–∞)
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Telegram token configuration
- Silent database errors –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**: –ö–æ–¥ –±–æ—Ç–æ–≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, –ø—Ä–æ–±–ª–µ–º—ã —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ runtime execution –∏–ª–∏ Telegram delivery issues.