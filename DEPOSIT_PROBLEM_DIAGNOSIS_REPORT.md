# –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ô –û–¢–ß–ï–¢: –ü–†–û–ë–õ–ï–ú–ê –° TON –î–ï–ü–û–ó–ò–¢–ê–ú–ò

## –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï –ü–†–û–ë–õ–ï–ú–´
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID 25** —Å–¥–µ–ª–∞–ª –Ω–æ–≤–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ TON, –Ω–æ –¥–µ–ø–æ–∑–∏—Ç –Ω–µ –±—ã–ª –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–ø–∏—Å–∞–ª–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ `balance_ton` –∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Ç–∏–ø–∞ `TON_DEPOSIT`.

## –ö–õ–Æ–ß–ï–í–´–ï –ù–ê–•–û–î–ö–ò

### 1. ‚úÖ –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û
- **–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω**: –ø—Ä–æ—Ü–µ—Å—Å `tsx server/index.ts` –∞–∫—Ç–∏–≤–µ–Ω (PID 9777)
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**: ID 25 (DimaOsadchuk, telegram_id: 425855744)
- **–¢–µ–∫—É—â–∏–µ –±–∞–ª–∞–Ω—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã**: UNI: 82549001.949919, TON: 12.505368
- **–õ–æ–≥–∏–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç**: `processTonDeposit` –º–µ—Ç–æ–¥ –≤ WalletService

### 2. üîç –ù–ê–ô–î–ï–ù–ù–´–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ò –ó–ê –ü–û–°–õ–ï–î–ù–ò–ï 2 –ß–ê–°–ê
- **328 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID 25
- **–¢–∏–ø—ã**: –≤ –æ—Å–Ω–æ–≤–Ω–æ–º REFERRAL_REWARD –∏ FARMING_REWARD
- **–ù–ï–¢ TON_DEPOSIT** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥
- **5 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤ TON –¥–µ–ø–æ–∑–∏—Ç–∞—Ö (–ø—Ä–æ–±–ª–µ–º–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏)

### 3. ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### A. TON API –ù–ï –ù–ê–°–¢–†–û–ï–ù
```
TON_API_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: false
TON_API_URL: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

#### B. –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ë–õ–û–ö–ß–ï–ô–ù –°–ö–ê–ù–ï–†
- –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–ª–æ–∫—á–µ–π–Ω–∞ TON
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- DepositMonitor —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∑–∞–ø—É—â–µ–Ω

#### C. –†–£–ß–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –î–ï–ü–û–ó–ò–¢–û–í
- –ú–µ—Ç–æ–¥ `processTonDeposit` —Ç—Ä–µ–±—É–µ—Ç **—Ä—É—á–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞**
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —É–≤–µ–¥–æ–º–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ –¥–µ–ø–æ–∑–∏—Ç–µ

## –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –û–ë–†–ê–ë–û–¢–ö–ò –î–ï–ü–û–ó–ò–¢–û–í

### –¢–µ–∫—É—â–∏–π –ü—Ä–æ—Ü–µ—Å—Å (–ù–ï –†–ê–ë–û–¢–ê–ï–¢ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò):
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –¥–µ–ø–æ–∑–∏—Ç –≤ –±–ª–æ–∫—á–µ–π–Ω–µ** ‚úÖ
2. **–ë–ª–æ–∫—á–µ–π–Ω —Å–∫–∞–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç** ‚ùå –ù–ï–¢ –°–ö–ê–ù–ï–†–ê
3. **TonAPI –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é** ‚ùå –ù–ï–¢ API KEY
4. **WalletService.processTonDeposit –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è** ‚ùå –ù–ï–¢ –ê–í–¢–û–í–´–ó–û–í–ê
5. **UnifiedTransactionService —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é** ‚ùå –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø
6. **BalanceManager –æ–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–ª–∞–Ω—Å** ‚ùå –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø

### –ï—Å—Ç—å Fallback –ú–µ—Ö–∞–Ω–∏–∑–º:
```typescript
// –í processTonDeposit –º–µ—Ç–æ–¥ –µ—Å—Ç—å fallback
const { processTonDepositWithFallback } = await import('../../utils/tonDepositFallback');
```

## –ü–†–ò–ß–ò–ù–´ –ü–û–ß–ï–ú–£ –î–ï–ü–û–ó–ò–¢ –ù–ï –û–ë–†–ê–ë–û–¢–ê–õ–°–Ø

### 1. **–û–¢–°–£–¢–°–¢–í–£–ï–¢ –ë–õ–û–ö–ß–ï–ô–ù –ú–û–ù–ò–¢–û–†–ò–ù–ì**
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –±–ª–æ–∫—á–µ–π–Ω TON –Ω–∞ –Ω–æ–≤—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- DepositMonitor –Ω–µ –∑–∞–ø—É—â–µ–Ω –≤ production

### 2. **TON API –ù–ï –°–ö–û–ù–§–ò–ì–£–†–ò–†–û–í–ê–ù**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `TON_API_KEY` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ë–µ–∑ API –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
- TonAPI SDK —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### 3. **–°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢ –í –†–ï–ñ–ò–ú–ï "PUSH"**
- –¢—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–µ–ø–æ–∑–∏—Ç–µ
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ "PULL" (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç webhook'–æ–≤ –∏–ª–∏ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞

## –†–ï–®–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú–´

### –ö–†–ê–¢–ö–û–°–†–û–ß–ù–û–ï –†–ï–®–ï–ù–ò–ï (–ú–ê–ù–£–ê–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê):
1. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞ TON
2. –í—ã–∑–≤–∞—Ç—å `WalletService.processTonDeposit` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
   - `user_id: 25`
   - `ton_tx_hash: "hash_—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏"`
   - `amount: —Å—É–º–º–∞_–¥–µ–ø–æ–∑–∏—Ç–∞`
   - `wallet_address: "–∞–¥—Ä–µ—Å_–∫–æ—à–µ–ª—å–∫–∞"`

### –î–û–õ–ì–û–°–†–û–ß–ù–û–ï –†–ï–®–ï–ù–ò–ï (–ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø):
1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å TON API**:
   - –ü–æ–ª—É—á–∏—Ç—å `TON_API_KEY` –æ—Ç https://tonapi.io
   - –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–ª–æ–∫—á–µ–π–Ω —Å–∫–∞–Ω–µ—Ä**:
   - –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å DepositMonitor
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å webhook'–∏**:
   - TON –±–ª–æ–∫—á–µ–π–Ω ‚Üí webhook ‚Üí processTonDeposit

## –§–ê–ô–õ–´ –°–ò–°–¢–ï–ú–´ –î–ï–ü–û–ó–ò–¢–û–í

```
modules/wallet/service.ts     - processTonDeposit –º–µ—Ç–æ–¥
modules/wallet/controller.ts  - REST API endpoints
utils/depositMonitor.ts      - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
utils/tonDepositFallback.ts  - fallback –º–µ—Ö–∞–Ω–∏–∑–º
core/tonApiClient.ts         - TON API –∫–ª–∏–µ–Ω—Ç
```

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:
1. ‚úÖ **–ü–æ–ª—É—á–∏—Ç—å TON_API_KEY** –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. ‚úÖ **–ù–∞–π—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–µ–ø–æ–∑–∏—Ç–∞** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID 25 –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
3. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–µ–ø–æ–∑–∏—Ç –≤—Ä—É—á–Ω—É—é** —á–µ—Ä–µ–∑ `processTonDeposit`

### –°–ò–°–¢–ï–ú–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø:
1. üîß **–ó–∞–ø—É—Å—Ç–∏—Ç—å DepositMonitor** –≤ production
2. üîß **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –±–ª–æ–∫—á–µ–π–Ω–∞
3. üîß **–î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –∞–¥–º–∏–Ω–∞–º –æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–µ–ø–æ–∑–∏—Ç–∞—Ö

## –°–¢–ê–¢–£–° –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò: –ü–†–û–ë–õ–ï–ú–ê –ò–î–ï–ù–¢–ò–§–ò–¶–ò–†–û–í–ê–ù–ê

**–ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–ª–æ–∫—á–µ–π–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TON API.

**–í–õ–ò–Ø–ù–ò–ï**: –í—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥—É—Ç –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

**–ö–†–ò–¢–ò–ß–ù–û–°–¢–¨**: –í–´–°–û–ö–ê–Ø - –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ –¥–µ–ø–æ–∑–∏—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ.

---
*–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: 2025-08-05 12:25 UTC*