# –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç –º–æ–¥—É–ª—è UniFarming

## –î–∞—Ç–∞: 12 —è–Ω–≤–∞—Ä—è 2025
## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ID 74 (telegram_id: 999489)

### 1. –ü–û–õ–ù–ê–Ø –¶–ï–ü–û–ß–ö–ê –†–ê–ë–û–¢–´ UNIFARMING

#### 1.1 UX ‚Üí Backend (–û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–∫–µ—Ç–∞)

**Frontend (UniFarmingCard.tsx):**
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û—Ç–∫—Ä—ã—Ç—å –ø–∞–∫–µ—Ç" –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `handleSubmit`
- –í–∞–ª–∏–¥–∞—Ü–∏—è: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 1 UNI
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ `uniBalance` –∏–∑ UserContext
- –û—Ç–ø—Ä–∞–≤–∫–∞ POST –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ `/api/v2/uni-farming/direct-deposit`
- –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞: `{ amount: string, user_id: number }`

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è endpoint `direct-deposit` –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–±–ª–µ–º —Å BaseController

#### 1.2 Backend –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–∞

**directDepositHandler (modules/farming/directDeposit.ts):**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û user_id –∏–∑ JWT
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ø—ã—Ç–∫—É –¥–µ–ø–æ–∑–∏—Ç–∞ –æ—Ç —á—É–∂–æ–≥–æ –∏–º–µ–Ω–∏
4. –í—ã–∑–æ–≤ `farmingService.depositUniForFarming(userId, amount)`

**farmingService.depositUniForFarming:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (currentBalance >= depositAmount)
3. –°–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `BalanceManager.subtractBalance()`
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ —á–µ—Ä–µ–∑ `UniFarmingRepository.addDeposit()`
5. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ç–∏–ø–∞ `FARMING_DEPOSIT`
6. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `farming_sessions`
7. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ `uni_farming_active = true`

#### 1.3 –î–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ (–¥–ª—è user_id = 74)

**–ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ:**
```
balance_uni: 1491100.122573
uni_farming_active: true
uni_deposit_amount: 427589
uni_farming_rate: 0.01 (1% –≤ –¥–µ–Ω—å)
uni_farming_start_timestamp: 2025-07-11T07:59:13.539
```

**–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:**
- ‚úÖ –î–µ–ø–æ–∑–∏—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω: 427,589 UNI
- ‚úÖ –§–∞—Ä–º–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω —Å 11 –∏—é–ª—è 2025
- ‚úÖ –°—Ç–∞–≤–∫–∞: 1% –≤ –¥–µ–Ω—å (365% –≥–æ–¥–æ–≤—ã—Ö)

### 2. –¶–ï–ü–û–ß–ö–ê –ù–ê–ß–ò–°–õ–ï–ù–ò–ô UNI

#### 2.1 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (FarmingScheduler)

**–ó–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ cron:**
```javascript
cron.schedule('*/5 * * * *', async () => {
  await this.processUniFarmingIncome();
})
```

#### 2.2 –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞—Ä–º–µ—Ä–æ–≤:**
   - –ó–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ `UniFarmingRepository.getActiveFarmers()`
   - –§–∏–ª—å—Ç—Ä: `uni_farming_active = true`

2. **–†–∞—Å—á–µ—Ç –¥–æ—Ö–æ–¥–∞ (calculateUniFarmingIncome):**
   ```javascript
   const daysElapsed = hoursSinceLastUpdate / 24;
   const income = depositAmount * rate * daysElapsed;
   ```
   - –§–æ—Ä–º—É–ª–∞: `–¥–æ—Ö–æ–¥ = –¥–µ–ø–æ–∑–∏—Ç √ó —Å—Ç–∞–≤–∫–∞ √ó –¥–Ω–∏`
   - –°—Ç–∞–≤–∫–∞: 0.01 (1% –≤ –¥–µ–Ω—å)

3. **Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤:**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `BatchBalanceProcessor.processFarmingIncome()`
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ 100 –∑–∞–ø–∏—Å–µ–π

4. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π:**
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Ç–∏–ø–∞ `FARMING_REWARD`
   - –ó–∞–ø–∏—Å—å –≤ `farming_sessions` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `completed`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `uni_farming_last_update`

5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - WebSocket —á–µ—Ä–µ–∑ `BalanceNotificationService.notifyBalanceUpdate()`
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥

### 3. –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ê–õ–ê–ù–°–ê –ò UI

#### 3.1 WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:**
```javascript
balanceService.notifyBalanceUpdate({
  userId: farmer.id,
  balanceUni: newBalance,
  changeAmount: income,
  currency: 'UNI',
  source: 'farming'
})
```

**Frontend –ø–æ–ª—É—á–∞–µ—Ç:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `WebSocketBalanceSync` —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `balance_update` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è UserContext
- UI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è

#### 3.2 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

- React Query —Å `refetchInterval: 15000` (–∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥)
- Endpoint `/api/v2/uni-farming/status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 4. –ü–†–û–í–ï–†–ö–ê –ö–û–†–†–ï–ö–¢–ù–û–°–¢–ò

#### 4.1 –†–∞—Å—á–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 74

```
–î–µ–ø–æ–∑–∏—Ç: 427,589 UNI
–°—Ç–∞–≤–∫–∞: 1% –≤ –¥–µ–Ω—å
–í—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞: ~32 —á–∞—Å–∞ (—Å 11 –∏—é–ª—è 15:59 –¥–æ 12 –∏—é–ª—è 23:59)
–î–Ω–µ–π –ø—Ä–æ—à–ª–æ: 1.33
–û–∂–∏–¥–∞–µ–º—ã–π –¥–æ—Ö–æ–¥: 427,589 √ó 0.01 √ó 1.33 = 5,686.93 UNI
```

#### 4.2 –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **uni_farming_balance –≤—Å–µ–≥–¥–∞ 0:**
   - –≠—Ç–æ –ø–æ–ª–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –î–æ—Ö–æ–¥—ã —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –±–∞–ª–∞–Ω—Å—É

2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã:**
   - –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–ø–æ–∑–∏—Ç—ã
   - –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ `uni_deposit_amount`

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –æ—Ç —á—É–∂–æ–≥–æ –∏–º–µ–Ω–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–µ—Ä–µ–¥ —Å–ø–∏—Å–∞–Ω–∏–µ–º
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BalanceManager –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏

### 5. –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:**
1. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –ë–î
2. –ö–∞–∂–¥—ã–π –ø–∞–∫–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ø—Ä–æ–≤–µ—Ä–∫–∞ JWT)
3. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ—á–Ω–æ (—Å—É–º–º–∞, –≤—Ä–µ–º—è, —Å—Ç–∞–≤–∫–∞)
4. –ù–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
5. –†–∞—Å—á–µ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ: `reward = deposit √ó rate √ó days`
6. –ù–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ UNI —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ –±–∞–ª–∞–Ω—Å—É
7. UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ WebSocket –∏ polling

**‚ö†Ô∏è –ó–∞–º–µ—á–∞–Ω–∏—è:**
1. –ü–æ–ª–µ `uni_farming_balance` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–≤—Å–µ–≥–¥–∞ 0)
2. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
3. –ò—Å—Ç–æ—Ä–∏—è –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ UI (—Ö–æ—Ç—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î)

**üìå –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å real-time –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ–º–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –≤ UI
2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è (5 –º–∏–Ω—É—Ç)

**üéØ –í–´–í–û–î: UniFarming –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!**